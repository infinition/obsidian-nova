{
  "items": [
    {
      "id": "finder",
      "pageIndex": 0,
      "type": "app",
      "title": "Finder",
      "icon": "F",
      "cols": 4,
      "rows": 4,
      "x": 1,
      "y": 1,
      "dockOrder": 0,
      "bgColor": "#3b82f6",
      "appId": "finder"
    },
    {
      "id": "browser",
      "pageIndex": 0,
      "dockOrder": 1,
      "type": "app",
      "title": "Web",
      "icon": "W",
      "cols": 4,
      "rows": 4,
      "x": 5,
      "y": 1,
      "bgColor": "#ffffff",
      "url": "https://obsidian.md"
    },
    {
      "id": "app-youtube",
      "pageIndex": 0,
      "dockOrder": 3,
      "type": "app",
      "title": "YouTube",
      "url": "https://www.youtube.com/embed/jfKfPfyJRdk",
      "icon": "▶️",
      "cols": 4,
      "rows": 4,
      "x": 13,
      "y": 1,
      "bgColor": "#dc2626"
    },
    {
      "id": "widget-btc",
      "pageIndex": 0,
      "type": "widget",
      "title": "Bitcoin Pro",
      "widgetId": "widget-btc",
      "cols": 8,
      "rows": 8,
      "bgColor": "#111827",
      "html": "<div class=\"flex flex-col justify-between h-full p-3 bg-gradient-to-br from-gray-900 to-black text-white relative overflow-hidden\">\n    <div class=\"absolute top-0 right-0 p-2 opacity-10 text-6xl\">₿</div>\n    <div class=\"flex items-center justify-between z-10\">\n        <div class=\"flex items-center gap-2\">\n            <div class=\"bg-yellow-500 w-8 h-8 rounded-full flex items-center justify-center text-lg font-bold shadow-lg shadow-yellow-500/50\">₿</div>\n            <div>\n                <div class=\"text-xs text-gray-400 font-bold\">BITCOIN</div>\n                <div class=\"text-xs text-green-400 flex items-center\">▲ 2.4%</div>\n            </div>\n        </div>\n        <div class=\"text-2xl font-mono font-bold tracking-tighter\" id=\"price\">$96,432</div>\n    </div>\n    <div class=\"w-full h-8 flex items-end gap-1 mt-auto opacity-50\">\n        \n        <div class=\"bg-green-500 w-1/6 h-2 rounded-t\"></div>\n        <div class=\"bg-green-500 w-1/6 h-4 rounded-t\"></div>\n        <div class=\"bg-green-500 w-1/6 h-3 rounded-t\"></div>\n        <div class=\"bg-green-500 w-1/6 h-6 rounded-t\"></div>\n        <div class=\"bg-green-500 w-1/6 h-5 rounded-t\"></div>\n        <div class=\"bg-green-500 w-1/6 h-8 rounded-t animate-pulse\"></div>\n    </div>\n</div>",
      "css": "",
      "js": "const p = container.querySelector('#price');\nconst tick = setInterval(() => {\n    const base = 96000;\n    const rand = Math.floor(Math.random() * 500);\n    p.innerText = '$' + (base + rand).toLocaleString();\n}, 3000);\ncontainer._cleanup = () => clearInterval(tick);",
      "x": 9,
      "y": 33
    },
    {
      "id": "widget-calc",
      "pageIndex": 0,
      "type": "widget",
      "title": "Calculatrice Glass",
      "widgetId": "widget-calc",
      "cols": 8,
      "rows": 12,
      "bgColor": "#1f2937",
      "html": "<div class=\"flex flex-col h-full p-2 bg-gray-800\">\n    <div id=\"disp\" class=\"flex-1 bg-black/40 text-white flex items-center justify-end px-3 rounded mb-2 text-3xl font-light tracking-widest overflow-hidden\">0</div>\n    <div class=\"grid grid-cols-4 gap-2 h-4/5\">\n        <button class=\"btn bg-gray-600\" onclick=\"clr()\">C</button>\n        <button class=\"btn bg-gray-600\" onclick=\"app('/')\">÷</button>\n        <button class=\"btn bg-gray-600\" onclick=\"app('*')\">×</button>\n        <button class=\"btn bg-orange-500\" onclick=\"app('-')\">-</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('7')\">7</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('8')\">8</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('9')\">9</button>\n        <button class=\"btn bg-orange-500\" onclick=\"app('+')\">+</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('4')\">4</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('5')\">5</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('6')\">6</button>\n        <button class=\"btn bg-blue-600 row-span-2\" onclick=\"calc()\">=</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('1')\">1</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('2')\">2</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('3')\">3</button>\n        <button class=\"btn bg-gray-700 col-span-2\" onclick=\"app('0')\">0</button>\n        <button class=\"btn bg-gray-700\" onclick=\"app('.')\">.</button>\n    </div>\n</div>",
      "css": ".btn { border-radius: 8px; color: white; font-weight: bold; transition: all 0.1s; border: 1px solid rgba(255,255,255,0.05); } .btn:active { transform: scale(0.95); filter: brightness(1.2); }",
      "js": "const d = container.querySelector('#disp');\nlet c = '';\ncontainer.querySelectorAll('button').forEach(b => {\n    const t = b.innerText;\n    if(t === '=') b.onclick = () => { try { c = eval(c).toString(); d.innerText = c.substring(0,10); } catch { d.innerText = 'Err'; c=''; } };\n    else if(t === 'C') b.onclick = () => { c = ''; d.innerText = '0'; };\n    else b.onclick = () => { if(d.innerText==='0') c=''; c += (t==='×'?'*':t==='÷'?'/':t); d.innerText = c; };\n});",
      "x": 33,
      "y": 25
    },
    {
      "id": "widget-tictactoe",
      "pageIndex": 0,
      "type": "widget",
      "title": "Morpion Neon",
      "widgetId": "widget-tictactoe",
      "cols": 12,
      "rows": 12,
      "bgColor": "#475569",
      "html": "<div class=\"relative flex flex-col h-full bg-slate-800 p-2\">\n    <div class=\"flex items-center justify-between mb-1\">\n        <span class=\"text-xs text-gray-400 uppercase tracking-widest\">Morpion</span>\n        <button id=\"reset\" class=\"text-[10px] bg-white/10 px-2 py-0.5 rounded text-white hover:bg-white/20 uppercase tracking-widest\">Recommencer</button>\n    </div>\n    <div id=\"status\" class=\"text-[10px] text-slate-300 mb-1\">X commence</div>\n    <div class=\"grid grid-cols-3 gap-1 flex-1\" id=\"grid\"></div>\n    <div id=\"overlay\" class=\"absolute inset-0 hidden items-center justify-center bg-black/70 backdrop-blur-sm\">\n        <div class=\"bg-slate-900/90 border border-white/10 rounded-xl px-4 py-3 text-center shadow-xl\">\n            <div id=\"winner-text\" class=\"text-lg font-bold text-white mb-2\">X a gagne !</div>\n            <button id=\"play-again\" class=\"px-3 py-1 text-[10px] rounded-full bg-white/10 hover:bg-white/20 text-white uppercase tracking-widest\">Recommencer</button>\n        </div>\n    </div>\n</div>",
      "css": "#grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); grid-template-rows: repeat(3, minmax(0, 1fr)); gap: 6px; flex: 1 1 auto; min-height: 0; align-items: stretch; justify-items: stretch; }\n.cell { background: rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 900; line-height: 1; color: white; cursor: pointer; border-radius: 6px; transition: background 0.2s, transform 0.1s; aspect-ratio: 1 / 1; width: 100%; height: 100%; padding: 0; min-width: 0; min-height: 0; overflow: hidden; }\n.cell:hover { background: rgba(255,255,255,0.06); }\n.cell:active { transform: scale(0.98); }\n.cell:disabled { cursor: default; }\n.x-mark { color: #f472b6; text-shadow: 0 0 10px rgba(244,114,182,0.8); }\n.o-mark { color: #38bdf8; text-shadow: 0 0 10px rgba(56,189,248,0.8); }\n.win { background: rgba(34,197,94,0.25); box-shadow: inset 0 0 12px rgba(34,197,94,0.6); }",
      "js": "const g = container.querySelector('#grid');\nconst r = container.querySelector('#reset');\nconst status = container.querySelector('#status');\nconst overlay = container.querySelector('#overlay');\nconst winnerText = container.querySelector('#winner-text');\nconst playAgain = container.querySelector('#play-again');\nconst lines = [\n  [0,1,2],[3,4,5],[6,7,8],\n  [0,3,6],[1,4,7],[2,5,8],\n  [0,4,8],[2,4,6]\n];\nlet board = Array(9).fill(null);\nlet turn = 'X';\nlet isOver = false;\n\nconst updateStatus = () => {\n  if (!status) return;\n  status.innerText = isOver ? 'Partie terminee' : turn + ' a toi';\n};\n\nconst check = () => {\n  for (const line of lines) {\n    const a = line[0], b = line[1], c = line[2];\n    if (board[a] && board[a] === board[b] && board[a] === board[c]) {\n      return { winner: board[a], line };\n    }\n  }\n  if (board.every(Boolean)) return { winner: 'draw' };\n  return null;\n};\n\nconst showOverlay = (text, line) => {\n  if (!overlay || !winnerText) return;\n  winnerText.innerText = text;\n  overlay.classList.remove('hidden');\n  overlay.classList.add('flex');\n  if (line && g) {\n    line.forEach((idx) => {\n      const cell = g.children[idx];\n      if (cell) cell.classList.add('win');\n    });\n  }\n};\n\nconst hideOverlay = () => {\n  if (!overlay) return;\n  overlay.classList.add('hidden');\n  overlay.classList.remove('flex');\n};\n\nconst render = () => {\n  if (!g) return;\n  g.innerHTML = '';\n  board.forEach((val, idx) => {\n    const d = document.createElement('button');\n    d.type = 'button';\n    d.className = 'cell';\n    if (val) {\n      d.innerText = val;\n      d.classList.add(val === 'X' ? 'x-mark' : 'o-mark');\n    }\n    d.disabled = !!val || isOver;\n    d.onclick = () => {\n      if (board[idx] || isOver) return;\n      board[idx] = turn;\n      const result = check();\n      if (result) {\n        isOver = true;\n      } else {\n        turn = turn === 'X' ? 'O' : 'X';\n      }\n      render();\n      if (result) {\n        if (result.winner === 'draw') showOverlay('Match nul ✨');\n        else showOverlay(result.winner + ' a gagne !', result.line);\n      }\n      updateStatus();\n    };\n    g.appendChild(d);\n  });\n};\n\nconst resetGame = () => {\n  board = Array(9).fill(null);\n  turn = 'X';\n  isOver = false;\n  hideOverlay();\n  render();\n  updateStatus();\n};\n\nif (r) r.onclick = resetGame;\nif (playAgain) playAgain.onclick = resetGame;\nrender();\nupdateStatus();",
      "x": 49,
      "y": 5
    },
    {
      "id": "widget-system",
      "pageIndex": 0,
      "type": "widget",
      "title": "Système Cyber",
      "widgetId": "widget-system",
      "cols": 8,
      "rows": 8,
      "bgColor": "#000",
      "html": "<div class=\"flex h-full p-4 gap-4 items-center bg-gray-900 border border-white/10\">\n    \n    <div class=\"flex-1 flex flex-col items-center\">\n        <div class=\"relative w-16 h-16 flex items-center justify-center\">\n             <svg class=\"w-full h-full -rotate-90\" viewBox=\"0 0 36 36\">\n                <path class=\"text-gray-700\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"4\" />\n                <path id=\"cpu-circle\" class=\"text-purple-500 drop-shadow-[0_0_5px_rgba(168,85,247,0.8)]\" stroke-dasharray=\"0, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"4\" />\n            </svg>\n            <span class=\"absolute text-xs font-mono text-purple-300\" id=\"cpu-txt\">0%</span>\n        </div>\n        <span class=\"text-[10px] text-gray-400 mt-1 uppercase\">CPU Load</span>\n    </div>\n    \n    <div class=\"flex-1 flex flex-col justify-center gap-1\">\n        <div class=\"flex justify-between text-[10px] text-cyan-400 font-mono\"><span>RAM</span><span id=\"ram-txt\">0GB</span></div>\n        <div class=\"w-full h-1.5 bg-gray-800 rounded-full overflow-hidden\">\n             <div id=\"ram-bar\" class=\"h-full bg-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.8)] transition-all duration-500\" style=\"width: 0%\"></div>\n        </div>\n        <div class=\"flex justify-between text-[10px] text-pink-400 font-mono mt-1\"><span>GPU</span><span id=\"gpu-txt\">0%</span></div>\n        <div class=\"w-full h-1.5 bg-gray-800 rounded-full overflow-hidden\">\n             <div id=\"gpu-bar\" class=\"h-full bg-pink-500 shadow-[0_0_10px_rgba(236,72,153,0.8)] transition-all duration-500\" style=\"width: 0%\"></div>\n        </div>\n    </div>\n</div>",
      "css": "",
      "js": "const setCircle = (el, percent) => { el.setAttribute('stroke-dasharray', percent + ', 100'); };\nconst r = () => Math.floor(Math.random()*100);\nconst inv = setInterval(() => {\n    const cpu = r(); \n    const ram = Math.floor(Math.random() * 16);\n    const gpu = r();\n    \n    container.querySelector('#cpu-txt').innerText = cpu+'%';\n    setCircle(container.querySelector('#cpu-circle'), cpu);\n\n    container.querySelector('#ram-txt').innerText = ram + 'GB';\n    container.querySelector('#ram-bar').style.width = (ram/32*100)+'%';\n\n    container.querySelector('#gpu-txt').innerText = gpu+'%';\n    container.querySelector('#gpu-bar').style.width = gpu+'%';\n}, 2000);\ncontainer._cleanup = () => clearInterval(inv);",
      "x": 9,
      "y": 41
    },
    {
      "id": "widget-ping",
      "pageIndex": 0,
      "type": "widget",
      "title": "Ping Radar",
      "widgetId": "widget-ping",
      "cols": 8,
      "rows": 8,
      "bgColor": "#064e3b",
      "html": "<div class=\"relative flex flex-col items-center justify-center h-full bg-black overflow-hidden\">\n    \n    <div class=\"absolute inset-0 border border-green-900 rounded-full m-2 opacity-50\"></div>\n    <div class=\"absolute inset-0 border border-green-900 rounded-full m-6 opacity-50\"></div>\n    \n    <div class=\"radar-scan absolute w-full h-full bg-gradient-to-r from-transparent via-green-500/20 to-transparent\"></div>\n    \n    <div class=\"z-10 text-center\">\n        <div class=\"text-3xl font-mono font-bold text-green-400 drop-shadow-[0_0_5px_rgba(74,222,128,0.8)]\" id=\"ping-val\">24</div>\n        <div class=\"text-[10px] text-green-600 uppercase tracking-widest\">LATENCY (MS)</div>\n    </div>\n    <div class=\"absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full animate-ping\"></div>\n</div>",
      "css": ".radar-scan { animation: scan 2s linear infinite; } @keyframes scan { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }",
      "js": "const el = container.querySelector('#ping-val');\nconst inv = setInterval(() => {\n    const ms = 15 + Math.floor(Math.random() * 40);\n    el.innerText = ms;\n    el.style.color = ms > 100 ? '#ef4444' : '#4ade80';\n}, 1000);\ncontainer._cleanup = () => clearInterval(inv);",
      "x": 33,
      "y": 37
    },
    {
      "id": "widget-water-adv",
      "pageIndex": 0,
      "type": "widget",
      "title": "Hydratation Pro",
      "widgetId": "widget-water-adv",
      "cols": 8,
      "rows": 8,
      "bgColor": "#3b82f6",
      "html": "<div class=\"relative flex flex-col h-full bg-blue-900 overflow-hidden group\">\n    \n    <div id=\"water-level\" class=\"absolute bottom-0 w-full bg-blue-500 transition-all duration-700 ease-in-out z-0 opacity-80\" style=\"height: 0%\">\n         <div class=\"absolute top-0 w-full h-4 bg-blue-400 opacity-50 animate-pulse\"></div>\n    </div>\n    \n    \n    <div class=\"relative z-10 flex flex-col items-center justify-between h-full py-4\">\n        <div class=\"text-white font-bold text-xl drop-shadow-md\">Objectif</div>\n        <div class=\"text-4xl font-black text-white drop-shadow-lg\"><span id=\"count\">0</span><span class=\"text-sm opacity-60 font-normal\">/8</span></div>\n        \n        <div class=\"flex gap-2\">\n            <button id=\"minus\" class=\"w-8 h-8 rounded-full bg-black/20 text-white hover:bg-black/40 text-xl flex items-center justify-center transition\">-</button>\n            <button id=\"plus\" class=\"w-8 h-8 rounded-full bg-white text-blue-600 hover:bg-blue-50 shadow-lg text-xl flex items-center justify-center transition transform active:scale-90\">+</button>\n        </div>\n    </div>\n    \n    \n    <div class=\"bubble w-2 h-2 bg-white/20 absolute bottom-0 left-2 rounded-full animate-bounce\" style=\"animation-duration: 2s\"></div>\n    <div class=\"bubble w-3 h-3 bg-white/20 absolute bottom-0 right-4 rounded-full animate-bounce\" style=\"animation-duration: 3s\"></div>\n</div>",
      "css": "",
      "js": "const c = container.querySelector('#count');\nconst w = container.querySelector('#water-level');\nlet val = parseInt(localStorage.getItem('w-water')||'0');\nconst max = 8;\nconst up = () => { \n    c.innerText = val; \n    w.style.height = (val/max * 100) + '%';\n    localStorage.setItem('w-water', val); \n};\ncontainer.querySelector('#plus').onclick = () => { if(val<max) val++; up(); };\ncontainer.querySelector('#minus').onclick = () => { if(val>0) val--; up(); };\nup();",
      "x": 57,
      "y": 29
    },
    {
      "id": "widget-coffee",
      "pageIndex": 0,
      "type": "widget",
      "title": "Compteur Café",
      "widgetId": "widget-coffee",
      "cols": 8,
      "rows": 8,
      "bgColor": "#78350f",
      "html": "<div class=\"flex flex-col items-center justify-center h-full text-[#fef3c7] relative overflow-hidden\">\n    <div class=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/coffee.png')] opacity-10\"></div>\n    <div class=\"z-10 flex flex-col items-center\">\n        <div class=\"text-2xl animate-pulse\">☕</div>\n        <div class=\"text-3xl font-bold my-1\" id=\"coffee-count\">0</div>\n        <button id=\"add-coffee\" class=\"bg-[#92400e] hover:bg-[#b45309] text-white text-xs px-3 py-1 rounded-full uppercase font-bold tracking-wide transition shadow-lg\">+ Drink</button>\n        <div id=\"warning\" class=\"hidden text-[10px] text-red-400 font-bold mt-1 bg-black/50 px-1 rounded\">SLOW DOWN!</div>\n    </div>\n</div>",
      "css": "",
      "js": "const d = container.querySelector('#coffee-count');\nconst btn = container.querySelector('#add-coffee');\nconst warn = container.querySelector('#warning');\nlet count = parseInt(localStorage.getItem('w-coffee')||'0');\n\nconst render = () => {\n    d.innerText = count;\n    warn.classList.toggle('hidden', count <= 5);\n    d.style.color = count > 5 ? '#ef4444' : '#fef3c7';\n    localStorage.setItem('w-coffee', count);\n};\nbtn.onclick = () => { count++; render(); };\n// Reset daily logic could go here\nrender();",
      "x": 57,
      "y": 37
    },
    {
      "id": "widget-kanban",
      "pageIndex": 0,
      "type": "widget",
      "title": "Mini Kanban",
      "widgetId": "widget-kanban",
      "cols": 24,
      "rows": 12,
      "bgColor": "#1e293b",
      "html": "<div class=\"flex h-full gap-2 p-2 overflow-hidden select-none\">\n    \n    <div class=\"flex-1 flex flex-col bg-slate-800 rounded border border-slate-700/50\">\n        <div class=\"p-2 text-xs font-bold text-gray-400 uppercase border-b border-slate-700\">À faire</div>\n        <div class=\"flex-1 p-1 overflow-y-auto space-y-1 kanban-col\" data-status=\"todo\" id=\"col-todo\"></div>\n        <button onclick=\"addTask()\" class=\"p-1 text-center text-xs text-slate-500 hover:text-slate-300\">+ Ajouter</button>\n    </div>\n    \n    <div class=\"flex-1 flex flex-col bg-slate-800 rounded border border-slate-700/50\">\n        <div class=\"p-2 text-xs font-bold text-blue-400 uppercase border-b border-slate-700\">En cours</div>\n        <div class=\"flex-1 p-1 overflow-y-auto space-y-1 kanban-col\" data-status=\"doing\" id=\"col-doing\"></div>\n    </div>\n    \n    <div class=\"flex-1 flex flex-col bg-slate-800 rounded border border-slate-700/50\">\n        <div class=\"p-2 text-xs font-bold text-green-400 uppercase border-b border-slate-700\">Fait</div>\n        <div class=\"flex-1 p-1 overflow-y-auto space-y-1 kanban-col\" data-status=\"done\" id=\"col-done\"></div>\n    </div>\n</div>",
      "css": ".task-card { background: #334155; padding: 6px; border-radius: 4px; font-size: 11px; color: #e2e8f0; cursor: grab; border-left: 3px solid transparent; } .task-card:active { cursor: grabbing; } .task-todo { border-left-color: #94a3b8; } .task-doing { border-left-color: #60a5fa; } .task-done { border-left-color: #4ade80; opacity: 0.6; text-decoration: line-through; }",
      "js": "let tasks = JSON.parse(localStorage.getItem('w-kanban') || '[{\"id\":1, \"txt\":\"Modifier JSON\", \"st\":\"doing\"}]');\nconst render = () => {\n    ['todo','doing','done'].forEach(s => container.querySelector('#col-' + s).innerHTML = '');\n    tasks.forEach(t => {\n        const el = document.createElement('div');\n        el.className = 'task-card task-' + t.st;\n        el.innerText = t.txt;\n        el.draggable = true;\n        el.ondragstart = (e) => { e.dataTransfer.setData('tid', t.id); };\n        // Double click to delete\n        el.ondblclick = () => { if(confirm('Supprimer ?')) { tasks = tasks.filter(x=>x.id!==t.id); save(); } };\n        container.querySelector('#col-' + t.st).appendChild(el);\n    });\n};\nconst save = () => { localStorage.setItem('w-kanban', JSON.stringify(tasks)); render(); };\nwindow.addTask = () => { \n    const t = prompt('Tâche ?'); \n    if(t) { tasks.push({id: Date.now(), txt: t, st: 'todo'}); save(); } \n};\n\n// Drop Logic\ncontainer.querySelectorAll('.kanban-col').forEach(col => {\n    col.ondragover = e => e.preventDefault();\n    col.ondrop = e => {\n        e.preventDefault();\n        const tid = parseInt(e.dataTransfer.getData('tid'));\n        const newSt = col.getAttribute('data-status');\n        const task = tasks.find(t => t.id === tid);\n        if(task && task.st !== newSt) { task.st = newSt; save(); }\n    };\n});\nrender();",
      "x": 9,
      "y": 5
    },
    {
      "id": "widget-ide",
      "pageIndex": 0,
      "type": "widget",
      "title": "Mini IDE",
      "widgetId": "widget-ide",
      "cols": 12,
      "rows": 12,
      "bgColor": "#171717",
      "html": "<div class=\"flex flex-col h-full text-xs font-mono\">\n    <div class=\"flex justify-between items-center bg-[#262626] px-2 py-1 border-b border-white/10\">\n        <span class=\"text-yellow-500\">script.js</span>\n        <button class=\"bg-green-600 hover:bg-green-700 text-white px-2 rounded flex items-center gap-1 transition\" onclick=\"runCode()\">▶ Run</button>\n    </div>\n    <textarea id=\"code\" class=\"flex-1 bg-[#171717] text-gray-300 p-2 outline-none resize-none\" spellcheck=\"false\">// Write JS here\nconst a = 10;\nalert('Result: ' + (a * 2));</textarea>\n    <div id=\"console\" class=\"h-6 bg-black text-gray-500 px-2 flex items-center border-t border-white/10 overflow-hidden whitespace-nowrap\">Console ready.</div>\n</div>",
      "css": "textarea { font-family: 'Fira Code', monospace; line-height: 1.4; }",
      "js": "const ta = container.querySelector('#code');\nconst cons = container.querySelector('#console');\n// Load saved\nta.value = localStorage.getItem('w-ide') || ta.value;\nta.addEventListener('input', () => localStorage.setItem('w-ide', ta.value));\n\nwindow.runCode = () => {\n    try {\n        // Capture console.log roughly\n        const oldLog = console.log;\n        console.log = (msg) => { cons.innerText = '> ' + msg; oldLog(msg); setTimeout(()=>console.log=oldLog, 100); };\n        eval(ta.value);\n        cons.style.color = '#4ade80';\n    } catch (e) {\n        cons.innerText = 'Err: ' + e.message;\n        cons.style.color = '#ef4444';\n    }\n};",
      "x": 17,
      "y": 29
    },
    {
      "id": "widget-2048",
      "type": "widget",
      "title": "2048",
      "widgetId": "game-2048",
      "cols": 8,
      "rows": 8,
      "bgColor": "#0f172a",
      "html": "<div class=\"g2048\">\n      <div class=\"g2048-head\">\n        <div class=\"g2048-title\">2048</div>\n        <div id=\"g2048-score\" class=\"g2048-score\">0</div>\n        <button id=\"g2048-new\" class=\"g2048-new\">Nouveau</button>\n      </div>\n      <div id=\"g2048-grid\" class=\"g2048-grid\"></div>\n      <div id=\"g2048-msg\" class=\"g2048-msg\">Utilise les fleches</div>\n    </div>",
      "css": ".g2048 { height: 100%; padding: 10px; color: #e2e8f0; border-radius: 14px; background: radial-gradient(circle at top, rgba(251,191,36,0.15), transparent 60%), linear-gradient(135deg, #0f172a, #111827 60%); border: 1px solid rgba(255,255,255,0.08); display: flex; flex-direction: column; gap: 6px; }\n.g2048-head { display: grid; grid-template-columns: 1fr auto auto; gap: 6px; align-items: center; }\n.g2048-title { font-size: 12px; letter-spacing: 0.25em; text-transform: uppercase; color: #fde68a; font-weight: 800; }\n.g2048-score { font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 999px; }\n.g2048-new { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: #fff; padding: 2px 8px; border-radius: 999px; cursor: pointer; }\n.g2048-grid { flex: 1; background: rgba(15,23,42,0.6); border-radius: 10px; padding: 6px; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); grid-template-rows: repeat(4, minmax(0, 1fr)); gap: 6px; }\n.g2048-tile { border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; color: #0f172a; background: rgba(255,255,255,0.08); transition: transform 0.15s, background 0.2s; }\n.g2048-tile[data-val=\"0\"] { background: rgba(255,255,255,0.05); color: transparent; }\n.g2048-tile[data-val=\"2\"] { background: #fef3c7; }\n.g2048-tile[data-val=\"4\"] { background: #fde68a; }\n.g2048-tile[data-val=\"8\"] { background: #fdba74; }\n.g2048-tile[data-val=\"16\"] { background: #fb923c; color: #fff; }\n.g2048-tile[data-val=\"32\"] { background: #f97316; color: #fff; }\n.g2048-tile[data-val=\"64\"] { background: #ea580c; color: #fff; }\n.g2048-tile[data-val=\"128\"] { background: #facc15; }\n.g2048-tile[data-val=\"256\"] { background: #eab308; }\n.g2048-tile[data-val=\"512\"] { background: #84cc16; color: #0f172a; }\n.g2048-tile[data-val=\"1024\"] { background: #22c55e; color: #0f172a; }\n.g2048-tile[data-val=\"2048\"] { background: #38bdf8; color: #0f172a; }\n.g2048-msg { font-size: 10px; text-align: center; color: #cbd5f5; }",
      "js": "const gridEl = container.querySelector('#g2048-grid');\nconst scoreEl = container.querySelector('#g2048-score');\nconst msgEl = container.querySelector('#g2048-msg');\nconst newBtn = container.querySelector('#g2048-new');\nconst root = container.querySelector('.g2048');\nconst size = 4;\nlet grid = Array.from({ length: size }, () => Array(size).fill(0));\nlet score = 0;\nlet locked = false;\n\nconst setMsg = (text) => { if (msgEl) msgEl.innerText = text; };\nconst setScore = (val) => { if (scoreEl) scoreEl.innerText = String(val); };\n\nconst addRandom = () => {\n  const empties = [];\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      if (grid[r][c] === 0) empties.push([r, c]);\n    }\n  }\n  if (empties.length === 0) return false;\n  const pick = empties[Math.floor(Math.random() * empties.length)];\n  grid[pick[0]][pick[1]] = Math.random() < 0.9 ? 2 : 4;\n  return true;\n};\n\nconst slideLine = (line) => {\n  const arr = line.filter((v) => v !== 0);\n  let gained = 0;\n  for (let i = 0; i < arr.length - 1; i++) {\n    if (arr[i] === arr[i + 1]) {\n      arr[i] *= 2;\n      gained += arr[i];\n      arr.splice(i + 1, 1);\n    }\n  }\n  while (arr.length < size) arr.push(0);\n  const changed = arr.some((v, i) => v !== line[i]);\n  return { line: arr, gained, changed };\n};\n\nconst move = (dir) => {\n  if (locked) return;\n  let moved = false;\n  let gained = 0;\n  if (dir === 'left' || dir === 'right') {\n    for (let r = 0; r < size; r++) {\n      const original = grid[r].slice();\n      const line = dir === 'left' ? original : original.slice().reverse();\n      const result = slideLine(line);\n      const next = dir === 'left' ? result.line : result.line.slice().reverse();\n      grid[r] = next;\n      moved = moved || result.changed;\n      gained += result.gained;\n    }\n  } else {\n    for (let c = 0; c < size; c++) {\n      const original = grid.map((row) => row[c]);\n      const line = dir === 'up' ? original : original.slice().reverse();\n      const result = slideLine(line);\n      const next = dir === 'up' ? result.line : result.line.slice().reverse();\n      for (let r = 0; r < size; r++) grid[r][c] = next[r];\n      moved = moved || result.changed;\n      gained += result.gained;\n    }\n  }\n  if (moved) {\n    score += gained;\n    setScore(score);\n    addRandom();\n    render();\n    checkState();\n  }\n};\n\nconst hasMoves = () => {\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      if (grid[r][c] === 0) return true;\n      if (r < size - 1 && grid[r][c] === grid[r + 1][c]) return true;\n      if (c < size - 1 && grid[r][c] === grid[r][c + 1]) return true;\n    }\n  }\n  return false;\n};\n\nconst checkState = () => {\n  const won = grid.some((row) => row.includes(2048));\n  if (won) setMsg('Bravo, 2048 !');\n  else if (!hasMoves()) setMsg('Perdu. Nouveau ?');\n  else setMsg('Utilise les fleches');\n};\n\nconst render = () => {\n  if (!gridEl) return;\n  gridEl.innerHTML = '';\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      const val = grid[r][c];\n      const tile = document.createElement('div');\n      tile.className = 'g2048-tile';\n      tile.dataset.val = String(val);\n      tile.innerText = val === 0 ? '' : String(val);\n      gridEl.appendChild(tile);\n    }\n  }\n};\n\nconst reset = () => {\n  grid = Array.from({ length: size }, () => Array(size).fill(0));\n  score = 0;\n  setScore(score);\n  addRandom();\n  addRandom();\n  render();\n  checkState();\n};\n\nconst onKey = (event) => {\n  const key = event.key;\n  if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(key)) {\n    event.preventDefault();\n    if (key === 'ArrowLeft') move('left');\n    if (key === 'ArrowRight') move('right');\n    if (key === 'ArrowUp') move('up');\n    if (key === 'ArrowDown') move('down');\n  }\n};\n\nlet touchStart = null;\nconst onTouchStart = (event) => {\n  if (!event.touches || event.touches.length === 0) return;\n  const touch = event.touches[0];\n  touchStart = { x: touch.clientX, y: touch.clientY };\n};\nconst onTouchEnd = (event) => {\n  if (!touchStart || !event.changedTouches || event.changedTouches.length === 0) return;\n  const touch = event.changedTouches[0];\n  const dx = touch.clientX - touchStart.x;\n  const dy = touch.clientY - touchStart.y;\n  const absX = Math.abs(dx);\n  const absY = Math.abs(dy);\n  if (Math.max(absX, absY) < 20) return;\n  if (absX > absY) move(dx > 0 ? 'right' : 'left');\n  else move(dy > 0 ? 'down' : 'up');\n  touchStart = null;\n};\n\nif (root) {\n  root.tabIndex = 0;\n  root.addEventListener('pointerdown', () => root.focus());\n  root.addEventListener('keydown', onKey);\n  root.addEventListener('touchstart', onTouchStart, { passive: true });\n  root.addEventListener('touchend', onTouchEnd, { passive: true });\n}\nif (newBtn) newBtn.onclick = reset;\nreset();\ncontainer._cleanup = () => {\n  if (root) root.removeEventListener('keydown', onKey);\n  if (root) root.removeEventListener('touchstart', onTouchStart);\n  if (root) root.removeEventListener('touchend', onTouchEnd);\n};",
      "x": 33,
      "y": 45,
      "pageIndex": 0
    },
    {
      "id": "widget-chifoumi",
      "type": "widget",
      "title": "Chifoumi",
      "widgetId": "chifoumi",
      "cols": 8,
      "rows": 8,
      "bgColor": "#111827",
      "html": "<div class=\"rps-root\">\n      <div class=\"rps-head\">\n        <div class=\"rps-title\">Chifoumi</div>\n        <div id=\"rps-score\" class=\"rps-score\">0 - 0</div>\n      </div>\n      <div class=\"rps-arena\">\n        <div class=\"rps-side\">\n          <div class=\"rps-label\">Toi</div>\n          <div id=\"rps-you\" class=\"rps-hand\">✊</div>\n        </div>\n        <div class=\"rps-vs\">VS</div>\n        <div class=\"rps-side\">\n          <div class=\"rps-label\">CPU</div>\n          <div id=\"rps-cpu\" class=\"rps-hand\">✊</div>\n        </div>\n      </div>\n      <div id=\"rps-msg\" class=\"rps-msg\">Choisis ton coup</div>\n      <div class=\"rps-actions\">\n        <button class=\"rps-btn\" data-move=\"rock\">✊</button>\n        <button class=\"rps-btn\" data-move=\"paper\">✋</button>\n        <button class=\"rps-btn\" data-move=\"scissors\">✌️</button>\n      </div>\n    </div>",
      "css": ".rps-root { height: 100%; padding: 10px; color: #e2e8f0; border-radius: 14px; background: radial-gradient(circle at top, rgba(59,130,246,0.2), transparent 60%), linear-gradient(135deg, #0f172a, #111827 60%); border: 1px solid rgba(255,255,255,0.06); display: flex; flex-direction: column; gap: 6px; }\n.rps-head { display: flex; align-items: center; justify-content: space-between; }\n.rps-title { font-size: 12px; letter-spacing: 0.2em; text-transform: uppercase; color: #93c5fd; font-weight: 700; }\n.rps-score { font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 999px; }\n.rps-arena { flex: 1; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 8px; }\n.rps-side { text-align: center; }\n.rps-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.12em; color: #94a3b8; }\n.rps-hand { font-size: 30px; filter: drop-shadow(0 6px 12px rgba(0,0,0,0.4)); transition: transform 0.2s; }\n.rps-vs { font-size: 10px; letter-spacing: 0.4em; color: #64748b; }\n.rps-msg { font-size: 10px; text-align: center; color: #e2e8f0; }\n.rps-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }\n.rps-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); color: #fff; border-radius: 10px; padding: 6px 0; font-size: 18px; cursor: pointer; transition: transform 0.1s, background 0.2s, box-shadow 0.2s; }\n.rps-btn:hover { background: rgba(59,130,246,0.3); box-shadow: 0 0 12px rgba(59,130,246,0.35); }\n.rps-btn:active { transform: scale(0.95) rotate(-2deg); }\n.rps-pop { animation: rps-pop 0.25s ease; }\n@keyframes rps-pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }",
      "js": "const you = container.querySelector('#rps-you');\nconst cpu = container.querySelector('#rps-cpu');\nconst msg = container.querySelector('#rps-msg');\nconst score = container.querySelector('#rps-score');\nconst icons = { rock: '✊', paper: '✋', scissors: '✌️' };\nconst moves = ['rock', 'paper', 'scissors'];\nlet youScore = 0;\nlet cpuScore = 0;\n\nconst decide = (a, b) => {\n  if (a === b) return 'draw';\n  if ((a === 'rock' && b === 'scissors') || (a === 'paper' && b === 'rock') || (a === 'scissors' && b === 'paper')) {\n    return 'win';\n  }\n  return 'lose';\n};\n\nconst pop = (el) => {\n  if (!el) return;\n  el.classList.remove('rps-pop');\n  void el.offsetWidth;\n  el.classList.add('rps-pop');\n};\n\ncontainer.querySelectorAll('.rps-btn').forEach((btn) => {\n  btn.onclick = () => {\n    const choice = btn.getAttribute('data-move');\n    if (!choice) return;\n    const cpuChoice = moves[Math.floor(Math.random() * moves.length)];\n    if (you) you.innerText = icons[choice];\n    if (cpu) cpu.innerText = icons[cpuChoice];\n    pop(you); pop(cpu);\n    const result = decide(choice, cpuChoice);\n    if (result === 'win') {\n      youScore += 1;\n      if (msg) msg.innerText = 'Bien joue !';\n    } else if (result === 'lose') {\n      cpuScore += 1;\n      if (msg) msg.innerText = 'Ouch... encore !';\n    } else {\n      if (msg) msg.innerText = 'Egalite !';\n    }\n    if (score) score.innerText = youScore + ' - ' + cpuScore;\n  };\n});",
      "x": 41,
      "y": 45,
      "pageIndex": 0
    }
  ],
  "config": {
    "barPosition": "bottom",
    "wallpaper": "https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=2070&q=80",
    "viewMode": "desktop",
    "theme": "dark",
    "swipeThreshold": 30,
    "lockVerticalSwipe": false,
    "transparentObsidgetWidgets": true,
    "fullscreenWidgetTransparent": false,
    "pageDotsPosition": "bottom",
    "pageDotsSize": 12,
    "pageDotsDurationMs": 5000,
    "pageDotsBlurBubble": true,
    "pageCoords": {
      "0": {
        "x": 0,
        "y": 0
      },
      "1": {
        "x": 0,
        "y": 1
      },
      "2": {
        "x": -1,
        "y": 0
      },
      "3": {
        "x": 1,
        "y": 0
      },
      "4": {
        "x": 0,
        "y": -1
      }
    },
    "pageOrder": [
      0,
      1,
      2,
      3,
      4
    ]
  },
  "windows": [],
  "widgetTemplates": [
    {
      "id": "clock",
      "title": "Horloge",
      "cols": 2,
      "rows": 1,
      "bgColor": "#334155",
      "kind": "runner",
      "html": "<div id=\"clock\" class=\"flex flex-col items-center justify-center h-full text-white font-mono\">\n      <div class=\"text-4xl font-bold\" id=\"time\">00:00</div>\n      <div class=\"text-sm opacity-70\" id=\"date\">...</div>\n    </div>",
      "css": "#clock { font-family: 'Courier New', monospace; }",
      "js": "const update = () => {\n      const now = new Date();\n      container.querySelector('#time').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\n      container.querySelector('#date').innerText = now.toLocaleDateString();\n    };\n    update();\n    const interval = setInterval(update, 1000);\n    container._cleanup = () => clearInterval(interval);"
    },
    {
      "id": "quicknote",
      "title": "Note rapide",
      "cols": 2,
      "rows": 2,
      "bgColor": "#fef08a",
      "kind": "react"
    },
    {
      "id": "weather",
      "title": "Meteo",
      "cols": 2,
      "rows": 1,
      "bgColor": "glass",
      "kind": "runner",
      "html": "<div class=\"flex items-center justify-between px-4 h-full text-white\">\n      <div class=\"flex flex-col\">\n        <span class=\"text-2xl font-bold\">22C</span>\n        <span class=\"text-xs opacity-80\">Paris</span>\n      </div>\n      <div class=\"text-4xl\">WX</div>\n    </div>"
    },
    {
      "id": "calendar",
      "title": "Calendrier",
      "cols": 2,
      "rows": 2,
      "bgColor": "#ffffff",
      "kind": "runner",
      "html": "<div class=\"h-full flex flex-col p-2 text-slate-800\">\n      <div class=\"text-center font-bold text-red-500 uppercase text-xs mb-1\" id=\"month\">Month</div>\n      <div class=\"text-center text-4xl font-bold flex-1 flex items-center justify-center\" id=\"day\">1</div>\n      <div class=\"text-center text-xs opacity-50\" id=\"weekday\">Day</div>\n    </div>",
      "js": "const now = new Date();\n    container.querySelector('#month').innerText = now.toLocaleString('default', { month: 'long' });\n    container.querySelector('#day').innerText = now.getDate();\n    container.querySelector('#weekday').innerText = now.toLocaleString('default', { weekday: 'long' });"
    },
    {
      "id": "calculator",
      "title": "Calculatrice",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"grid grid-cols-4 gap-1 h-full p-1\">\n      <div id=\"disp\" class=\"col-span-4 bg-gray-900 text-white flex items-center justify-end px-2 rounded mb-1 text-xl\">0</div>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">7</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">8</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">9</button>\n      <button class=\"bg-orange-500 text-white rounded\">+</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">4</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">5</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">6</button>\n      <button class=\"bg-orange-500 text-white rounded\">-</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">1</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">2</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600\">3</button>\n      <button class=\"bg-blue-500 text-white rounded row-span-2\">=</button>\n      <button class=\"bg-gray-700 text-white rounded hover:bg-gray-600 col-span-2\">0</button>\n      <button class=\"bg-red-500 text-white rounded\">C</button>\n    </div>",
      "css": "button { transition: background 0.1s; } button:active { transform: scale(0.95); }",
      "js": "const d = container.querySelector('#disp');\n    let c = '';\n    container.querySelectorAll('button').forEach(b => {\n      const t = b.innerText;\n      if(t === '=') b.onclick = () => { try { c = String(eval(c)); d.innerText = c; } catch { d.innerText = 'Err'; c=''; } };\n      else if(t === 'C') b.onclick = () => { c = ''; d.innerText = '0'; };\n      else b.onclick = () => { c += t; d.innerText = c; };\n    });"
    },
    {
      "id": "todo",
      "title": "To-Do",
      "cols": 2,
      "rows": 2,
      "bgColor": "#ffffff",
      "kind": "react"
    },
    {
      "id": "pomodoro",
      "title": "Pomodoro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#e11d48",
      "kind": "runner",
      "html": "<div class=\"flex flex-col items-center justify-center h-full text-white\">\n      <div class=\"text-4xl font-mono font-bold mb-2\" id=\"timer\">25:00</div>\n      <div class=\"flex gap-2\">\n        <button id=\"start\" class=\"w-8 h-8 rounded-full border-2 border-white flex items-center justify-center hover:bg-white hover:text-red-600 transition\">></button>\n        <button id=\"reset\" class=\"w-8 h-8 rounded-full border-2 border-white flex items-center justify-center hover:bg-white hover:text-red-600 transition\">R</button>\n      </div>\n    </div>",
      "js": "let time = 1500; let int = null;\n    const disp = container.querySelector('#timer');\n    const update = () => {\n      const minutes = Math.floor(time / 60).toString().padStart(2,'0');\n      const seconds = (time % 60).toString().padStart(2,'0');\n      disp.innerText = minutes + ':' + seconds;\n    };\n    container.querySelector('#start').onclick = () => {\n      if(int) { clearInterval(int); int=null; }\n      else { int = setInterval(() => { if(time>0) { time--; update(); } else { clearInterval(int); alert('Fini!'); } }, 1000); }\n    };\n    container.querySelector('#reset').onclick = () => { clearInterval(int); int=null; time=1500; update(); };\n    container._cleanup = () => clearInterval(int);"
    },
    {
      "id": "breath",
      "title": "Respire",
      "cols": 2,
      "rows": 2,
      "bgColor": "#8b5cf6",
      "kind": "runner",
      "html": "<div class=\"flex flex-col items-center justify-center h-full text-white relative overflow-hidden\">\n      <div class=\"circle absolute bg-white/20 rounded-full\"></div>\n      <div class=\"text-lg font-bold z-10 animate-pulse\">Inhale... Exhale</div>\n    </div>",
      "css": ".circle { width: 50px; height: 50px; animation: breathe 4s infinite ease-in-out; }\n    @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(3); } }"
    },
    {
      "id": "game-2048",
      "title": "2048",
      "cols": 2,
      "rows": 2,
      "bgColor": "#0f172a",
      "kind": "runner",
      "html": "<div class=\"g2048\">\n      <div class=\"g2048-head\">\n        <div class=\"g2048-title\">2048</div>\n        <div id=\"g2048-score\" class=\"g2048-score\">0</div>\n        <button id=\"g2048-new\" class=\"g2048-new\">Nouveau</button>\n      </div>\n      <div id=\"g2048-grid\" class=\"g2048-grid\"></div>\n      <div id=\"g2048-msg\" class=\"g2048-msg\">Utilise les fleches</div>\n    </div>",
      "css": ".g2048 { height: 100%; padding: 10px; color: #e2e8f0; border-radius: 14px; background: radial-gradient(circle at top, rgba(251,191,36,0.15), transparent 60%), linear-gradient(135deg, #0f172a, #111827 60%); border: 1px solid rgba(255,255,255,0.08); display: flex; flex-direction: column; gap: 6px; }\n.g2048-head { display: grid; grid-template-columns: 1fr auto auto; gap: 6px; align-items: center; }\n.g2048-title { font-size: 12px; letter-spacing: 0.25em; text-transform: uppercase; color: #fde68a; font-weight: 800; }\n.g2048-score { font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 999px; }\n.g2048-new { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: #fff; padding: 2px 8px; border-radius: 999px; cursor: pointer; }\n.g2048-grid { flex: 1; background: rgba(15,23,42,0.6); border-radius: 10px; padding: 6px; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); grid-template-rows: repeat(4, minmax(0, 1fr)); gap: 6px; }\n.g2048-tile { border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; color: #0f172a; background: rgba(255,255,255,0.08); transition: transform 0.15s, background 0.2s; }\n.g2048-tile[data-val=\"0\"] { background: rgba(255,255,255,0.05); color: transparent; }\n.g2048-tile[data-val=\"2\"] { background: #fef3c7; }\n.g2048-tile[data-val=\"4\"] { background: #fde68a; }\n.g2048-tile[data-val=\"8\"] { background: #fdba74; }\n.g2048-tile[data-val=\"16\"] { background: #fb923c; color: #fff; }\n.g2048-tile[data-val=\"32\"] { background: #f97316; color: #fff; }\n.g2048-tile[data-val=\"64\"] { background: #ea580c; color: #fff; }\n.g2048-tile[data-val=\"128\"] { background: #facc15; }\n.g2048-tile[data-val=\"256\"] { background: #eab308; }\n.g2048-tile[data-val=\"512\"] { background: #84cc16; color: #0f172a; }\n.g2048-tile[data-val=\"1024\"] { background: #22c55e; color: #0f172a; }\n.g2048-tile[data-val=\"2048\"] { background: #38bdf8; color: #0f172a; }\n.g2048-msg { font-size: 10px; text-align: center; color: #cbd5f5; }",
      "js": "const gridEl = container.querySelector('#g2048-grid');\nconst scoreEl = container.querySelector('#g2048-score');\nconst msgEl = container.querySelector('#g2048-msg');\nconst newBtn = container.querySelector('#g2048-new');\nconst root = container.querySelector('.g2048');\nconst size = 4;\nlet grid = Array.from({ length: size }, () => Array(size).fill(0));\nlet score = 0;\nlet locked = false;\n\nconst setMsg = (text) => { if (msgEl) msgEl.innerText = text; };\nconst setScore = (val) => { if (scoreEl) scoreEl.innerText = String(val); };\n\nconst addRandom = () => {\n  const empties = [];\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      if (grid[r][c] === 0) empties.push([r, c]);\n    }\n  }\n  if (empties.length === 0) return false;\n  const pick = empties[Math.floor(Math.random() * empties.length)];\n  grid[pick[0]][pick[1]] = Math.random() < 0.9 ? 2 : 4;\n  return true;\n};\n\nconst slideLine = (line) => {\n  const arr = line.filter((v) => v !== 0);\n  let gained = 0;\n  for (let i = 0; i < arr.length - 1; i++) {\n    if (arr[i] === arr[i + 1]) {\n      arr[i] *= 2;\n      gained += arr[i];\n      arr.splice(i + 1, 1);\n    }\n  }\n  while (arr.length < size) arr.push(0);\n  const changed = arr.some((v, i) => v !== line[i]);\n  return { line: arr, gained, changed };\n};\n\nconst move = (dir) => {\n  if (locked) return;\n  let moved = false;\n  let gained = 0;\n  if (dir === 'left' || dir === 'right') {\n    for (let r = 0; r < size; r++) {\n      const original = grid[r].slice();\n      const line = dir === 'left' ? original : original.slice().reverse();\n      const result = slideLine(line);\n      const next = dir === 'left' ? result.line : result.line.slice().reverse();\n      grid[r] = next;\n      moved = moved || result.changed;\n      gained += result.gained;\n    }\n  } else {\n    for (let c = 0; c < size; c++) {\n      const original = grid.map((row) => row[c]);\n      const line = dir === 'up' ? original : original.slice().reverse();\n      const result = slideLine(line);\n      const next = dir === 'up' ? result.line : result.line.slice().reverse();\n      for (let r = 0; r < size; r++) grid[r][c] = next[r];\n      moved = moved || result.changed;\n      gained += result.gained;\n    }\n  }\n  if (moved) {\n    score += gained;\n    setScore(score);\n    addRandom();\n    render();\n    checkState();\n  }\n};\n\nconst hasMoves = () => {\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      if (grid[r][c] === 0) return true;\n      if (r < size - 1 && grid[r][c] === grid[r + 1][c]) return true;\n      if (c < size - 1 && grid[r][c] === grid[r][c + 1]) return true;\n    }\n  }\n  return false;\n};\n\nconst checkState = () => {\n  const won = grid.some((row) => row.includes(2048));\n  if (won) setMsg('Bravo, 2048 !');\n  else if (!hasMoves()) setMsg('Perdu. Nouveau ?');\n  else setMsg('Utilise les fleches');\n};\n\nconst render = () => {\n  if (!gridEl) return;\n  gridEl.innerHTML = '';\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      const val = grid[r][c];\n      const tile = document.createElement('div');\n      tile.className = 'g2048-tile';\n      tile.dataset.val = String(val);\n      tile.innerText = val === 0 ? '' : String(val);\n      gridEl.appendChild(tile);\n    }\n  }\n};\n\nconst reset = () => {\n  grid = Array.from({ length: size }, () => Array(size).fill(0));\n  score = 0;\n  setScore(score);\n  addRandom();\n  addRandom();\n  render();\n  checkState();\n};\n\nconst onKey = (event) => {\n  const key = event.key;\n  if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(key)) {\n    event.preventDefault();\n    if (key === 'ArrowLeft') move('left');\n    if (key === 'ArrowRight') move('right');\n    if (key === 'ArrowUp') move('up');\n    if (key === 'ArrowDown') move('down');\n  }\n};\n\nlet touchStart = null;\nconst onTouchStart = (event) => {\n  if (!event.touches || event.touches.length === 0) return;\n  const touch = event.touches[0];\n  touchStart = { x: touch.clientX, y: touch.clientY };\n};\nconst onTouchEnd = (event) => {\n  if (!touchStart || !event.changedTouches || event.changedTouches.length === 0) return;\n  const touch = event.changedTouches[0];\n  const dx = touch.clientX - touchStart.x;\n  const dy = touch.clientY - touchStart.y;\n  const absX = Math.abs(dx);\n  const absY = Math.abs(dy);\n  if (Math.max(absX, absY) < 20) return;\n  if (absX > absY) move(dx > 0 ? 'right' : 'left');\n  else move(dy > 0 ? 'down' : 'up');\n  touchStart = null;\n};\n\nif (root) {\n  root.tabIndex = 0;\n  root.addEventListener('pointerdown', () => root.focus());\n  root.addEventListener('keydown', onKey);\n  root.addEventListener('touchstart', onTouchStart, { passive: true });\n  root.addEventListener('touchend', onTouchEnd, { passive: true });\n}\nif (newBtn) newBtn.onclick = reset;\nreset();\ncontainer._cleanup = () => {\n  if (root) root.removeEventListener('keydown', onKey);\n  if (root) root.removeEventListener('touchstart', onTouchStart);\n  if (root) root.removeEventListener('touchend', onTouchEnd);\n};"
    },
    {
      "id": "chifoumi",
      "title": "Chifoumi",
      "cols": 2,
      "rows": 2,
      "bgColor": "#111827",
      "kind": "runner",
      "html": "<div class=\"rps-root\">\n      <div class=\"rps-head\">\n        <div class=\"rps-title\">Chifoumi</div>\n        <div id=\"rps-score\" class=\"rps-score\">0 - 0</div>\n      </div>\n      <div class=\"rps-arena\">\n        <div class=\"rps-side\">\n          <div class=\"rps-label\">Toi</div>\n          <div id=\"rps-you\" class=\"rps-hand\">✊</div>\n        </div>\n        <div class=\"rps-vs\">VS</div>\n        <div class=\"rps-side\">\n          <div class=\"rps-label\">CPU</div>\n          <div id=\"rps-cpu\" class=\"rps-hand\">✊</div>\n        </div>\n      </div>\n      <div id=\"rps-msg\" class=\"rps-msg\">Choisis ton coup</div>\n      <div class=\"rps-actions\">\n        <button class=\"rps-btn\" data-move=\"rock\">✊</button>\n        <button class=\"rps-btn\" data-move=\"paper\">✋</button>\n        <button class=\"rps-btn\" data-move=\"scissors\">✌️</button>\n      </div>\n    </div>",
      "css": ".rps-root { height: 100%; padding: 10px; color: #e2e8f0; border-radius: 14px; background: radial-gradient(circle at top, rgba(59,130,246,0.2), transparent 60%), linear-gradient(135deg, #0f172a, #111827 60%); border: 1px solid rgba(255,255,255,0.06); display: flex; flex-direction: column; gap: 6px; }\n.rps-head { display: flex; align-items: center; justify-content: space-between; }\n.rps-title { font-size: 12px; letter-spacing: 0.2em; text-transform: uppercase; color: #93c5fd; font-weight: 700; }\n.rps-score { font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 999px; }\n.rps-arena { flex: 1; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 8px; }\n.rps-side { text-align: center; }\n.rps-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.12em; color: #94a3b8; }\n.rps-hand { font-size: 30px; filter: drop-shadow(0 6px 12px rgba(0,0,0,0.4)); transition: transform 0.2s; }\n.rps-vs { font-size: 10px; letter-spacing: 0.4em; color: #64748b; }\n.rps-msg { font-size: 10px; text-align: center; color: #e2e8f0; }\n.rps-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }\n.rps-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); color: #fff; border-radius: 10px; padding: 6px 0; font-size: 18px; cursor: pointer; transition: transform 0.1s, background 0.2s, box-shadow 0.2s; }\n.rps-btn:hover { background: rgba(59,130,246,0.3); box-shadow: 0 0 12px rgba(59,130,246,0.35); }\n.rps-btn:active { transform: scale(0.95) rotate(-2deg); }\n.rps-pop { animation: rps-pop 0.25s ease; }\n@keyframes rps-pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }",
      "js": "const you = container.querySelector('#rps-you');\nconst cpu = container.querySelector('#rps-cpu');\nconst msg = container.querySelector('#rps-msg');\nconst score = container.querySelector('#rps-score');\nconst icons = { rock: '✊', paper: '✋', scissors: '✌️' };\nconst moves = ['rock', 'paper', 'scissors'];\nlet youScore = 0;\nlet cpuScore = 0;\n\nconst decide = (a, b) => {\n  if (a === b) return 'draw';\n  if ((a === 'rock' && b === 'scissors') || (a === 'paper' && b === 'rock') || (a === 'scissors' && b === 'paper')) {\n    return 'win';\n  }\n  return 'lose';\n};\n\nconst pop = (el) => {\n  if (!el) return;\n  el.classList.remove('rps-pop');\n  void el.offsetWidth;\n  el.classList.add('rps-pop');\n};\n\ncontainer.querySelectorAll('.rps-btn').forEach((btn) => {\n  btn.onclick = () => {\n    const choice = btn.getAttribute('data-move');\n    if (!choice) return;\n    const cpuChoice = moves[Math.floor(Math.random() * moves.length)];\n    if (you) you.innerText = icons[choice];\n    if (cpu) cpu.innerText = icons[cpuChoice];\n    pop(you); pop(cpu);\n    const result = decide(choice, cpuChoice);\n    if (result === 'win') {\n      youScore += 1;\n      if (msg) msg.innerText = 'Bien joue !';\n    } else if (result === 'lose') {\n      cpuScore += 1;\n      if (msg) msg.innerText = 'Ouch... encore !';\n    } else {\n      if (msg) msg.innerText = 'Egalite !';\n    }\n    if (score) score.innerText = youScore + ' - ' + cpuScore;\n  };\n});"
    },
    {
      "id": "ai-token-studio",
      "title": "AI Token Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <span class=\"icon\">💎</span>\n      <h4 class=\"widget-title\">AI Cost Studio</h4>\n    </div>\n    <div class=\"header-right\">\n      <button id=\"btn-settings\" class=\"icon-btn\" title=\"Custom Pricing\">⚙️</button>\n      <div class=\"total-badge\">$<span id=\"total-cost\">0.0000</span></div>\n    </div>\n  </div>\n\n  \n  <div id=\"settings-panel\" class=\"settings-overlay hidden\">\n    <div class=\"settings-content\">\n      <h5>Custom Model Pricing</h5>\n      <div class=\"setting-row\">\n        <label>Input Price ($/1M)</label>\n        <input type=\"number\" id=\"set-input-price\" step=\"0.1\">\n      </div>\n      <div class=\"setting-row\">\n        <label>Output Price ($/1M)</label>\n        <input type=\"number\" id=\"set-output-price\" step=\"0.1\">\n      </div>\n      <button id=\"btn-save-settings\" class=\"btn-primary\">Apply Custom</button>\n    </div>\n  </div>\n\n  \n  <div class=\"input-container\">\n    <textarea id=\"prompt-input\" placeholder=\"Paste your prompt here to calculate magic...\"></textarea>\n    <div class=\"char-count\"><span id=\"char-val\">0</span> chars</div>\n  </div>\n\n  \n  <div class=\"simulation-section\">\n    <div class=\"sim-header\">\n      <label>Expected Response Length</label>\n      <span id=\"output-val\">500 tokens</span>\n    </div>\n    <input type=\"range\" id=\"output-slider\" min=\"0\" max=\"4000\" step=\"50\" value=\"500\">\n  </div>\n\n  \n  <div class=\"stats-grid\">\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">Input Tokens</span>\n      <span class=\"stat-value\" id=\"input-tokens\">0</span>\n    </div>\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">Total Tokens</span>\n      <span class=\"stat-value accent\" id=\"total-tokens\">0</span>\n    </div>\n  </div>\n\n  \n  <div class=\"model-selector\">\n    <button class=\"model-btn active\" data-model=\"gpt4o\">GPT-4o</button>\n    <button class=\"model-btn\" data-model=\"mini\">Mini</button>\n    <button class=\"model-btn\" data-model=\"claude\">Claude 3.5</button>\n    <button class=\"model-btn\" data-model=\"llama\">Llama 3</button>\n  </div>\n\n  \n  <div class=\"context-bar-container\">\n    <div class=\"context-label\">Context Window Usage (128k)</div>\n    <div class=\"context-bar-bg\">\n      <div class=\"context-bar-fill\" id=\"context-fill\"></div>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 450px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; } .header-left { display: flex; align-items: center; gap: 8px; } .widget-title { margin: 0; font-size: 0.9rem; font-weight: 800; color: var(--text-normal); text-transform: uppercase; letter-spacing: 0.5px; } .icon-btn { background: transparent; border: none; cursor: pointer; opacity: 0.6; font-size: 1.1rem; } .icon-btn:hover { opacity: 1; } .total-badge { background: rgba(var(--interactive-accent-rgb), 0.15); color: var(--interactive-accent); padding: 4px 10px; border-radius: 8px; font-weight: 800; font-family: var(--font-monospace); font-size: 1rem; border: 1px solid rgba(var(--interactive-accent-rgb), 0.3); } .input-container { position: relative; margin-bottom: 1rem; } textarea { width: 100%; height: 120px; background: var(--background-primary); color: var(--text-normal); border: 1px solid var(--background-modifier-border); border-radius: 12px; padding: 12px; font-size: 0.9rem; outline: none; resize: vertical; transition: border-color 0.2s; font-family: var(--font-monospace); } textarea:focus { border-color: var(--interactive-accent); } .char-count { position: absolute; bottom: 8px; right: 12px; font-size: 0.7rem; color: var(--text-muted); pointer-events: none; } .simulation-section { margin-bottom: 1.5rem; background: var(--background-primary-alt); padding: 10px; border-radius: 10px; border: 1px solid var(--background-modifier-border); } .sim-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); } input[type=range] { width: 100%; height: 4px; border-radius: 2px; -webkit-appearance: none; background: var(--background-modifier-border); outline: none; } input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--interactive-accent); cursor: pointer; transition: transform 0.1s; } input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); } .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 1rem; } .stat-card { background: var(--background-primary); padding: 10px; border-radius: 10px; text-align: center; border: 1px solid var(--background-modifier-border); } .stat-label { display: block; font-size: 0.65rem; text-transform: uppercase; color: var(--text-muted); font-weight: 700; margin-bottom: 4px; } .stat-value { font-size: 1.1rem; font-weight: 800; color: var(--text-normal); font-family: var(--font-monospace); } .stat-value.accent { color: var(--interactive-accent); } .model-selector { display: flex; gap: 4px; margin-bottom: 1.5rem; background: var(--background-primary); padding: 4px; border-radius: 8px; border: 1px solid var(--background-modifier-border); } .model-btn { flex: 1; background: transparent; border: none; padding: 6px; font-size: 0.7rem; font-weight: 700; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all 0.2s; } .model-btn.active { background: var(--background-secondary); color: var(--text-normal); box-shadow: 0 1px 3px rgba(0,0,0,0.1); } .context-bar-container { margin-top: 1rem; } .context-label { font-size: 0.65rem; color: var(--text-faint); margin-bottom: 4px; text-align: right; } .context-bar-bg { height: 6px; background: var(--background-modifier-border); border-radius: 3px; overflow: hidden; } .context-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--interactive-accent), #a78bfa); transition: width 0.3s ease; } .settings-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; } .settings-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .settings-content { background: var(--background-primary); padding: 1.5rem; border-radius: 12px; width: 85%; border: 1px solid var(--background-modifier-border); } .settings-content h5 { margin: 0 0 1rem 0; text-align: center; } .setting-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; align-items: center; } .setting-row input { width: 80px; background: var(--background-secondary); border: 1px solid var(--background-modifier-border); padding: 4px; border-radius: 4px; color: var(--text-normal); text-align: right; } .btn-primary { width: 100%; background: var(--interactive-accent); color: white; border: none; padding: 8px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\n// Prices per 1M tokens (Input / Output)\nvar presets = {\n  gpt4o: { in: 5.00, out: 15.00 },\n  mini: { in: 0.15, out: 0.60 },\n  claude: { in: 3.00, out: 15.00 },\n  llama: { in: 0.10, out: 0.10 }, // generic cheap\n  custom: { in: 0, out: 0 }\n};\n\nvar state = {\n  text: '',\n  model: 'gpt4o',\n  outputTokens: 500,\n  customPrice: { in: 5, out: 15 }\n};\n\nfunction estimateTokens(str) {\n  if(!str) return 0;\n  // Improved approximation: Words * 1.3 is standard for English\n  // Using regex to count word-like groups\n  var words = str.trim().split(/\\s+/).length;\n  var chars = str.length;\n  // Hybrid formula for code/text mix\n  return Math.ceil(Math.max(words * 1.33, chars / 4));\n}\n\nfunction update() {\n  var inTokens = estimateTokens(state.text);\n  var outTokens = parseInt(state.outputTokens);\n  var totalTokens = inTokens + outTokens;\n  \n  // Pricing\n  var pricing = (state.model === 'custom') ? state.customPrice : presets[state.model];\n  var cost = ((inTokens / 1000000) * pricing.in) + ((outTokens / 1000000) * pricing.out);\n\n  // Update UI Stats\n  root.getElementById('input-tokens').innerText = inTokens.toLocaleString();\n  root.getElementById('total-tokens').innerText = totalTokens.toLocaleString();\n  root.getElementById('total-cost').innerText = cost.toFixed(4);\n  root.getElementById('char-val').innerText = state.text.length;\n  \n  // Update Slider Label\n  root.getElementById('output-val').innerText = outTokens + ' tokens';\n\n  // Update Context Bar (Assuming 128k window)\n  var ctxPct = (totalTokens / 128000) * 100;\n  root.getElementById('context-fill').style.width = Math.min(100, Math.max(1, ctxPct)) + '%';\n}\n\nfunction setupModelBtns() {\n  var btns = root.querySelectorAll('.model-btn');\n  btns.forEach(function(btn) {\n    btn.onclick = function() {\n      btns.forEach(function(b){ b.classList.remove('active'); });\n      btn.classList.add('active');\n      state.model = btn.getAttribute('data-model');\n      update();\n      saveState(state);\n    };\n  });\n}\n\nfunction toggleSettings(show) {\n  var el = root.getElementById('settings-panel');\n  if(show) {\n      el.classList.remove('hidden');\n      // Load current pricing into inputs if custom, else load selected preset to edit\n      var currentP = (state.model === 'custom') ? state.customPrice : presets[state.model];\n      root.getElementById('set-input-price').value = currentP.in;\n      root.getElementById('set-output-price').value = currentP.out;\n  } else {\n      el.classList.add('hidden');\n  }\n}\n\nasync function init() {\n  var saved = await getState();\n  if (saved) Object.assign(state, saved);\n\n  // Restore Input\n  var input = root.getElementById('prompt-input');\n  input.value = state.text;\n  \n  // Restore Slider\n  var slider = root.getElementById('output-slider');\n  slider.value = state.outputTokens;\n\n  // Restore Model UI\n  var btns = root.querySelectorAll('.model-btn');\n  btns.forEach(function(b) {\n      if(b.getAttribute('data-model') === state.model) b.classList.add('active');\n      else b.classList.remove('active');\n  });\n\n  // Listeners\n  input.oninput = function(e) {\n      state.text = e.target.value;\n      update();\n      saveState(state);\n  };\n\n  slider.oninput = function(e) {\n      state.outputTokens = e.target.value;\n      update();\n      saveState(state);\n  };\n\n  root.getElementById('btn-settings').onclick = function() { toggleSettings(true); };\n  \n  root.getElementById('btn-save-settings').onclick = function() {\n      state.model = 'custom';\n      state.customPrice.in = parseFloat(root.getElementById('set-input-price').value) || 0;\n      state.customPrice.out = parseFloat(root.getElementById('set-output-price').value) || 0;\n      \n      // Visually deselect presets\n      btns.forEach(function(b){ b.classList.remove('active'); });\n      \n      toggleSettings(false);\n      update();\n      saveState(state);\n  };\n\n  setupModelBtns();\n  update();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "base64-tool",
      "title": "Base64 Tool",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <h4 class=\"widget-title\">🔐 Base64 Tool</h4>\n  \n  <div class=\"input-group\">\n    <label>Raw Text</label>\n    <textarea id=\"raw-text\" placeholder=\"Enter text...\" oninput=\"encode()\" onblur=\"save()\"></textarea>\n  </div>\n\n  <div class=\"separator\">↕</div>\n\n  <div class=\"input-group\">\n    <label>Base64</label>\n    <textarea id=\"b64-text\" placeholder=\"RW50ZXIgdGV4dC4uLg==\" oninput=\"decode()\" onblur=\"save()\"></textarea>\n  </div>\n\n  <div class=\"actions\">\n    <button onclick=\"copy('b64-text')\">Copy B64</button>\n    <button onclick=\"copy('raw-text')\">Copy Raw</button>\n    <button class=\"btn-clear\" onclick=\"clearFields()\">Clear</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 12px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-s);\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n}\n.widget-title { margin: 0 0 1.5rem 0; font-size: 0.9rem; font-weight: 800; color: var(--interactive-accent); text-transform: uppercase; letter-spacing: 2px; }\n\n.input-group { text-align: left; }\n.input-group label { display: block; font-size: 0.65rem; font-weight: 700; color: var(--interactive-accent); margin-bottom: 4px; text-transform: uppercase; }\n.input-group textarea {\n    width: 100%;\n    height: 80px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    caret-color: var(--interactive-accent);\n    border-radius: 4px;\n    padding: 10px;\n    font-size: 0.85rem;\n    outline: none;\n    resize: none;\n    font-family: var(--font-monospace);\n}\n.input-group textarea:focus {\n    border-color: var(--interactive-accent);\n}\n\n.separator { margin: 8px 0; font-size: 1.2rem; color: var(--text-muted); }\n\n.actions { display: flex; gap: 8px; margin-top: 1rem; }\n.actions button {\n    flex: 1;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px;\n    border-radius: 4px;\n    font-weight: 600;\n    font-size: 0.75rem;\n    cursor: pointer;\n    transition: opacity 0.2s;\n}\n.actions button:hover { opacity: 0.8; }\n.actions .btn-clear {\n    background: var(--background-modifier-error);\n    color: white;\n}",
      "js": "const { root, saveState, getState } = api;\n\nfunction encode() {\n    const raw = root.getElementById('raw-text').value;\n    try {\n        const b64 = btoa(unescape(encodeURIComponent(raw)));\n        root.getElementById('b64-text').value = b64;\n    } catch(e) { \n        root.getElementById('b64-text').value = '';\n    }\n}\n\nfunction decode() {\n    const b64 = root.getElementById('b64-text').value;\n    try {\n        const raw = decodeURIComponent(escape(atob(b64)));\n        root.getElementById('raw-text').value = raw;\n    } catch(e) { \n        root.getElementById('raw-text').value = '';\n    }\n}\n\nfunction save() {\n    const raw = root.getElementById('raw-text').value;\n    saveState(raw);\n}\n\nfunction clearFields() {\n    root.getElementById('raw-text').value = '';\n    root.getElementById('b64-text').value = '';\n    saveState('');\n}\n\nfunction copy(id) {\n    const el = root.getElementById(id);\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(el.value);\n    } else {\n        el.select();\n        document.execCommand('copy');\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        root.getElementById('raw-text').value = saved;\n        const b64 = btoa(unescape(encodeURIComponent(saved)));\n        root.getElementById('b64-text').value = b64;\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "bmr-calculator",
      "title": "BMR Calculator",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"bmr-container\">\n  <h4 class=\"widget-title\">⚖️ BMR Calculator</h4>\n  \n  <div class=\"gender-section\">\n    <div class=\"toggle-container\">\n      <span class=\"gender-label\" id=\"label-f\">Female</span>\n      <label class=\"switch\">\n        <input type=\"checkbox\" id=\"gender-toggle\" onchange=\"updateGender()\">\n        <span class=\"toggle-slider\"></span>\n      </label>\n      <span class=\"gender-label active\" id=\"label-m\">Male</span>\n    </div>\n  </div>\n\n  <div class=\"sliders-grid\">\n    <div class=\"input-group\">\n      <div class=\"label-row\">\n        <label>Age</label>\n        <span class=\"value-badge\"><span id=\"age-display\">25</span> y/o</span>\n      </div>\n      <input type=\"range\" id=\"age\" min=\"1\" max=\"100\" value=\"25\" class=\"modern-slider\" oninput=\"sync('age')\">\n    </div>\n\n    <div class=\"input-group\">\n      <div class=\"label-row\">\n        <label>Weight</label>\n        <span class=\"value-badge\"><span id=\"weight-display\">70</span> kg</span>\n      </div>\n      <input type=\"range\" id=\"weight\" min=\"30\" max=\"200\" value=\"70\" class=\"modern-slider\" oninput=\"sync('weight')\">\n    </div>\n\n    <div class=\"input-group\">\n      <div class=\"label-row\">\n        <label>Height</label>\n        <span class=\"value-badge\"><span id=\"height-display\">175</span> cm</span>\n      </div>\n      <input type=\"range\" id=\"height\" min=\"100\" max=\"250\" value=\"175\" class=\"modern-slider\" oninput=\"sync('height')\">\n    </div>\n  </div>\n\n  <div class=\"result-card\">\n    <div class=\"res-row\">\n      <div class=\"res-label\">Basal Metabolic Rate</div>\n      <div class=\"res-value\"><span id=\"bmr-val\">0</span> <small>kcal</small></div>\n    </div>\n    <div class=\"res-divider\"></div>\n    <div class=\"res-row\">\n      <div class=\"res-label\">TDEE (Sedentary)</div>\n      <div class=\"res-value secondary\"><span id=\"tdee-val\">0</span> <small>kcal</small></div>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n.bmr-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n}\n\n.widget-title { \n    margin: 0 0 1.25rem 0; \n    font-size: 0.85rem; \n    font-weight: 600; \n    color: var(--text-muted); \n    text-transform: uppercase; \n    letter-spacing: 0.05em; \n    text-align: center;\n}\n\n/* Gender Toggle */\n.gender-section {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 1.5rem;\n}\n.toggle-container {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    background: var(--background-primary);\n    padding: 6px 12px;\n    border-radius: 20px;\n    border: 1px solid var(--background-modifier-border);\n}\n.gender-label {\n    font-size: 0.75rem;\n    font-weight: 500;\n    color: var(--text-muted);\n    transition: color 0.2s;\n}\n.gender-label.active {\n    color: var(--interactive-accent);\n    font-weight: 600;\n}\n\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 36px;\n  height: 20px;\n}\n.switch input { opacity: 0; width: 0; height: 0; }\n.toggle-slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0; left: 0; right: 0; bottom: 0;\n  background-color: var(--background-modifier-border);\n  transition: .3s;\n  border-radius: 20px;\n}\n.toggle-slider:before {\n  position: absolute;\n  content: \"\";\n  height: 14px; width: 14px;\n  left: 3px; bottom: 3px;\n  background-color: white;\n  transition: .3s;\n  border-radius: 50%;\n}\ninput:checked + .toggle-slider { background-color: var(--interactive-accent); }\ninput:checked + .toggle-slider:before { transform: translateX(16px); }\n\n/* Sliders */\n.sliders-grid {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    margin-bottom: 1.5rem;\n}\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 6px;\n}\n.label-row label {\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: var(--text-normal);\n}\n.value-badge {\n    font-size: 0.75rem;\n    background: var(--background-primary);\n    padding: 2px 8px;\n    border-radius: 4px;\n    border: 1px solid var(--background-modifier-border);\n    color: var(--interactive-accent);\n    font-weight: 600;\n}\n\n.modern-slider {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 6px;\n    background: var(--background-modifier-border);\n    border-radius: 3px;\n    outline: none;\n}\n.modern-slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 16px;\n    height: 16px;\n    background: var(--interactive-accent);\n    cursor: pointer;\n    border-radius: 50%;\n    border: 2px solid var(--background-secondary);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n}\n\n/* Result Card */\n.result-card {\n    background: var(--background-primary);\n    border-radius: 12px;\n    padding: 1rem;\n    border: 1px solid var(--background-modifier-border);\n}\n.res-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n.res-label {\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    font-weight: 600;\n}\n.res-value {\n    font-size: 1.25rem;\n    font-weight: 700;\n    color: var(--interactive-accent);\n}\n.res-value.secondary {\n    font-size: 1.1rem;\n    color: var(--text-normal);\n}\n.res-value small { font-size: 0.65rem; font-weight: 500; opacity: 0.7; }\n.res-divider {\n    height: 1px;\n    background: var(--background-modifier-border);\n    margin: 8px 0;\n}",
      "js": "const { root, saveState, getState } = api;\n\nfunction sync(id) {\n    const val = root.getElementById(id).value;\n    root.getElementById(id + '-display').innerText = val;\n    calculate();\n}\n\nfunction updateGender() {\n    const isMale = root.getElementById('gender-toggle').checked;\n    root.getElementById('label-m').classList.toggle('active', isMale);\n    root.getElementById('label-f').classList.toggle('active', !isMale);\n    calculate();\n}\n\nfunction calculate() {\n    const isMale = root.getElementById('gender-toggle').checked;\n    const age = parseInt(root.getElementById('age').value);\n    const weight = parseFloat(root.getElementById('weight').value);\n    const height = parseFloat(root.getElementById('height').value);\n    \n    let bmr = 0;\n    if (isMale) {\n        bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);\n    } else {\n        bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);\n    }\n    \n    root.getElementById('bmr-val').innerText = Math.round(bmr).toLocaleString();\n    root.getElementById('tdee-val').innerText = Math.round(bmr * 1.2).toLocaleString();\n    \n    saveState({ isMale, age, weight, height });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        root.getElementById('gender-toggle').checked = saved.isMale !== undefined ? saved.isMale : true;\n        root.getElementById('age').value = saved.age || 25;\n        root.getElementById('weight').value = saved.weight || 70;\n        root.getElementById('height').value = saved.height || 175;\n        \n        // Sync displays\n        ['age', 'weight', 'height'].forEach(id => {\n            root.getElementById(id + '-display').innerText = root.getElementById(id).value;\n        });\n        updateGender();\n    } else {\n        // Default state\n        root.getElementById('gender-toggle').checked = true;\n        calculate();\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "budget-tracker",
      "title": "Budget Tracker",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"budget-container\">\n  <h4 class=\"widget-title\">💰 Budget Tracker</h4>\n  \n  <div class=\"balance-card\">\n    <div class=\"balance-label\">Current Balance</div>\n    <div class=\"balance-value\" id=\"total-balance\">$0.00</div>\n    <div class=\"balance-stats\">\n      <div class=\"stat-item income\">\n        <span class=\"stat-label\">Income</span>\n        <span class=\"stat-val\" id=\"total-income\">$0.00</span>\n      </div>\n      <div class=\"stat-divider\"></div>\n      <div class=\"stat-item expense\">\n        <span class=\"stat-label\">Expenses</span>\n        <span class=\"stat-val\" id=\"total-expense\">$0.00</span>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"input-section\">\n    <div class=\"input-row\">\n      <input type=\"text\" id=\"exp-name\" placeholder=\"Description...\" class=\"modern-input\">\n      <input type=\"number\" id=\"exp-amount\" placeholder=\"0.00\" class=\"modern-input\">\n    </div>\n    <div class=\"action-row\">\n      <div class=\"type-toggle\">\n        <button id=\"type-expense\" class=\"toggle-btn active\" onclick=\"setType('expense')\">Expense</button>\n        <button id=\"type-income\" class=\"toggle-btn\" onclick=\"setType('income')\">Income</button>\n      </div>\n      <button id=\"btn-add\" class=\"add-btn\">Add Entry</button>\n    </div>\n  </div>\n\n  <div class=\"entry-list\" id=\"entry-list\"></div>\n\n  <div class=\"footer\">\n    <button id=\"btn-reset\" class=\"reset-btn\">Reset All Data</button>\n  </div>\n</div>",
      "css": ":host {\n    --budget-bg: var(--background-secondary);\n    --budget-card-bg: var(--background-primary);\n    --budget-accent: var(--interactive-accent);\n    --budget-radius: 16px;\n    --budget-padding: 1.25rem;\n    --budget-font-size: 0.85rem;\n    display: block;\n    font-family: var(--font-interface);\n}\n\n* { box-sizing: border-box; }\n\n.budget-container {\n    background: var(--budget-bg);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: var(--budget-radius);\n    padding: var(--budget-padding);\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n}\n\n.widget-title {\n    margin: 0 0 1.25rem 0;\n    font-size: var(--budget-font-size);\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    text-align: center;\n}\n\n/* Balance Card */\n.balance-card {\n    background: var(--budget-card-bg);\n    border-radius: calc(var(--budget-radius) - 4px);\n    padding: var(--budget-padding);\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n    margin-bottom: 1.5rem;\n}\n.balance-label {\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    font-weight: 600;\n    margin-bottom: 4px;\n}\n.balance-value {\n    font-size: 2rem;\n    font-weight: 800;\n    color: var(--budget-accent);\n    margin-bottom: 1rem;\n}\n.balance-value.negative { color: var(--text-error); }\n\n.balance-stats {\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    padding-top: 0.75rem;\n    border-top: 1px solid var(--background-modifier-border);\n}\n.stat-item { display: flex; flex-direction: column; gap: 2px; }\n.stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; }\n.stat-val { font-size: 0.9rem; font-weight: 700; }\n.stat-item.income .stat-val { color: var(--text-success); }\n.stat-item.expense .stat-val { color: var(--text-error); }\n.stat-divider { width: 1px; height: 20px; background: var(--background-modifier-border); }\n\n/* Input Section */\n.input-section {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin-bottom: 1.5rem;\n}\n.input-row { display: flex; gap: 8px; }\n.modern-input {\n    background: var(--budget-card-bg);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 8px;\n    padding: 8px 12px;\n    font-size: var(--budget-font-size);\n    outline: none;\n    flex: 1;\n}\n.modern-input:focus { border-color: var(--budget-accent); }\n\n.action-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 8px;\n}\n.type-toggle {\n    display: flex;\n    background: var(--budget-card-bg);\n    border-radius: 8px;\n    padding: 3px;\n    border: 1px solid var(--background-modifier-border);\n    flex: 1;\n}\n.toggle-btn {\n    flex: 1;\n    background: none;\n    border: none;\n    padding: 6px;\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    cursor: pointer;\n    border-radius: 6px;\n    transition: all 0.2s;\n}\n.toggle-btn.active {\n    background: var(--budget-bg);\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n}\n#type-income.active { color: var(--text-success); }\n#type-expense.active { color: var(--text-error); }\n\n.add-btn {\n    background: var(--budget-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px 16px;\n    border-radius: 8px;\n    font-weight: 600;\n    font-size: var(--budget-font-size);\n    cursor: pointer;\n}\n.add-btn:hover { opacity: 0.9; }\n\n/* Entry List */\n.entry-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-height: 240px;\n    overflow-y: auto;\n    margin-bottom: 1.5rem;\n    padding-right: 4px;\n}\n.entry-list::-webkit-scrollbar {\n    width: 4px;\n}\n.entry-list::-webkit-scrollbar-thumb {\n    background: var(--background-modifier-border);\n    border-radius: 2px;\n}\n\n.entry-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--budget-card-bg);\n    border-radius: 10px;\n    border: 1px solid var(--background-modifier-border);\n    animation: slideIn 0.2s ease-out;\n}\n@keyframes slideIn {\n    from { opacity: 0; transform: translateY(5px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.entry-info {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n.entry-name {\n    font-size: var(--budget-font-size);\n    font-weight: 600;\n    color: var(--text-normal);\n}\n.entry-date {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n}\n\n.entry-right {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n.entry-amount { font-weight: 700; font-size: 0.9rem; }\n.entry-amount.income { color: var(--text-success); }\n.entry-amount.expense { color: var(--text-error); }\n\n.btn-del {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    cursor: pointer;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n}\n.btn-del:hover {\n    background: var(--background-modifier-error-hover);\n    color: var(--text-error);\n}\n\n.footer {\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 1rem;\n    text-align: center;\n}\n.reset-btn {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    font-size: 0.7rem;\n    font-weight: 600;\n    cursor: pointer;\n    text-decoration: underline;\n}\n.reset-btn:hover { color: var(--text-error); }",
      "js": "const { root, saveState, getState } = api;\nlet entries = [];\nlet currentType = 'expense';\n\nfunction setType(type) {\n    currentType = type;\n    root.getElementById('type-expense').classList.toggle('active', type === 'expense');\n    root.getElementById('type-income').classList.toggle('active', type === 'income');\n}\n\nfunction formatCurrency(amount) {\n    return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n    }).format(amount);\n}\n\nfunction render() {\n    const list = root.getElementById('entry-list');\n    list.innerHTML = '';\n    \n    let total = 0;\n    let income = 0;\n    let expense = 0;\n\n    entries.forEach((e, idx) => {\n        total += e.amount;\n        if (e.amount > 0) income += e.amount;\n        else expense += Math.abs(e.amount);\n\n        const div = document.createElement('div');\n        div.className = 'entry-item';\n        \n        const isIncome = e.amount > 0;\n        const dateStr = new Date(e.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n\n        div.innerHTML = `\n            <div class=\"entry-info\">\n                <span class=\"entry-name\">${e.name}</span>\n                <span class=\"entry-date\">${dateStr}</span>\n            </div>\n            <div class=\"entry-right\">\n                <span class=\"entry-amount ${isIncome ? 'income' : 'expense'}\">\n                    ${isIncome ? '+' : '-'}${formatCurrency(Math.abs(e.amount))}\n                </span>\n                <button class=\"btn-del\" title=\"Delete\">✕</button>\n            </div>\n        `;\n        \n        div.querySelector('.btn-del').onclick = () => deleteEntry(idx);\n        list.appendChild(div);\n    });\n    \n    const balEl = root.getElementById('total-balance');\n    balEl.innerText = formatCurrency(total);\n    balEl.classList.toggle('negative', total < 0);\n\n    root.getElementById('total-income').innerText = formatCurrency(income);\n    root.getElementById('total-expense').innerText = formatCurrency(expense);\n}\n\nfunction addEntry() {\n    const nameInput = root.getElementById('exp-name');\n    const amountInput = root.getElementById('exp-amount');\n    \n    const name = nameInput.value.trim();\n    let amount = parseFloat(amountInput.value);\n    \n    if (name && !isNaN(amount) && amount > 0) {\n        if (currentType === 'expense') amount = -amount;\n        \n        entries.unshift({\n            name: name,\n            amount: amount,\n            date: Date.now()\n        });\n        \n        if (entries.length > 50) entries.pop();\n        \n        nameInput.value = '';\n        amountInput.value = '';\n        \n        render();\n        saveState(entries);\n    }\n}\n\nfunction deleteEntry(idx) {\n    entries.splice(idx, 1);\n    render();\n    saveState(entries);\n}\n\nfunction resetBudget() {\n    if (confirm('Are you sure you want to reset all budget data?')) {\n        entries = [];\n        render();\n        saveState(entries);\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (Array.isArray(saved)) entries = saved;\n    \n    root.getElementById('btn-add').onclick = addEntry;\n    root.getElementById('btn-reset').onclick = resetBudget;\n    \n    const handleEnter = (e) => { if (e.key === 'Enter') addEntry(); };\n    root.getElementById('exp-name').onkeydown = handleEnter;\n    root.getElementById('exp-amount').onkeydown = handleEnter;\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "calculator-studio",
      "title": "Calculator Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"calc-header\">\n    <h4 class=\"widget-title\">🧮 Calculator Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-history-toggle\" class=\"btn-icon-small\" title=\"Toggle History\">📜</button>\n      <button id=\"btn-copy\" class=\"btn-icon-small\" title=\"Copy Result\">📋</button>\n    </div>\n  </div>\n\n  <div class=\"display-container\">\n    <div id=\"calc-expression\" class=\"expression-display\"></div>\n    <div id=\"calc-display\" class=\"main-display\">0</div>\n  </div>\n\n  <div class=\"calc-layout\">\n    <div id=\"history-panel\" class=\"history-panel\">\n      <div class=\"history-header\">\n        <span>History</span>\n        <button id=\"btn-clear-history\" class=\"btn-text\">Clear</button>\n      </div>\n      <div id=\"history-list\" class=\"history-list\"></div>\n    </div>\n\n    <div class=\"calc-main\">\n      <div class=\"calc-grid\">\n        <!-- Scientific Row 1 -->\n        <button class=\"btn-sci\" data-val=\"Math.sqrt(\">√</button>\n        <button class=\"btn-sci\" data-val=\"Math.pow(\">xʸ</button>\n        <button class=\"btn-sci\" data-val=\"Math.PI\">π</button>\n        <button class=\"btn-sci\" data-val=\"Math.E\">e</button>\n\n        <!-- Row 1 -->\n        <button class=\"btn-op btn-clear\" id=\"btn-clear\">AC</button>\n        <button class=\"btn-op\" id=\"btn-back\">⌫</button>\n        <button class=\"btn-op\" data-val=\"%\">%</button>\n        <button class=\"btn-op highlight\" data-val=\"/\">÷</button>\n\n        <!-- Row 2 -->\n        <button class=\"btn-num\" data-val=\"7\">7</button>\n        <button class=\"btn-num\" data-val=\"8\">8</button>\n        <button class=\"btn-num\" data-val=\"9\">9</button>\n        <button class=\"btn-op highlight\" data-val=\"*\">×</button>\n\n        <!-- Row 3 -->\n        <button class=\"btn-num\" data-val=\"4\">4</button>\n        <button class=\"btn-num\" data-val=\"5\">5</button>\n        <button class=\"btn-num\" data-val=\"6\">6</button>\n        <button class=\"btn-op highlight\" data-val=\"-\">−</button>\n\n        <!-- Row 4 -->\n        <button class=\"btn-num\" data-val=\"1\">1</button>\n        <button class=\"btn-num\" data-val=\"2\">2</button>\n        <button class=\"btn-num\" data-val=\"3\">3</button>\n        <button class=\"btn-op highlight\" data-val=\"+\">+</button>\n\n        <!-- Row 5 -->\n        <button class=\"btn-num btn-zero\" data-val=\"0\">0</button>\n        <button class=\"btn-num\" data-val=\".\">.</button>\n        <button class=\"btn-eq\" id=\"btn-eq\">=</button>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); color: var(--text-normal); border-radius: 24px; padding: 1.25rem; box-shadow: var(--shadow-s); border: 1px solid var(--background-modifier-border); max-width: 340px; margin: 0 auto; position: relative; overflow: hidden; } .calc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1px; } .header-actions { display: flex; gap: 8px; } .btn-icon-small { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-muted); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; } .btn-icon-small:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .display-container { background: var(--background-primary-alt); border-radius: 16px; padding: 1rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); text-align: right; min-height: 100px; display: flex; flex-direction: column; justify-content: flex-end; } .expression-display { color: var(--text-faint); font-size: 0.9rem; font-family: var(--font-monospace); min-height: 1.2rem; margin-bottom: 0.25rem; word-break: break-all; } .main-display { color: var(--interactive-accent); font-size: 2.2rem; font-weight: 700; font-family: var(--font-monospace); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } .calc-layout { display: flex; flex-direction: column; gap: 1rem; } .history-panel { display: none; background: var(--background-primary); border-radius: 16px; padding: 1rem; max-height: 200px; overflow-y: auto; border: 1px solid var(--background-modifier-border); } .history-panel.active { display: block; } .history-header { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; } .btn-text { background: none; border: none; color: var(--text-error); font-size: 0.7rem; cursor: pointer; padding: 2px 6px; } .btn-text:hover { text-decoration: underline; } .history-list { display: flex; flex-direction: column; gap: 8px; } .history-item { padding: 8px; background: var(--background-secondary-alt); border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: background 0.2s; border: 1px solid var(--background-modifier-border); } .history-item:hover { background: var(--background-modifier-hover); } .history-item .h-expr { color: var(--text-muted); display: block; font-size: 0.7rem; } .history-item .h-res { color: var(--interactive-accent); font-weight: 700; } .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; } .calc-grid button { border: none; padding: 16px 0; font-size: 1.1rem; font-weight: 700; border-radius: 14px; cursor: pointer; transition: all 0.2s; background: var(--background-primary); color: var(--text-normal); border: 1px solid var(--background-modifier-border); } .calc-grid button:hover { background: var(--background-modifier-hover); transform: translateY(-2px); } .calc-grid button:active { transform: scale(0.95); } .btn-op { background: var(--background-secondary-alt); color: var(--text-accent); } .btn-op.highlight { background: var(--interactive-accent); color: var(--text-on-accent); border: none; } .btn-op.highlight:hover { opacity: 0.9; } .btn-sci { background: var(--background-secondary-alt) !important; color: var(--text-muted) !important; font-size: 0.9rem !important; } .btn-sci:hover { color: var(--text-accent) !important; border-color: var(--interactive-accent) !important; } .btn-clear { color: var(--text-error) !important; } .btn-eq { background: var(--interactive-accent) !important; color: var(--text-on-accent) !important; grid-column: span 2; border: none !important; } .btn-eq:hover { opacity: 0.9; } .btn-zero { grid-column: span 1; } .toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 6px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 800; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    current: '0',\n    expression: '',\n    history: [],\n    showHistory: false\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg;\n    toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction updateDisplay() {\n    root.querySelector('#calc-display').innerText = state.current;\n    root.querySelector('#calc-expression').innerText = state.expression;\n    \n    const historyPanel = root.querySelector('#history-panel');\n    if (state.showHistory) historyPanel.classList.add('active');\n    else historyPanel.classList.remove('active');\n    \n    renderHistory();\n}\n\nfunction renderHistory() {\n    const list = root.querySelector('#history-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.history.slice().reverse().forEach((item, idx) => {\n        const div = document.createElement('div');\n        div.className = 'history-item';\n        div.innerHTML = `\n            <span class=\"h-expr\">${item.expr} =</span>\n            <span class=\"h-res\">${item.res}</span>\n        `;\n        div.onclick = () => {\n            state.current = item.res;\n            state.expression = '';\n            updateDisplay();\n        };\n        list.appendChild(div);\n    });\n}\n\nfunction handleInput(val) {\n    if (state.current === 'Error') clearAll();\n    \n    if (val === 'AC') {\n        clearAll();\n    } else if (val === '⌫') {\n        if (state.current.length > 1) state.current = state.current.slice(0, -1);\n        else state.current = '0';\n    } else if (val === '=') {\n        calculate();\n    } else if (['+', '-', '*', '/', '%'].includes(val)) {\n        if (state.current !== '0' || state.expression !== '') {\n            state.expression += state.current + ' ' + val + ' ';\n            state.current = '0';\n        }\n    } else if (val.startsWith('Math.')) {\n        // Scientific functions\n        state.current = val + state.current + ')';\n        calculate();\n    } else {\n        // Numbers and dot\n        if (state.current === '0' && val !== '.') state.current = val;\n        else if (val === '.' && state.current.includes('.')) return;\n        else state.current += val;\n    }\n    \n    updateDisplay();\n    saveState(state);\n}\n\nfunction clearAll() {\n    state.current = '0';\n    state.expression = '';\n    updateDisplay();\n    saveState(state);\n}\n\nfunction calculate() {\n    try {\n        let fullExpr = state.expression + state.current;\n        // Basic sanitization and evaluation\n        // Replace visual operators with JS ones if needed (already done in data-val)\n        let result = eval(fullExpr);\n        \n        // Format result\n        let formattedResult = Number.isInteger(result) ? result.toString() : result.toFixed(8).replace(/\\.0+$|(\\.[0-9]*[1-9])0+$/, '$1');\n        \n        // Add to history\n        state.history.push({ expr: fullExpr, res: formattedResult });\n        if (state.history.length > 20) state.history.shift();\n        \n        state.current = formattedResult;\n        state.expression = '';\n        \n        showToast('Calculated! ✨');\n    } catch (e) {\n        state.current = 'Error';\n    }\n    updateDisplay();\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n    \n    // Attach listeners\n    root.querySelectorAll('button[data-val]').forEach(btn => {\n        btn.onclick = () => handleInput(btn.dataset.val);\n    });\n    \n    root.querySelector('#btn-clear').onclick = () => handleInput('AC');\n    root.querySelector('#btn-back').onclick = () => handleInput('⌫');\n    root.querySelector('#btn-eq').onclick = () => handleInput('=');\n    \n    root.querySelector('#btn-history-toggle').onclick = () => {\n        state.showHistory = !state.showHistory;\n        updateDisplay();\n        saveState(state);\n    };\n    \n    root.querySelector('#btn-clear-history').onclick = () => {\n        state.history = [];\n        renderHistory();\n        saveState(state);\n    };\n    \n    root.querySelector('#btn-copy').onclick = () => {\n        navigator.clipboard.writeText(state.current);\n        showToast('Copied to clipboard! 📋');\n    };\n\n    // Keyboard support\n    window.addEventListener('keydown', (e) => {\n        if (e.key >= '0' && e.key <= '9') handleInput(e.key);\n        if (e.key === '.') handleInput('.');\n        if (e.key === '+') handleInput('+');\n        if (e.key === '-') handleInput('-');\n        if (e.key === '*') handleInput('*');\n        if (e.key === '/') handleInput('/');\n        if (e.key === 'Enter' || e.key === '=') handleInput('=');\n        if (e.key === 'Backspace') handleInput('⌫');\n        if (e.key === 'Escape') handleInput('AC');\n    });\n    \n    updateDisplay();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "char-counter",
      "title": "Character Counter",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"char-container\">\n  <h4 class=\"widget-title\">📝 Text Stats</h4>\n  \n  <textarea id=\"text-input\" placeholder=\"Type or paste text here...\" oninput=\"updateStats()\" onblur=\"save()\"></textarea>\n\n  <div class=\"stats-grid\">\n    <div class=\"stat-box\">\n      <span id=\"char-count\">0</span>\n      <label>Chars</label>\n    </div>\n    <div class=\"stat-box\">\n      <span id=\"word-count\">0</span>\n      <label>Words</label>\n    </div>\n    <div class=\"stat-box\">\n      <span id=\"line-count\">0</span>\n      <label>Lines</label>\n    </div>\n    <div class=\"stat-box\">\n      <span id=\"read-time\">0s</span>\n      <label>Read Time</label>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.char-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n}\n\n.widget-title {\n    margin: 0 0 1.25rem 0;\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    text-align: center;\n}\n\ntextarea {\n    width: 100%;\n    height: 140px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 12px;\n    padding: 12px;\n    font-size: 0.9rem;\n    outline: none;\n    resize: vertical;\n    margin-bottom: 1.25rem;\n    font-family: var(--font-monospace);\n    transition: border-color 0.2s;\n    display: block;\n}\n\ntextarea:focus {\n    border-color: var(--interactive-accent);\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 10px;\n}\n\n.stat-box {\n    background: var(--background-primary);\n    padding: 12px 4px;\n    border-radius: 10px;\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.stat-box span {\n    display: block;\n    font-size: 1.1rem;\n    font-weight: 700;\n    color: var(--interactive-accent);\n}\n\n.stat-box label {\n    font-size: 0.65rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    color: var(--text-muted);\n    letter-spacing: 0.02em;\n}",
      "js": "const { root, saveState, getState } = api;\n\nfunction updateStats() {\n    const text = root.getElementById('text-input').value;\n    \n    const chars = text.length;\n    const words = text.trim() ? text.trim().split(/\\s+/).length : 0;\n    const lines = text ? text.split('\\n').length : 0;\n    \n    // Reading time calculation (200 words per minute)\n    const readTimeSec = Math.round((words / 200) * 60);\n    let readTimeStr = \"0s\";\n    \n    if (words > 0) {\n        if (readTimeSec < 60) {\n            readTimeStr = Math.max(1, readTimeSec) + \"s\";\n        } else {\n            const mins = Math.floor(readTimeSec / 60);\n            const secs = readTimeSec % 60;\n            readTimeStr = secs > 0 ? `${mins}m ${secs}s` : `${mins}m`;\n        }\n    }\n\n    root.getElementById('char-count').innerText = chars.toLocaleString();\n    root.getElementById('word-count').innerText = words.toLocaleString();\n    root.getElementById('line-count').innerText = lines.toLocaleString();\n    root.getElementById('read-time').innerText = readTimeStr;\n}\n\nfunction save() {\n    const text = root.getElementById('text-input').value;\n    saveState(text);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        root.getElementById('text-input').value = saved;\n        updateStats();\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "color-palette-gen",
      "title": "Color Palette Generator",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"palette-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🎨 Palette Studio</h4>\n    <button id=\"btn-edit-mode\" class=\"edit-toggle-btn\" onclick=\"toggleEditMode()\" title=\"Toggle Edit Mode\">Edit</button>\n  </div>\n  \n  <div class=\"main-palette\" id=\"palette\"></div>\n\n  <div class=\"controls\">\n    <button class=\"btn-gen\" id=\"btn-gen\">Generate</button>\n    <button class=\"btn-save-p\" id=\"btn-save-p\" title=\"Save Palette\">💾</button>\n  </div>\n\n  <div class=\"favorites-section\" id=\"favorites-section\" style=\"display: none;\">\n    <div class=\"fav-header\">\n      <span>Favorites</span>\n      <button class=\"btn-clear-fav\" id=\"btn-clear-fav\">Clear All</button>\n    </div>\n    <div class=\"fav-list\" id=\"fav-list\"></div>\n  </div>\n\n  <div class=\"saved-palettes-section\" id=\"saved-palettes-section\" style=\"display: none;\">\n    <div class=\"fav-header\">\n      <span>Saved Palettes</span>\n    </div>\n    <div class=\"palettes-list\" id=\"palettes-list\"></div>\n  </div>\n\n  <div class=\"toast\" id=\"toast\">Copied!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.palette-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    position: relative;\n    width: 100%;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.25rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n}\n\n.edit-toggle-btn {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    font-size: 0.65rem;\n    padding: 2px 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n.edit-toggle-btn.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border-color: var(--interactive-accent);\n}\n\n.main-palette {\n    display: flex;\n    height: 120px;\n    border-radius: 12px;\n    overflow: hidden;\n    margin-bottom: 1rem;\n    border: 1px solid var(--background-modifier-border);\n    box-shadow: var(--shadow-m);\n}\n\n.color-swatch {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-end;\n    padding-bottom: 10px;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n}\n.color-swatch:hover { flex: 2; }\n\n.swatch-actions {\n    display: flex;\n    gap: 4px;\n    opacity: 0;\n    transform: translateY(10px);\n    transition: all 0.2s ease;\n}\n.color-swatch:hover .swatch-actions {\n    opacity: 1;\n    transform: translateY(0);\n}\n\n.swatch-btn {\n    background: rgba(0,0,0,0.4);\n    color: white;\n    border: none;\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    font-size: 0.7rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    backdrop-filter: blur(4px);\n}\n.swatch-btn:hover { background: rgba(0,0,0,0.6); }\n\n.color-code {\n    font-size: 0.6rem;\n    font-weight: 700;\n    color: white;\n    background: rgba(0,0,0,0.3);\n    padding: 2px 6px;\n    border-radius: 4px;\n    margin-top: 4px;\n    opacity: 0;\n    transition: opacity 0.2s;\n}\n.color-swatch:hover .color-code { opacity: 1; }\n\n.controls {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 1rem;\n}\n\n.btn-gen {\n    flex: 1;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 10px;\n    border-radius: 8px;\n    font-weight: 600;\n    font-size: 0.85rem;\n    cursor: pointer;\n    transition: opacity 0.2s;\n}\n.btn-gen:hover { opacity: 0.9; }\n\n.btn-save-p {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    width: 40px;\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1rem;\n}\n.btn-save-p:hover { background: var(--background-modifier-hover); }\n\n/* Favorites & Saved Palettes */\n.favorites-section, .saved-palettes-section {\n    background: var(--background-primary);\n    border-radius: 10px;\n    padding: 10px;\n    margin-top: 10px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.fav-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.btn-clear-fav {\n    background: none;\n    border: none;\n    color: var(--text-error);\n    font-size: 0.6rem;\n    cursor: pointer;\n    text-decoration: underline;\n}\n\n.fav-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n}\n\n.fav-item {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    border: 1px solid var(--background-modifier-border);\n    cursor: pointer;\n    position: relative;\n    transition: transform 0.1s;\n}\n.fav-item:hover { transform: scale(1.1); }\n\n/* Edit Mode Overlays */\n.edit-mode .fav-item:hover::after {\n    content: '✕';\n    position: absolute;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(239, 68, 68, 0.8);\n    color: white;\n    font-size: 0.6rem;\n    border-radius: 50%;\n}\n\n.palettes-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.saved-palette-row {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.saved-palette-item {\n    display: flex;\n    flex: 1;\n    height: 24px;\n    border-radius: 6px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n    position: relative;\n}\n\n.mini-swatch {\n    flex: 1;\n    height: 100%;\n    cursor: pointer;\n    transition: flex 0.2s;\n}\n.mini-swatch:hover { flex: 1.5; }\n\n.btn-restore-p {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n    font-size: 0.7rem;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.btn-restore-p:hover { background: var(--background-modifier-hover); color: var(--interactive-accent); }\n\n.btn-delete-p {\n    display: none;\n    background: var(--background-modifier-error);\n    color: white;\n    border: none;\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n    font-size: 0.7rem;\n    cursor: pointer;\n    align-items: center;\n    justify-content: center;\n}\n.edit-mode .btn-delete-p { display: flex; }\n.edit-mode .btn-restore-p { display: none; }\n\n.toast {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: var(--text-success);\n    color: white;\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    opacity: 0;\n    transition: all 0.3s;\n    pointer-events: none;\n    z-index: 10;\n    box-shadow: var(--shadow-l);\n}",
      "js": "const { root, saveState, getState } = api;\nlet state = {\n    current: ['#264653', '#2a9d8f', '#e9c46a', '#f4a261', '#e76f51'],\n    favorites: [],\n    palettes: []\n};\nlet isEditMode = false;\n\nfunction toggleEditMode() {\n    isEditMode = !isEditMode;\n    const btn = root.getElementById('btn-edit-mode');\n    btn.classList.toggle('active', isEditMode);\n    btn.innerText = isEditMode ? 'Done' : 'Edit';\n    root.querySelector('.palette-widget').classList.toggle('edit-mode', isEditMode);\n    render();\n}\n\nfunction render() {\n    const container = root.getElementById('palette');\n    container.innerHTML = '';\n    state.current.forEach(c => {\n        const swatch = document.createElement('div');\n        swatch.className = 'color-swatch';\n        swatch.style.background = c;\n        swatch.innerHTML = `\n            <div class=\"swatch-actions\">\n                <button class=\"swatch-btn btn-copy\" title=\"Copy\">📋</button>\n                <button class=\"swatch-btn btn-fav\" title=\"Favorite\">❤️</button>\n            </div>\n            <span class=\"color-code\">${c.toUpperCase()}</span>\n        `;\n        swatch.querySelector('.btn-copy').onclick = (e) => { e.stopPropagation(); copy(c); };\n        swatch.querySelector('.btn-fav').onclick = (e) => { e.stopPropagation(); addFav(c); };\n        swatch.onclick = () => copy(c);\n        container.appendChild(swatch);\n    });\n\n    const favSection = root.getElementById('favorites-section');\n    const favList = root.getElementById('fav-list');\n    if (state.favorites.length > 0) {\n        favSection.style.display = 'block';\n        favList.innerHTML = '';\n        state.favorites.forEach((c, idx) => {\n            const item = document.createElement('div');\n            item.className = 'fav-item';\n            item.style.background = c;\n            item.title = isEditMode ? 'Click to Delete' : 'Click to Copy: ' + c;\n            item.onclick = () => isEditMode ? removeFav(idx) : copy(c);\n            favList.appendChild(item);\n        });\n    } else {\n        favSection.style.display = 'none';\n    }\n\n    const palSection = root.getElementById('saved-palettes-section');\n    const palList = root.getElementById('palettes-list');\n    if (state.palettes.length > 0) {\n        palSection.style.display = 'block';\n        palList.innerHTML = '';\n        state.palettes.forEach((p, idx) => {\n            const row = document.createElement('div');\n            row.className = 'saved-palette-row';\n            const item = document.createElement('div');\n            item.className = 'saved-palette-item';\n            item.innerHTML = p.map(c => `<div class=\"mini-swatch\" style=\"background:${c}\" title=\"Copy: ${c}\"></div>`).join('');\n            item.querySelectorAll('.mini-swatch').forEach((s, sIdx) => {\n                s.onclick = (e) => {\n                    if (!isEditMode) {\n                        e.stopPropagation();\n                        copy(p[sIdx]);\n                    }\n                };\n            });\n            const restoreBtn = document.createElement('button');\n            restoreBtn.className = 'btn-restore-p';\n            restoreBtn.innerHTML = '🔄';\n            restoreBtn.title = 'Restore Palette';\n            restoreBtn.onclick = () => restorePalette(idx);\n            const deleteBtn = document.createElement('button');\n            deleteBtn.className = 'btn-delete-p';\n            deleteBtn.innerHTML = '✕';\n            deleteBtn.title = 'Delete Palette';\n            deleteBtn.onclick = () => removePalette(idx);\n            row.appendChild(item);\n            row.appendChild(restoreBtn);\n            row.appendChild(deleteBtn);\n            palList.appendChild(row);\n        });\n    } else {\n        palSection.style.display = 'none';\n    }\n}\n\nfunction generate() {\n    state.current = [];\n    for (let i = 0; i < 5; i++) {\n        state.current.push('#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0'));\n    }\n    render();\n    saveState(state);\n}\n\nfunction addFav(color) {\n    if (!state.favorites.includes(color)) {\n        state.favorites.push(color);\n        render();\n        saveState(state);\n        showToast('Color added to favorites!');\n    }\n}\n\nfunction removeFav(idx) {\n    state.favorites.splice(idx, 1);\n    render();\n    saveState(state);\n}\n\nfunction saveCurrentPalette() {\n    state.palettes.unshift([...state.current]);\n    if (state.palettes.length > 20) state.palettes.pop();\n    render();\n    saveState(state);\n    showToast('Palette saved!');\n}\n\nfunction removePalette(idx) {\n    state.palettes.splice(idx, 1);\n    render();\n    saveState(state);\n}\n\nfunction restorePalette(idx) {\n    state.current = [...state.palettes[idx]];\n    render();\n    saveState(state);\n    showToast('Palette restored!');\n}\n\nfunction copy(text) {\n    navigator.clipboard.writeText(text).then(() => {\n        showToast('Copied: ' + text.toUpperCase());\n    });\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    toast.innerText = msg;\n    toast.style.opacity = '1';\n    toast.style.transform = 'translate(-50%, -50%) scale(1.1)';\n    setTimeout(() => {\n        toast.style.opacity = '0';\n        toast.style.transform = 'translate(-50%, -50%) scale(1)';\n    }, 1500);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && saved.current) state = saved;\n    root.getElementById('btn-gen').onclick = generate;\n    root.getElementById('btn-save-p').onclick = saveCurrentPalette;\n    root.getElementById('btn-clear-fav').onclick = () => {\n        if (confirm('Clear all favorites?')) {\n            state.favorites = [];\n            render();\n            saveState(state);\n        }\n    };\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "countdown-timer",
      "title": "Countdown Timer",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\" id=\"event-title\">⏳ Event Countdown</h4>\n  </div>\n  \n  <div class=\"countdown-grid\">\n    <div class=\"time-box\">\n      <span id=\"days\">00</span>\n      <label>Days</label>\n    </div>\n    <div class=\"time-box\">\n      <span id=\"hours\">00</span>\n      <label>Hours</label>\n    </div>\n    <div class=\"time-box\">\n      <span id=\"mins\">00</span>\n      <label>Mins</label>\n    </div>\n    <div class=\"time-box\">\n      <span id=\"secs\">00</span>\n      <label>Secs</label>\n    </div>\n  </div>\n\n  <div class=\"settings-panel\">\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"event-name\" placeholder=\"Event Name...\">\n      <input type=\"date\" id=\"event-date\">\n    </div>\n    <div class=\"btn-row\">\n      <button id=\"btn-set\" class=\"btn-primary\">Set Event</button>\n      <button id=\"btn-clear\" class=\"btn-secondary\">Clear</button>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow-s); text-align: center; max-width: 360px; margin: 0 auto; } .widget-header { margin-bottom: 1.5rem; } .widget-title { margin: 0; font-size: 0.9rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1px; } .countdown-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 1.5rem; } .time-box { background: var(--background-primary); padding: 12px 4px; border-radius: 12px; border: 1px solid var(--background-modifier-border); transition: transform 0.2s ease; } .time-box:hover { transform: translateY(-2px); border-color: var(--interactive-accent); } .time-box span { display: block; font-size: 1.5rem; font-weight: 900; font-family: var(--font-monospace); color: var(--interactive-accent); } .time-box label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); } .settings-panel { background: var(--background-primary-alt); padding: 12px; border-radius: 12px; border: 1px solid var(--background-modifier-border); } .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; } .input-group input { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-normal); padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; outline: none; width: 100%; } .input-group input:focus { border-color: var(--interactive-accent); } .btn-row { display: flex; gap: 8px; } button { flex: 1; padding: 10px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; cursor: pointer; border: none; transition: opacity 0.2s; } button:hover { opacity: 0.9; } .btn-primary { background: var(--interactive-accent); color: var(--text-on-accent); } .btn-secondary { background: var(--background-modifier-border); color: var(--text-normal); }",
      "js": "var state = {\n    title: 'Next Vacation',\n    targetDate: new Date(Date.now() + 1000 * 60 * 60 * 24 * 30).toISOString().split('T')[0]\n};\nvar timerId = null;\n\nfunction startCountdown() {\n    if (timerId) clearInterval(timerId);\n    \n    var titleEl = api.root.getElementById('event-title');\n    if (titleEl) titleEl.innerText = '⏳ ' + state.title;\n    \n    timerId = setInterval(function() {\n        var now = new Date().getTime();\n        var target = new Date(state.targetDate).getTime();\n        var diff = target - now;\n        \n        if (diff <= 0) {\n            clearInterval(timerId);\n            updateDisplay(0, 0, 0, 0);\n            return;\n        }\n        \n        var days = Math.floor(diff / (1000 * 60 * 60 * 24));\n        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n        var mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n        var secs = Math.floor((diff % (1000 * 60)) / 1000);\n        \n        updateDisplay(days, hours, mins, secs);\n    }, 1000);\n}\n\nfunction updateDisplay(d, h, m, s) {\n    var dEl = api.root.getElementById('days');\n    var hEl = api.root.getElementById('hours');\n    var mEl = api.root.getElementById('mins');\n    var sEl = api.root.getElementById('secs');\n    \n    if (dEl) dEl.innerText = d.toString().padStart(2, '0');\n    if (hEl) hEl.innerText = h.toString().padStart(2, '0');\n    if (mEl) mEl.innerText = m.toString().padStart(2, '0');\n    if (sEl) sEl.innerText = s.toString().padStart(2, '0');\n}\n\nfunction updateEvent() {\n    var nameInput = api.root.getElementById('event-name');\n    var dateInput = api.root.getElementById('event-date');\n    \n    state.title = nameInput.value.trim() || 'Event';\n    state.targetDate = dateInput.value;\n    \n    if (state.targetDate) {\n        startCountdown();\n        api.saveState(state);\n    }\n}\n\nfunction clearEvent() {\n    state = {\n        title: 'Event',\n        targetDate: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7).toISOString().split('T')[0]\n    };\n    var nameInput = api.root.getElementById('event-name');\n    var dateInput = api.root.getElementById('event-date');\n    \n    if (nameInput) nameInput.value = '';\n    if (dateInput) dateInput.value = state.targetDate;\n    \n    startCountdown();\n    api.saveState(state);\n}\n\nasync function init() {\n    var saved = await api.getState();\n    if (saved) state = saved;\n    \n    var nameInput = api.root.getElementById('event-name');\n    var dateInput = api.root.getElementById('event-date');\n    var btnSet = api.root.getElementById('btn-set');\n    var btnClear = api.root.getElementById('btn-clear');\n    \n    if (nameInput) nameInput.value = state.title;\n    if (dateInput) dateInput.value = state.targetDate;\n    \n    if (btnSet) btnSet.onclick = updateEvent;\n    if (btnClear) btnClear.onclick = clearEvent;\n    \n    startCountdown();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "cross-widget-pro",
      "title": "Cross-Widget Controller Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"test-container\">\n  <h4>🔗 Cross-Widget Controller Pro</h4>\n  \n  <div class=\"selector-row\">\n    <label>Target Note:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"note-search\" list=\"note-list\" placeholder=\"Search or select a note...\" onchange=\"handleTargetChange()\">\n      <datalist id=\"note-list\"></datalist>\n      <button onclick=\"refreshNotes()\" class=\"mini-btn\" title=\"Refresh note list\">🔄</button>\n    </div>\n  </div>\n\n  <div class=\"selector-row\">\n    <label>Target Widget ID:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"widget-id\" list=\"widget-ids-list\" placeholder=\"e.g. my-widget-id\" oninput=\"saveLocalState()\">\n      <datalist id=\"widget-ids-list\"></datalist>\n      <button onclick=\"scanWidgets()\" class=\"mini-btn\" title=\"Scan note for widget IDs\">🔍 Scan</button>\n    </div>\n  </div>\n\n  <div class=\"editor-section\">\n    <div class=\"label-row\">\n      <label>Remote State (JSON):</label>\n      <div class=\"mini-actions\">\n        <button onclick=\"fetchRemoteState()\" class=\"mini-btn\">📥 Fetch</button>\n        <button onclick=\"clearEditor()\" class=\"mini-btn\">🗑️</button>\n      </div>\n    </div>\n    <textarea id=\"state-editor\" placeholder=\"Fetch a widget to see its data...\"></textarea>\n  </div>\n  \n  <div class=\"actions\">\n    <button onclick=\"pushRemoteState()\" class=\"save-btn\">📤 Push Update to Remote</button>\n  </div>\n\n  <div class=\"quick-add\">\n    <label>Quick Remote Increment:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"prop-key\" placeholder=\"Property key (e.g. count)\" oninput=\"saveLocalState()\">\n      <button onclick=\"remoteIncrement()\" class=\"accent-btn\">+1</button>\n    </div>\n  </div>\n\n  <div id=\"status-bar\" class=\"status\">Ready</div>\n</div>",
      "css": ".test-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 15px;\n    color: var(--text-normal);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n.selector-row, .editor-section, .quick-add {\n    margin-bottom: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n}\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 5px;\n}\n.mini-actions {\n    display: flex;\n    gap: 4px;\n}\nlabel {\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: var(--text-muted);\n    letter-spacing: 0.5px;\n}\n.search-wrapper {\n    display: flex;\n    gap: 8px;\n    width: 100%;\n}\n#note-search, #widget-id, #prop-key, #state-editor {\n    width: 100%;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 8px;\n    font-size: 0.8rem;\n    outline: none;\n    transition: border-color 0.2s;\n}\n#state-editor {\n    height: 140px;\n    font-family: var(--font-monospace);\n    resize: vertical;\n    color: var(--text-accent);\n    line-height: 1.4;\n}\n#note-search:focus, #widget-id:focus, #state-editor:focus {\n    border-color: var(--interactive-accent);\n}\n.actions { display: flex; gap: 8px; margin-bottom: 15px; }\nbutton {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px 12px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: filter 0.2s;\n}\nbutton:hover { filter: brightness(1.1); }\nbutton.save-btn {\n    background: var(--background-modifier-success);\n    color: white;\n    flex: 1;\n}\nbutton.accent-btn {\n    background: var(--interactive-accent);\n    min-width: 50px;\n}\n.mini-btn {\n    padding: 4px 8px;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.7rem;\n}\n.mini-btn:hover {\n    background: var(--background-secondary-alt);\n}\n.status {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    margin-top: 10px;\n    font-style: italic;\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 8px;\n    display: flex;\n    justify-content: space-between;\n}",
      "js": "async function saveLocalState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const key = root.getElementById('prop-key').value;\n    await api.saveState({ targetPath: path, targetId: id, propKey: key });\n}\n\nasync function handleTargetChange() {\n    await saveLocalState();\n    await scanWidgets();\n    await fetchRemoteState();\n}\n\nasync function refreshNotes() {\n    const datalist = root.getElementById('note-list');\n    const files = api.getFiles('md');\n    \n    datalist.innerHTML = '<option value=\"\">Current Note</option>';\n    files.forEach(file => {\n        const option = document.createElement('option');\n        option.value = file;\n        datalist.appendChild(option);\n    });\n    setStatus(\"Note list updated\");\n}\n\nasync function scanWidgets() {\n    const path = root.getElementById('note-search').value;\n    const datalist = root.getElementById('widget-ids-list');\n    setStatus(\"Scanning note...\");\n    \n    const content = await api.readFile(path);\n    if (!content) {\n        setStatus(\"Note not found\");\n        return;\n    }\n\n    const regex = /ID:\\s*([a-zA-Z0-9_-]+)/g;\n    const ids = new Set();\n    let match;\n    while ((match = regex.exec(content)) !== null) {\n        ids.add(match[1]);\n    }\n\n    datalist.innerHTML = '';\n    ids.forEach(id => {\n        const option = document.createElement('option');\n        option.value = id;\n        datalist.appendChild(option);\n    });\n\n    if (ids.size > 0) {\n        setStatus(`Found ${ids.size} widgets`);\n    } else {\n        setStatus(\"No widgets found\");\n    }\n}\n\nasync function fetchRemoteState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const editor = root.getElementById('state-editor');\n\n    if (!id) {\n        setStatus(\"Enter a Widget ID\");\n        return;\n    }\n\n    setStatus(\"Fetching...\");\n    const state = await api.getWidgetState(id, path);\n    \n    if (state === null) {\n        setStatus(\"No data found\");\n        editor.value = \"\";\n    } else {\n        editor.value = JSON.stringify(state, null, 2);\n        setStatus(\"State fetched\");\n    }\n}\n\nasync function pushRemoteState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const content = root.getElementById('state-editor').value;\n\n    if (!id || !content) {\n        new Notice(\"ID and Data required\");\n        return;\n    }\n\n    try {\n        const data = JSON.parse(content);\n        setStatus(\"Pushing...\");\n        await api.updateWidgetState(id, data, path);\n        new Notice(\"Remote widget updated!\");\n        setStatus(\"Push successful\");\n    } catch (e) {\n        new Notice(\"Invalid JSON format\");\n        setStatus(\"Error: Invalid JSON\");\n    }\n}\n\nasync function remoteIncrement() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const key = root.getElementById('prop-key').value || \"count\";\n\n    if (!id) {\n        new Notice(\"Widget ID required\");\n        return;\n    }\n\n    setStatus(\"Incrementing...\");\n    const state = await api.getWidgetState(id, path) || {};\n    const currentVal = Number(state[key]) || 0;\n    state[key] = currentVal + 1;\n    \n    await api.updateWidgetState(id, state, path);\n    new Notice(`Remote ${key} is now ${state[key]}`);\n    await fetchRemoteState();\n}\n\nfunction clearEditor() {\n    root.getElementById('state-editor').value = \"\";\n    setStatus(\"Editor cleared\");\n}\n\nfunction setStatus(msg) {\n    root.getElementById('status-bar').innerText = msg;\n}\n\nasync function init() {\n    refreshNotes();\n    \n    const saved = await api.getState();\n    if (saved) {\n        if (saved.targetPath) root.getElementById('note-search').value = saved.targetPath;\n        if (saved.targetId) root.getElementById('widget-id').value = saved.targetId;\n        if (saved.propKey) root.getElementById('prop-key').value = saved.propKey;\n    }\n    \n    if (root.getElementById('widget-id').value) {\n        await scanWidgets();\n        await fetchRemoteState();\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "crypto-tracker",
      "title": "Crypto Tracker",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"crypto-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🚀 Crypto Studio</h4>\n    <button class=\"btn-refresh\" id=\"btn-refresh\" title=\"Refresh Prices\">↻</button>\n  </div>\n\n  <div class=\"balance-summary\">\n    <div class=\"summary-label\">Market Sentiment</div>\n    <div class=\"summary-value\" id=\"market-status\">Loading...</div>\n  </div>\n\n  <div class=\"crypto-list\" id=\"crypto-list\"></div>\n\n  <div class=\"add-section\">\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"coin-id\" placeholder=\"Coin ID (e.g. bitcoin, solana)...\" class=\"modern-input\">\n      <button id=\"btn-add\" class=\"add-btn\">Add</button>\n    </div>\n    <div class=\"hint\">Use CoinGecko IDs (e.g. 'ethereum', 'cardano')</div>\n  </div>\n\n  <div class=\"last-update\" id=\"last-update\">Last updated: Never</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.crypto-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.25rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n}\n\n.btn-refresh {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--interactive-accent);\n    width: 32px;\n    height: 32px;\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1rem;\n    transition: all 0.3s ease;\n}\n.btn-refresh:hover { background: var(--background-modifier-hover); transform: rotate(180deg); }\n.btn-refresh.loading { animation: spin 1s linear infinite; pointer-events: none; }\n@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n\n.balance-summary {\n    background: var(--background-primary);\n    border-radius: 12px;\n    padding: 1rem;\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n    margin-bottom: 1.25rem;\n}\n.summary-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; margin-bottom: 4px; }\n.summary-value { font-size: 1.1rem; font-weight: 700; color: var(--interactive-accent); }\n\n.crypto-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 1.25rem;\n}\n\n.crypto-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px 14px;\n    background: var(--background-primary);\n    border-radius: 10px;\n    border: 1px solid var(--background-modifier-border);\n    transition: all 0.2s ease;\n    animation: slideIn 0.3s ease-out;\n}\n@keyframes slideIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }\n.crypto-item:hover { border-color: var(--interactive-accent); transform: translateX(2px); }\n\n.coin-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n.coin-img {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--background-secondary);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.8rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    border: 1px solid var(--background-modifier-border);\n}\n.coin-meta {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n.coin-name {\n    font-size: 0.85rem;\n    font-weight: 700;\n    color: var(--text-normal);\n    text-transform: capitalize;\n}\n.coin-symbol {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    font-weight: 600;\n}\n\n.coin-data {\n    text-align: right;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n.price-box { display: flex; flex-direction: column; gap: 2px; }\n.price { font-size: 0.9rem; font-weight: 700; }\n.change { font-size: 0.7rem; font-weight: 600; }\n.change.up { color: var(--text-success); }\n.change.down { color: var(--text-error); }\n\n.btn-del {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    cursor: pointer;\n    padding: 4px;\n    border-radius: 4px;\n    opacity: 0;\n    transition: all 0.2s;\n}\n.crypto-item:hover .btn-del { opacity: 1; }\n.btn-del:hover { background: var(--background-modifier-error-hover); color: var(--text-error); }\n\n.add-section {\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 1.25rem;\n    margin-bottom: 1rem;\n}\n.input-group {\n    display: flex;\n    gap: 8px;\n}\n.modern-input {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 8px;\n    padding: 8px 12px;\n    font-size: 0.8rem;\n    outline: none;\n}\n.modern-input:focus { border-color: var(--interactive-accent); }\n\n.add-btn {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px 16px;\n    border-radius: 8px;\n    font-weight: 600;\n    font-size: 0.8rem;\n    cursor: pointer;\n}\n.add-btn:hover { opacity: 0.9; }\n\n.hint {\n    font-size: 0.6rem;\n    color: var(--text-muted);\n    margin-top: 6px;\n    font-style: italic;\n}\n\n.last-update {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    text-align: center;\n    font-style: italic;\n}",
      "js": "const { root, saveState, getState, requestUrl } = api;\nlet trackedCoins = ['bitcoin', 'ethereum', 'solana'];\nlet coinData = {};\n\nasync function fetchPrices() {\n    const refreshBtn = root.getElementById('btn-refresh');\n    if (!refreshBtn) return;\n    refreshBtn.classList.add('loading');\n    \n    try {\n        const ids = trackedCoins.join(',');\n        if (!ids) {\n            coinData = {};\n            render();\n            root.getElementById('last-update').innerText = `Last updated: ${new Date().toLocaleTimeString()}`;\n            root.getElementById('market-status').innerText = 'No coins tracked';\n            return;\n        }\n\n        let data;\n        if (requestUrl) {\n            const response = await requestUrl({\n                url: `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_last_updated_at=true`,\n                method: 'GET'\n            });\n            data = response.json;\n        } else {\n            const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_last_updated_at=true`);\n            data = await response.json();\n        }\n        \n        if (data && Object.keys(data).length > 0) {\n            coinData = data;\n            render();\n            \n            const now = new Date();\n            root.getElementById('last-update').innerText = `Last updated: ${now.toLocaleTimeString()}`;\n            \n            const changes = Object.values(data).map(c => c.usd_24h_change);\n            const avgChange = changes.length > 0 ? changes.reduce((a, b) => a + b, 0) / changes.length : 0;\n            const statusEl = root.getElementById('market-status');\n            if (avgChange > 2) statusEl.innerText = '🔥 Bullish';\n            else if (avgChange < -2) statusEl.innerText = '🧊 Bearish';\n            else statusEl.innerText = '⚖️ Neutral';\n        } else {\n            throw new Error('No data received');\n        }\n        \n    } catch (err) {\n        console.error('Crypto Tracker Error:', err);\n        root.getElementById('last-update').innerText = 'Update failed. Check coin IDs or connection.';\n        root.getElementById('market-status').innerText = '⚠️ Error';\n    } finally {\n        refreshBtn.classList.remove('loading');\n    }\n}\n\nfunction render() {\n    const list = root.getElementById('crypto-list');\n    if (!list) return;\n    list.innerHTML = '';\n\n    trackedCoins.forEach(id => {\n        const data = coinData[id];\n        const item = document.createElement('div');\n        item.className = 'crypto-item';\n        \n        if (!data) {\n            item.innerHTML = `\n                <div class=\"coin-info\">\n                    <div class=\"coin-img\">?</div>\n                    <div class=\"coin-meta\">\n                        <span class=\"coin-name\">${id}</span>\n                        <span class=\"coin-symbol\">Pending...</span>\n                    </div>\n                </div>\n                <div class=\"coin-data\">\n                    <button class=\"btn-del\" title=\"Remove\">✕</button>\n                </div>\n            `;\n        } else {\n            const change = data.usd_24h_change || 0;\n            const isUp = change >= 0;\n            item.innerHTML = `\n                <div class=\"coin-info\">\n                    <div class=\"coin-img\">${id.charAt(0).toUpperCase()}</div>\n                    <div class=\"coin-meta\">\n                        <span class=\"coin-name\">${id}</span>\n                        <span class=\"coin-symbol\">${id.substring(0, 3)}</span>\n                    </div>\n                </div>\n                <div class=\"coin-data\">\n                    <div class=\"price-box\">\n                        <span class=\"price\">$${data.usd.toLocaleString()}</span>\n                        <span class=\"change ${isUp ? 'up' : 'down'}\">${isUp ? '+' : ''}${change.toFixed(2)}%</span>\n                    </div>\n                    <button class=\"btn-del\" title=\"Remove\">✕</button>\n                </div>\n            `;\n        }\n\n        item.querySelector('.btn-del').onclick = (e) => {\n            e.stopPropagation();\n            removeCoin(id);\n        };\n        \n        list.appendChild(item);\n    });\n}\n\nfunction addCoin() {\n    const input = root.getElementById('coin-id');\n    const id = input.value.trim().toLowerCase();\n    \n    if (id && !trackedCoins.includes(id)) {\n        trackedCoins.push(id);\n        input.value = '';\n        fetchPrices();\n        saveState(trackedCoins);\n    }\n}\n\nfunction removeCoin(id) {\n    trackedCoins = trackedCoins.filter(c => c !== id);\n    render();\n    saveState(trackedCoins);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (Array.isArray(saved)) trackedCoins = saved;\n    \n    root.getElementById('btn-refresh').onclick = fetchPrices;\n    root.getElementById('btn-add').onclick = addCoin;\n    root.getElementById('coin-id').onkeydown = (e) => {\n        if (e.key === 'Enter') addCoin();\n    };\n\n    fetchPrices();\n    setInterval(fetchPrices, 300000);\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "cvss-calculator",
      "title": "CVSS Calculator",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"cvss-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🛡️ CVSS v3.1 Studio</h4>\n    <div class=\"header-actions\">\n      <button class=\"btn-icon\" id=\"btn-copy-vector\" title=\"Copy Vector\">📋</button>\n      <button class=\"btn-icon\" id=\"btn-reset\" title=\"Reset\">↺</button>\n    </div>\n  </div>\n\n  <div class=\"score-hero\" id=\"score-hero\">\n    <div class=\"score-main\">\n      <span class=\"score-value\" id=\"cvss-score\">0.0</span>\n      <span class=\"score-label\">Base Score</span>\n    </div>\n    <div class=\"severity-badge\" id=\"severity\">None</div>\n  </div>\n\n  <div class=\"vector-bar\" id=\"vector-display\">CVSS:3.1/AV:_/AC:_/PR:_/UI:_/S:_/C:_/I:_/A:_</div>\n\n  <div class=\"metrics-container\">\n    <div class=\"metric-group\">\n      <div class=\"group-title\">Exploitability Metrics</div>\n      <div class=\"metric-row\">\n        <label>Attack Vector (AV)</label>\n        <select id=\"AV\" class=\"cvss-select\">\n          <option value=\"0.85\">Network (N)</option>\n          <option value=\"0.62\">Adjacent (A)</option>\n          <option value=\"0.55\">Local (L)</option>\n          <option value=\"0.2\">Physical (P)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>Attack Complexity (AC)</label>\n        <select id=\"AC\" class=\"cvss-select\">\n          <option value=\"0.77\">Low (L)</option>\n          <option value=\"0.44\">High (H)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>Privileges Required (PR)</label>\n        <select id=\"PR\" class=\"cvss-select\">\n          <option value=\"0.85\">None (N)</option>\n          <option value=\"0.62\">Low (L)</option>\n          <option value=\"0.27\">High (H)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>User Interaction (UI)</label>\n        <select id=\"UI\" class=\"cvss-select\">\n          <option value=\"0.85\">None (N)</option>\n          <option value=\"0.62\">Required (R)</option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"metric-group\">\n      <div class=\"group-title\">Impact Metrics</div>\n      <div class=\"metric-row\">\n        <label>Scope (S)</label>\n        <select id=\"S\" class=\"cvss-select\">\n          <option value=\"U\">Unchanged (U)</option>\n          <option value=\"C\">Changed (C)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>Confidentiality (C)</label>\n        <select id=\"C\" class=\"cvss-select\">\n          <option value=\"0.56\">High (H)</option>\n          <option value=\"0.22\">Low (L)</option>\n          <option value=\"0\">None (N)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>Integrity (I)</label>\n        <select id=\"I\" class=\"cvss-select\">\n          <option value=\"0.56\">High (H)</option>\n          <option value=\"0.22\">Low (L)</option>\n          <option value=\"0\">None (N)</option>\n        </select>\n      </div>\n      <div class=\"metric-row\">\n        <label>Availability (A)</label>\n        <select id=\"A\" class=\"cvss-select\">\n          <option value=\"0.56\">High (H)</option>\n          <option value=\"0.22\">Low (L)</option>\n          <option value=\"0\">None (N)</option>\n        </select>\n      </div>\n    </div>\n  </div>\n  \n  <div id=\"toast\" class=\"toast\">Copied!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.cvss-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n}\n\n.header-actions { display: flex; gap: 8px; }\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    width: 28px;\n    height: 28px;\n    border-radius: 6px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); color: var(--interactive-accent); }\n\n.score-hero {\n    background: var(--background-primary);\n    border-radius: 12px;\n    padding: 1.5rem;\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n    margin-bottom: 1rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    transition: all 0.3s ease;\n}\n\n.score-main {\n    display: flex;\n    flex-direction: column;\n    line-height: 1;\n}\n\n.score-value {\n    font-size: 3rem;\n    font-weight: 900;\n    color: var(--interactive-accent);\n}\n\n.score-label {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    font-weight: 700;\n    letter-spacing: 0.05em;\n}\n\n.severity-badge {\n    padding: 4px 12px;\n    border-radius: 20px;\n    font-size: 0.7rem;\n    font-weight: 800;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n    background: var(--background-secondary);\n    color: var(--text-muted);\n}\n\n.vector-bar {\n    background: var(--background-secondary-alt);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    padding: 8px 12px;\n    font-family: var(--font-monospace);\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    text-align: center;\n    margin-bottom: 1.5rem;\n    word-break: break-all;\n}\n\n.metrics-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 400px) {\n    .metrics-container { grid-template-columns: 1fr; }\n}\n\n.metric-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.group-title {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-accent);\n    text-transform: uppercase;\n    margin-bottom: 4px;\n    border-bottom: 1px solid var(--background-modifier-border);\n    padding-bottom: 4px;\n}\n\n.metric-row {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.metric-row label {\n    font-size: 0.65rem;\n    font-weight: 600;\n    color: var(--text-muted);\n}\n\n.cvss-select {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 6px;\n    padding: 6px 8px;\n    font-size: 0.8rem;\n    outline: none;\n    cursor: pointer;\n}\n.cvss-select:focus { border-color: var(--interactive-accent); }\n\n.toast {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nconst METRICS = ['AV', 'AC', 'PR', 'UI', 'S', 'C', 'I', 'A'];\n\nfunction getVal(id) {\n    const el = root.getElementById(id);\n    return el ? el.value : '0';\n}\n\nfunction roundup(input) {\n    const int_input = Math.round(input * 100000);\n    if (int_input % 10000 === 0) return int_input / 100000;\n    return (Math.floor(int_input / 10000) + 1) / 10;\n}\n\nfunction calculate() {\n    const av = parseFloat(getVal('AV'));\n    const ac = parseFloat(getVal('AC'));\n    const pr_val = getVal('PR');\n    const ui = parseFloat(getVal('UI'));\n    const s = getVal('S');\n    const c = parseFloat(getVal('C'));\n    const i = parseFloat(getVal('I'));\n    const a = parseFloat(getVal('A'));\n\n    let pr = parseFloat(pr_val);\n    if (s === 'C') {\n        if (pr_val === '0.62') pr = 0.68;\n        if (pr_val === '0.27') pr = 0.5;\n    }\n\n    const iss = 1 - ((1 - c) * (1 - i) * (1 - a));\n    let impact = 0;\n    if (s === 'U') {\n        impact = 6.42 * iss;\n    } else {\n        impact = 7.52 * (iss - 0.029) - 3.25 * Math.pow(iss - 0.02, 15);\n    }\n\n    const exploitability = 8.22 * av * ac * pr * ui;\n    \n    let baseScore = 0;\n    if (impact > 0) {\n        if (s === 'U') {\n            baseScore = roundup(Math.min(impact + exploitability, 10));\n        } else {\n            baseScore = roundup(Math.min(1.08 * (impact + exploitability), 10));\n        }\n    }\n\n    updateUI(baseScore.toFixed(1));\n    save();\n}\n\nfunction updateUI(score) {\n    const scoreEl = root.getElementById('cvss-score');\n    const sevEl = root.getElementById('severity');\n    if (!scoreEl || !sevEl) return;\n    \n    scoreEl.innerText = score;\n    \n    let sev = 'None';\n    let color = 'var(--text-muted)';\n    let bg = 'var(--background-secondary)';\n\n    const s = parseFloat(score);\n    if (s >= 9.0) { sev = 'Critical'; color = '#ffffff'; bg = '#cc0000'; }\n    else if (s >= 7.0) { sev = 'High'; color = '#ffffff'; bg = '#ff4400'; }\n    else if (s >= 4.0) { sev = 'Medium'; color = '#ffffff'; bg = '#ffbb33'; }\n    else if (s >= 0.1) { sev = 'Low'; color = '#ffffff'; bg = '#00c851'; }\n\n    sevEl.innerText = sev;\n    sevEl.style.backgroundColor = bg;\n    sevEl.style.color = color;\n    \n    const vector = `CVSS:3.1/AV:${getShort('AV')}/AC:${getShort('AC')}/PR:${getShort('PR')}/UI:${getShort('UI')}/S:${getVal('S')}/C:${getShort('C')}/I:${getShort('I')}/A:${getShort('A')}`;\n    const vecEl = root.getElementById('vector-display');\n    if (vecEl) vecEl.innerText = vector;\n}\n\nfunction getShort(id) {\n    const el = root.getElementById(id);\n    if (!el) return '_';\n    const text = el.options[el.selectedIndex].text;\n    const match = text.match(/\\(([A-Z])\\)/);\n    return match ? match[1] : '_';\n}\n\nfunction copyVector() {\n    const vecEl = root.getElementById('vector-display');\n    if (!vecEl) return;\n    const vector = vecEl.innerText;\n    navigator.clipboard.writeText(vector);\n    showToast();\n}\n\nfunction showToast() {\n    const toast = root.getElementById('toast');\n    if (!toast) return;\n    toast.classList.add('show');\n    setTimeout(() => toast.classList.remove('show'), 2000);\n}\n\nfunction reset() {\n    METRICS.forEach(m => {\n        const el = root.getElementById(m);\n        if (el) el.selectedIndex = 0;\n    });\n    calculate();\n}\n\nfunction save() {\n    const state = {};\n    METRICS.forEach(m => {\n        const el = root.getElementById(m);\n        if (el) state[m] = el.value;\n    });\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    METRICS.forEach(m => {\n        const el = root.getElementById(m);\n        if (!el) return;\n        if (saved && saved[m]) el.value = saved[m];\n        el.onchange = calculate;\n    });\n\n    const copyBtn = root.getElementById('btn-copy-vector');\n    if (copyBtn) copyBtn.onclick = copyVector;\n    \n    const resetBtn = root.getElementById('btn-reset');\n    if (resetBtn) resetBtn.onclick = reset;\n\n    calculate();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "cyber-tool-converter",
      "title": "Cyber Tool Converter",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"cyber-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🔐 Cyber Studio</h4>\n    <div class=\"header-actions\">\n      <button class=\"btn-icon\" id=\"btn-swap\" title=\"Swap Input/Output\">⇄</button>\n      <button class=\"btn-icon\" id=\"btn-clear\" title=\"Clear All\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"converter-layout\">\n    <div class=\"field-group\">\n      <div class=\"field-header\">\n        <label>Input</label>\n        <select id=\"mode-select\" class=\"mode-select\">\n          <optgroup label=\"Text\">\n            <option value=\"b64-enc\">Base64 Encode</option>\n            <option value=\"b64-dec\">Base64 Decode</option>\n            <option value=\"hex-enc\">Hex Encode</option>\n            <option value=\"hex-dec\">Hex Decode</option>\n            <option value=\"bin-enc\">Binary Encode</option>\n            <option value=\"bin-dec\">Binary Decode</option>\n          </optgroup>\n          <optgroup label=\"Web\">\n            <option value=\"url-enc\">URL Encode</option>\n            <option value=\"url-dec\">URL Decode</option>\n            <option value=\"html-enc\">HTML Encode</option>\n            <option value=\"html-dec\">HTML Decode</option>\n          </optgroup>\n          <optgroup label=\"Ciphers\">\n            <option value=\"rot13\">ROT13</option>\n          </optgroup>\n        </select>\n      </div>\n      <textarea id=\"input-text\" placeholder=\"Enter text or code...\" class=\"cyber-area\"></textarea>\n    </div>\n\n    <div class=\"field-group\">\n      <div class=\"field-header\">\n        <label>Output</label>\n        <button class=\"copy-btn\" id=\"btn-copy\">Copy Result</button>\n      </div>\n      <textarea id=\"output-text\" readonly placeholder=\"Result will appear here...\" class=\"cyber-area output\"></textarea>\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Copied!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.cyber-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n}\n\n.header-actions { display: flex; gap: 8px; }\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    width: 28px;\n    height: 28px;\n    border-radius: 6px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); color: var(--interactive-accent); }\n\n.converter-layout {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.field-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.field-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.field-header label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.mode-select {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 6px;\n    padding: 4px 8px;\n    font-size: 0.75rem;\n    outline: none;\n    cursor: pointer;\n}\n\n.cyber-area {\n    width: 100%;\n    height: 100px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    border-radius: 10px;\n    padding: 12px;\n    font-size: 0.85rem;\n    font-family: var(--font-monospace);\n    outline: none;\n    resize: none;\n    transition: border-color 0.2s;\n}\n.cyber-area:focus { border-color: var(--interactive-accent); }\n.cyber-area.output {\n    background: var(--background-secondary-alt);\n    color: var(--text-accent);\n}\n\n.copy-btn {\n    background: transparent;\n    border: 1px solid var(--interactive-accent);\n    color: var(--interactive-accent);\n    padding: 2px 8px;\n    border-radius: 4px;\n    font-size: 0.65rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.copy-btn:hover { background: var(--interactive-accent); color: var(--text-on-accent); }\n\n.toast {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nfunction convert() {\n    const input = root.getElementById('input-text').value;\n    const mode = root.getElementById('mode-select').value;\n    const output = root.getElementById('output-text');\n    \n    if (!input) {\n        output.value = '';\n        return;\n    }\n\n    try {\n        let result = '';\n        switch (mode) {\n            case 'b64-enc': result = btoa(unescape(encodeURIComponent(input))); break;\n            case 'b64-dec': result = decodeURIComponent(escape(atob(input))); break;\n            case 'hex-enc': result = Array.from(input).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' '); break;\n            case 'hex-dec': result = input.split(/\\s+/).map(h => String.fromCharCode(parseInt(h, 16))).join(''); break;\n            case 'bin-enc': result = Array.from(input).map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' '); break;\n            case 'bin-dec': result = input.split(/\\s+/).map(b => String.fromCharCode(parseInt(b, 2))).join(''); break;\n            case 'url-enc': result = encodeURIComponent(input); break;\n            case 'url-dec': result = decodeURIComponent(input); break;\n            case 'html-enc': result = input.replace(/[&<>'\"/]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','\\'':'&#39;','\"':'&quot;','/':'&#47;'}[m])); break;\n            case 'html-dec': \n                const doc = new DOMParser().parseFromString(input, 'text/html');\n                result = doc.documentElement.textContent;\n                break;\n            case 'rot13': result = input.replace(/[a-zA-Z]/g, c => String.fromCharCode((c <= 'Z' ? 90 : 122) >= (c = c.charCodeAt(0) + 13) ? c : c - 26)); break;\n        }\n        output.value = result;\n    } catch (e) {\n        output.value = '⚠️ Error: Invalid format for ' + mode;\n    }\n}\n\nfunction save() {\n    const input = root.getElementById('input-text').value;\n    const mode = root.getElementById('mode-select').value;\n    saveState({ input, mode });\n}\n\nfunction swap() {\n    const inputEl = root.getElementById('input-text');\n    const outputEl = root.getElementById('output-text');\n    const modeEl = root.getElementById('mode-select');\n    \n    const temp = inputEl.value;\n    inputEl.value = outputEl.value;\n    \n    // Try to invert mode\n    const currentMode = modeEl.value;\n    if (currentMode.endsWith('-enc')) modeEl.value = currentMode.replace('-enc', '-dec');\n    else if (currentMode.endsWith('-dec')) modeEl.value = currentMode.replace('-dec', '-enc');\n    \n    convert();\n    save();\n}\n\nfunction clearAll() {\n    root.getElementById('input-text').value = '';\n    root.getElementById('output-text').value = '';\n    convert();\n    save();\n}\n\nfunction copyResult() {\n    const output = root.getElementById('output-text').value;\n    if (!output) return;\n    navigator.clipboard.writeText(output);\n    showToast();\n}\n\nfunction showToast() {\n    const toast = root.getElementById('toast');\n    toast.classList.add('show');\n    setTimeout(() => toast.classList.remove('show'), 2000);\n}\n\nasync function init() {\n    const saved = await getState();\n    const inputEl = root.getElementById('input-text');\n    const modeEl = root.getElementById('mode-select');\n\n    if (saved) {\n        if (saved.input) inputEl.value = saved.input;\n        if (saved.mode) modeEl.value = saved.mode;\n    }\n\n    inputEl.oninput = convert;\n    inputEl.onblur = save;\n    modeEl.onchange = () => { convert(); save(); };\n    \n    root.getElementById('btn-swap').onclick = swap;\n    root.getElementById('btn-clear').onclick = clearAll;\n    root.getElementById('btn-copy').onclick = copyResult;\n\n    convert();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "daily-affirmations",
      "title": "Daily Quotes",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"quote-icon\">\"</div>\n  <div class=\"quote-container\">\n    <div class=\"affirmation\" id=\"affirmation-text\">Loading quotes...</div>\n    <div class=\"author\" id=\"quote-author\"></div>\n  </div>\n  <button class=\"btn-next\" id=\"btn-next\">New Quote</button>\n  <div class=\"footer\" id=\"last-updated\">Last updated: Just now</div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 16px;\n    padding: 2rem;\n    box-shadow: var(--shadow-s);\n    border: 1px solid var(--background-modifier-border);\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\n.quote-icon {\n    position: absolute;\n    top: -10px;\n    left: 20px;\n    font-size: 6rem;\n    opacity: 0.05;\n    font-family: serif;\n    color: var(--interactive-accent);\n}\n\n.quote-container {\n    min-height: 120px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    margin-bottom: 1.5rem;\n}\n\n.affirmation {\n    font-size: 1.2rem;\n    font-weight: 600;\n    line-height: 1.5;\n    margin-bottom: 0.5rem;\n    color: var(--text-normal);\n}\n\n.author {\n    font-size: 0.9rem;\n    font-style: italic;\n    color: var(--text-muted);\n    font-weight: 500;\n}\n\n.btn-next {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 10px 20px;\n    border-radius: 8px;\n    font-weight: 600;\n    font-size: 0.8rem;\n    cursor: pointer;\n    transition: opacity 0.2s;\n}\n.btn-next:hover { opacity: 0.8; }\n\n.footer {\n    margin-top: 1.5rem;\n    font-size: 0.65rem;\n    color: var(--text-faint);\n    font-weight: 500;\n}",
      "js": "const { root, saveState, getState } = api;\nconst QUOTES_URL = 'https://raw.githubusercontent.com/dwyl/quotes/main/quotes.json';\nlet quotes = [];\nlet updateInterval;\n\nasync function fetchQuotes() {\n    try {\n        const response = await fetch(QUOTES_URL);\n        quotes = await response.json();\n        return true;\n    } catch (e) {\n        console.error('Failed to fetch quotes', e);\n        root.getElementById('affirmation-text').innerText = 'Failed to load quotes.';\n        return false;\n    }\n}\n\nfunction displayRandomQuote() {\n    if (quotes.length === 0) return;\n    \n    const quote = quotes[Math.floor(Math.random() * quotes.length)];\n    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    \n    root.getElementById('affirmation-text').innerText = quote.text;\n    root.getElementById('quote-author').innerText = quote.author ? '- ' + quote.author : '';\n    root.getElementById('last-updated').innerText = 'Last updated: ' + time;\n    \n    saveState({ quote, time });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && saved.quote) {\n        root.getElementById('affirmation-text').innerText = saved.quote.text;\n        root.getElementById('quote-author').innerText = saved.quote.author ? '- ' + saved.quote.author : '';\n        root.getElementById('last-updated').innerText = 'Last updated: ' + saved.time;\n    }\n\n    const success = await fetchQuotes();\n    if (success) {\n        if (!saved) displayRandomQuote();\n        \n        // Update every 10 minutes\n        clearInterval(updateInterval);\n        updateInterval = setInterval(displayRandomQuote, 10 * 60 * 1000);\n    }\n    \n    root.getElementById('btn-next').onclick = displayRandomQuote;\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "daily-gratitude",
      "title": "Gratitude Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"gratitude-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <h4 class=\"widget-title\">✨ Gratitude Studio</h4>\n      <div class=\"streak-badge\" id=\"streak-display\">🔥 0 day streak</div>\n    </div>\n    <button class=\"btn-icon\" id=\"btn-history\" title=\"View Memories\">📜</button>\n  </div>\n\n  <div class=\"jar-container\" id=\"jar\">\n    <div class=\"jar-bg-animated\"></div>\n    <div class=\"bubbles-area\" id=\"bubbles-container\"></div>\n    <div class=\"empty-state\" id=\"empty-msg\">Your jar is waiting for<br>a beautiful memory...</div>\n  </div>\n\n  <div class=\"input-section\">\n    <div class=\"input-wrapper\">\n      <input type=\"text\" id=\"grat-input\" placeholder=\"Today, I am grateful for...\" maxlength=\"40\">\n      <button id=\"btn-add\" class=\"add-btn\">✨</button>\n    </div>\n  </div>\n\n  <div class=\"history-drawer\" id=\"history-drawer\">\n    <div class=\"drawer-blur\"></div>\n    <div class=\"drawer-content\">\n      <div class=\"drawer-header\">\n        <span>Memory Lane</span>\n        <button id=\"btn-close-history\" class=\"close-btn\">✕</button>\n      </div>\n      <div class=\"history-list\" id=\"history-list\"></div>\n      <div class=\"drawer-footer\">\n        <button id=\"btn-clear\" class=\"btn-clear\">Clear All Memories</button>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Memory Saved!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.gratitude-widget {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    color: var(--text-accent);\n}\n\n.streak-badge {\n    font-size: 0.65rem;\n    font-weight: 600;\n    color: var(--text-on-accent);\n    background: var(--interactive-accent);\n    padding: 2px 10px;\n    border-radius: 12px;\n    margin-top: 4px;\n    display: inline-block;\n}\n\n.btn-icon {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    width: 34px;\n    height: 34px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1rem;\n    color: var(--text-muted);\n    transition: all 0.2s ease;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); color: var(--text-normal); }\n\n.jar-container {\n    height: 300px;\n    background: #0f172a;\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 20px 20px 60px 60px;\n    position: relative;\n    margin-bottom: 1.5rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n    box-shadow: inset 0 4px 30px rgba(0,0,0,0.5);\n}\n\n.jar-bg-animated {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);\n    background-size: 400% 400%;\n    animation: gradientBG 15s ease infinite;\n    opacity: 0.6;\n    z-index: 0;\n}\n\n@keyframes gradientBG {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n}\n\n.empty-state {\n    text-align: center;\n    font-size: 0.8rem;\n    color: #fff;\n    font-style: italic;\n    z-index: 1;\n    pointer-events: none;\n    opacity: 0.8;\n    text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n}\n\n.bubbles-area {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    z-index: 2;\n}\n\n.bubble {\n    position: absolute;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n    padding: 12px;\n    font-size: 0.65rem;\n    font-weight: 800;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.3), inset 0 0 20px rgba(255,255,255,0.4);\n    border: 1px solid rgba(255,255,255,0.3);\n    word-break: break-word;\n    line-height: 1.1;\n    cursor: pointer;\n    will-change: transform;\n    user-select: none;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0,0,0,0.5);\n    background-size: 200% 200%;\n    animation: bubbleGradient 3s ease infinite;\n}\n\n@keyframes bubbleGradient {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n}\n\n.input-section {\n    position: relative;\n    z-index: 10;\n}\n\n.input-wrapper {\n    display: flex;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 14px;\n    padding: 4px;\n}\n.input-wrapper:focus-within { border-color: var(--interactive-accent); }\n\n#grat-input {\n    flex: 1;\n    border: none;\n    background: none;\n    padding: 8px 12px;\n    font-size: 0.9rem;\n    color: var(--text-normal);\n    outline: none;\n}\n\n.add-btn {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    width: 38px;\n    height: 38px;\n    border-radius: 10px;\n    font-size: 1.1rem;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.history-drawer {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    z-index: 100;\n    visibility: hidden;\n}\n.history-drawer.open { visibility: visible; }\n\n.drawer-blur {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: rgba(0, 0, 0, 0.4);\n    backdrop-filter: blur(8px);\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n.history-drawer.open .drawer-blur { opacity: 1; }\n\n.drawer-content {\n    position: absolute;\n    bottom: 0; left: 0; width: 100%; height: 85%;\n    background: var(--background-primary);\n    border-radius: 24px 24px 0 0;\n    padding: 1.5rem;\n    transform: translateY(100%);\n    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    display: flex;\n    flex-direction: column;\n    border-top: 1px solid var(--background-modifier-border);\n}\n.history-drawer.open .drawer-content { transform: translateY(0); }\n\n.drawer-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n.drawer-header span { font-size: 1rem; font-weight: 700; color: var(--text-accent); }\n\n.close-btn {\n    background: var(--background-secondary);\n    border: none;\n    width: 30px;\n    height: 30px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--text-muted);\n}\n\n.history-list {\n    flex: 1;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.history-day {\n    background: var(--background-secondary);\n    border-radius: 12px;\n    padding: 12px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.day-date {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-accent);\n    text-transform: uppercase;\n    margin-bottom: 4px;\n    display: block;\n}\n.day-items {\n    font-size: 0.8rem;\n    line-height: 1.5;\n    color: var(--text-normal);\n}\n\n.drawer-footer {\n    padding-top: 1rem;\n    text-align: center;\n}\n\n.btn-clear {\n    background: none;\n    border: none;\n    color: var(--text-error);\n    font-size: 0.7rem;\n    font-weight: 600;\n    cursor: pointer;\n    opacity: 0.7;\n}\n\n.toast {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-success);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s ease;\n    z-index: 200;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    today: [],\n    history: [],\n    streak: 0,\n    lastDate: null\n};\n\nconst BUBBLE_GRADIENTS = [\n    'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)',\n    'linear-gradient(45deg, #5ee7df 0%, #b490ca 100%)',\n    'linear-gradient(45deg, #c31432 0%, #240b36 100%)',\n    'linear-gradient(45deg, #0093E9 0%, #80D0C7 100%)',\n    'linear-gradient(45deg, #FBAB7E 0%, #F7CE68 100%)',\n    'linear-gradient(45deg, #85FFBD 0%, #FFFB7D 100%)'\n];\n\nlet bubbles = [];\nlet animationId = null;\n\nclass Bubble {\n    constructor(text, i) {\n        this.text = text;\n        this.el = document.createElement('div');\n        this.el.className = 'bubble';\n        this.el.innerText = text;\n        \n        this.el.style.backgroundImage = BUBBLE_GRADIENTS[i % BUBBLE_GRADIENTS.length];\n        \n        this.radius = Math.max(35, Math.min(50, 30 + text.length * 1.2));\n        this.el.style.width = (this.radius * 2) + 'px';\n        this.el.style.height = (this.radius * 2) + 'px';\n        \n        this.x = Math.random() * 100 + 50;\n        this.y = Math.random() * 100 + 50;\n        this.vx = (Math.random() - 0.5) * 1.5;\n        this.vy = (Math.random() - 0.5) * 1.5;\n        \n        this.el.onmouseenter = () => {\n            this.vx += (Math.random() - 0.5) * 4;\n            this.vy += (Math.random() - 0.5) * 4;\n        };\n        \n        this.el.onclick = () => {\n            this.vx *= 2;\n            this.vy *= 2;\n        };\n\n        root.getElementById('bubbles-container').appendChild(this.el);\n    }\n\n    update(width, height) {\n        this.x += this.vx;\n        this.y += this.vy;\n        \n        if (this.x - this.radius < 0) { this.x = this.radius; this.vx *= -1; }\n        else if (this.x + this.radius > width) { this.x = width - this.radius; this.vx *= -1; }\n        \n        if (this.y - this.radius < 0) { this.y = this.radius; this.vy *= -1; }\n        else if (this.y + this.radius > height) { this.y = height - this.radius; this.vy *= -1; }\n        \n        this.vx *= 0.998;\n        this.vy *= 0.998;\n        \n        if (Math.abs(this.vx) < 0.05) this.vx = (Math.random() - 0.5) * 0.3;\n        if (Math.abs(this.vy) < 0.05) this.vy = (Math.random() - 0.5) * 0.3;\n\n        this.el.style.transform = `translate3d(${this.x - this.radius}px, ${this.y - this.radius}px, 0)`;\n    }\n}\n\nfunction animate() {\n    const container = root.getElementById('bubbles-container');\n    if (!container) return;\n    const rect = container.getBoundingClientRect();\n    bubbles.forEach(b => b.update(rect.width, rect.height));\n    animationId = requestAnimationFrame(animate);\n}\n\nfunction showToast() {\n    const toast = root.getElementById('toast');\n    toast.classList.add('show');\n    setTimeout(() => toast.classList.remove('show'), 2000);\n}\n\nfunction updateJar() {\n    const container = root.getElementById('bubbles-container');\n    const emptyMsg = root.getElementById('empty-msg');\n    container.innerHTML = '';\n    bubbles = [];\n    \n    if (state.today.length === 0) {\n        emptyMsg.style.display = 'block';\n    } else {\n        emptyMsg.style.display = 'none';\n        state.today.forEach((text, i) => {\n            bubbles.push(new Bubble(text, i));\n        });\n    }\n}\n\nfunction addGratitude() {\n    const input = root.getElementById('grat-input');\n    const text = input.value.trim();\n    if (text) {\n        state.today.push(text);\n        input.value = '';\n        const todayStr = new Date().toLocaleDateString();\n        if (state.lastDate !== todayStr) {\n            if (state.lastDate) {\n                const last = new Date(state.lastDate);\n                const diff = (new Date() - last) / (1000 * 60 * 60 * 24);\n                if (diff <= 1.5) state.streak++;\n                else state.streak = 1;\n            } else state.streak = 1;\n            state.lastDate = todayStr;\n        }\n        updateJar();\n        updateStreakDisplay();\n        save();\n        showToast();\n    }\n}\n\nfunction updateStreakDisplay() {\n    root.getElementById('streak-display').innerText = `🔥 ${state.streak} day streak`;\n}\n\nfunction renderHistory() {\n    const list = root.getElementById('history-list');\n    list.innerHTML = '';\n    const todayStr = new Date().toLocaleDateString();\n    const allHistory = JSON.parse(JSON.stringify(state.history));\n    if (state.today.length > 0) {\n        const existingToday = allHistory.find(h => h.date === todayStr);\n        if (existingToday) existingToday.items = state.today;\n        else allHistory.unshift({ date: todayStr, items: state.today });\n    }\n    if (allHistory.length === 0) {\n        list.innerHTML = '<div style=\"text-align:center;color:var(--text-muted);margin-top:2rem;\">No memories yet...</div>';\n        return;\n    }\n    allHistory.forEach(day => {\n        const div = document.createElement('div');\n        div.className = 'history-day';\n        div.innerHTML = `<span class=\"day-date\">${day.date}</span><div class=\"day-items\">${day.items.join(' • ')}</div>`;\n        list.appendChild(div);\n    });\n}\n\nfunction save() {\n    const todayStr = new Date().toLocaleDateString();\n    if (state.today.length > 0) {\n        const idx = state.history.findIndex(h => h.date === todayStr);\n        if (idx !== -1) state.history[idx].items = state.today;\n        else state.history.unshift({ date: todayStr, items: state.today });\n    }\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        state = saved;\n        const todayStr = new Date().toLocaleDateString();\n        if (state.lastDate !== todayStr) state.today = [];\n    }\n    updateJar();\n    updateStreakDisplay();\n    animate();\n    root.getElementById('btn-add').onclick = addGratitude;\n    root.getElementById('grat-input').onkeydown = (e) => { if (e.key === 'Enter') addGratitude(); };\n    const drawer = root.getElementById('history-drawer');\n    root.getElementById('btn-history').onclick = () => { renderHistory(); drawer.classList.add('open'); };\n    root.getElementById('btn-close-history').onclick = () => { drawer.classList.remove('open'); };\n    root.getElementById('btn-clear').onclick = () => {\n        if (confirm('Clear all your beautiful memories?')) {\n            state.history = []; state.today = []; state.streak = 0; state.lastDate = null;\n            updateJar(); updateStreakDisplay(); renderHistory(); save();\n        }\n    };\n}\ninit();",
      "source": "obsidget"
    },
    {
      "id": "data-converter",
      "title": "Universal Data Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"data-studio\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">💾 Data Studio</h4>\n    <div class=\"tab-bar\">\n      <button class=\"tab-btn active\" id=\"tab-storage\">Storage</button>\n      <button class=\"tab-btn\" id=\"tab-format\">Format</button>\n    </div>\n  </div>\n\n  <div class=\"studio-content\">\n    <!-- Storage Converter Section -->\n    <div id=\"section-storage\" class=\"section active\">\n      <div class=\"input-card\">\n        <div class=\"input-row\">\n          <input type=\"number\" id=\"storage-val\" value=\"1024\" placeholder=\"0\">\n          <select id=\"storage-unit\">\n            <option value=\"1\">B</option>\n            <option value=\"1024\">KB</option>\n            <option value=\"1048576\" selected>MB</option>\n            <option value=\"1073741824\">GB</option>\n            <option value=\"1099511627776\">TB</option>\n          </select>\n        </div>\n      </div>\n\n      <div class=\"results-grid\" id=\"storage-results\">\n        <!-- Dynamically populated -->\n      </div>\n\n      <div class=\"visualizer\">\n        <div class=\"vis-bar\">\n          <div class=\"vis-fill\" id=\"vis-fill\"></div>\n        </div>\n        <div class=\"vis-labels\">\n          <span>0</span>\n          <span id=\"vis-max-label\">1 TB</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- Format Converter Section -->\n    <div id=\"section-format\" class=\"section\">\n      <div class=\"format-controls\">\n        <select id=\"format-from\">\n          <option value=\"json\">JSON</option>\n          <option value=\"csv\">CSV</option>\n          <option value=\"xml\">XML</option>\n        </select>\n        <span class=\"arrow\">→</span>\n        <select id=\"format-to\">\n          <option value=\"json\">JSON</option>\n          <option value=\"csv\" selected>CSV</option>\n          <option value=\"xml\">XML</option>\n        </select>\n      </div>\n\n      <div class=\"editor-layout\">\n        <div class=\"editor-pane\">\n          <label>Input</label>\n          <textarea id=\"format-input\" placeholder=\"Paste your data here...\"></textarea>\n        </div>\n        <div class=\"editor-pane\">\n          <div class=\"pane-header\">\n            <label>Output</label>\n            <button class=\"copy-btn\" id=\"btn-copy-format\">Copy</button>\n          </div>\n          <textarea id=\"format-output\" readonly placeholder=\"Result will appear here...\"></textarea>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Copied to clipboard!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.data-studio {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 20px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.25rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.tab-bar {\n    display: flex;\n    background: var(--background-primary);\n    padding: 4px;\n    border-radius: 10px;\n    gap: 4px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.tab-btn {\n    background: none;\n    border: none;\n    padding: 6px 12px;\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    cursor: pointer;\n    border-radius: 6px;\n    transition: all 0.2s;\n}\n.tab-btn.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n}\n\n.section {\n    display: none;\n    animation: fadeIn 0.3s ease;\n}\n.section.active { display: block; }\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(5px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.input-card {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 12px;\n    margin-bottom: 1rem;\n}\n\n.input-row {\n    display: flex;\n    gap: 8px;\n}\n\n#storage-val {\n    flex: 2;\n    background: none;\n    border: none;\n    font-size: 1.2rem;\n    font-weight: 700;\n    color: var(--text-accent);\n    outline: none;\n    width: 50%;\n}\n\n#storage-unit {\n    flex: 1;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    padding: 4px 8px;\n    font-size: 0.85rem;\n    color: var(--text-normal);\n    cursor: pointer;\n}\n\n.results-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 10px;\n    margin-bottom: 1.5rem;\n}\n\n.res-item {\n    background: var(--background-primary-alt);\n    padding: 10px;\n    border-radius: 10px;\n    border: 1px solid var(--background-modifier-border);\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.res-label {\n    font-size: 0.6rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.res-val {\n    font-size: 0.9rem;\n    font-weight: 700;\n    color: var(--text-normal);\n}\n\n.visualizer {\n    margin-top: 1rem;\n}\n\n.vis-bar {\n    height: 8px;\n    background: var(--background-primary);\n    border-radius: 4px;\n    overflow: hidden;\n    margin-bottom: 6px;\n}\n\n.vis-fill {\n    height: 100%;\n    background: linear-gradient(90deg, var(--interactive-accent), #00d2ff);\n    width: 0%;\n    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.vis-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    font-weight: 600;\n}\n\n/* Format Section Styles */\n.format-controls {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    margin-bottom: 1rem;\n    background: var(--background-primary);\n    padding: 8px;\n    border-radius: 12px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.format-controls select {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 4px 10px;\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    outline: none;\n}\n\n.arrow { color: var(--text-muted); font-weight: 800; }\n\n.editor-layout {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.editor-pane {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.pane-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.editor-pane label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\ntextarea {\n    width: 100%;\n    height: 120px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 10px;\n    padding: 10px;\n    font-size: 0.8rem;\n    font-family: var(--font-monospace);\n    color: var(--text-normal);\n    outline: none;\n    resize: none;\n    transition: border-color 0.2s;\n}\ntextarea:focus { border-color: var(--interactive-accent); }\n\n.copy-btn {\n    background: none;\n    border: 1px solid var(--interactive-accent);\n    color: var(--interactive-accent);\n    padding: 2px 8px;\n    border-radius: 4px;\n    font-size: 0.65rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.copy-btn:hover { background: var(--interactive-accent); color: var(--text-on-accent); }\n\n.toast {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nlet currentTab = 'storage';\n\nconst UNITS = [\n    { label: 'Bytes', factor: 1, suffix: 'B' },\n    { label: 'Kilobytes', factor: 1024, suffix: 'KB' },\n    { label: 'Megabytes', factor: 1048576, suffix: 'MB' },\n    { label: 'Gigabytes', factor: 1073741824, suffix: 'GB' },\n    { label: 'Terabytes', factor: 1099511627776, suffix: 'TB' },\n    { label: 'Petabytes', factor: 1125899906842624, suffix: 'PB' }\n];\n\nfunction updateStorage() {\n    const val = parseFloat(root.getElementById('storage-val').value) || 0;\n    const factor = parseFloat(root.getElementById('storage-unit').value);\n    const totalBytes = val * factor;\n\n    const grid = root.getElementById('storage-results');\n    grid.innerHTML = '';\n\n    UNITS.forEach(u => {\n        const converted = totalBytes / u.factor;\n        const displayVal = converted < 0.01 && converted > 0 ? converted.toExponential(2) : converted.toLocaleString(undefined, { maximumFractionDigits: 2 });\n        \n        const div = document.createElement('div');\n        div.className = 'res-item';\n        div.innerHTML = `\n            <span class=\"res-label\">${u.label}</span>\n            <span class=\"res-val\">${displayVal} ${u.suffix}</span>\n        `;\n        grid.appendChild(div);\n    });\n\n    // Update visualizer\n    const max = 1099511627776; // 1 TB for scale\n    const percent = Math.min(100, (totalBytes / max) * 100);\n    root.getElementById('vis-fill').style.width = percent + '%';\n}\n\nfunction convertFormat() {\n    const input = root.getElementById('format-input').value.trim();\n    const from = root.getElementById('format-from').value;\n    const to = root.getElementById('format-to').value;\n    const output = root.getElementById('format-output');\n\n    if (!input) {\n        output.value = '';\n        return;\n    }\n\n    try {\n        let data;\n        // Parse input\n        if (from === 'json') data = JSON.parse(input);\n        else if (from === 'csv') data = csvToJson(input);\n        else if (from === 'xml') data = xmlToJson(input);\n\n        // Convert to output\n        let result = '';\n        if (to === 'json') result = JSON.stringify(data, null, 2);\n        else if (to === 'csv') result = jsonToCsv(data);\n        else if (to === 'xml') result = jsonToXml(data);\n\n        output.value = result;\n    } catch (e) {\n        output.value = '⚠️ Error: Invalid ' + from.toUpperCase() + ' format';\n    }\n}\n\nfunction csvToJson(csv) {\n    const lines = csv.split('\\n');\n    const headers = lines[0].split(',').map(h => h.trim());\n    return lines.slice(1).filter(l => l.trim()).map(line => {\n        const values = line.split(',');\n        return headers.reduce((obj, h, i) => {\n            obj[h] = values[i]?.trim();\n            return obj;\n        }, {});\n    });\n}\n\nfunction jsonToCsv(json) {\n    if (!Array.isArray(json)) json = [json];\n    const headers = Object.keys(json[0]);\n    const rows = json.map(obj => headers.map(h => obj[h]).join(','));\n    return [headers.join(','), ...rows].join('\\n');\n}\n\nfunction jsonToXml(json, rootName = 'root') {\n    const toXml = (obj) => {\n        let xml = '';\n        for (const prop in obj) {\n            xml += `<${prop}>`;\n            if (typeof obj[prop] === 'object') xml += toXml(obj[prop]);\n            else xml += obj[prop];\n            xml += `</${prop}>`;\n        }\n        return xml;\n    };\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<${rootName}>\\n${toXml(json)}\\n</${rootName}>`;\n}\n\nfunction xmlToJson(xml) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(xml, \"text/xml\");\n    const parseNode = (node) => {\n        if (node.nodeType === 3) return node.nodeValue;\n        const obj = {};\n        if (node.childNodes.length > 0) {\n            node.childNodes.forEach(child => {\n                const val = parseNode(child);\n                if (child.nodeName !== '#text') obj[child.nodeName] = val;\n            });\n        }\n        return obj;\n    };\n    return parseNode(doc.documentElement);\n}\n\nfunction switchTab(tab) {\n    currentTab = tab;\n    root.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));\n    root.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n    \n    root.getElementById('tab-' + tab).classList.add('active');\n    root.getElementById('section-' + tab).classList.add('active');\n    save();\n}\n\nfunction save() {\n    saveState({\n        tab: currentTab,\n        storageVal: root.getElementById('storage-val').value,\n        storageUnit: root.getElementById('storage-unit').value,\n        formatFrom: root.getElementById('format-from').value,\n        formatTo: root.getElementById('format-to').value,\n        formatInput: root.getElementById('format-input').value\n    });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        currentTab = saved.tab || 'storage';\n        root.getElementById('storage-val').value = saved.storageVal || 1024;\n        root.getElementById('storage-unit').value = saved.storageUnit || 1048576;\n        root.getElementById('format-from').value = saved.formatFrom || 'json';\n        root.getElementById('format-to').value = saved.formatTo || 'csv';\n        root.getElementById('format-input').value = saved.formatInput || '';\n    }\n\n    switchTab(currentTab);\n\n    const storageVal = root.getElementById('storage-val');\n    const formatInput = root.getElementById('format-input');\n\n    storageVal.oninput = updateStorage;\n    storageVal.onblur = save;\n    root.getElementById('storage-unit').onchange = () => { updateStorage(); save(); };\n    \n    formatInput.oninput = convertFormat;\n    formatInput.onblur = save;\n    root.getElementById('format-from').onchange = () => { convertFormat(); save(); };\n    root.getElementById('format-to').onchange = () => { convertFormat(); save(); };\n\n    root.getElementById('tab-storage').onclick = () => switchTab('storage');\n    root.getElementById('tab-format').onclick = () => switchTab('format');\n\n    root.getElementById('btn-copy-format').onclick = () => {\n        const output = root.getElementById('format-output').value;\n        if (output) {\n            navigator.clipboard.writeText(output);\n            const toast = root.getElementById('toast');\n            toast.classList.add('show');\n            setTimeout(() => toast.classList.remove('show'), 2000);\n        }\n    };\n\n    updateStorage();\n    if (currentTab === 'format') convertFormat();\n}\ninit();",
      "source": "obsidget"
    },
    {
      "id": "data-explorer",
      "title": "Data Explorer Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"data-container\">\n  <h4>📊 Data Explorer Pro</h4>\n  \n  <div class=\"row\">\n    <label>1. Search & Select File:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"file-search\" list=\"data-file-list\" placeholder=\"Search files (json, csv, log, xml...)\" onchange=\"handleFileChange()\">\n      <datalist id=\"data-file-list\"></datalist>\n      <button onclick=\"refreshFileList()\" class=\"mini-btn\">🔄</button>\n    </div>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"header-row\">\n      <label>2. Editor:</label>\n      <button onclick=\"saveData()\" class=\"save-btn\">💾 Save Changes</button>\n    </div>\n    <textarea id=\"data-editor\" placeholder=\"Select a file to edit...\"></textarea>\n  </div>\n\n  <div id=\"csv-stats\" class=\"stats-box\" style=\"display:none\">\n    <div id=\"row-count\">Rows: 0</div>\n    <div id=\"col-count\">Columns: 0</div>\n  </div>\n\n  <div id=\"status-bar\" class=\"status\">Ready</div>\n</div>",
      "css": ".data-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 15px;\n    color: var(--text-normal);\n}\n.row {\n    margin-bottom: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n.header-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n.row label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: var(--text-muted);\n}\n.search-wrapper {\n    display: flex;\n    gap: 8px;\n}\n#file-search, #data-editor {\n    width: 100%;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 8px;\n    font-size: 0.85rem;\n    outline: none;\n}\n#file-search:focus, #data-editor:focus {\n    border-color: var(--interactive-accent);\n}\n#data-editor {\n    height: 200px;\n    font-family: var(--font-monospace);\n    resize: vertical;\n    color: var(--text-accent);\n}\n.stats-box {\n    display: flex;\n    gap: 15px;\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    margin-top: 5px;\n    padding: 5px 10px;\n    background: var(--background-modifier-border);\n    border-radius: 4px;\n}\n.mini-btn {\n    padding: 8px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    cursor: pointer;\n}\n.save-btn {\n    background: var(--background-modifier-success);\n    color: white;\n    border: none;\n    padding: 4px 10px;\n    border-radius: 4px;\n    font-size: 0.75rem;\n    cursor: pointer;\n    font-weight: 600;\n}\n.status {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    margin-top: 10px;\n    font-style: italic;\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 8px;\n}",
      "js": "const TEXT_EXTENSIONS = ['json', 'csv', 'log', 'xml', 'txt', 'md', 'yaml', 'yml', 'css', 'js', 'ts'];\n\nasync function refreshFileList() {\n    const datalist = root.getElementById('data-file-list');\n    const allFiles = api.getFiles();\n    \n    const files = allFiles.filter(f => {\n        const ext = f.split('.').pop().toLowerCase();\n        return TEXT_EXTENSIONS.includes(ext);\n    });\n    \n    datalist.innerHTML = '';\n    files.forEach(file => {\n        const option = document.createElement('option');\n        option.value = file;\n        datalist.appendChild(option);\n    });\n    setStatus(\"File list updated (\" + files.length + \" files)\");\n    await loadFileContent();\n}\n\nasync function handleFileChange() {\n    const path = root.getElementById('file-search').value;\n    if (!path || !path.includes('.')) return;\n    \n    await api.saveState({ lastPath: path });\n    await loadFileContent();\n}\n\nasync function loadFileContent() {\n    const path = root.getElementById('file-search').value;\n    const editor = root.getElementById('data-editor');\n    const stats = root.getElementById('csv-stats');\n\n    if (!path || !path.includes('.')) {\n        editor.value = \"\";\n        stats.style.display = 'none';\n        return;\n    }\n\n    setStatus(\"Loading \" + path + \"...\");\n    const content = await api.readFile(path);\n\n    if (content === null) {\n        setStatus(\"File not found\");\n        editor.value = \"\";\n        return;\n    }\n\n    editor.value = content;\n    \n    if (path.endsWith('.csv')) {\n        const data = api.parseCSV(content);\n        if (data.length > 0) {\n            stats.style.display = 'flex';\n            root.getElementById('row-count').innerText = `Rows: ${data.length}`;\n            root.getElementById('col-count').innerText = `Columns: ${Object.keys(data[0]).length}`;\n        }\n    } else {\n        stats.style.display = 'none';\n    }\n    setStatus(\"Loaded: \" + path);\n}\n\nasync function saveData() {\n    const path = root.getElementById('file-search').value;\n    const content = root.getElementById('data-editor').value;\n    \n    if (!path) {\n        new Notice(\"Please select a file first\");\n        return;\n    }\n\n    setStatus(\"Saving...\");\n    await api.writeFile(path, content);\n    new Notice(\"Saved successfully!\");\n    setStatus(\"Saved: \" + path);\n    \n    if (path.endsWith('.csv')) loadFileContent();\n}\n\nfunction setStatus(msg) {\n    root.getElementById('status-bar').innerText = msg;\n}\n\nasync function init() {\n    refreshFileList();\n    const saved = await api.getState();\n    if (saved && saved.lastPath) {\n        root.getElementById('file-search').value = saved.lastPath;\n        loadFileContent();\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "decision-maker",
      "title": "Decision Maker",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"decision-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🤔 Decision Studio</h4>\n    <button class=\"btn-icon\" id=\"btn-clear\" title=\"Clear All\">🗑️</button>\n  </div>\n\n  <div class=\"decision-display\">\n    <div class=\"display-bg\"></div>\n    <div class=\"result-text\" id=\"decision-result\">Ready?</div>\n  </div>\n\n  <div class=\"options-container\">\n    <label class=\"section-label\">Your Options</label>\n    <div class=\"options-list\" id=\"options-list\"></div>\n  </div>\n\n  <div class=\"controls\">\n    <button class=\"btn-secondary\" id=\"btn-add\">+ Add Option</button>\n    <button class=\"btn-primary\" id=\"btn-decide\">DECIDE!</button>\n  </div>\n\n  <div id=\"confetti-container\" class=\"confetti-container\"></div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.decision-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.25rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1rem;\n    opacity: 0.6;\n    transition: opacity 0.2s;\n}\n.btn-icon:hover { opacity: 1; }\n\n.decision-display {\n    height: 100px;\n    background: #0f172a;\n    border-radius: 16px;\n    margin-bottom: 1.5rem;\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n    border: 1px solid rgba(255,255,255,0.1);\n    box-shadow: inset 0 4px 20px rgba(0,0,0,0.5);\n}\n\n.display-bg {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: radial-gradient(circle at center, var(--interactive-accent) 0%, transparent 70%);\n    opacity: 0.2;\n    transition: opacity 0.3s;\n}\n\n.result-text {\n    font-size: 1.5rem;\n    font-weight: 800;\n    color: white;\n    z-index: 1;\n    text-align: center;\n    padding: 0 1rem;\n    text-shadow: 0 0 15px var(--interactive-accent);\n    transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n}\n\n.result-text.spinning {\n    animation: spinText 0.1s infinite linear;\n}\n\n@keyframes spinText {\n    0% { transform: translateY(-10px); opacity: 0.5; }\n    50% { transform: translateY(10px); opacity: 0.5; }\n    100% { transform: translateY(-10px); opacity: 0.5; }\n}\n\n.options-container {\n    margin-bottom: 1.5rem;\n}\n\n.section-label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    display: block;\n    margin-bottom: 8px;\n}\n\n.options-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding-right: 4px;\n}\n\n.option-item {\n    display: flex;\n    gap: 8px;\n    animation: slideIn 0.3s ease;\n}\n\n@keyframes slideIn {\n    from { opacity: 0; transform: translateX(-10px); }\n    to { opacity: 1; transform: translateX(0); }\n}\n\n.option-item input {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 0.85rem;\n    outline: none;\n    transition: border-color 0.2s;\n}\n.option-item input:focus { border-color: var(--interactive-accent); }\n\n.btn-del {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-error);\n    width: 38px;\n    border-radius: 12px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.2rem;\n    transition: all 0.2s;\n}\n.btn-del:hover { background: var(--text-error); color: white; border-color: var(--text-error); }\n\n.controls {\n    display: flex;\n    gap: 12px;\n}\n\n.btn-secondary {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 12px;\n    border-radius: 14px;\n    font-weight: 600;\n    font-size: 0.85rem;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-secondary:hover { background: var(--background-modifier-hover); }\n\n.btn-primary {\n    flex: 1.5;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 12px;\n    border-radius: 14px;\n    font-weight: 800;\n    font-size: 0.9rem;\n    cursor: pointer;\n    box-shadow: 0 4px 0 rgba(0,0,0,0.2);\n    transition: all 0.1s;\n}\n.btn-primary:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }\n\n.confetti-container {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    pointer-events: none;\n    z-index: 10;\n}\n\n.confetti {\n    position: absolute;\n    width: 8px; height: 8px;\n    background: var(--interactive-accent);\n    border-radius: 2px;\n    animation: fall 2s linear forwards;\n}\n\n@keyframes fall {\n    to { transform: translateY(300px) rotate(360deg); opacity: 0; }\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet options = ['Yes', 'No'];\nlet isSpinning = false;\n\nfunction render() {\n    const list = root.getElementById('options-list');\n    list.innerHTML = '';\n    options.forEach((opt, idx) => {\n        const div = document.createElement('div');\n        div.className = 'option-item';\n        \n        const input = document.createElement('input');\n        input.type = 'text';\n        input.value = opt;\n        input.placeholder = `Option ${idx + 1}`;\n        \n        // Focus fix: update array on input, but only save on blur\n        input.oninput = (e) => { options[idx] = e.target.value; };\n        input.onblur = () => { save(); };\n        \n        const delBtn = document.createElement('button');\n        delBtn.className = 'btn-del';\n        delBtn.innerHTML = '×';\n        delBtn.onclick = () => deleteOption(idx);\n        \n        div.appendChild(input);\n        div.appendChild(delBtn);\n        list.appendChild(div);\n    });\n}\n\nfunction addOption() {\n    options.push('');\n    render();\n    // Focus the new input\n    const inputs = root.querySelectorAll('.option-item input');\n    inputs[inputs.length - 1].focus();\n    save();\n}\n\nfunction deleteOption(idx) {\n    options.splice(idx, 1);\n    render();\n    save();\n}\n\nfunction clearAll() {\n    if (confirm('Clear all options?')) {\n        options = ['', ''];\n        render();\n        save();\n    }\n}\n\nfunction save() {\n    saveState(options);\n}\n\nfunction decide() {\n    if (isSpinning) return;\n    const validOptions = options.filter(o => o.trim() !== '');\n    if (validOptions.length < 2) {\n        alert('Please add at least 2 options!');\n        return;\n    }\n\n    isSpinning = true;\n    const resultBox = root.getElementById('decision-result');\n    const displayBg = root.querySelector('.display-bg');\n    \n    resultBox.classList.add('spinning');\n    displayBg.style.opacity = '0.8';\n\n    let count = 0;\n    const maxCount = 20;\n    const interval = setInterval(() => {\n        resultBox.innerText = validOptions[Math.floor(Math.random() * validOptions.length)];\n        count++;\n        \n        if (count >= maxCount) {\n            clearInterval(interval);\n            finishDecision(validOptions);\n        }\n    }, 80);\n}\n\nfunction finishDecision(validOptions) {\n    const resultBox = root.getElementById('decision-result');\n    const displayBg = root.querySelector('.display-bg');\n    \n    const finalChoice = validOptions[Math.floor(Math.random() * validOptions.length)];\n    resultBox.innerText = finalChoice;\n    resultBox.classList.remove('spinning');\n    resultBox.style.transform = 'scale(1.2)';\n    \n    setTimeout(() => {\n        resultBox.style.transform = 'scale(1)';\n        displayBg.style.opacity = '0.2';\n        isSpinning = false;\n    }, 500);\n\n    createConfetti();\n}\n\nfunction createConfetti() {\n    const container = root.getElementById('confetti-container');\n    for (let i = 0; i < 30; i++) {\n        const c = document.createElement('div');\n        c.className = 'confetti';\n        c.style.left = Math.random() * 100 + '%';\n        c.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;\n        c.style.animationDelay = Math.random() * 0.5 + 's';\n        container.appendChild(c);\n        setTimeout(() => c.remove(), 2500);\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && Array.isArray(saved)) options = saved;\n    \n    root.getElementById('btn-add').onclick = addOption;\n    root.getElementById('btn-decide').onclick = decide;\n    root.getElementById('btn-clear').onclick = clearAll;\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "dice-roller",
      "title": "Dice Studio Slot",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"dice-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🎰 Dice Studio Slot</h4>\n    <button class=\"btn-icon\" id=\"btn-clear\" title=\"Clear History\">🗑️</button>\n  </div>\n\n  <div class=\"slot-arena\">\n    <div class=\"slot-window\">\n      <div class=\"slot-reel\" id=\"slot-reel\">\n        <div class=\"slot-number\">?</div>\n      </div>\n      <div class=\"slot-overlay\"></div>\n    </div>\n    <div class=\"dice-type-badge\" id=\"dice-type-badge\">None</div>\n  </div>\n\n  <div class=\"dice-selector\">\n    <button class=\"dice-btn\" data-sides=\"4\">D4</button>\n    <button class=\"dice-btn\" data-sides=\"6\">D6</button>\n    <button class=\"dice-btn\" data-sides=\"8\">D8</button>\n    <button class=\"dice-btn\" data-sides=\"10\">D10</button>\n    <button class=\"dice-btn\" data-sides=\"12\">D12</button>\n    <button class=\"dice-btn\" data-sides=\"20\">D20</button>\n    <button class=\"dice-btn\" data-sides=\"100\">D100</button>\n  </div>\n\n  <button class=\"roll-btn\" id=\"btn-roll\">SELECT A DIE</button>\n\n  <div class=\"history-section\">\n    <div class=\"history-header\">\n      <label>Recent Rolls</label>\n      <span class=\"history-count\" id=\"history-count\">0</span>\n    </div>\n    <div class=\"history-container\">\n      <div class=\"history-list\" id=\"roll-history\"></div>\n      <div class=\"history-fade-left\"></div>\n      <div class=\"history-fade-right\"></div>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.dice-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1rem;\n    opacity: 0.6;\n    transition: opacity 0.2s;\n}\n.btn-icon:hover { opacity: 1; }\n\n.slot-arena {\n    height: 160px;\n    background: #0f172a;\n    border-radius: 20px;\n    border: 1px solid rgba(255,255,255,0.05);\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    margin-bottom: 1.5rem;\n    overflow: hidden;\n    box-shadow: inset 0 10px 30px rgba(0,0,0,0.5);\n}\n\n.slot-window {\n    width: 100px;\n    height: 100px;\n    position: relative;\n    overflow: hidden;\n    background: rgba(255,255,255,0.03);\n    border-radius: 12px;\n    border: 2px solid var(--interactive-accent);\n    box-shadow: 0 0 20px rgba(var(--interactive-accent-rgb), 0.2);\n}\n\n.slot-reel {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    transition: transform 1.5s cubic-bezier(0.1, 0, 0.1, 1);\n}\n\n.slot-number {\n    height: 100px;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3.5rem;\n    font-weight: 900;\n    color: white;\n    text-shadow: 0 0 15px var(--interactive-accent);\n}\n\n.slot-overlay {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: linear-gradient(rgba(15,23,42,1) 0%, rgba(15,23,42,0) 20%, rgba(15,23,42,0) 80%, rgba(15,23,42,1) 100%);\n    pointer-events: none;\n}\n\n.dice-type-badge {\n    margin-top: 10px;\n    font-size: 0.7rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n    background: rgba(var(--interactive-accent-rgb), 0.1);\n    padding: 2px 10px;\n    border-radius: 10px;\n    text-transform: uppercase;\n}\n\n.dice-selector {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 8px;\n    margin-bottom: 1rem;\n}\n\n.dice-btn {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    padding: 8px 4px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.dice-btn.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border-color: var(--interactive-accent);\n}\n\n.roll-btn {\n    width: 100%;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 14px;\n    border-radius: 14px;\n    font-weight: 800;\n    font-size: 1rem;\n    cursor: pointer;\n    box-shadow: 0 4px 0 rgba(0,0,0,0.2);\n    transition: all 0.1s;\n    margin-bottom: 1.5rem;\n}\n.roll-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; background: var(--background-modifier-border); color: var(--text-muted); }\n.roll-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }\n\n.history-section {\n    background: rgba(0,0,0,0.1);\n    padding: 12px;\n    border-radius: 16px;\n}\n\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.history-header label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.history-count {\n    font-size: 0.65rem;\n    font-weight: 800;\n    background: var(--background-modifier-border);\n    padding: 2px 6px;\n    border-radius: 6px;\n    color: var(--text-muted);\n}\n\n.history-container {\n    position: relative;\n    overflow: hidden;\n}\n\n.history-list {\n    display: flex;\n    gap: 10px;\n    overflow-x: auto;\n    padding: 4px 0;\n    scrollbar-width: none;\n}\n.history-list::-webkit-scrollbar { display: none; }\n\n.history-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    min-width: 45px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    padding: 6px;\n    border-radius: 10px;\n    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n}\n\n@keyframes popIn {\n    from { opacity: 0; transform: scale(0.8); }\n    to { opacity: 1; transform: scale(1); }\n}\n\n.hist-sides {\n    font-size: 0.55rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    margin-bottom: 2px;\n}\n\n.hist-val {\n    font-size: 0.9rem;\n    font-weight: 900;\n    color: var(--interactive-accent);\n}\n\n.history-fade-left, .history-fade-right {\n    position: absolute;\n    top: 0; bottom: 0; width: 20px;\n    pointer-events: none;\n    z-index: 1;\n}\n.history-fade-left { left: 0; background: linear-gradient(to right, rgba(0,0,0,0.1), transparent); }\n.history-fade-right { right: 0; background: linear-gradient(to left, rgba(0,0,0,0.1), transparent); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    history: [], // Array of { sides: number, val: number }\n    currentSides: null,\n    lastResult: null\n};\n\nlet isRolling = false;\n\nfunction renderHistory() {\n    const list = root.getElementById('roll-history');\n    const count = root.getElementById('history-count');\n    if (!list || !count) return;\n    \n    list.innerHTML = '';\n    count.innerText = state.history.length;\n    \n    state.history.forEach(item => {\n        const div = document.createElement('div');\n        div.className = 'history-item';\n        div.innerHTML = `\n            <span class=\"hist-sides\">D${item.sides}</span>\n            <span class=\"hist-val\">${item.val}</span>\n        `;\n        list.appendChild(div);\n    });\n}\n\nfunction roll() {\n    if (isRolling || !state.currentSides) return;\n    isRolling = true;\n    \n    const btn = root.getElementById('btn-roll');\n    if (btn) {\n        btn.disabled = true;\n        btn.innerText = 'ROLLING...';\n    }\n\n    const reel = root.getElementById('slot-reel');\n    const result = Math.floor(Math.random() * state.currentSides) + 1;\n    \n    const reelNumbers = [];\n    for (let i = 0; i < 20; i++) {\n        reelNumbers.push(Math.floor(Math.random() * state.currentSides) + 1);\n    }\n    reelNumbers.push(result);\n\n    reel.innerHTML = reelNumbers.map(n => `<div class=\"slot-number\">${n}</div>`).join('');\n    \n    reel.style.transition = 'none';\n    reel.style.transform = 'translateY(0)';\n    reel.offsetHeight;\n\n    const targetY = -(reelNumbers.length - 1) * 100;\n    reel.style.transition = 'transform 1.5s cubic-bezier(0.1, 0, 0.1, 1)';\n    reel.style.transform = `translateY(${targetY}px)`;\n\n    setTimeout(() => {\n        state.lastResult = result;\n        state.history.unshift({ sides: state.currentSides, val: result });\n        if (state.history.length > 20) state.history.pop();\n        \n        renderHistory();\n        save();\n        \n        isRolling = false;\n        if (btn) {\n            btn.disabled = false;\n            btn.innerText = 'SPIN DICE';\n        }\n    }, 1600);\n}\n\nfunction setDice(sides) {\n    state.currentSides = sides ? parseInt(sides) : null;\n    \n    root.querySelectorAll('.dice-btn').forEach(b => {\n        b.classList.toggle('active', parseInt(b.dataset.sides) === state.currentSides);\n    });\n    \n    const badge = root.getElementById('dice-type-badge');\n    const btn = root.getElementById('btn-roll');\n    \n    if (state.currentSides) {\n        if (badge) badge.innerText = `D${state.currentSides}`;\n        if (btn) {\n            btn.disabled = false;\n            btn.innerText = 'SPIN DICE';\n        }\n    } else {\n        if (badge) badge.innerText = 'None';\n        if (btn) {\n            btn.disabled = true;\n            btn.innerText = 'SELECT A DIE';\n        }\n    }\n    \n    const reel = root.getElementById('slot-reel');\n    if (reel) {\n        reel.style.transition = 'none';\n        reel.style.transform = 'translateY(0)';\n        reel.innerHTML = `<div class=\"slot-number\">${state.lastResult || '?'}</div>`;\n    }\n    \n    save();\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        // Migration for old history format if needed\n        if (saved.history && saved.history.length > 0 && typeof saved.history[0] === 'string') {\n            saved.history = []; // Reset if old format to avoid errors\n        }\n        Object.assign(state, saved);\n    }\n\n    const rollBtn = root.getElementById('btn-roll');\n    if (rollBtn) {\n        rollBtn.onclick = (e) => {\n            e.preventDefault();\n            roll();\n        };\n    }\n\n    const clearBtn = root.getElementById('btn-clear');\n    if (clearBtn) {\n        clearBtn.onclick = () => {\n            state.history = [];\n            renderHistory();\n            save();\n        };\n    }\n\n    root.querySelectorAll('.dice-btn').forEach(btn => {\n        btn.onclick = () => setDice(btn.dataset.sides);\n    });\n\n    setDice(state.currentSides);\n    renderHistory();\n    \n    // Safety reset\n    isRolling = false;\n    if (rollBtn) rollBtn.disabled = !state.currentSides;\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "dynamic-table",
      "title": "Table Studio Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"table-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">📊 Table Studio Pro</h4>\n      <div class=\"header-actions\">\n        <button class=\"btn-edit\" id=\"btn-edit-toggle\">Edit</button>\n        <div class=\"edit-controls-group\" id=\"edit-controls-group\" style=\"display: none;\">\n          <button class=\"btn-icon\" id=\"btn-paste\" title=\"Paste CSV from Clipboard\">📥</button>\n          <button class=\"btn-icon\" id=\"btn-copy\" title=\"Copy as CSV\">📋</button>\n          <button class=\"btn-icon\" id=\"btn-reset\" title=\"Reset Table\">🗑️</button>\n        </div>\n      </div>\n    </div>\n    <div class=\"controls\" id=\"main-controls\" style=\"display: none;\">\n      <button class=\"btn-primary\" id=\"btn-add-row\">+ Add Row</button>\n      <button class=\"btn-primary\" id=\"btn-add-col\">+ Add Column</button>\n    </div>\n  </div>\n\n  <div class=\"table-container\">\n    <div class=\"table-scroll\">\n      <table id=\"main-table\">\n        <thead id=\"table-head\"></thead>\n        <tbody id=\"table-body\"></tbody>\n      </table>\n    </div>\n  </div>\n\n  <div class=\"table-footer\">\n    <span class=\"stats\" id=\"table-stats\">0 Rows • 0 Columns</span>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Copied to clipboard!</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.table-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 20px;\n    padding: 1.25rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    max-width: 100%;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.header-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); transform: translateY(-1px); }\n\n.btn-edit {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    padding: 4px 12px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    cursor: pointer;\n    color: var(--text-muted);\n    transition: all 0.2s;\n}\n.btn-edit.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border-color: var(--interactive-accent);\n}\n\n.edit-controls-group {\n    display: flex;\n    gap: 8px;\n    animation: fadeIn 0.2s ease;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateX(10px); }\n    to { opacity: 1; transform: translateX(0); }\n}\n\n.controls {\n    display: flex;\n    gap: 10px;\n    animation: slideDown 0.2s ease;\n}\n\n@keyframes slideDown {\n    from { opacity: 0; transform: translateY(-10px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.btn-primary {\n    flex: 1;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px 12px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n}\n.btn-primary:hover { filter: brightness(1.1); transform: translateY(-1px); }\n.btn-primary:active { transform: translateY(0); }\n\n.table-container {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    overflow: hidden;\n    position: relative;\n}\n\n.table-scroll {\n    overflow-x: auto;\n    max-height: 400px;\n    overflow-y: auto;\n}\n\ntable {\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 0.85rem;\n}\n\nth {\n    position: sticky;\n    top: 0;\n    background: var(--background-secondary-alt);\n    z-index: 10;\n    border-bottom: 2px solid var(--background-modifier-border);\n    padding: 0;\n}\n\ntd {\n    border-bottom: 1px solid var(--background-modifier-border);\n    border-right: 1px solid var(--background-modifier-border);\n    padding: 0;\n}\ntd:last-child { border-right: none; }\n\n.cell-input {\n    width: 100%;\n    border: none;\n    background: transparent;\n    color: var(--text-normal);\n    padding: 10px 12px;\n    outline: none;\n    font-size: 0.85rem;\n    transition: background 0.2s;\n}\n.cell-input:focus {\n    background: var(--background-modifier-hover);\n    box-shadow: inset 0 0 0 1px var(--interactive-accent);\n}\n\n.header-cell {\n    display: flex;\n    align-items: center;\n}\n\n.btn-del-col, .btn-del-row {\n    background: transparent;\n    border: none;\n    color: var(--text-error);\n    opacity: 0.3;\n    cursor: pointer;\n    padding: 4px;\n    font-size: 0.7rem;\n    transition: opacity 0.2s;\n}\n.btn-del-col:hover, .btn-del-row:hover { opacity: 1; }\n\n.row-header {\n    width: 30px;\n    background: var(--background-secondary-alt);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: width 0.2s;\n}\n\n.table-widget:not(.is-editing) .row-header {\n    width: 0;\n    overflow: hidden;\n    border: none;\n}\n\n.table-widget:not(.is-editing) .btn-del-col {\n    display: none;\n}\n\n.table-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 0 4px;\n}\n\n.stats {\n    font-size: 0.65rem;\n    font-weight: 600;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n    box-shadow: var(--shadow-l);\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    tableData: [\n        ['Header 1', 'Header 2', 'Header 3'],\n        ['Data 1', 'Data 2', 'Data 3'],\n        ['Data 4', 'Data 5', 'Data 6']\n    ],\n    isEditing: false\n};\n\nfunction render() {\n    const widget = root.querySelector('.table-widget');\n    const editBtn = root.getElementById('btn-edit-toggle');\n    const editGroup = root.getElementById('edit-controls-group');\n    const mainControls = root.getElementById('main-controls');\n\n    if (state.isEditing) {\n        widget.classList.add('is-editing');\n        if (editBtn) { editBtn.classList.add('active'); editBtn.innerText = 'Done'; }\n        if (editGroup) editGroup.style.display = 'flex';\n        if (mainControls) mainControls.style.display = 'flex';\n    } else {\n        widget.classList.remove('is-editing');\n        if (editBtn) { editBtn.classList.remove('active'); editBtn.innerText = 'Edit'; }\n        if (editGroup) editGroup.style.display = 'none';\n        if (mainControls) mainControls.style.display = 'none';\n    }\n\n    const thead = root.getElementById('table-head');\n    const tbody = root.getElementById('table-body');\n    const stats = root.getElementById('table-stats');\n    \n    if (!thead || !tbody) return;\n\n    thead.innerHTML = '';\n    tbody.innerHTML = '';\n\n    // Render Header\n    const headerRow = document.createElement('tr');\n    const corner = document.createElement('th');\n    corner.className = 'row-header';\n    headerRow.appendChild(corner);\n\n    state.tableData[0].forEach((colName, colIdx) => {\n        const th = document.createElement('th');\n        const container = document.createElement('div');\n        container.className = 'header-cell';\n        \n        const input = document.createElement('input');\n        input.className = 'cell-input';\n        input.style.fontWeight = '700';\n        input.value = colName;\n        input.oninput = (e) => { state.tableData[0][colIdx] = e.target.value; };\n        input.onblur = () => { save(); };\n\n        const delBtn = document.createElement('button');\n        delBtn.className = 'btn-del-col';\n        delBtn.innerHTML = '×';\n        delBtn.onclick = () => deleteColumn(colIdx);\n\n        container.appendChild(input);\n        container.appendChild(delBtn);\n        th.appendChild(container);\n        headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n\n    // Render Body\n    for (let r = 1; r < state.tableData.length; r++) {\n        const tr = document.createElement('tr');\n        const rowAction = document.createElement('td');\n        rowAction.className = 'row-header';\n        const delRowBtn = document.createElement('button');\n        delRowBtn.className = 'btn-del-row';\n        delRowBtn.innerHTML = '×';\n        delRowBtn.onclick = () => deleteRow(r);\n        rowAction.appendChild(delRowBtn);\n        tr.appendChild(rowAction);\n\n        state.tableData[r].forEach((cellData, cIdx) => {\n            const td = document.createElement('td');\n            const input = document.createElement('input');\n            input.className = 'cell-input';\n            input.value = cellData;\n            input.oninput = (e) => { state.tableData[r][cIdx] = e.target.value; };\n            input.onblur = () => { save(); };\n            td.appendChild(input);\n            tr.appendChild(td);\n        });\n        tbody.appendChild(tr);\n    }\n\n    if (stats) {\n        stats.innerText = `${state.tableData.length - 1} Rows • ${state.tableData[0].length} Columns`;\n    }\n}\n\nfunction addRow() {\n    const newRow = new Array(state.tableData[0].length).fill('');\n    state.tableData.push(newRow);\n    render();\n    save();\n}\n\nfunction addColumn() {\n    state.tableData.forEach((row, idx) => {\n        row.push(idx === 0 ? `Header ${row.length + 1}` : '');\n    });\n    render();\n    save();\n}\n\nfunction deleteRow(idx) {\n    if (state.tableData.length <= 2) return;\n    state.tableData.splice(idx, 1);\n    render();\n    save();\n}\n\nfunction deleteColumn(idx) {\n    if (state.tableData[0].length <= 1) return;\n    state.tableData.forEach(row => row.splice(idx, 1));\n    render();\n    save();\n}\n\nfunction resetTable() {\n    if (confirm('Reset table to default?')) {\n        state.tableData = [\n            ['Header 1', 'Header 2', 'Header 3'],\n            ['', '', ''],\n            ['', '', '']\n        ];\n        render();\n        save();\n    }\n}\n\nfunction copyAsCSV() {\n    const csv = state.tableData.map(row => \n        row.map(cell => `\"${cell.replace(/\"/g, '\"\"')}\"`).join(',')\n    ).join('\\n');\n    \n    navigator.clipboard.writeText(csv).then(() => {\n        showToast('Copied to clipboard!');\n    });\n}\n\nasync function pasteFromCSV() {\n    try {\n        const text = await navigator.clipboard.readText();\n        if (!text) return;\n\n        const rows = [];\n        let currentRow = [];\n        let currentCell = '';\n        let inQuotes = false;\n\n        for (let i = 0; i < text.length; i++) {\n            const char = text[i];\n            const nextChar = text[i+1];\n\n            if (char === '\"' && inQuotes && nextChar === '\"') {\n                currentCell += '\"';\n                i++;\n            } else if (char === '\"') {\n                inQuotes = !inQuotes;\n            } else if (char === ',' && !inQuotes) {\n                currentRow.push(currentCell.trim());\n                currentCell = '';\n            } else if ((char === '\\n' || char === '\\r') && !inQuotes) {\n                if (char === '\\r' && nextChar === '\\n') i++;\n                currentRow.push(currentCell.trim());\n                rows.push(currentRow);\n                currentRow = [];\n                currentCell = '';\n            } else {\n                currentCell += char;\n            }\n        }\n        if (currentCell || currentRow.length > 0) {\n            currentRow.push(currentCell.trim());\n            rows.push(currentRow);\n        }\n\n        if (rows.length > 0) {\n            state.tableData = rows;\n            render();\n            save();\n            showToast('Table updated from CSV!');\n        }\n    } catch (err) {\n        console.error('Failed to read clipboard:', err);\n        alert('Could not read clipboard. Please ensure you have granted permission.');\n    }\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(state);\n}\n\nfunction toggleEdit() {\n    state.isEditing = !state.isEditing;\n    render();\n    save();\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (Array.isArray(saved)) {\n            state.tableData = saved;\n        } else {\n            Object.assign(state, saved);\n        }\n    }\n\n    const btnAddRow = root.getElementById('btn-add-row');\n    const btnAddCol = root.getElementById('btn-add-col');\n    const btnReset = root.getElementById('btn-reset');\n    const btnCopy = root.getElementById('btn-copy');\n    const btnPaste = root.getElementById('btn-paste');\n    const btnEdit = root.getElementById('btn-edit-toggle');\n\n    if (btnAddRow) btnAddRow.onclick = addRow;\n    if (btnAddCol) btnAddCol.onclick = addColumn;\n    if (btnReset) btnReset.onclick = resetTable;\n    if (btnCopy) btnCopy.onclick = copyAsCSV;\n    if (btnPaste) btnPaste.onclick = pasteFromCSV;\n    if (btnEdit) btnEdit.onclick = toggleEdit;\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "entropy-guard",
      "title": "Entropy Guard",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"entropy-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🛡️ Entropy Guard Pro</h4>\n    <button class=\"btn-icon\" id=\"btn-copy\" title=\"Copy to Clipboard\">📋</button>\n  </div>\n\n  <div class=\"pass-arena\">\n    <div class=\"pass-display\">\n      <input type=\"text\" id=\"pass-out\" spellcheck=\"false\" placeholder=\"Type or generate...\" title=\"Click to copy\">\n      <div class=\"copy-feedback\" id=\"copy-feedback\">Copied!</div>\n    </div>\n    <button class=\"refresh-btn\" id=\"btn-refresh\" title=\"Regenerate Password\">↺</button>\n  </div>\n\n  <div class=\"settings-panel\">\n    <div class=\"setting-item\">\n      <div class=\"label-row\">\n        <span>Length</span>\n        <b id=\"len-val\">16</b>\n      </div>\n      <input type=\"range\" id=\"len\" min=\"1\" max=\"64\" value=\"16\">\n    </div>\n\n    <div class=\"options-grid\">\n      <label class=\"option-check\">\n        <input type=\"checkbox\" id=\"opt-upper\" checked>\n        <span class=\"check-label\">ABC</span>\n      </label>\n      <label class=\"option-check\">\n        <input type=\"checkbox\" id=\"opt-lower\" checked>\n        <span class=\"check-label\">abc</span>\n      </label>\n      <label class=\"option-check\">\n        <input type=\"checkbox\" id=\"opt-num\" checked>\n        <span class=\"check-label\">123</span>\n      </label>\n      <label class=\"option-check\">\n        <input type=\"checkbox\" id=\"opt-sym\" checked>\n        <span class=\"check-label\">#$&</span>\n      </label>\n    </div>\n\n    <div class=\"setting-item\">\n      <div class=\"label-row\">\n        <span>Cracking Power (RTX 4090s)</span>\n        <b id=\"gpu-val\">1</b>\n      </div>\n      <input type=\"range\" id=\"gpu-count\" min=\"1\" max=\"100\" value=\"1\">\n    </div>\n  </div>\n\n  <div class=\"strength-section\">\n    <div class=\"strength-header\">\n      <div class=\"label-row\">\n        <span>Security Strength</span>\n        <span id=\"strength-label\" style=\"margin-left: 8px;\">Strong</span>\n      </div>\n      <div class=\"entropy-badge\"><span id=\"entropy-val\">0</span> bits</div>\n    </div>\n    <div class=\"progress-container\">\n      <div id=\"strength-bar\" class=\"progress-fill\"></div>\n    </div>\n    <div class=\"crack-time-box\">\n      <span class=\"crack-label\">Est. Time to Crack:</span>\n      <span class=\"crack-val\" id=\"crack-time\">Calculating...</span>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.entropy-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1.1rem;\n    opacity: 0.6;\n    transition: all 0.2s;\n    padding: 4px;\n    border-radius: 8px;\n}\n.btn-icon:hover { opacity: 1; background: var(--background-modifier-hover); }\n\n.pass-arena {\n    position: relative;\n    background: #0f172a;\n    border-radius: 18px;\n    padding: 1.25rem;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    border: 1px solid rgba(255,255,255,0.05);\n    box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);\n}\n\n.pass-display {\n    flex: 1;\n    position: relative;\n    display: flex;\n    align-items: center;\n}\n\n#pass-out {\n    background: transparent;\n    border: none;\n    color: #38bdf8;\n    font-family: var(--font-monospace);\n    font-size: 1.2rem;\n    font-weight: 700;\n    width: 100%;\n    outline: none;\n    padding: 0;\n    cursor: text;\n}\n\n#pass-out::placeholder {\n    color: rgba(56, 189, 248, 0.3);\n}\n\n.copy-feedback {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 4px 12px;\n    border-radius: 20px;\n    font-size: 0.7rem;\n    font-weight: 800;\n    opacity: 0;\n    pointer-events: none;\n    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n    white-space: nowrap;\n}\n.copy-feedback.show { opacity: 1; transform: translate(-50%, -120%); }\n\n.refresh-btn {\n    background: rgba(255,255,255,0.1);\n    border: none;\n    color: white;\n    width: 36px;\n    height: 36px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.2rem;\n    transition: all 0.2s;\n}\n.refresh-btn:hover { background: rgba(255,255,255,0.2); transform: rotate(90deg); }\n\n.settings-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    margin-bottom: 8px;\n}\n\ninput[type=range] {\n    width: 100%;\n    accent-color: var(--interactive-accent);\n    cursor: pointer;\n}\n\n.options-grid {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 8px;\n}\n\n.option-check {\n    cursor: pointer;\n    position: relative;\n}\n\n.option-check input {\n    display: none;\n}\n\n.check-label {\n    display: block;\n    text-align: center;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    padding: 8px 4px;\n    border-radius: 10px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    transition: all 0.2s;\n}\n\n.option-check input:checked + .check-label {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border-color: var(--interactive-accent);\n    box-shadow: 0 2px 8px rgba(var(--interactive-accent-rgb), 0.3);\n}\n\n.strength-section {\n    background: rgba(0,0,0,0.05);\n    padding: 1rem;\n    border-radius: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.strength-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n}\n\n.entropy-badge {\n    font-size: 0.65rem;\n    font-weight: 800;\n    background: var(--background-modifier-border);\n    padding: 4px 8px;\n    border-radius: 8px;\n    color: var(--text-muted);\n}\n\n.progress-container {\n    height: 8px;\n    background: var(--background-primary);\n    border-radius: 4px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.progress-fill {\n    height: 100%;\n    width: 0%;\n    transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);\n    box-shadow: 0 0 10px rgba(0,0,0,0.1);\n}\n\n.crack-time-box {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-top: 8px;\n    border-top: 1px solid var(--background-modifier-border);\n}\n\n.crack-label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.crack-val {\n    font-size: 0.8rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    len: 16,\n    upper: true,\n    lower: true,\n    num: true,\n    sym: true,\n    gpus: 1,\n    password: ''\n};\n\nconst CHARSETS = {\n    upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',\n    lower: 'abcdefghijklmnopqrstuvwxyz',\n    num: '0123456789',\n    sym: '!@#$%^&*()_+-=[]{}|;:,.<>?'\n};\n\nfunction formatTime(seconds) {\n    if (seconds === Infinity) return 'Infinity';\n    if (seconds < 1) return '< 1 second';\n    \n    const units = [\n        { label: 'centuries', value: 3153600000 },\n        { label: 'years', value: 31536000 },\n        { label: 'months', value: 2592000 },\n        { label: 'days', value: 86400 },\n        { label: 'hours', value: 3600 },\n        { label: 'minutes', value: 60 },\n        { label: 'seconds', value: 1 }\n    ];\n\n    for (const unit of units) {\n        if (seconds >= unit.value) {\n            const count = Math.floor(seconds / unit.value);\n            if (unit.label === 'centuries' && count > 1000) return '> 1000 centuries';\n            return `${count} ${count > 1 ? unit.label : unit.label.slice(0, -1)}`;\n        }\n    }\n    return 'Instant';\n}\n\nfunction analyzePassword(pass, shouldSave = false) {\n    const hasUpper = /[A-Z]/.test(pass);\n    const hasLower = /[a-z]/.test(pass);\n    const hasNum = /[0-9]/.test(pass);\n    const hasSym = /[^A-Za-z0-9]/.test(pass);\n\n    state.len = pass.length;\n    state.upper = hasUpper;\n    state.lower = hasLower;\n    state.num = hasNum;\n    state.sym = hasSym;\n    state.password = pass;\n\n    // Update UI components\n    root.getElementById('len').value = state.len;\n    root.getElementById('len-val').innerText = state.len;\n    root.getElementById('opt-upper').checked = hasUpper;\n    root.getElementById('opt-lower').checked = hasLower;\n    root.getElementById('opt-num').checked = hasNum;\n    root.getElementById('opt-sym').checked = hasSym;\n\n    let poolSize = 0;\n    if (hasUpper) poolSize += CHARSETS.upper.length;\n    if (hasLower) poolSize += CHARSETS.lower.length;\n    if (hasNum) poolSize += CHARSETS.num.length;\n    if (hasSym) poolSize += CHARSETS.sym.length;\n\n    const entropy = poolSize > 0 ? Math.floor(state.len * Math.log2(poolSize)) : 0;\n    updateStrength(entropy, poolSize);\n    if (shouldSave) saveState(state);\n}\n\nfunction generate() {\n    let charset = '';\n    if (state.upper) charset += CHARSETS.upper;\n    if (state.lower) charset += CHARSETS.lower;\n    if (state.num) charset += CHARSETS.num;\n    if (state.sym) charset += CHARSETS.sym;\n\n    if (charset === '') {\n        root.getElementById('pass-out').value = '';\n        updateStrength(0, 0);\n        return;\n    }\n\n    let password = '';\n    const array = new Uint32Array(state.len);\n    crypto.getRandomValues(array);\n\n    for (let i = 0; i < state.len; i++) {\n        password += charset[array[i] % charset.length];\n    }\n\n    state.password = password;\n    root.getElementById('pass-out').value = password;\n    \n    const entropy = Math.floor(state.len * Math.log2(charset.length));\n    updateStrength(entropy, charset.length);\n    saveState(state);\n}\n\nfunction updateStrength(entropy, poolSize) {\n    const valEl = root.getElementById('entropy-val');\n    const labelEl = root.getElementById('strength-label');\n    const barEl = root.getElementById('strength-bar');\n    const crackEl = root.getElementById('crack-time');\n    \n    valEl.innerText = entropy;\n    \n    let label = 'Very Weak';\n    let color = '#ef4444'; // Red\n    let percent = Math.min((entropy / 128) * 100, 100);\n\n    if (entropy >= 100) {\n        label = 'Secure';\n        color = '#10b981'; // Green\n    } else if (entropy >= 80) {\n        label = 'Strong';\n        color = '#34d399'; // Light Green\n    } else if (entropy >= 60) {\n        label = 'Good';\n        color = '#fbbf24'; // Amber\n    } else if (entropy >= 40) {\n        label = 'Weak';\n        color = '#f59e0b'; // Orange\n    }\n\n    if (poolSize === 0 || entropy === 0) {\n        label = 'N/A';\n        percent = 0;\n        crackEl.innerText = 'N/A';\n    } else {\n        const hashesPerSec = state.gpus * 1e11;\n        const totalCombinations = Math.pow(2, entropy);\n        const secondsToCrack = (totalCombinations / 2) / hashesPerSec;\n        crackEl.innerText = formatTime(secondsToCrack);\n    }\n\n    labelEl.innerText = label;\n    labelEl.style.color = color;\n    barEl.style.width = `${percent}%`;\n    barEl.style.background = color;\n}\n\nasync function copyToClipboard() {\n    const pass = root.getElementById('pass-out').value;\n    if (!pass) return;\n\n    try {\n        await navigator.clipboard.writeText(pass);\n        const feedback = root.getElementById('copy-feedback');\n        feedback.classList.add('show');\n        setTimeout(() => feedback.classList.remove('show'), 2000);\n    } catch (err) {\n        console.error('Failed to copy: ', err);\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) Object.assign(state, saved);\n\n    // Restore UI\n    root.getElementById('len').value = state.len;\n    root.getElementById('len-val').innerText = state.len;\n    root.getElementById('opt-upper').checked = state.upper;\n    root.getElementById('opt-lower').checked = state.lower;\n    root.getElementById('opt-num').checked = state.num;\n    root.getElementById('opt-sym').checked = state.sym;\n    root.getElementById('gpu-count').value = state.gpus || 1;\n    root.getElementById('gpu-val').innerText = state.gpus || 1;\n\n    const passInput = root.getElementById('pass-out');\n    \n    if (state.password) {\n        passInput.value = state.password;\n        analyzePassword(state.password, false);\n    } else {\n        generate();\n    }\n\n    // Event Listeners\n    passInput.oninput = (e) => {\n        analyzePassword(e.target.value, false);\n    };\n\n    passInput.onblur = () => {\n        saveState(state);\n    };\n\n    passInput.onclick = (e) => {\n        if (window.getSelection().toString().length === 0) {\n            copyToClipboard();\n        }\n    };\n\n    root.getElementById('len').oninput = (e) => {\n        state.len = parseInt(e.target.value);\n        root.getElementById('len-val').innerText = state.len;\n        generate();\n    };\n\n    root.getElementById('gpu-count').oninput = (e) => {\n        state.gpus = parseInt(e.target.value);\n        root.getElementById('gpu-val').innerText = state.gpus;\n        analyzePassword(passInput.value, true);\n    };\n\n    ['upper', 'lower', 'num', 'sym'].forEach(opt => {\n        root.getElementById(`opt-${opt}`).onchange = (e) => {\n            state[opt] = e.target.checked;\n            generate();\n        };\n    });\n\n    root.getElementById('btn-refresh').onclick = generate;\n    root.getElementById('btn-copy').onclick = copyToClipboard;\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "expense-tracker",
      "title": "Expense Tracker",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">💰 Expense Tracker</h4>\n    <div class=\"total-display\" id=\"total-amount\">$0.00</div>\n  </div>\n\n  <div class=\"input-section\">\n    <div class=\"input-row\">\n      <input type=\"text\" id=\"exp-name\" placeholder=\"Description\">\n      <input type=\"number\" id=\"exp-amount\" placeholder=\"Amount\">\n    </div>\n    <div class=\"input-row controls\">\n      <div class=\"color-picker-wrapper\">\n        <input type=\"checkbox\" id=\"use-color\">\n        <input type=\"color\" id=\"exp-color\" value=\"#7c4dff\">\n      </div>\n      <button class=\"btn-add\" id=\"btn-add\">Add</button>\n    </div>\n  </div>\n\n  <div class=\"expense-list\" id=\"expense-list\"></div>\n  \n  <div class=\"footer-actions\">\n    <button class=\"btn-clear\" id=\"btn-clear\">Clear All</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--divider-color);\n    border-radius: 16px;\n    padding: 1.5rem;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.05);\n}\n.widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }\n.widget-title { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text-normal); }\n\n.total-display {\n    font-size: 1.5rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n}\n\n.input-section {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    margin-bottom: 1.5rem;\n}\n.input-row {\n    display: flex;\n    gap: 8px;\n}\n.input-section input[type=\"text\"], \n.input-section input[type=\"number\"] {\n    background: var(--background-primary);\n    border: 1px solid var(--divider-color);\n    color: var(--text-normal);\n    border-radius: 8px;\n    padding: 8px 12px;\n    font-size: 0.85rem;\n    outline: none;\n    width: 100%;\n}\n#exp-name { flex: 2; }\n#exp-amount { flex: 1; }\n\n.controls {\n    justify-content: space-between;\n    align-items: center;\n}\n\n.color-picker-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\ninput[type=\"color\"] {\n    border: none;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: none;\n    cursor: pointer;\n}\n\n.btn-add {\n    background: var(--interactive-accent);\n    color: white;\n    border: none;\n    border-radius: 8px;\n    padding: 8px 16px;\n    font-weight: 700;\n    cursor: pointer;\n    flex-grow: 1;\n}\n\n.expense-list {\n    max-height: 200px;\n    overflow-y: auto;\n    margin-bottom: 1rem;\n    display: grid;\n    gap: 8px;\n}\n\n.expense-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px 12px;\n    background: var(--background-primary-alt);\n    border-radius: 10px;\n    border: 1px solid var(--divider-color);\n    border-left: 4px solid transparent;\n}\n\n.exp-info { display: flex; flex-direction: column; }\n.exp-title { font-weight: 600; font-size: 0.9rem; }\n.exp-date { font-size: 0.7rem; color: var(--text-muted); }\n\n.exp-right { display: flex; align-items: center; gap: 12px; }\n.exp-val { font-weight: 700; color: var(--text-error); }\n.btn-del { background: none; border: none; color: var(--text-error); cursor: pointer; opacity: 0.5; font-size: 1rem; }\n.btn-del:hover { opacity: 1; }\n\n.footer-actions { text-align: right; }\n.btn-clear { \n    background: none; \n    border: none; \n    color: var(--text-muted); \n    font-size: 0.75rem; \n    cursor: pointer; \n    text-decoration: underline; \n}\n.btn-clear:hover { color: var(--text-error); }",
      "js": "var expenses = [];\n\nfunction render() {\n    var list = api.root.getElementById('expense-list');\n    var totalEl = api.root.getElementById('total-amount');\n    list.innerHTML = '';\n    \n    var total = 0;\n    expenses.forEach(function(exp, idx) {\n        total += parseFloat(exp.amount);\n        var item = document.createElement('div');\n        item.className = 'expense-item';\n        if (exp.color) {\n            item.style.borderLeftColor = exp.color;\n        }\n        item.innerHTML = '<div class=\"exp-info\"><span class=\"exp-title\">' + exp.name + '</span><span class=\"exp-date\">' + exp.date + '</span></div><div class=\"exp-right\"><span class=\"exp-val\">-$' + parseFloat(exp.amount).toFixed(2) + '</span><button class=\"btn-del\">×</button></div>';\n        \n        item.querySelector('.btn-del').onclick = function() { deleteExpense(idx); };\n        list.appendChild(item);\n    });\n    \n    totalEl.innerText = '$' + total.toFixed(2);\n}\n\nfunction addExpense() {\n    var nameInput = api.root.getElementById('exp-name');\n    var amountInput = api.root.getElementById('exp-amount');\n    var useColor = api.root.getElementById('use-color');\n    var colorInput = api.root.getElementById('exp-color');\n    \n    var name = nameInput.value.trim();\n    var amount = parseFloat(amountInput.value);\n    var color = useColor.checked ? colorInput.value : null;\n    \n    if (name && !isNaN(amount)) {\n        expenses.unshift({\n            name: name,\n            amount: amount,\n            date: new Date().toLocaleString(),\n            color: color\n        });\n        nameInput.value = '';\n        amountInput.value = '';\n        render();\n        api.saveState(expenses);\n    }\n}\n\nfunction deleteExpense(idx) {\n    expenses.splice(idx, 1);\n    render();\n    api.saveState(expenses);\n}\n\nfunction clearAll() {\n    var btn = api.root.getElementById('btn-clear');\n    if (btn.innerText === 'Clear All') {\n        btn.innerText = 'Confirm Clear?';\n        btn.style.color = 'var(--text-error)';\n        setTimeout(function() {\n            if (btn.innerText === 'Confirm Clear?') {\n                btn.innerText = 'Clear All';\n                btn.style.color = '';\n            }\n        }, 3000);\n    } else {\n        expenses = [];\n        render();\n        api.saveState(expenses);\n        btn.innerText = 'Clear All';\n        btn.style.color = '';\n    }\n}\n\nasync function init() {\n    var saved = await api.getState();\n    if (saved) expenses = saved;\n    \n    api.root.getElementById('btn-add').onclick = addExpense;\n    api.root.getElementById('btn-clear').onclick = clearAll;\n    api.root.getElementById('exp-name').onkeydown = function(e) { if (e.key === 'Enter') addExpense(); };\n    api.root.getElementById('exp-amount').onkeydown = function(e) { if (e.key === 'Enter') addExpense(); };\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "experiment-log",
      "title": "Experiment Log",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\" style=\"position: relative; resize: both; overflow: auto;\">\n  <h4 class=\"widget-title\">🧪 Experiment Tracker</h4>\n  <div class=\"log-inputs\">\n    <input type=\"text\" id=\"exp-name\" placeholder=\"Model / Hypothesis\">\n    <div class=\"input-row\">\n      <input type=\"text\" id=\"exp-params\" placeholder=\"Params (LR, Batch...)\">\n      <input type=\"text\" id=\"exp-res\" placeholder=\"Result (Acc, Loss...)\">\n    </div>\n    <div class=\"input-row controls\">\n      <div class=\"color-picker-wrapper\">\n        <input type=\"checkbox\" id=\"use-color\">\n        <input type=\"color\" id=\"exp-color\" value=\"#7c4dff\">\n      </div>\n      <button class=\"btn-log\" id=\"btn-log\">Log Experiment</button>\n    </div>\n  </div>\n  <div class=\"table-container\">\n    <table id=\"log-table\">\n      <thead><tr><th>Date/Time</th><th>Name</th><th>Params</th><th>Result</th><th></th></tr></thead>\n      <tbody id=\"log-body\"></tbody>\n    </table>\n  </div>\n  <div class=\"footer\">\n    <button class=\"btn-clear\" id=\"btn-clear\">Clear All</button>\n  </div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--divider-color);\n    border-radius: 12px;\n    padding: 1.25rem;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n}\n.widget-title { margin: 0 0 1.25rem 0; font-size: 0.9rem; font-weight: 600; color: var(--text-accent); text-align: center; text-transform: uppercase; letter-spacing: 0.05em; }\n\n.log-inputs { display: flex; flex-direction: column; gap: 10px; margin-bottom: 1.5rem; }\n.input-row { display: flex; gap: 10px; }\n.input-row input { flex: 1; }\n\ninput[type=\"text\"] { \n    background: var(--background-primary); \n    border: 1px solid var(--divider-color);\n    color: var(--text-normal); \n    padding: 10px; \n    border-radius: 8px; \n    font-size: 0.85rem;\n    outline: none;\n}\ninput[type=\"text\"]:focus { border-color: var(--interactive-accent); }\n\n.controls {\n    justify-content: space-between;\n    align-items: center;\n}\n\n.color-picker-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\ninput[type=\"color\"] {\n    border: none;\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    background: none;\n    cursor: pointer;\n}\n\n.btn-log { \n    background: var(--interactive-accent); \n    color: white; \n    border: none; \n    padding: 10px; \n    border-radius: 8px; \n    cursor: pointer; \n    font-weight: 700;\n    font-size: 0.85rem;\n    transition: filter 0.2s;\n    flex-grow: 1;\n}\n.btn-log:hover { filter: brightness(1.1); }\n\n.table-container { \n    max-height: 250px; \n    overflow-y: auto; \n    border: 1px solid var(--divider-color);\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\ntable { width: 100%; border-collapse: collapse; font-size: 0.8rem; background: var(--background-primary); }\nth { \n    text-align: left; \n    padding: 10px;\n    background: var(--background-secondary-alt);\n    color: var(--text-muted); \n    text-transform: uppercase;\n    font-size: 0.65rem;\n    letter-spacing: 1px;\n    position: sticky;\n    top: 0;\n}\nth:last-child { width: 40px; }\ntd { padding: 10px; border-bottom: 1px solid var(--divider-color); color: var(--text-normal); }\ntr:last-child td { border-bottom: none; }\n\n.log-row {\n    border-left: 4px solid transparent;\n}\n\n.btn-del { background: none; border: none; color: var(--text-error); cursor: pointer; opacity: 0.5; }\n.btn-del:hover { opacity: 1; }\n\n.footer { text-align: right; }\n.btn-clear { background: none; border: none; color: var(--text-muted); font-size: 0.75rem; cursor: pointer; text-decoration: underline; }\n.btn-clear:hover { color: var(--text-error); }",
      "js": "var logs = [];\n\nfunction render() {\n    var body = api.root.querySelector('#log-body');\n    body.innerHTML = '';\n    logs.forEach(function(log, idx) {\n        var tr = document.createElement('tr');\n        tr.className = 'log-row';\n        if (log.color) {\n            tr.style.borderLeftColor = log.color;\n        }\n        tr.innerHTML = '<td>' + log.time + '</td><td>' + log.name + '</td><td>' + log.p + '</td><td><b style=\"color:var(--text-accent)\">' + log.r + '</b></td><td><button class=\"btn-del\">×</button></td>';\n        tr.querySelector('.btn-del').onclick = function() { deleteLog(idx); };\n        body.appendChild(tr);\n    });\n}\n\nfunction addLog() {\n    var nameInput = api.root.querySelector('#exp-name');\n    var paramsInput = api.root.querySelector('#exp-params');\n    var resInput = api.root.querySelector('#exp-res');\n    var useColor = api.root.querySelector('#use-color');\n    var colorInput = api.root.querySelector('#exp-color');\n\n    var name = nameInput.value.trim();\n    var p = paramsInput.value.trim();\n    var r = resInput.value.trim();\n    var color = useColor.checked ? colorInput.value : null;\n\n    if (name && r) {\n        logs.unshift({\n            time: new Date().toLocaleString([], { dateStyle: 'short', timeStyle: 'short' }),\n            name: name,\n            p: p,\n            r: r,\n            color: color\n        });\n        api.saveState(logs);\n        render();\n        nameInput.value = '';\n        paramsInput.value = '';\n        resInput.value = '';\n    }\n}\n\nfunction deleteLog(idx) {\n    logs.splice(idx, 1);\n    render();\n    api.saveState(logs);\n}\n\nfunction clearAll() {\n    var btn = api.root.getElementById('btn-clear');\n    if (btn.innerText === 'Clear All') {\n        btn.innerText = 'Confirm Clear?';\n        btn.style.color = 'var(--text-error)';\n        setTimeout(function() {\n            if (btn.innerText === 'Confirm Clear?') {\n                btn.innerText = 'Clear All';\n                btn.style.color = '';\n            }\n        }, 3000);\n    } else {\n        logs = [];\n        render();\n        api.saveState(logs);\n        btn.innerText = 'Clear All';\n        btn.style.color = '';\n    }\n}\n\nasync function init() {\n    var saved = await api.getState();\n    if (saved) logs = saved;\n    \n    api.root.getElementById('btn-log').onclick = addLog;\n    api.root.getElementById('btn-clear').onclick = clearAll;\n    \n    api.root.getElementById('exp-name').onkeydown = function(e) { if (e.key === 'Enter') addLog(); };\n    api.root.getElementById('exp-params').onkeydown = function(e) { if (e.key === 'Enter') addLog(); };\n    api.root.getElementById('exp-res').onkeydown = function(e) { if (e.key === 'Enter') addLog(); };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "file-api-tester",
      "title": "File API Tester",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"api-tester\" style=\"position: relative; resize: both; overflow: auto;\">\n  <h4>📂 File API Tester Pro</h4>\n  \n  <div class=\"section\">\n    <label>1. Search & Select File:</label>\n    <div class=\"search-row\">\n      <input type=\"text\" id=\"file-search\" list=\"file-datalist\" placeholder=\"Search any file (log, xml, md...)\" onchange=\"handleFileChange()\">\n      <datalist id=\"file-datalist\"></datalist>\n      <button onclick=\"refreshFiles()\" class=\"mini-btn\">🔄</button>\n    </div>\n  </div>\n\n  <div class=\"section\">\n    <div class=\"preview-header\">\n      <label>2. Editor:</label>\n      <div class=\"header-actions\">\n        <button onclick=\"saveChanges()\" class=\"save-btn\">💾 Save</button>\n      </div>\n    </div>\n    <textarea id=\"editor-box\" placeholder=\"Select a file to edit content...\"></textarea>\n  </div>\n\n  <div class=\"section\">\n    <label>3. Quick Log Configuration:</label>\n    <div class=\"log-config-row\">\n      <input type=\"text\" id=\"log-path\" list=\"log-datalist\" placeholder=\"Log file path (e.g. logs/daily.log)\" onchange=\"saveLocalState()\">\n      <datalist id=\"log-datalist\"></datalist>\n    </div>\n    <div class=\"log-row\">\n      <input type=\"text\" id=\"log-input\" placeholder=\"Message to append...\">\n      <button onclick=\"appendLog()\">➕ Append</button>\n    </div>\n  </div>\n\n  <div id=\"status-bar\" class=\"status\">Ready</div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ".api-tester {\n  background: var(--background-secondary);\n  border: 1px solid var(--background-modifier-border);\n  border-radius: 12px;\n  padding: 15px;\n  color: var(--text-normal);\n  font-family: var(--font-interface);\n}\n.section {\n  margin-bottom: 15px;\n}\nlabel {\n  display: block;\n  font-size: 0.7rem;\n  font-weight: 700;\n  margin-bottom: 5px;\n  color: var(--text-muted);\n  text-transform: uppercase;\n}\n.search-row, .log-row, .log-config-row {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 5px;\n}\n.preview-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 5px;\n}\n#file-search, #log-path, #log-input, #editor-box {\n  width: 100%;\n  background: var(--background-primary);\n  color: var(--text-normal);\n  border: 1px solid var(--background-modifier-border);\n  border-radius: 6px;\n  padding: 8px;\n  font-size: 0.85rem;\n  outline: none;\n}\n#file-search:focus, #log-path:focus, #log-input:focus, #editor-box:focus {\n  border-color: var(--interactive-accent);\n}\n#editor-box {\n  height: 180px;\n  font-family: var(--font-monospace);\n  font-size: 0.8rem;\n  resize: vertical;\n  color: var(--text-accent);\n}\nbutton {\n  background: var(--interactive-accent);\n  color: white;\n  border: none;\n  border-radius: 6px;\n  padding: 8px 12px;\n  cursor: pointer;\n  font-weight: 600;\n  font-size: 0.8rem;\n  white-space: nowrap;\n}\n.mini-btn {\n  padding: 8px;\n  background: var(--background-primary);\n  border: 1px solid var(--background-modifier-border);\n}\n.save-btn {\n  background: var(--background-modifier-success);\n  padding: 4px 10px;\n  font-size: 0.75rem;\n}\n.status {\n  font-size: 0.65rem;\n  color: var(--text-muted);\n  margin-top: 10px;\n  font-style: italic;\n  border-top: 1px solid var(--background-modifier-border);\n  padding-top: 8px;\n}",
      "js": "const TEXT_EXTENSIONS = ['json', 'csv', 'log', 'xml', 'txt', 'md', 'yaml', 'yml', 'css', 'js', 'ts'];\n\nasync function saveLocalState() {\n  const mainPath = root.getElementById('file-search').value;\n  const logPath = root.getElementById('log-path').value;\n  await api.saveState({ mainPath, logPath });\n}\n\nasync function refreshFiles() {\n  const allFiles = api.getFiles();\n  const files = allFiles.filter(f => {\n    const ext = f.split('.').pop().toLowerCase();\n    return TEXT_EXTENSIONS.includes(ext);\n  });\n\n  const fileDatalist = root.getElementById('file-datalist');\n  const logDatalist = root.getElementById('log-datalist');\n  \n  fileDatalist.innerHTML = '';\n  logDatalist.innerHTML = '';\n  \n  files.forEach(f => {\n    const opt = document.createElement('option');\n    opt.value = f;\n    fileDatalist.appendChild(opt.cloneNode(true));\n    logDatalist.appendChild(opt);\n  });\n  setStatus(\"File lists updated (\" + files.length + \" files)\");\n  await readSelectedFile();\n}\n\nasync function handleFileChange() {\n  const path = root.getElementById('file-search').value;\n  if (!path || !path.includes('.')) return;\n  \n  await saveLocalState();\n  await readSelectedFile();\n}\n\nasync function readSelectedFile() {\n  const path = root.getElementById('file-search').value;\n  const editor = root.getElementById('editor-box');\n  \n  if (!path || !path.includes('.')) return;\n  \n  setStatus(\"Reading \" + path + \"...\");\n  const content = await api.readFile(path);\n  \n  if (content === null) {\n    setStatus(\"File not found\");\n    editor.value = \"\";\n    return;\n  }\n\n  editor.value = content;\n  setStatus(\"Loaded: \" + path);\n}\n\nasync function saveChanges() {\n  const path = root.getElementById('file-search').value;\n  const content = root.getElementById('editor-box').value;\n  \n  if (!path) {\n    new Notice(\"Please select a file first\");\n    return;\n  }\n\n  setStatus(\"Saving \" + path + \"...\");\n  await api.writeFile(path, content);\n  new Notice(\"File saved successfully!\");\n  setStatus(\"Saved: \" + path);\n}\n\nasync function appendLog() {\n  const logPath = root.getElementById('log-path').value || \"log.txt\";\n  const msg = root.getElementById('log-input').value;\n  \n  if (!msg) return;\n  \n  setStatus(\"Appending to \" + logPath + \"...\");\n  \n  let currentLog = await api.readFile(logPath) || \"\";\n  const newLog = currentLog + (currentLog ? \"\\n\" : \"\") + \"[\" + new Date().toLocaleString() + \"] \" + msg;\n  \n  await api.writeFile(logPath, newLog);\n  root.getElementById('log-input').value = \"\";\n  setStatus(\"Log updated in \" + logPath);\n  \n  if (root.getElementById('file-search').value === logPath) {\n    readSelectedFile();\n  }\n}\n\nfunction setStatus(msg) {\n  root.getElementById('status-bar').innerText = msg;\n}\n\nasync function init() {\n  refreshFiles();\n  const saved = await api.getState();\n  if (saved) {\n    if (saved.mainPath) {\n      root.getElementById('file-search').value = saved.mainPath;\n      readSelectedFile();\n    }\n    if (saved.logPath) {\n      root.getElementById('log-path').value = saved.logPath;\n    }\n  }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "fitness-log",
      "title": "Fitness Log",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"fitness-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">💪 Fitness Studio Pro</h4>\n      <button class=\"btn-icon\" id=\"btn-clear-all\" title=\"Clear All History\">🗑️</button>\n    </div>\n    <div class=\"input-container\">\n      <div class=\"input-main\">\n        <input type=\"text\" id=\"fit-name\" placeholder=\"Exercise name (e.g. Bench Press)\">\n        <select id=\"fit-category\">\n          <option value=\"strength\">Strength</option>\n          <option value=\"cardio\">Cardio</option>\n          <option value=\"flexibility\">Flexibility</option>\n          <option value=\"other\">Other</option>\n        </select>\n      </div>\n      <div class=\"input-details\">\n        <div class=\"detail-field\">\n          <label>Sets</label>\n          <input type=\"number\" id=\"fit-sets\" placeholder=\"0\">\n        </div>\n        <div class=\"detail-field\">\n          <label>Reps/Mins</label>\n          <input type=\"number\" id=\"fit-reps\" placeholder=\"0\">\n        </div>\n        <button class=\"btn-add\" id=\"btn-add\">ADD LOG</button>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"history-section\">\n    <div class=\"history-header\">\n      <label>Workout History</label>\n      <span class=\"history-count\" id=\"history-count\">0 logs</span>\n    </div>\n    <div class=\"entry-list\" id=\"entry-list\"></div>\n  </div>\n\n  <div class=\"footer-stats\">\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"stat-total\">0</span>\n      <span class=\"stat-label\">Total</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"stat-today\">0</span>\n      <span class=\"stat-label\">Today</span>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.fitness-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1rem;\n    opacity: 0.6;\n    transition: opacity 0.2s;\n}\n.btn-icon:hover { opacity: 1; }\n\n.input-container {\n    background: rgba(0,0,0,0.1);\n    padding: 1rem;\n    border-radius: 16px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.input-main {\n    display: flex;\n    gap: 8px;\n}\n\n.input-main input {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 10px 12px;\n    border-radius: 10px;\n    font-size: 0.85rem;\n    outline: none;\n}\n\n.input-main select {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 0 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    outline: none;\n    cursor: pointer;\n}\n\n.input-details {\n    display: flex;\n    gap: 10px;\n    align-items: flex-end;\n}\n\n.detail-field {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.detail-field label {\n    font-size: 0.6rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    padding-left: 4px;\n}\n\n.detail-field input {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px;\n    border-radius: 10px;\n    font-size: 0.85rem;\n    outline: none;\n    width: 100%;\n}\n\n.btn-add {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 10px 16px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n    box-shadow: 0 4px 0 rgba(0,0,0,0.1);\n}\n.btn-add:hover { filter: brightness(1.1); transform: translateY(-1px); }\n.btn-add:active { transform: translateY(1px); box-shadow: none; }\n\n.history-section {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.history-header label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.history-count {\n    font-size: 0.65rem;\n    font-weight: 800;\n    background: var(--background-modifier-border);\n    padding: 2px 8px;\n    border-radius: 10px;\n    color: var(--text-muted);\n}\n\n.entry-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-height: 300px;\n    overflow-y: auto;\n    padding-right: 4px;\n}\n.entry-list::-webkit-scrollbar { width: 4px; }\n.entry-list::-webkit-scrollbar-thumb { background: var(--background-modifier-border); border-radius: 4px; }\n\n.entry-item {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 14px;\n    padding: 12px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    position: relative;\n    overflow: hidden;\n}\n\n@keyframes slideIn {\n    from { opacity: 0; transform: translateX(-10px); }\n    to { opacity: 1; transform: translateX(0); }\n}\n\n.entry-main {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.entry-icon {\n    width: 36px;\n    height: 36px;\n    background: rgba(var(--interactive-accent-rgb), 0.1);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.2rem;\n}\n\n.entry-content {\n    display: flex;\n    flex-direction: column;\n}\n\n.entry-name {\n    font-weight: 700;\n    font-size: 0.85rem;\n    color: var(--text-normal);\n}\n\n.entry-meta {\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.entry-time {\n    font-size: 0.6rem;\n    font-weight: 600;\n    color: var(--interactive-accent);\n    background: rgba(var(--interactive-accent-rgb), 0.05);\n    padding: 1px 6px;\n    border-radius: 4px;\n}\n\n.btn-del {\n    background: none;\n    border: none;\n    color: var(--text-error);\n    opacity: 0.3;\n    cursor: pointer;\n    padding: 8px;\n    font-size: 1.1rem;\n    transition: all 0.2s;\n}\n.btn-del:hover { opacity: 1; transform: scale(1.1); }\n\n.footer-stats {\n    display: flex;\n    gap: 1rem;\n    background: rgba(0,0,0,0.05);\n    padding: 12px;\n    border-radius: 16px;\n}\n\n.stat-item {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.stat-val {\n    font-size: 1.1rem;\n    font-weight: 900;\n    color: var(--interactive-accent);\n}\n\n.stat-label {\n    font-size: 0.55rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet entries = [];\n\nconst CATEGORY_ICONS = {\n    strength: '🏋️',\n    cardio: '🏃',\n    flexibility: '🧘',\n    other: '✨'\n};\n\nfunction render() {\n    const list = root.getElementById('entry-list');\n    const count = root.getElementById('history-count');\n    const totalStat = root.getElementById('stat-total');\n    const todayStat = root.getElementById('stat-today');\n    \n    if (!list) return;\n    list.innerHTML = '';\n    \n    const today = new Date().toLocaleDateString();\n    let todayCount = 0;\n\n    entries.forEach((entry, idx) => {\n        const item = document.createElement('div');\n        item.className = 'entry-item';\n        \n        const entryDate = new Date(entry.timestamp);\n        const isToday = entryDate.toLocaleDateString() === today;\n        if (isToday) todayCount++;\n\n        const timeStr = entryDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n        const dateStr = isToday ? 'Today' : entryDate.toLocaleDateString([], { month: 'short', day: 'numeric' });\n\n        item.innerHTML = `\n            <div class=\"entry-main\">\n                <div class=\"entry-icon\">${CATEGORY_ICONS[entry.category] || '✨'}</div>\n                <div class=\"entry-content\">\n                    <span class=\"entry-name\">${entry.name}</span>\n                    <div class=\"entry-meta\">\n                        <span>${entry.sets} sets × ${entry.reps}</span>\n                        <span class=\"entry-time\">${dateStr} ${timeStr}</span>\n                    </div>\n                </div>\n            </div>\n            <button class=\"btn-del\" title=\"Delete Log\">×</button>\n        `;\n        \n        item.querySelector('.btn-del').onclick = () => deleteEntry(idx);\n        list.appendChild(item);\n    });\n    \n    if (count) count.innerText = `${entries.length} logs`;\n    if (totalStat) totalStat.innerText = entries.length;\n    if (todayStat) todayStat.innerText = todayCount;\n}\n\nfunction addEntry() {\n    const nameIn = root.getElementById('fit-name');\n    const categoryIn = root.getElementById('fit-category');\n    const setsIn = root.getElementById('fit-sets');\n    const repsIn = root.getElementById('fit-reps');\n    \n    const name = nameIn.value.trim();\n    const category = categoryIn.value;\n    const sets = setsIn.value || 0;\n    const reps = repsIn.value || 0;\n    \n    if (name) {\n        entries.unshift({\n            name,\n            category,\n            sets,\n            reps,\n            timestamp: Date.now()\n        });\n        \n        nameIn.value = '';\n        setsIn.value = '';\n        repsIn.value = '';\n        \n        render();\n        save();\n    }\n}\n\nfunction deleteEntry(idx) {\n    entries.splice(idx, 1);\n    render();\n    save();\n}\n\nfunction clearAll() {\n    if (confirm('Clear all fitness logs?')) {\n        entries = [];\n        render();\n        save();\n    }\n}\n\nfunction save() {\n    saveState(entries);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) entries = saved;\n    \n    root.getElementById('btn-add').onclick = addEntry;\n    root.getElementById('btn-clear-all').onclick = clearAll;\n    \n    root.getElementById('fit-name').onkeydown = (e) => {\n        if (e.key === 'Enter') addEntry();\n    };\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "focus-hub",
      "title": "Focus Hub",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-info\">\n      <h4 class=\"widget-title\">🚀 Focus Hub</h4>\n      <div class=\"date-subtitle\" id=\"date-display\">Today</div>\n    </div>\n    <div class=\"progress-container\">\n      <svg class=\"progress-ring\" width=\"48\" height=\"48\">\n        <circle class=\"progress-ring__circle-bg\" stroke=\"var(--background-modifier-border)\" stroke-width=\"4\" fill=\"transparent\" r=\"20\" cx=\"24\" cy=\"24\"/>\n        <circle id=\"prog-circle\" class=\"progress-ring__circle\" stroke=\"var(--interactive-accent)\" stroke-width=\"4\" fill=\"transparent\" r=\"20\" cx=\"24\" cy=\"24\"/>\n      </svg>\n      <span id=\"prog-text\" class=\"progress-text\">0%</span>\n    </div>\n  </div>\n\n  <div class=\"input-wrapper\">\n    <button id=\"prio-toggle\" class=\"prio-btn prio-2\" title=\"Priority: Medium\">●</button>\n    <input type=\"text\" id=\"todo-input\" placeholder=\"New mission...\">\n    <button id=\"btn-add\" class=\"add-btn\">+</button>\n  </div>\n\n  <div class=\"filters\">\n    <button class=\"filter-btn active\" data-filter=\"all\">All</button>\n    <button class=\"filter-btn\" data-filter=\"active\">Active</button>\n    <button class=\"filter-btn\" data-filter=\"completed\">Done</button>\n  </div>\n\n  <div class=\"todo-list\" id=\"todo-list\">\n    \n  </div>\n\n  <div class=\"footer\">\n    <span id=\"items-count\">0 tasks</span>\n    <button class=\"btn-clear\" id=\"btn-clear\">Clear Done</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { --prio-high: #ef4444; --prio-med: #f59e0b; --prio-low: #3b82f6; background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 20px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 400px; margin: 0 auto; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; } .widget-title { margin: 0; font-size: 1.2rem; font-weight: 900; color: var(--text-normal); } .date-subtitle { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; margin-top: 2px; } .progress-container { position: relative; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; } .progress-ring__circle { transition: stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1); transform: rotate(-90deg); transform-origin: 50% 50%; stroke-dasharray: 125.6; stroke-dashoffset: 125.6; stroke-linecap: round; } .progress-text { position: absolute; font-size: 0.7rem; font-weight: 800; color: var(--text-normal); } .input-wrapper { display: flex; gap: 8px; background: var(--background-primary); padding: 6px; border-radius: 12px; border: 1px solid var(--background-modifier-border); margin-bottom: 1rem; align-items: center; } .prio-btn { width: 28px; height: 28px; border-radius: 8px; border: none; cursor: pointer; font-size: 1.2rem; line-height: 0; background: transparent; display: flex; align-items: center; justify-content: center; } .prio-1 { color: var(--prio-high); } .prio-2 { color: var(--prio-med); } .prio-3 { color: var(--prio-low); } #todo-input { flex: 1; border: none; background: transparent; color: var(--text-normal); font-size: 0.95rem; outline: none; padding: 8px 0; } .add-btn { background: var(--interactive-accent); color: var(--text-on-accent); border: none; border-radius: 8px; width: 32px; height: 32px; font-weight: bold; cursor: pointer; } .filters { display: flex; gap: 4px; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--background-modifier-border); } .filter-btn { background: none; border: none; color: var(--text-muted); font-size: 0.75rem; font-weight: 700; cursor: pointer; padding: 4px 8px; border-radius: 6px; } .filter-btn.active { color: var(--interactive-accent); background: rgba(var(--interactive-accent-rgb), 0.1); } .todo-list { max-height: 320px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; min-height: 50px; } .todo-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: var(--background-primary-alt); border-radius: 10px; border: 1px solid transparent; transition: all 0.2s; animation: slideIn 0.3s ease-out forwards; } @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .todo-item:hover { border-color: var(--background-modifier-border-hover); transform: translateX(2px); } .todo-item.completed { opacity: 0.6; } .todo-item.completed .todo-text { text-decoration: line-through; color: var(--text-muted); } .custom-cb { width: 20px; height: 20px; border: 2px solid var(--text-muted); border-radius: 6px; cursor: pointer; position: relative; } .todo-item.completed .custom-cb { background: var(--interactive-accent); border-color: var(--interactive-accent); } .todo-content { flex: 1; display: flex; flex-direction: column; } .todo-text { font-size: 0.9rem; font-weight: 500; color: var(--text-normal); } .prio-dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 4px; } .btn-del { background: none; border: none; cursor: pointer; font-size: 0.9rem; opacity: 0.3; } .todo-item:hover .btn-del { opacity: 1; } .footer { margin-top: 1rem; padding-top: 0.8rem; border-top: 1px solid var(--background-modifier-border); display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); } .btn-clear { background: none; border: none; color: var(--text-muted); cursor: pointer; font-weight: 600; } .btn-clear:hover { color: var(--text-error); } .empty-state { text-align: center; color: var(--text-faint); font-size: 0.85rem; padding: 1rem 0; font-style: italic; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar todos = [];\nvar currentPrio = 2;\nvar currentFilter = 'all';\n\nfunction getPrioColor(p) {\n  if(p===1) return 'var(--prio-high)';\n  if(p===2) return 'var(--prio-med)';\n  return 'var(--prio-low)';\n}\n\nfunction updateProgress() {\n  var total = todos.length;\n  var done = 0;\n  for(var i=0; i<total; i++) { if(todos[i].done) done++; }\n  \n  var pct = total === 0 ? 0 : Math.round((done / total) * 100);\n  \n  root.getElementById('prog-text').innerText = pct + '%';\n  \n  var circle = root.getElementById('prog-circle');\n  if(circle) {\n      var radius = 20;\n      var circumference = radius * 2 * Math.PI;\n      var offset = circumference - (pct / 100) * circumference;\n      circle.style.strokeDashoffset = offset;\n  }\n\n  var left = total - done;\n  root.getElementById('items-count').innerText = left + ' task' + (left !== 1 ? 's' : '') + ' left';\n}\n\nfunction render() {\n  var list = root.getElementById('todo-list');\n  list.innerHTML = '';\n\n  var filtered = todos.filter(function(t) {\n    if (currentFilter === 'active') return !t.done;\n    if (currentFilter === 'completed') return t.done;\n    return true;\n  }).sort(function(a, b) { return a.prio - b.prio; });\n\n  if (filtered.length === 0) {\n    list.innerHTML = '<div class=\"empty-state\">No tasks found.</div>';\n  } else {\n    filtered.forEach(function(todo) {\n      var el = document.createElement('div');\n      el.className = 'todo-item' + (todo.done ? ' completed' : '');\n      \n      var html = '<div class=\"custom-cb\"></div>' +\n                 '<div class=\"todo-content\">' +\n                    '<span class=\"todo-text\">' + todo.text + '</span>' +\n                    '<div class=\"prio-dot\" style=\"background: ' + getPrioColor(todo.prio) + '\"></div>' +\n                 '</div>' +\n                 '<button class=\"btn-del\">🗑️</button>';\n      el.innerHTML = html;\n\n      var cb = el.querySelector('.custom-cb');\n      cb.onclick = function() { toggleTodo(todo.id); };\n      \n      var del = el.querySelector('.btn-del');\n      del.onclick = function(e) { e.stopPropagation(); deleteTodo(todo.id); };\n      \n      var txt = el.querySelector('.todo-text');\n      txt.ondblclick = function() {\n         var newText = prompt('Edit task:', todo.text);\n         if(newText && newText.trim()) editTodo(todo.id, newText.trim());\n      };\n\n      list.appendChild(el);\n    });\n  }\n  updateProgress();\n}\n\nfunction addTodo() {\n  var input = root.getElementById('todo-input');\n  var text = input.value.trim();\n  if (!text) return;\n\n  todos.push({\n    id: Date.now(),\n    text: text,\n    done: false,\n    prio: currentPrio\n  });\n  \n  input.value = '';\n  render();\n  saveState(todos);\n}\n\nfunction toggleTodo(id) {\n  for(var i=0; i<todos.length; i++) {\n      if(todos[i].id === id) {\n          todos[i].done = !todos[i].done;\n          break;\n      }\n  }\n  render();\n  saveState(todos);\n}\n\nfunction deleteTodo(id) {\n  var newTodos = [];\n  for(var i=0; i<todos.length; i++) {\n      if(todos[i].id !== id) newTodos.push(todos[i]);\n  }\n  todos = newTodos;\n  render();\n  saveState(todos);\n}\n\nfunction editTodo(id, newText) {\n  for(var i=0; i<todos.length; i++) {\n      if(todos[i].id === id) {\n          todos[i].text = newText;\n          break;\n      }\n  }\n  render();\n  saveState(todos);\n}\n\nfunction clearCompleted() {\n  var newTodos = [];\n  for(var i=0; i<todos.length; i++) {\n      if(!todos[i].done) newTodos.push(todos[i]);\n  }\n  todos = newTodos;\n  render();\n  saveState(todos);\n}\n\nasync function init() {\n  var saved = await getState();\n  if (saved && Array.isArray(saved)) todos = saved;\n\n  var d = new Date();\n  root.getElementById('date-display').innerText = d.toLocaleDateString();\n\n  root.getElementById('btn-add').onclick = addTodo;\n  root.getElementById('todo-input').onkeydown = function(e) { if(e.key === 'Enter') addTodo(); };\n  root.getElementById('btn-clear').onclick = clearCompleted;\n  \n  // Filters\n  var btns = root.querySelectorAll('.filter-btn');\n  btns.forEach(function(btn) {\n    btn.onclick = function() {\n      btns.forEach(function(b) { b.classList.remove('active'); });\n      btn.classList.add('active');\n      currentFilter = btn.getAttribute('data-filter');\n      render();\n    };\n  });\n\n  // Prio Toggle\n  var pBtn = root.getElementById('prio-toggle');\n  pBtn.onclick = function() {\n    currentPrio++;\n    if(currentPrio > 3) currentPrio = 1;\n    pBtn.className = 'prio-btn prio-' + currentPrio;\n  };\n\n  render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "focus-timer",
      "title": "Focus Timer",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"focus-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🧘 Focus Studio Pro</h4>\n    <div class=\"session-stats\" id=\"session-stats\">Session #1</div>\n  </div>\n\n  <div class=\"timer-container\">\n    <svg class=\"progress-ring\" width=\"200\" height=\"200\">\n      <circle class=\"progress-ring__background\" stroke=\"var(--background-modifier-border)\" stroke-width=\"8\" fill=\"transparent\" r=\"90\" cx=\"100\" cy=\"100\"/>\n      <circle class=\"progress-ring__circle\" id=\"progress-circle\" stroke=\"var(--interactive-accent)\" stroke-width=\"8\" stroke-linecap=\"round\" fill=\"transparent\" r=\"90\" cx=\"100\" cy=\"100\"/>\n    </svg>\n    <div class=\"timer-content\">\n      <div class=\"timer-display\" id=\"timer-display\">25:00</div>\n      <div class=\"timer-status\" id=\"timer-status\">READY</div>\n    </div>\n  </div>\n\n  <div class=\"settings-group\" id=\"settings-group\">\n    <div class=\"slider-header\">\n      <label>Duration</label>\n      <span class=\"slider-value\" id=\"slider-value\">25 min</span>\n    </div>\n    <input type=\"range\" id=\"time-slider\" min=\"1\" max=\"120\" value=\"25\" class=\"modern-range\">\n  </div>\n\n  <div class=\"controls\">\n    <button class=\"btn-main\" id=\"btn-toggle\">START FOCUS</button>\n    <button class=\"btn-icon\" id=\"btn-reset\" title=\"Reset Timer\">🔄</button>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Focus Session Complete! ✨</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.focus-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 30px;\n    padding: 2rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.session-stats {\n    font-size: 0.65rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n    background: rgba(var(--interactive-accent-rgb), 0.1);\n    padding: 2px 10px;\n    border-radius: 10px;\n}\n\n.timer-container {\n    position: relative;\n    width: 200px;\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.progress-ring {\n    transform: rotate(-90deg);\n    filter: drop-shadow(0 0 10px rgba(var(--interactive-accent-rgb), 0.2));\n}\n\n.progress-ring__circle {\n    transition: stroke-dashoffset 0.3s linear;\n    stroke-dasharray: 565.48; /* 2 * PI * 90 */\n    stroke-dashoffset: 0;\n}\n\n.timer-content {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n}\n\n.timer-display {\n    font-size: 3rem;\n    font-weight: 900;\n    font-family: var(--font-monospace);\n    color: var(--text-normal);\n    line-height: 1;\n}\n\n.timer-status {\n    font-size: 0.65rem;\n    font-weight: 800;\n    letter-spacing: 0.2em;\n    color: var(--text-muted);\n    margin-top: 4px;\n}\n\n.settings-group {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: opacity 0.3s, transform 0.3s;\n}\n\n.settings-group.hidden {\n    opacity: 0;\n    pointer-events: none;\n    transform: translateY(10px);\n}\n\n.slider-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.slider-header label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.slider-value {\n    font-size: 0.85rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n}\n\n.modern-range {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 6px;\n    background: var(--background-modifier-border);\n    border-radius: 3px;\n    outline: none;\n}\n\n.modern-range::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 18px;\n    height: 18px;\n    background: var(--interactive-accent);\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(var(--interactive-accent-rgb), 0.4);\n    transition: transform 0.2s;\n}\n\n.modern-range::-webkit-slider-thumb:hover { transform: scale(1.2); }\n\n.controls {\n    width: 100%;\n    display: flex;\n    gap: 12px;\n}\n\n.btn-main {\n    flex: 1;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 14px;\n    border-radius: 16px;\n    font-size: 0.85rem;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n    box-shadow: 0 4px 0 rgba(0,0,0,0.1);\n}\n.btn-main:hover { filter: brightness(1.1); transform: translateY(-1px); }\n.btn-main:active { transform: translateY(1px); box-shadow: none; }\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    width: 50px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); }\n\n.toast {\n    position: absolute;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(-100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 10px 20px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 700;\n    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n    box-shadow: var(--shadow-l);\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nlet timeLeft = 25 * 60;\nlet totalTime = 25 * 60;\nlet timerId = null;\nlet sessionCount = 1;\n\nconst CIRCUMFERENCE = 2 * Math.PI * 90;\n\nfunction updateUI() {\n    const display = root.getElementById('timer-display');\n    const status = root.getElementById('timer-status');\n    const circle = root.getElementById('progress-circle');\n    const sliderValue = root.getElementById('slider-value');\n    const slider = root.getElementById('time-slider');\n    const stats = root.getElementById('session-stats');\n\n    const mins = Math.floor(timeLeft / 60);\n    const secs = timeLeft % 60;\n    if (display) display.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n\n    if (circle) {\n        const offset = CIRCUMFERENCE - (timeLeft / totalTime) * CIRCUMFERENCE;\n        circle.style.strokeDashoffset = offset;\n    }\n\n    if (status) {\n        if (timerId) status.innerText = 'FOCUSING...';\n        else if (timeLeft === totalTime) status.innerText = 'READY';\n        else status.innerText = 'PAUSED';\n    }\n\n    if (sliderValue && !timerId) {\n        sliderValue.innerText = `${slider.value} min`;\n    }\n\n    if (stats) stats.innerText = `Session #${sessionCount}`;\n}\n\nfunction toggleTimer() {\n    const btn = root.getElementById('btn-toggle');\n    const settings = root.getElementById('settings-group');\n\n    if (timerId) {\n        // Pause\n        clearInterval(timerId);\n        timerId = null;\n        btn.innerText = 'RESUME FOCUS';\n        if (settings) settings.classList.remove('hidden');\n    } else {\n        // Start\n        if (timeLeft <= 0) resetTimer();\n        \n        timerId = setInterval(() => {\n            timeLeft--;\n            if (timeLeft <= 0) {\n                completeSession();\n            }\n            updateUI();\n        }, 1000);\n        \n        btn.innerText = 'PAUSE';\n        if (settings) settings.classList.add('hidden');\n    }\n    updateUI();\n}\n\nfunction resetTimer() {\n    clearInterval(timerId);\n    timerId = null;\n    const slider = root.getElementById('time-slider');\n    totalTime = parseInt(slider.value) * 60;\n    timeLeft = totalTime;\n    \n    const btn = root.getElementById('btn-toggle');\n    const settings = root.getElementById('settings-group');\n    if (btn) btn.innerText = 'START FOCUS';\n    if (settings) settings.classList.remove('hidden');\n    \n    updateUI();\n}\n\nfunction completeSession() {\n    clearInterval(timerId);\n    timerId = null;\n    sessionCount++;\n    showToast();\n    resetTimer();\n    save();\n}\n\nfunction showToast() {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 4000);\n    }\n}\n\nfunction save() {\n    saveState({ totalTime, sessionCount });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (saved.totalTime) {\n            totalTime = saved.totalTime;\n            timeLeft = totalTime;\n            root.getElementById('time-slider').value = totalTime / 60;\n        }\n        if (saved.sessionCount) sessionCount = saved.sessionCount;\n    }\n\n    const slider = root.getElementById('time-slider');\n    slider.oninput = () => {\n        if (!timerId) {\n            totalTime = parseInt(slider.value) * 60;\n            timeLeft = totalTime;\n            updateUI();\n        }\n    };\n    slider.onchange = () => save();\n\n    root.getElementById('btn-toggle').onclick = toggleTimer;\n    root.getElementById('btn-reset').onclick = resetTimer;\n\n    updateUI();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "github-stats",
      "title": "GitHub Stats",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"github-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">🐙 GitHub Studio Pro</h4>\n      <div class=\"header-actions\">\n        <button class=\"btn-icon\" id=\"btn-refresh\" title=\"Refresh Data\">🔄</button>\n      </div>\n    </div>\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"gh-username\" placeholder=\"Enter GitHub username...\">\n      <button id=\"btn-fetch\">FETCH</button>\n    </div>\n  </div>\n\n  <div id=\"profile-card\" class=\"profile-card hidden\">\n    <div class=\"profile-header\">\n      <img id=\"avatar-img\" class=\"avatar\" src=\"\" alt=\"Avatar\">\n      <div class=\"user-info\">\n        <h2 id=\"user-name\">User Name</h2>\n        <p id=\"user-login\">@username</p>\n        <p id=\"user-bio\" class=\"bio\">Bio goes here...</p>\n      </div>\n    </div>\n\n    <div class=\"stats-grid\">\n      <div class=\"stat-item\">\n        <span class=\"stat-val\" id=\"stat-repos\">0</span>\n        <span class=\"stat-label\">Repos</span>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-val\" id=\"stat-followers\">0</span>\n        <span class=\"stat-label\">Followers</span>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-val\" id=\"stat-following\">0</span>\n        <span class=\"stat-label\">Following</span>\n      </div>\n    </div>\n\n    <div class=\"meta-info\">\n      <div class=\"meta-item\" id=\"meta-location\">\n        <span>📍</span> <span id=\"val-location\">Location</span>\n      </div>\n      <div class=\"meta-item\" id=\"meta-blog\">\n        <span>🔗</span> <a id=\"val-blog\" href=\"#\" target=\"_blank\">Website</a>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"loading-state\" class=\"loading-state hidden\">\n    <div class=\"spinner\"></div>\n    <span>Fetching GitHub data...</span>\n  </div>\n\n  <div id=\"error-state\" class=\"error-state hidden\">\n    <span>❌ User not found or API limit reached.</span>\n  </div>\n\n  <div id=\"empty-state\" class=\"empty-state\">\n    <div class=\"empty-icon\">🔍</div>\n    <p>Enter a username to see stats</p>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.github-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    position: relative;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.input-group {\n    display: flex;\n    gap: 8px;\n}\n\n.input-group input {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 0.85rem;\n    outline: none;\n    transition: border-color 0.2s;\n}\n.input-group input:focus { border-color: var(--interactive-accent); }\n\n.input-group button {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 0 16px;\n    border-radius: 12px;\n    font-size: 0.75rem;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.input-group button:hover { filter: brightness(1.1); }\n\n.profile-card {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 18px;\n    padding: 1.25rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    animation: fadeIn 0.3s ease;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.profile-header {\n    display: flex;\n    gap: 16px;\n    align-items: center;\n}\n\n.avatar {\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    border: 2px solid var(--interactive-accent);\n    background: var(--background-secondary);\n}\n\n.user-info h2 {\n    margin: 0;\n    font-size: 1.1rem;\n    font-weight: 800;\n    line-height: 1.2;\n}\n\n.user-info p {\n    margin: 2px 0;\n    font-size: 0.8rem;\n    color: var(--text-muted);\n}\n\n.bio {\n    font-size: 0.8rem !important;\n    line-height: 1.4;\n    margin-top: 6px !important;\n    color: var(--text-normal) !important;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 10px;\n}\n\n.stat-item {\n    background: var(--background-secondary);\n    padding: 10px;\n    border-radius: 12px;\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.stat-val {\n    font-size: 1.1rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n}\n\n.stat-label {\n    font-size: 0.6rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: var(--text-muted);\n}\n\n.meta-info {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    padding-top: 10px;\n    border-top: 1px solid var(--background-modifier-border);\n}\n\n.meta-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.75rem;\n    color: var(--text-muted);\n}\n\n.meta-item a {\n    color: var(--interactive-accent);\n    text-decoration: none;\n}\n.meta-item a:hover { text-decoration: underline; }\n\n.loading-state, .error-state, .empty-state {\n    padding: 2rem;\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 12px;\n    color: var(--text-muted);\n    font-size: 0.85rem;\n}\n\n.spinner {\n    width: 24px;\n    height: 24px;\n    border: 3px solid var(--background-modifier-border);\n    border-top-color: var(--interactive-accent);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n.empty-icon { font-size: 2rem; opacity: 0.5; }\n.hidden { display: none !important; }\n\n.btn-icon {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1rem;\n    opacity: 0.6;\n    transition: all 0.2s;\n}\n.btn-icon:hover { opacity: 1; transform: rotate(180deg); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    lastUsername: \"\"\n};\n\nasync function fetchGitHubData(username) {\n    if (!username) return;\n    \n    showState('loading');\n    \n    try {\n        const response = await fetch(`https://api.github.com/users/${username}`);\n        if (!response.ok) throw new Error('User not found');\n        \n        const data = await response.json();\n        updateProfile(data);\n        state.lastUsername = username;\n        saveState(state);\n        showState('profile');\n    } catch (err) {\n        console.error(err);\n        showState('error');\n    }\n}\n\nfunction updateProfile(data) {\n    root.getElementById('avatar-img').src = data.avatar_url;\n    root.getElementById('user-name').innerText = data.name || data.login;\n    root.getElementById('user-login').innerText = `@${data.login}`;\n    root.getElementById('user-bio').innerText = data.bio || \"No bio available\";\n    \n    root.getElementById('stat-repos').innerText = data.public_repos;\n    root.getElementById('stat-followers').innerText = data.followers;\n    root.getElementById('stat-following').innerText = data.following;\n    \n    const location = root.getElementById('meta-location');\n    if (data.location) {\n        location.classList.remove('hidden');\n        root.getElementById('val-location').innerText = data.location;\n    } else {\n        location.classList.add('hidden');\n    }\n    \n    const blog = root.getElementById('meta-blog');\n    if (data.blog) {\n        blog.classList.remove('hidden');\n        const blogLink = root.getElementById('val-blog');\n        blogLink.href = data.blog.startsWith('http') ? data.blog : `https://${data.blog}`;\n        blogLink.innerText = data.blog.replace(/^https?:\\/\\//, '');\n    } else {\n        blog.classList.add('hidden');\n    }\n}\n\nfunction showState(mode) {\n    const states = {\n        profile: root.getElementById('profile-card'),\n        loading: root.getElementById('loading-state'),\n        error: root.getElementById('error-state'),\n        empty: root.getElementById('empty-state')\n    };\n    \n    Object.keys(states).forEach(key => {\n        if (states[key]) {\n            if (key === mode) states[key].classList.remove('hidden');\n            else states[key].classList.add('hidden');\n        }\n    });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && saved.lastUsername) {\n        state = saved;\n        root.getElementById('gh-username').value = state.lastUsername;\n        fetchGitHubData(state.lastUsername);\n    }\n\n    root.getElementById('btn-fetch').onclick = () => {\n        const user = root.getElementById('gh-username').value.trim();\n        fetchGitHubData(user);\n    };\n\n    root.getElementById('gh-username').onkeydown = (e) => {\n        if (e.key === 'Enter') {\n            const user = root.getElementById('gh-username').value.trim();\n            fetchGitHubData(user);\n        }\n    };\n\n    root.getElementById('btn-refresh').onclick = () => {\n        const user = root.getElementById('gh-username').value.trim();\n        if (user) fetchGitHubData(user);\n    };\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "habit-tracker-pro",
      "title": "Habit Tracker Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"habit-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">🔥 Habit Studio Pro</h4>\n      <div class=\"header-actions\">\n        <button class=\"btn-icon\" id=\"btn-reset-week\" title=\"Reset Week\">↻</button>\n        <button class=\"btn-edit\" id=\"btn-edit-toggle\">Edit</button>\n      </div>\n    </div>\n    <div class=\"input-group\" id=\"add-habit-group\">\n      <input type=\"text\" id=\"new-habit-name\" placeholder=\"New habit name...\">\n      <button id=\"btn-add-habit\">ADD</button>\n    </div>\n  </div>\n\n  <div class=\"habit-list\" id=\"habit-list\"></div>\n\n  <div class=\"stats-footer\">\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"stat-avg\">0%</span>\n      <span class=\"stat-label\">Weekly Avg</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"stat-streak\">0</span>\n      <span class=\"stat-label\">Best Streak</span>\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Habit added! 🚀</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.habit-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.header-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.btn-icon, .btn-edit {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    padding: 4px 10px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n    color: var(--text-muted);\n    transition: all 0.2s;\n}\n.btn-icon:hover, .btn-edit:hover { background: var(--background-modifier-hover); }\n.btn-edit.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border-color: var(--interactive-accent);\n}\n\n.input-group {\n    display: flex;\n    gap: 8px;\n    animation: fadeIn 0.3s ease;\n}\n\n.input-group input {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px 12px;\n    border-radius: 10px;\n    font-size: 0.85rem;\n    outline: none;\n}\n\n.input-group button {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 0 16px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 800;\n    cursor: pointer;\n}\n\n.habit-list {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.habit-item {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    position: relative;\n}\n\n.habit-item.new-habit {\n    animation: slideIn 0.3s ease;\n}\n\n@keyframes slideIn {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.habit-info {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.habit-name {\n    font-weight: 700;\n    font-size: 0.9rem;\n    color: var(--text-normal);\n}\n\n.habit-streak {\n    font-size: 0.7rem;\n    font-weight: 800;\n    color: #f59e0b;\n    background: rgba(245, 158, 11, 0.1);\n    padding: 2px 8px;\n    border-radius: 8px;\n}\n\n.habit-grid {\n    display: grid;\n    grid-template-columns: repeat(7, 1fr);\n    gap: 6px;\n}\n\n.day-dot {\n    aspect-ratio: 1;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    transition: all 0.2s;\n}\n\n.day-dot.done {\n    background: var(--interactive-accent);\n    border-color: var(--interactive-accent);\n    color: var(--text-on-accent);\n    box-shadow: 0 0 10px rgba(var(--interactive-accent-rgb), 0.3);\n}\n\n.day-dot:hover { transform: scale(1.1); border-color: var(--interactive-accent); }\n\n.btn-del {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    background: none;\n    border: none;\n    color: var(--text-error);\n    opacity: 0;\n    cursor: pointer;\n    padding: 4px;\n    font-size: 1rem;\n    transition: opacity 0.2s;\n}\n.habit-item:hover .btn-del { opacity: 0.5; }\n.btn-del:hover { opacity: 1 !important; }\n\n.stats-footer {\n    display: flex;\n    gap: 1rem;\n    background: rgba(0,0,0,0.05);\n    padding: 12px;\n    border-radius: 16px;\n}\n\n.stat-item {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.stat-val {\n    font-size: 1.1rem;\n    font-weight: 900;\n    color: var(--interactive-accent);\n}\n\n.stat-label {\n    font-size: 0.55rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }\n\n.hidden { display: none !important; }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    habits: [\n        { name: 'Morning Meditation', done: [true, true, false, true, false, false, false] },\n        { name: 'Read 20 Pages', done: [true, true, true, true, true, false, false] }\n    ],\n    isEditing: false\n};\n\nconst DAYS = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];\n\nfunction render() {\n    const list = root.getElementById('habit-list');\n    const avgEl = root.getElementById('stat-avg');\n    const streakEl = root.getElementById('stat-streak');\n    const editBtn = root.getElementById('btn-edit-toggle');\n    const inputGroup = root.getElementById('add-habit-group');\n\n    if (!list) return;\n    list.innerHTML = '';\n\n    if (state.isEditing) {\n        editBtn.classList.add('active');\n        editBtn.innerText = 'Done';\n        inputGroup.classList.remove('hidden');\n    } else {\n        editBtn.classList.remove('active');\n        editBtn.innerText = 'Edit';\n        inputGroup.classList.add('hidden');\n    }\n\n    let totalDone = 0;\n    let totalPossible = state.habits.length * 7;\n    let maxStreak = 0;\n\n    state.habits.forEach((habit, hIdx) => {\n        const item = document.createElement('div');\n        item.className = 'habit-item';\n\n        let currentStreak = 0;\n        for (let i = habit.done.length - 1; i >= 0; i--) {\n            if (habit.done[i]) currentStreak++;\n            else break;\n        }\n\n        let bestStreak = 0;\n        let tempStreak = 0;\n        habit.done.forEach(d => {\n            if (d) {\n                tempStreak++;\n                if (tempStreak > bestStreak) bestStreak = tempStreak;\n            } else {\n                tempStreak = 0;\n            }\n        });\n\n        habit.done.forEach(d => { if (d) totalDone++; });\n        if (bestStreak > maxStreak) maxStreak = bestStreak;\n\n        let dotsHtml = '';\n        habit.done.forEach((d, dIdx) => {\n            dotsHtml += `<div class=\"day-dot ${d ? 'done' : ''}\" data-h=\"${hIdx}\" data-d=\"${dIdx}\">${DAYS[dIdx]}</div>`;\n        });\n\n        item.innerHTML = `\n            <div class=\"habit-info\">\n                <span class=\"habit-name\">${habit.name}</span>\n                <span class=\"habit-streak\">🔥 ${bestStreak}d</span>\n            </div>\n            <div class=\"habit-grid\">${dotsHtml}</div>\n            ${state.isEditing ? `<button class=\"btn-del\" data-idx=\"${hIdx}\">🗑️</button>` : ''}\n        `;\n\n        list.appendChild(item);\n    });\n\n    const avg = totalPossible > 0 ? Math.round((totalDone / totalPossible) * 100) : 0;\n    if (avgEl) avgEl.innerText = `${avg}%`;\n    if (streakEl) streakEl.innerText = maxStreak;\n}\n\nfunction addHabit() {\n    const input = root.getElementById('new-habit-name');\n    const name = input.value.trim();\n    if (name) {\n        state.habits.push({\n            name,\n            done: [false, false, false, false, false, false, false]\n        });\n        input.value = '';\n        render();\n        save();\n        showToast('Habit added! 🚀');\n    }\n}\n\nfunction deleteHabit(idx) {\n    state.habits.splice(idx, 1);\n    render();\n    save();\n}\n\nfunction toggleDay(hIdx, dIdx, dotEl) {\n    state.habits[hIdx].done[dIdx] = !state.habits[hIdx].done[dIdx];\n    \n    // Surgical UI update to avoid full re-render flicker\n    if (dotEl) {\n        dotEl.classList.toggle('done', state.habits[hIdx].done[dIdx]);\n        \n        // Update best streak for this specific habit\n        const habitItem = dotEl.closest('.habit-item');\n        const streakEl = habitItem.querySelector('.habit-streak');\n        let bestStreak = 0;\n        let tempStreak = 0;\n        state.habits[hIdx].done.forEach(d => {\n            if (d) {\n                tempStreak++;\n                if (tempStreak > bestStreak) bestStreak = tempStreak;\n            } else {\n                tempStreak = 0;\n            }\n        });\n        if (streakEl) streakEl.innerText = `🔥 ${bestStreak}d`;\n    }\n\n    // Update global stats\n    updateGlobalStats();\n    save();\n}\n\nfunction updateGlobalStats() {\n    const avgEl = root.getElementById('stat-avg');\n    const streakEl = root.getElementById('stat-streak');\n    \n    let totalDone = 0;\n    let totalPossible = state.habits.length * 7;\n    let maxStreak = 0;\n\n    state.habits.forEach(habit => {\n        let best = 0;\n        let current = 0;\n        habit.done.forEach(d => {\n            if (d) {\n                totalDone++;\n                current++;\n                if (current > best) best = current;\n            } else {\n                current = 0;\n            }\n        });\n        if (best > maxStreak) maxStreak = best;\n    });\n\n    const avg = totalPossible > 0 ? Math.round((totalDone / totalPossible) * 100) : 0;\n    if (avgEl) avgEl.innerText = `${avg}%`;\n    if (streakEl) streakEl.innerText = maxStreak;\n}\n\nfunction resetWeek() {\n    if (confirm('Reset all habits for this week?')) {\n        state.habits.forEach(h => h.done = [false, false, false, false, false, false, false]);\n        render();\n        save();\n    }\n}\n\nfunction toggleEdit() {\n    state.isEditing = !state.isEditing;\n    render();\n    save();\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (Array.isArray(saved)) state.habits = saved;\n        else Object.assign(state, saved);\n    }\n\n    root.getElementById('btn-add-habit').onclick = addHabit;\n    root.getElementById('btn-reset-week').onclick = resetWeek;\n    root.getElementById('btn-edit-toggle').onclick = toggleEdit;\n    root.getElementById('new-habit-name').onkeydown = (e) => {\n        if (e.key === 'Enter') addHabit();\n    };\n\n    root.addEventListener('click', (e) => {\n        const dot = e.target.closest('.day-dot');\n        if (dot) {\n            const hIdx = parseInt(dot.dataset.h);\n            const dIdx = parseInt(dot.dataset.d);\n            toggleDay(hIdx, dIdx, dot);\n            return;\n        }\n\n        const del = e.target.closest('.btn-del');\n        if (del) {\n            const idx = parseInt(del.dataset.idx);\n            deleteHabit(idx);\n            return;\n        }\n    });\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "habit-tracker",
      "title": "Habit Tracker",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">✅ Habit Tracker</h4>\n    <button class=\"btn-icon\" id=\"btn-add-habit\">+</button>\n  </div>\n  \n  <div class=\"habit-grid-header\">\n    <span class=\"label-habit\">Habit</span>\n    <div class=\"days-labels\">\n      <span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span>\n    </div>\n  </div>\n\n  <div id=\"habit-list\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--divider-color);\n    border-radius: 12px;\n    padding: 1.25rem;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n}\n.widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }\n.widget-title { margin: 0; font-size: 0.9rem; font-weight: 600; color: var(--text-accent); text-transform: uppercase; letter-spacing: 0.05em; }\n\n.btn-icon {\n    background: var(--interactive-accent);\n    color: white;\n    border: none;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    transition: filter 0.2s;\n}\n.btn-icon:hover { filter: brightness(1.1); }\n\n.btn-delete {\n    background: transparent;\n    color: var(--text-muted);\n    border: none;\n    cursor: pointer;\n    font-size: 1.2rem;\n    padding: 0 8px;\n    opacity: 0;\n    transition: opacity 0.2s, color 0.2s;\n}\n.habit-row:hover .btn-delete { opacity: 1; }\n.btn-delete:hover { color: var(--text-danger); }\n\n.habit-grid-header {\n    display: grid;\n    grid-template-columns: 1fr auto;\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    margin-bottom: 0.75rem;\n    padding-right: 32px;\n    text-transform: uppercase;\n}\n\n.days-labels {\n    display: grid;\n    grid-template-columns: repeat(7, 28px);\n    text-align: center;\n}\n\n.habit-row {\n    display: grid;\n    grid-template-columns: 1fr auto auto;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    gap: 8px;\n    padding: 4px;\n    border-radius: 8px;\n    transition: background 0.2s;\n}\n.habit-row:hover { background: var(--background-primary-alt); }\n\n.habit-name {\n    border: none;\n    background: transparent;\n    color: var(--text-normal);\n    font-size: 0.85rem;\n    outline: none;\n    padding: 4px;\n    border-radius: 4px;\n    width: 100%;\n}\n.habit-name:focus { background: var(--background-primary); box-shadow: 0 0 0 1px var(--divider-color); }\n\n.dots-container {\n    display: grid;\n    grid-template-columns: repeat(7, 28px);\n}\n\n.dot {\n    width: 18px;\n    height: 18px;\n    border-radius: 5px;\n    border: 2px solid var(--divider-color);\n    margin: auto;\n    cursor: pointer;\n    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n}\n\n.dot.active {\n    background: var(--interactive-accent);\n    border-color: var(--interactive-accent);\n    transform: scale(1.1);\n}",
      "js": "var habits = [{ name: 'Reading', done: [false, false, false, false, false, false, false] }, { name: 'Meditation', done: [false, false, false, false, false, false, false] }];\n\nfunction render() {\n    var container = api.root.getElementById('habit-list');\n    container.innerHTML = '';\n    habits.forEach(function(habit, hIdx) {\n        var row = document.createElement('div');\n        row.className = 'habit-row';\n        var input = document.createElement('input');\n        input.className = 'habit-name';\n        input.value = habit.name;\n        input.onchange = function(e) {\n            habits[hIdx].name = e.target.value;\n            api.saveState(habits);\n        };\n        var dots = document.createElement('div');\n        dots.className = 'dots-container';\n        habit.done.forEach(function(status, dIdx) {\n            var dot = document.createElement('div');\n            dot.className = 'dot' + (status ? ' active' : '');\n            dot.onclick = function() {\n                habits[hIdx].done[dIdx] = !habits[hIdx].done[dIdx];\n                api.saveState(habits);\n                render();\n            };\n            dots.appendChild(dot);\n        });\n        var btnDel = document.createElement('button');\n        btnDel.className = 'btn-delete';\n        btnDel.innerHTML = '×';\n        btnDel.onclick = function() {\n            habits.splice(hIdx, 1);\n            api.saveState(habits);\n            render();\n        };\n        row.appendChild(input);\n        row.appendChild(dots);\n        row.appendChild(btnDel);\n        container.appendChild(row);\n    });\n}\n\nfunction addHabit() {\n    habits.push({ name: 'New Habit', done: [false, false, false, false, false, false, false] });\n    render();\n    api.saveState(habits);\n}\n\nasync function init() {\n    var saved = await api.getState();\n    if (Array.isArray(saved)) {\n        habits = saved;\n    }\n    \n    api.root.getElementById('btn-add-habit').onclick = addHabit;\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "health-tracker-pro",
      "title": "Health Tracker Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">⚖️ Health Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-view-toggle\" class=\"btn-icon-small\" title=\"Toggle Graph/List\">📊</button>\n      <button id=\"btn-reset\" class=\"btn-icon-small\" title=\"Clear All Data\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"hero-stats\">\n    <div class=\"main-stat\">\n      <div id=\"avg-weight\" class=\"stat-value\">0.0</div>\n      <div class=\"stat-label\">Avg Weight (kg)</div>\n    </div>\n    <div class=\"stat-divider\"></div>\n    <div class=\"main-stat\">\n      <div id=\"weight-diff\" class=\"stat-value\">0.0</div>\n      <div class=\"stat-label\">30d Change</div>\n    </div>\n  </div>\n\n  <div class=\"input-card\">\n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Weight (kg)</label>\n        <span id=\"val-weight\" class=\"slider-val\">75.0kg</span>\n      </div>\n      <input type=\"range\" id=\"input-weight\" min=\"30\" max=\"150\" step=\"0.1\" value=\"75.0\" class=\"modern-slider\">\n    </div>\n    \n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Body Fat (%)</label>\n        <span id=\"val-fat\" class=\"slider-val\">20%</span>\n      </div>\n      <input type=\"range\" id=\"input-fat\" min=\"5\" max=\"50\" step=\"0.5\" value=\"20\" class=\"modern-slider fat-slider\">\n    </div>\n    \n    <button class=\"btn-log\" id=\"btn-log\">Log Progress ✨</button>\n  </div>\n\n  <div id=\"view-list\" class=\"view-container active\">\n    <div class=\"section-label\">Recent Logs (Drag to scroll, click to edit)</div>\n    <div class=\"history-list\" id=\"health-history\"></div>\n  </div>\n\n  <div id=\"view-graph\" class=\"view-container\">\n    <div class=\"section-label\">Weight Trends</div>\n    <div class=\"graph-wrapper\">\n      <svg id=\"health-graph\" viewBox=\"0 0 300 120\" preserveAspectRatio=\"none\"></svg>\n      <div class=\"graph-labels\">\n        <button id=\"btn-graph-range\" class=\"btn-range-toggle\">30 days</button>\n        <span>Today</span>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);\n    color: #ecfdf5;\n    border-radius: 28px;\n    padding: 1.5rem;\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(16, 185, 129, 0.2);\n    max-width: 360px;\n    margin: 0 auto;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.25rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 800;\n    color: #10b981;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n}\n\n.header-actions { display: flex; gap: 8px; }\n\n.btn-icon-small {\n    background: rgba(255, 255, 255, 0.05);\n    border: none;\n    color: #a7f3d0;\n    width: 32px;\n    height: 32px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n.btn-icon-small:hover { background: rgba(16, 185, 129, 0.2); color: white; }\n\n.hero-stats {\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 20px;\n    padding: 1rem;\n    margin-bottom: 1.25rem;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.stat-value {\n    font-size: 1.8rem;\n    font-weight: 800;\n    color: #10b981;\n    line-height: 1;\n    margin-bottom: 4px;\n}\n\n.stat-label {\n    font-size: 0.6rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: #6ee7b7;\n    opacity: 0.7;\n    letter-spacing: 0.5px;\n}\n\n.stat-divider {\n    width: 1px;\n    height: 30px;\n    background: rgba(255, 255, 255, 0.1);\n}\n\n.input-card {\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 20px;\n    padding: 1.25rem;\n    margin-bottom: 1.25rem;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.slider-group {\n    margin-bottom: 1.25rem;\n}\n\n.slider-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.slider-header label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: #a7f3d0;\n    text-transform: uppercase;\n}\n\n.slider-val {\n    font-size: 0.9rem;\n    font-weight: 800;\n    color: #10b981;\n}\n\n.modern-slider {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 6px;\n    background: #022c22;\n    border-radius: 10px;\n    outline: none;\n}\n\n.modern-slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 18px;\n    height: 18px;\n    background: #10b981;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);\n    transition: transform 0.2s;\n}\n\n.modern-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }\n\n.fat-slider::-webkit-slider-thumb { background: #34d399; box-shadow: 0 0 10px rgba(52, 211, 153, 0.5); }\n\n.btn-log {\n    width: 100%;\n    background: linear-gradient(135deg, #10b981, #059669);\n    color: white;\n    border: none;\n    padding: 12px;\n    border-radius: 12px;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n.btn-log:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }\n\n.view-container { display: none; }\n.view-container.active { display: block; }\n\n.section-label {\n    font-size: 0.65rem;\n    font-weight: 800;\n    text-transform: uppercase;\n    color: #6ee7b7;\n    opacity: 0.6;\n    margin-bottom: 10px;\n    letter-spacing: 1px;\n}\n\n.history-list {\n    display: flex;\n    gap: 8px;\n    overflow-x: auto;\n    padding-bottom: 8px;\n    scrollbar-width: none;\n    cursor: grab;\n    user-select: none;\n}\n.history-list:active { cursor: grabbing; }\n.history-list::-webkit-scrollbar { display: none; }\n\n.history-item {\n    background: rgba(255, 255, 255, 0.03);\n    padding: 10px;\n    border-radius: 14px;\n    min-width: 75px;\n    text-align: center;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    transition: transform 0.2s, background 0.2s;\n}\n.history-item:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); }\n\n.h-val { display: block; font-weight: 800; font-size: 1rem; color: #10b981; pointer-events: none; }\n.h-sub { display: block; font-size: 0.6rem; color: #6ee7b7; opacity: 0.7; margin-bottom: 4px; pointer-events: none; }\n.h-date { font-size: 0.55rem; font-weight: 700; color: #34d399; text-transform: uppercase; pointer-events: none; }\n\n.graph-wrapper {\n    background: rgba(0,0,0,0.2);\n    border-radius: 16px;\n    padding: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n#health-graph {\n    width: 100%;\n    height: 100px;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n}\n\n.graph-labels {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 8px;\n    font-size: 0.6rem;\n    color: #6ee7b7;\n    opacity: 0.6;\n    font-weight: 700;\n    text-transform: uppercase;\n}\n\n.btn-range-toggle {\n    background: rgba(16, 185, 129, 0.1);\n    border: 1px solid rgba(16, 185, 129, 0.2);\n    color: #10b981;\n    padding: 2px 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.6rem;\n    font-weight: 800;\n    text-transform: uppercase;\n    transition: all 0.2s;\n}\n.btn-range-toggle:hover { background: rgba(16, 185, 129, 0.2); color: white; }\n\n.toast-msg {\n    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);\n    background: #10b981; color: white; padding: 8px 16px; border-radius: 100px;\n    font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;\n    pointer-events: none; z-index: 100;\n}",
      "js": "const { root, saveState, getState } = api;\n\nconst RANGES = [\n    { label: '7 days', val: 7 },\n    { label: '30 days', val: 30 },\n    { label: '3 months', val: 90 },\n    { label: '6 months', val: 180 },\n    { label: '1 year', val: 365 }\n];\n\nlet state = {\n    history: [],\n    view: 'list',\n    rangeIdx: 1,\n    editingDate: null\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const list = root.querySelector('#health-history');\n    if (!list) return;\n    \n    // Update Stats\n    let totalW = 0;\n    state.history.forEach(item => totalW += parseFloat(item.weight));\n    const avgW = state.history.length > 0 ? (totalW / state.history.length).toFixed(1) : '0.0';\n    \n    let diff = '0.0';\n    if (state.history.length >= 30) {\n        const current = parseFloat(state.history[0].weight);\n        const old = parseFloat(state.history[29].weight);\n        const delta = (current - old).toFixed(1);\n        diff = (delta > 0 ? '+' : '') + delta;\n    }\n    \n    root.querySelector('#avg-weight').innerText = avgW;\n    root.querySelector('#weight-diff').innerText = diff;\n\n    // Render List\n    list.innerHTML = '';\n    state.history.forEach((item, idx) => {\n        const el = document.createElement('div');\n        el.className = 'history-item';\n        el.innerHTML = `\n            <span class=\"h-val\">${item.weight}kg</span>\n            <span class=\"h-sub\">${item.fat}% fat</span>\n            <span class=\"h-date\">${item.date}</span>\n        `;\n        el.onclick = () => editEntry(idx);\n        list.appendChild(el);\n    });\n\n    renderGraph();\n\n    root.querySelector('#view-list').className = 'view-container' + (state.view === 'list' ? ' active' : '');\n    root.querySelector('#view-graph').className = 'view-container' + (state.view === 'graph' ? ' active' : '');\n    root.querySelector('#btn-view-toggle').innerText = state.view === 'list' ? '📊' : '📜';\n    root.querySelector('#btn-graph-range').innerText = RANGES[state.rangeIdx].label;\n    \n    const logBtn = root.querySelector('#btn-log');\n    logBtn.innerText = state.editingDate ? `Update ${state.editingDate} ✨` : 'Log Progress ✨';\n}\n\nfunction editEntry(idx) {\n    const item = state.history[idx];\n    state.editingDate = item.date;\n    \n    const wSlider = root.querySelector('#input-weight');\n    const fSlider = root.querySelector('#input-fat');\n    \n    wSlider.value = item.weight;\n    fSlider.value = item.fat;\n    \n    root.querySelector('#val-weight').innerText = item.weight + 'kg';\n    root.querySelector('#val-fat').innerText = item.fat + '%';\n    \n    showToast(`Editing log from ${item.date} ✏️`);\n    render();\n}\n\nfunction renderGraph() {\n    const svg = root.querySelector('#health-graph');\n    if (!svg) return;\n    if (state.history.length < 2) {\n        svg.innerHTML = '<text x=\"50%\" y=\"50%\" text-anchor=\"middle\" fill=\"#6ee7b7\" font-size=\"10\">Need more data...</text>';\n        return;\n    }\n    const range = RANGES[state.rangeIdx].val;\n    const data = state.history.slice(0, range).reverse();\n    const weights = data.map(d => parseFloat(d.weight));\n    const minW = Math.min(...weights) - 2;\n    const maxW = Math.max(...weights) + 2;\n    const width = 300, height = 120, padding = 10;\n    let points = '';\n    data.forEach((item, i) => {\n        const x = (i / (data.length - 1)) * (width - padding * 2) + padding;\n        const y = height - (((parseFloat(item.weight) - minW) / (maxW - minW)) * (height - padding * 2)) - padding;\n        points += `${x},${y} `;\n    });\n    svg.innerHTML = `\n        <defs>\n            <linearGradient id=\"grad-health\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                <stop offset=\"0%\" style=\"stop-color:#10b981;stop-opacity:0.3\" />\n                <stop offset=\"100%\" style=\"stop-color:#10b981;stop-opacity:0\" />\n            </linearGradient>\n        </defs>\n        <polyline points=\"${points}\" fill=\"none\" stroke=\"#10b981\" stroke-width=\"${range > 100 ? 1 : 2}\" />\n        <path d=\"M ${padding},${height} L ${points} L ${width-padding},${height} Z\" fill=\"url(#grad-health)\" />\n    `;\n}\n\nfunction logProgress() {\n    const weight = root.querySelector('#input-weight').value;\n    const fat = root.querySelector('#input-fat').value;\n    const date = state.editingDate || new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n\n    const existingIdx = state.history.findIndex(h => h.date === date);\n    if (existingIdx !== -1) {\n        state.history[existingIdx] = { weight, fat, date };\n    } else {\n        state.history.unshift({ weight, fat, date });\n    }\n\n    state.editingDate = null;\n    saveState(state);\n    render();\n    showToast('Progress saved! 💪');\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n\n    const wSlider = root.querySelector('#input-weight');\n    const fSlider = root.querySelector('#input-fat');\n    wSlider.oninput = (e) => root.querySelector('#val-weight').innerText = e.target.value + 'kg';\n    fSlider.oninput = (e) => root.querySelector('#val-fat').innerText = e.target.value + '%';\n\n    root.querySelector('#btn-log').onclick = logProgress;\n    root.querySelector('#btn-view-toggle').onclick = () => {\n        state.view = state.view === 'list' ? 'graph' : 'list';\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-graph-range').onclick = () => {\n        state.rangeIdx = (state.rangeIdx + 1) % RANGES.length;\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-reset').onclick = () => {\n        if (confirm('Clear all data?')) {\n            state.history = [];\n            render();\n            saveState(state);\n            showToast('Data cleared 🗑️');\n        }\n    };\n\n    // Drag to scroll\n    const list = root.querySelector('#health-history');\n    let isDown = false, startX, scrollLeft;\n    list.onmousedown = (e) => {\n        isDown = true;\n        startX = e.pageX - list.offsetLeft;\n        scrollLeft = list.scrollLeft;\n    };\n    list.onmouseleave = () => isDown = false;\n    list.onmouseup = () => isDown = false;\n    list.onmousemove = (e) => {\n        if (!isDown) return;\n        e.preventDefault();\n        const x = e.pageX - list.offsetLeft;\n        const walk = (x - startX) * 2;\n        list.scrollLeft = scrollLeft - walk;\n    };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "hiit-pulse-pro",
      "title": "HIIT Pulse Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card phase-ready\" id=\"main-card\">\n  <div class=\"header\">\n    <div class=\"status-pill\" id=\"status-label\">READY</div>\n    <button id=\"btn-settings\" class=\"icon-btn\">⚙️</button>\n  </div>\n\n  <div id=\"settings-panel\" class=\"settings-overlay hidden\">\n    <div class=\"settings-content\">\n      <h5>HIIT Config</h5>\n      <div class=\"setting-row\">\n        <label>🔥 Work (s)</label>\n        <input type=\"number\" id=\"inp-work\" value=\"30\">\n      </div>\n      <div class=\"setting-row\">\n        <label>❄️ Rest (s)</label>\n        <input type=\"number\" id=\"inp-rest\" value=\"10\">\n      </div>\n      <div class=\"setting-row\">\n        <label>🔁 Sets</label>\n        <input type=\"number\" id=\"inp-sets\" value=\"8\">\n      </div>\n      <div class=\"setting-row\">\n        <label>🔊 Sound</label>\n        <div class=\"toggle-container\">\n             <input type=\"checkbox\" id=\"inp-sound\" checked>\n        </div>\n      </div>\n      <button id=\"btn-save\" class=\"btn-primary\">Save & Reset</button>\n    </div>\n  </div>\n\n  <div class=\"timer-visual\">\n    <svg class=\"progress-ring\" width=\"200\" height=\"200\">\n      <circle class=\"bg-ring\" stroke=\"rgba(255,255,255,0.1)\" stroke-width=\"8\" fill=\"transparent\" r=\"90\" cx=\"100\" cy=\"100\"/>\n      <circle id=\"prog-circle\" class=\"fg-ring\" stroke=\"white\" stroke-width=\"8\" fill=\"transparent\" r=\"90\" cx=\"100\" cy=\"100\"/>\n    </svg>\n    <div class=\"timer-content\">\n      <div class=\"big-time\" id=\"time-display\">00:00</div>\n      <div class=\"set-info\" id=\"set-display\">Set 1 / 8</div>\n    </div>\n  </div>\n\n  <div class=\"controls\">\n    <button id=\"btn-toggle\" class=\"btn-big\">START</button>\n    <button id=\"btn-reset\" class=\"btn-icon-large\">↺</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: #1f2937; color: white; border-radius: 24px; padding: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; transition: background 0.5s; border: 1px solid rgba(255,255,255,0.1); } .phase-ready { background: #374151; } .phase-prep { background: #eab308; } .phase-work { background: #ef4444; } .phase-rest { background: #3b82f6; } .phase-done { background: #10b981; } .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; } .status-pill { font-size: 0.8rem; font-weight: 800; background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 100px; text-transform: uppercase; letter-spacing: 1px; } .icon-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: white; opacity: 0.7; transition: opacity 0.2s; } .icon-btn:hover { opacity: 1; } .timer-visual { position: relative; width: 200px; height: 200px; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; } .progress-ring { transform: rotate(-90deg); } .fg-ring { transition: stroke-dashoffset 1s linear; stroke-linecap: round; } .timer-content { position: absolute; text-align: center; } .big-time { font-size: 3.5rem; font-weight: 900; line-height: 1; font-family: var(--font-monospace); text-shadow: 0 4px 10px rgba(0,0,0,0.2); } .set-info { font-size: 0.9rem; font-weight: 600; opacity: 0.8; margin-top: 4px; } .controls { display: flex; justify-content: center; gap: 12px; } .btn-big { background: white; color: #1f2937; border: none; padding: 14px 40px; border-radius: 16px; font-weight: 900; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.2); width: 140px; transition: transform 0.1s; } .btn-big:active { transform: translateY(4px); box-shadow: none; } .btn-icon-large { background: rgba(255,255,255,0.1); border: none; width: 48px; height: 48px; border-radius: 16px; font-size: 1.5rem; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; } .btn-icon-large:hover { background: rgba(255,255,255,0.2); } .settings-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 10; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; } .settings-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .settings-content { width: 85%; background: #1f2937; padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255,255,255,0.2); text-align: center; } .settings-content h5 { margin: 0 0 1rem 0; color: #9ca3af; text-transform: uppercase; } .setting-row { display: flex; justify-content: space-between; margin-bottom: 12px; align-items: center; font-weight: bold; } .setting-row input[type=\"number\"] { width: 70px; background: #374151; border: none; color: white; padding: 6px; border-radius: 6px; text-align: center; font-weight: 700; font-size: 1rem; } .setting-row input[type=\"checkbox\"] { width: 20px; height: 20px; accent-color: #ef4444; } .hidden { display: none; } .btn-primary { background: #ef4444; color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar config = { work: 30, rest: 10, sets: 8, sound: true };\nvar state = { phase: 'ready', timeLeft: 0, currentSet: 1, isRunning: false };\nvar timerInterval = null;\nvar circumference = 2 * Math.PI * 90;\nvar audioCtx = null;\n\nfunction beep(type) {\n    if (!config.sound) return;\n    try {\n        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n        if (audioCtx.state === 'suspended') audioCtx.resume();\n        \n        var osc = audioCtx.createOscillator();\n        var gain = audioCtx.createGain();\n        osc.connect(gain);\n        gain.connect(audioCtx.destination);\n        \n        // High pitch (880Hz) for start/stop, Low (440Hz) for countdown\n        osc.frequency.value = type === 'high' ? 880 : 440;\n        gain.gain.value = 0.1;\n        osc.start();\n        osc.stop(audioCtx.currentTime + (type === 'high' ? 0.4 : 0.2));\n    } catch(e) {}\n}\n\nfunction formatTime(s) {\n    var m = Math.floor(s/60);\n    var sec = s%60;\n    return (m<10?'0'+m:m) + ':' + (sec<10?'0'+sec:sec);\n}\n\nfunction render() {\n    var card = root.getElementById('main-card');\n    card.className = 'widget-card phase-' + state.phase;\n    \n    root.getElementById('status-label').innerText = state.phase.toUpperCase();\n    root.getElementById('time-display').innerText = formatTime(state.timeLeft);\n    \n    var setText = '';\n    if(state.phase === 'done') setText = 'Complete!';\n    else if(state.phase === 'ready') setText = config.sets + ' Sets';\n    else setText = 'Set ' + state.currentSet + ' / ' + config.sets;\n    \n    root.getElementById('set-display').innerText = setText;\n\n    var btn = root.getElementById('btn-toggle');\n    if(state.phase === 'done') btn.innerText = 'RESTART';\n    else btn.innerText = state.isRunning ? 'PAUSE' : 'START';\n\n    var total = 1;\n    if (state.phase === 'work') total = config.work;\n    else if (state.phase === 'rest') total = config.rest;\n    else if (state.phase === 'prep') total = 3;\n\n    var circle = root.getElementById('prog-circle');\n    circle.style.strokeDasharray = circumference;\n    \n    if(state.phase === 'ready' || state.phase === 'done') {\n        circle.style.strokeDashoffset = 0;\n    } else {\n        var pct = state.timeLeft / total;\n        circle.style.strokeDashoffset = circumference - (pct * circumference);\n    }\n}\n\nfunction tick() {\n    if (state.timeLeft > 0) {\n        state.timeLeft--;\n        if (state.timeLeft <= 3 && state.timeLeft > 0) beep('low');\n        if (state.timeLeft === 0) beep('high');\n        render();\n    } else {\n        nextPhase();\n    }\n}\n\nfunction nextPhase() {\n    if (state.phase === 'prep') {\n        state.phase = 'work';\n        state.timeLeft = config.work;\n    } else if (state.phase === 'work') {\n        if (state.currentSet >= config.sets) {\n            state.phase = 'done';\n            state.isRunning = false;\n            clearInterval(timerInterval);\n        } else {\n            state.phase = 'rest';\n            state.timeLeft = config.rest;\n        }\n    } else if (state.phase === 'rest') {\n        state.phase = 'work';\n        state.currentSet++;\n        state.timeLeft = config.work;\n    }\n    render();\n}\n\nfunction toggleTimer() {\n    if (state.phase === 'done') { reset(); return; }\n    \n    if (state.isRunning) {\n        clearInterval(timerInterval);\n        state.isRunning = false;\n    } else {\n        if (state.phase === 'ready') {\n            state.phase = 'prep';\n            state.timeLeft = 3;\n            beep('low');\n        }\n        timerInterval = setInterval(tick, 1000);\n        state.isRunning = true;\n    }\n    render();\n}\n\nfunction reset() {\n    clearInterval(timerInterval);\n    state.phase = 'ready';\n    state.currentSet = 1;\n    state.timeLeft = config.work;\n    state.isRunning = false;\n    render();\n}\n\nfunction loadUI() {\n    root.getElementById('inp-work').value = config.work;\n    root.getElementById('inp-rest').value = config.rest;\n    root.getElementById('inp-sets').value = config.sets;\n    root.getElementById('inp-sound').checked = config.sound;\n}\n\nasync function init() {\n    var saved = await getState();\n    if(saved) Object.assign(config, saved);\n    \n    state.timeLeft = config.work;\n    \n    root.getElementById('btn-toggle').onclick = toggleTimer;\n    root.getElementById('btn-reset').onclick = reset;\n    \n    root.getElementById('btn-settings').onclick = function() {\n        loadUI();\n        root.getElementById('settings-panel').classList.remove('hidden');\n    };\n    \n    root.getElementById('btn-save').onclick = function() {\n        config.work = parseInt(root.getElementById('inp-work').value);\n        config.rest = parseInt(root.getElementById('inp-rest').value);\n        config.sets = parseInt(root.getElementById('inp-sets').value);\n        config.sound = root.getElementById('inp-sound').checked;\n        api.saveState(config);\n        root.getElementById('settings-panel').classList.add('hidden');\n        reset();\n    };\n    \n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "hydro-pulse",
      "title": "Hydro Pulse",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <span class=\"icon\">💧</span>\n      <h4 class=\"widget-title\">Hydro Pulse</h4>\n    </div>\n    <button id=\"btn-settings\" class=\"icon-btn\" title=\"Edit Goal\">⚙️</button>\n  </div>\n\n  \n  <div id=\"settings-panel\" class=\"settings-overlay hidden\">\n    <div class=\"settings-content\">\n      <h5>Daily Goal (ml)</h5>\n      <input type=\"number\" id=\"inp-goal\" step=\"100\">\n      <button id=\"btn-save-goal\" class=\"btn-primary\">Save Goal</button>\n    </div>\n  </div>\n\n  \n  <div class=\"hydro-visual\">\n    <div class=\"circle-container\">\n      \n      <div class=\"wave-wrapper\" id=\"wave-wrapper\">\n        <div class=\"wave wave-one\"></div>\n        <div class=\"wave wave-two\"></div>\n      </div>\n      <div class=\"info-overlay\">\n        <span id=\"percent-display\" class=\"big-percent\">0%</span>\n        <span id=\"amount-display\" class=\"small-amount\">0 / 2500 ml</span>\n      </div>\n    </div>\n  </div>\n\n  \n  <div class=\"controls-grid\">\n    <button class=\"add-btn\" id=\"btn-250\">+250ml</button>\n    <button class=\"add-btn\" id=\"btn-500\">+500ml</button>\n    <button class=\"action-btn\" id=\"btn-undo\" title=\"Undo last\">↩️</button>\n    <button class=\"action-btn\" id=\"btn-reset\" title=\"Reset day\">🗑️</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 20px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 350px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; } .header-left { display: flex; align-items: center; gap: 8px; } .widget-title { margin: 0; font-size: 1rem; font-weight: 800; color: var(--text-normal); text-transform: uppercase; letter-spacing: 1px; } .icon-btn { background: transparent; border: 1px solid var(--background-modifier-border); border-radius: 8px; cursor: pointer; color: var(--text-muted); padding: 4px 8px; transition: all 0.2s; } .icon-btn:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .hydro-visual { display: flex; justify-content: center; margin-bottom: 2rem; } .circle-container { width: 160px; height: 160px; border-radius: 50%; border: 4px solid var(--background-modifier-border); position: relative; overflow: hidden; background: var(--background-primary); box-shadow: inset 0 0 20px rgba(0,0,0,0.05); } .wave-wrapper { position: absolute; width: 200%; height: 200%; top: 100%; left: -50%; /* No transition by default to fix reload glitch */ } .wave-wrapper.animate-height { transition: top 0.8s cubic-bezier(0.4, 0, 0.2, 1); } .wave { position: absolute; width: 100%; height: 100%; border-radius: 40%; animation: rotate 10s infinite linear; } .wave-one { background: rgba(14, 165, 233, 0.4); z-index: 1; animation-duration: 8s; } .wave-two { background: rgba(14, 165, 233, 0.8); z-index: 2; margin-top: 5px; animation-duration: 12s; } @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } .info-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; text-shadow: 0 2px 10px rgba(0,0,0,0.1); } .big-percent { font-size: 2rem; font-weight: 900; color: var(--text-normal); mix-blend-mode: difference; } .small-amount { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); margin-top: 4px; } .controls-grid { display: grid; grid-template-columns: 2fr 2fr 1fr 1fr; gap: 8px; } .add-btn { background: #0ea5e9; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: transform 0.1s, filter 0.2s; } .add-btn:hover { filter: brightness(1.1); transform: translateY(-2px); } .add-btn:active { transform: translateY(0); } .action-btn { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-muted); border-radius: 12px; cursor: pointer; font-size: 1rem; transition: all 0.2s; } .action-btn:hover { background: var(--background-modifier-error); color: white; border-color: transparent; } .settings-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 20; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; } .settings-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .settings-content { background: var(--background-primary); padding: 1.5rem; border-radius: 16px; width: 85%; text-align: center; } .settings-content h5 { margin: 0 0 1rem 0; color: var(--text-normal); } .settings-content input { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--background-modifier-border); background: var(--background-secondary); color: var(--text-normal); text-align: center; font-size: 1.2rem; margin-bottom: 1rem; } .btn-primary { width: 100%; background: var(--interactive-accent); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar state = {\n  current: 0,\n  goal: 2500,\n  history: []\n};\n\nfunction render() {\n  var pct = Math.min((state.current / state.goal) * 100, 100);\n  var topVal = 100 - (pct * 1.1);\n  \n  var wave = root.getElementById('wave-wrapper');\n  \n  // Just set the position. \n  // The animation depends on whether the class 'animate-height' is present.\n  wave.style.top = topVal + '%';\n  \n  root.getElementById('percent-display').innerText = Math.round(pct) + '%';\n  root.getElementById('amount-display').innerText = state.current + ' / ' + state.goal + ' ml';\n  \n  var wave2 = root.querySelector('.wave-two');\n  if (pct >= 100) {\n      if(wave2) wave2.style.background = '#10b981';\n  } else {\n      if(wave2) wave2.style.background = 'rgba(14, 165, 233, 0.8)';\n  }\n}\n\nfunction addWater(amount) {\n  state.history.push(state.current);\n  state.current += amount;\n  render();\n  saveState(state);\n}\n\nfunction undo() {\n  if (state.history.length > 0) {\n      state.current = state.history.pop();\n      render();\n      saveState(state);\n  }\n}\n\nfunction reset() {\n  if(confirm('Reset water tracker?')) {\n      state.history = [];\n      state.current = 0;\n      render();\n      saveState(state);\n  }\n}\n\nfunction toggleSettings(show) {\n  var el = root.getElementById('settings-panel');\n  if(show) {\n      el.classList.remove('hidden');\n      root.getElementById('inp-goal').value = state.goal;\n  } else {\n      el.classList.add('hidden');\n  }\n}\n\nfunction saveGoal() {\n  var val = parseInt(root.getElementById('inp-goal').value);\n  if(val && val > 0) {\n      state.goal = val;\n      toggleSettings(false);\n      render();\n      saveState(state);\n  }\n}\n\nasync function init() {\n  var saved = await getState();\n  if (saved) {\n      if(typeof saved === 'number') state.current = saved;\n      else Object.assign(state, saved);\n  }\n  \n  // 1. Initial Render (Instant, no animation class yet)\n  render();\n  \n  // 2. Force Reflow (The trick to fix the reload glitch)\n  var wave = root.getElementById('wave-wrapper');\n  void wave.offsetWidth; \n  \n  // 3. Enable Animation for future clicks\n  wave.classList.add('animate-height');\n  \n  // Listeners\n  root.getElementById('btn-250').onclick = function() { addWater(250); };\n  root.getElementById('btn-500').onclick = function() { addWater(500); };\n  root.getElementById('btn-undo').onclick = undo;\n  root.getElementById('btn-reset').onclick = reset;\n  \n  root.getElementById('btn-settings').onclick = function() { toggleSettings(true); };\n  root.getElementById('btn-save-goal').onclick = saveGoal;\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "json-formatter",
      "title": "JSON Formatter",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"json-widget\" style=\"position: relative; resize: both; overflow: auto;\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">📦 JSON Studio Pro</h4>\n      <div class=\"header-actions\">\n        <button class=\"btn-icon\" id=\"btn-paste\" title=\"Paste from Clipboard\">📥</button>\n        <button class=\"btn-icon\" id=\"btn-clear\" title=\"Clear All\">🗑️</button>\n      </div>\n    </div>\n    <div class=\"status-bar\" id=\"status-bar\">\n      <span class=\"status-dot\" id=\"status-dot\"></span>\n      <span class=\"status-text\" id=\"status-text\">Ready</span>\n    </div>\n  </div>\n\n  <div class=\"editor-container\">\n    <textarea id=\"json-input\" placeholder=\"Paste your JSON here...\" spellcheck=\"false\"></textarea>\n    <div class=\"line-numbers\" id=\"line-numbers\"></div>\n  </div>\n\n  <div class=\"actions-grid\">\n    <button class=\"btn-primary\" id=\"btn-format\">BEAUTIFY</button>\n    <button class=\"btn-secondary\" id=\"btn-minify\">MINIFY</button>\n    <button class=\"btn-secondary\" id=\"btn-copy\">COPY</button>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Copied to clipboard! ✨</div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.json-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    position: relative;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.header-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n    font-size: 0.9rem;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); }\n\n.status-bar {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    background: rgba(0,0,0,0.1);\n    padding: 6px 12px;\n    border-radius: 10px;\n}\n\n.status-dot {\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    background: var(--text-muted);\n    transition: background 0.3s;\n}\n.status-dot.valid { background: #10b981; box-shadow: 0 0 8px rgba(16, 185, 129, 0.4); }\n.status-dot.invalid { background: #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.4); }\n\n.status-text {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.editor-container {\n    position: relative;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    overflow: hidden;\n    display: flex;\n}\n\ntextarea {\n    width: 100%;\n    height: 250px;\n    background: transparent;\n    border: none;\n    color: var(--text-normal);\n    padding: 16px;\n    font-size: 0.85rem;\n    font-family: var(--font-monospace);\n    outline: none;\n    resize: vertical;\n    line-height: 1.5;\n    z-index: 2;\n}\n\n.actions-grid {\n    display: grid;\n    grid-template-columns: 2fr 1fr 1fr;\n    gap: 10px;\n}\n\n.actions-grid button {\n    border: none;\n    padding: 12px;\n    border-radius: 12px;\n    font-size: 0.75rem;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n\n.btn-primary {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    box-shadow: 0 4px 0 rgba(0,0,0,0.1);\n}\n.btn-primary:hover { filter: brightness(1.1); transform: translateY(-1px); }\n.btn-primary:active { transform: translateY(1px); box-shadow: none; }\n\n.btn-secondary {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border) !important;\n    color: var(--text-normal);\n}\n.btn-secondary:hover { background: var(--background-modifier-hover); }\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n    box-shadow: var(--shadow-l);\n}\n.toast.show { transform: translateX(-50%) translateY(0); }",
      "js": "const { root, saveState, getState } = api;\n\nfunction updateStatus(isValid, message = '') {\n    const dot = root.getElementById('status-dot');\n    const text = root.getElementById('status-text');\n    \n    if (isValid) {\n        dot.className = 'status-dot valid';\n        text.innerText = 'Valid JSON';\n        text.style.color = 'var(--text-normal)';\n    } else {\n        dot.className = 'status-dot invalid';\n        text.innerText = message || 'Invalid JSON';\n        text.style.color = '#ef4444';\n    }\n}\n\nfunction formatJSON() {\n    const input = root.getElementById('json-input');\n    const val = input.value.trim();\n    if (!val) return;\n\n    try {\n        const obj = JSON.parse(val);\n        input.value = JSON.stringify(obj, null, 2);\n        updateStatus(true);\n        save();\n    } catch (e) {\n        updateStatus(false, e.message);\n    }\n}\n\nfunction minifyJSON() {\n    const input = root.getElementById('json-input');\n    const val = input.value.trim();\n    if (!val) return;\n\n    try {\n        const obj = JSON.parse(val);\n        input.value = JSON.stringify(obj);\n        updateStatus(true);\n        save();\n    } catch (e) {\n        updateStatus(false, e.message);\n    }\n}\n\nasync function pasteFromClipboard() {\n    try {\n        const text = await navigator.clipboard.readText();\n        if (text) {\n            root.getElementById('json-input').value = text;\n            validate();\n        }\n    } catch (err) {\n        alert('Clipboard access denied. Please paste manually.');\n    }\n}\n\nfunction copyToClipboard() {\n    const input = root.getElementById('json-input');\n    if (!input.value) return;\n\n    navigator.clipboard.writeText(input.value).then(() => {\n        showToast('Copied to clipboard! ✨');\n    });\n}\n\nfunction validate() {\n    const input = root.getElementById('json-input');\n    const val = input.value.trim();\n    if (!val) {\n        updateStatus(false, 'Ready');\n        root.getElementById('status-dot').className = 'status-dot';\n        return;\n    }\n\n    try {\n        JSON.parse(val);\n        updateStatus(true);\n    } catch (e) {\n        updateStatus(false, 'Invalid');\n    }\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(root.getElementById('json-input').value);\n}\n\nasync function init() {\n    const saved = await getState();\n    const input = root.getElementById('json-input');\n    if (saved) input.value = saved;\n\n    root.getElementById('btn-format').onclick = formatJSON;\n    root.getElementById('btn-minify').onclick = minifyJSON;\n    root.getElementById('btn-copy').onclick = copyToClipboard;\n    root.getElementById('btn-paste').onclick = pasteFromClipboard;\n    root.getElementById('btn-clear').onclick = () => {\n        input.value = '';\n        validate();\n        save();\n    };\n\n    input.oninput = () => {\n        validate();\n    };\n\n    input.onblur = () => save();\n\n    validate();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "kanban-pro2",
      "title": "Kanban Pro2",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"kanban-wrapper\" id=\"kanban-root\" style=\"height: 100%; width: 100%; resize: horizontal; overflow: auto; min-width: 280px;\">\n  <div class=\"kanban-header-main\">\n    <div class=\"kanban-title-group\">\n      <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"></line><line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"21\"></line></svg>\n      <span>KANBAN PROv2</span>\n      <div class=\"kanban-actions-menu\">\n         <button class=\"kanban-icon-btn\" id=\"kanban-settings-btn\" title=\"Settings\">\n           <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg>\n         </button>\n         <div class=\"kanban-dropdown\" id=\"kanban-dropdown\">\n            <div class=\"kanban-dropdown-item\" id=\"toggle-vertical\">Toggle Vertical Mode</div>\n            <div class=\"kanban-dropdown-item\" id=\"toggle-sync\">2-Way Sync: <span id=\"sync-status\">ON</span></div>\n            <div class=\"kanban-dropdown-divider\"></div>\n            <div class=\"kanban-dropdown-item\" id=\"sync-vault\">Import from Vault (Smart Scan)</div>\n         </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"kanban-board-container\">\n    <div class=\"kanban-board\">\n      <div class=\"kanban-column\" data-state=\"todo\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">To Do</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"todo\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n      <div class=\"kanban-column\" data-state=\"in-progress\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">In Progress</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"in-progress\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n      <div class=\"kanban-column\" data-state=\"done\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">Done</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"done\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n    </div>\n  </div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\"></div>\n</div>",
      "css": ":host {\n    --kanban-column-bg: var(--background-secondary);\n    --kanban-card-bg: var(--background-primary);\n    --kanban-accent: var(--interactive-accent);\n    --kanban-border: var(--background-modifier-border);\n}\n\n.kanban-wrapper {\n    width: 100%;\n    padding: 10px;\n    font-family: var(--font-interface);\n    position: relative;\n    box-sizing: border-box;\n}\n\n.kanban-header-main {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n    padding-bottom: 8px;\n    border-bottom: 1px solid var(--kanban-border);\n}\n\n.kanban-title-group {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: var(--text-muted);\n    letter-spacing: 1px;\n    width: 100%;\n}\n\n.kanban-actions-menu {\n    position: relative;\n    margin-left: 4px;\n}\n\n.kanban-icon-btn {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    cursor: pointer;\n    padding: 2px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    transition: all 0.2s;\n    opacity: 0.6;\n}\n\n.kanban-icon-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    opacity: 1;\n}\n\n.kanban-dropdown {\n    position: absolute;\n    top: 100%;\n    left: 0;\n    background: var(--background-primary);\n    border: 1px solid var(--kanban-border);\n    border-radius: 6px;\n    box-shadow: var(--shadow-l);\n    display: none;\n    z-index: 1000;\n    min-width: 200px;\n    padding: 4px;\n    margin-top: 4px;\n}\n\n.kanban-dropdown.is-open {\n    display: block;\n}\n\n.kanban-dropdown-item {\n    padding: 8px 12px;\n    font-size: 0.8rem;\n    cursor: pointer;\n    border-radius: 4px;\n    color: var(--text-normal);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.kanban-dropdown-item:hover {\n    background: var(--background-modifier-hover);\n    color: var(--kanban-accent);\n}\n\n.kanban-dropdown-divider {\n    height: 1px;\n    background: var(--kanban-border);\n    margin: 4px 0;\n}\n\n#sync-status {\n    font-weight: bold;\n    font-size: 0.7rem;\n    padding: 2px 6px;\n    border-radius: 4px;\n}\n\n#sync-status.on { color: var(--text-success); background: rgba(0, 255, 0, 0.1); }\n#sync-status.off { color: var(--text-error); background: rgba(255, 0, 0, 0.1); }\n\n.kanban-board-container {\n    width: 100%;\n}\n\n.kanban-board {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 8px;\n    align-items: flex-start;\n    width: 100%;\n}\n\n.kanban-board.is-vertical {\n    grid-template-columns: 1fr;\n}\n\n.kanban-column {\n    background: var(--kanban-column-bg);\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    border: 1px solid var(--kanban-border);\n    min-width: 0;\n}\n\n.kanban-column-header {\n    padding: 8px 12px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: 600;\n}\n\n.kanban-column-title {\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.kanban-column-count {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    background: var(--kanban-card-bg);\n    padding: 1px 6px;\n    border-radius: 10px;\n    border: 1px solid var(--kanban-border);\n}\n\n.kanban-column-items {\n    padding: 6px;\n    min-height: 80px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.kanban-card {\n    background: var(--kanban-card-bg);\n    border: 1px solid var(--kanban-border);\n    border-radius: 6px;\n    padding: 8px;\n    cursor: grab;\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    transition: all 0.15s ease;\n    position: relative;\n    word-break: break-word;\n}\n\n.kanban-card:hover {\n    border-color: var(--kanban-accent);\n    box-shadow: var(--shadow-m);\n}\n\n.kanban-card.kanban-card-dragging {\n    opacity: 0.4;\n    cursor: grabbing;\n    transform: scale(0.95);\n}\n\n.kanban-card.kanban-card-selected {\n    border-color: var(--kanban-accent);\n    background: var(--background-modifier-hover);\n    box-shadow: 0 0 0 2px var(--kanban-accent);\n}\n\n.kanban-card.kanban-card-done {\n    opacity: 0.6;\n}\n\n.kanban-card.kanban-card-done .kanban-card-text {\n    text-decoration: line-through;\n}\n\n.kanban-add-btn {\n    padding: 6px;\n    text-align: center;\n    color: var(--text-muted);\n    cursor: pointer;\n    font-size: 1.2rem;\n    font-weight: bold;\n    border-top: 1px solid var(--kanban-border);\n    transition: all 0.2s;\n    line-height: 1;\n}\n\n.kanban-add-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--kanban-accent);\n}\n\n.kanban-drag-over {\n    background: var(--background-modifier-hover);\n    border-radius: 0 0 8px 8px;\n}\n\n.kanban-drop-indicator {\n    height: 3px;\n    background: var(--kanban-accent);\n    margin: 2px 0;\n    border-radius: 2px;\n}\n\n.kanban-card-delete-zone {\n    border: 2px dashed var(--text-error) !important;\n    background: rgba(255, 0, 0, 0.1) !important;\n    transform: scale(0.9) rotate(2deg) !important;\n}\n\n.kanban-edit-input {\n    width: 100%;\n    background: var(--background-primary);\n    border: 1px solid var(--kanban-accent);\n    color: var(--text-normal);\n    padding: 6px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    font-family: inherit;\n    outline: none;\n    min-height: 50px;\n}\n\n.internal-link {\n    color: var(--link-color);\n    cursor: pointer;\n    text-decoration: none;\n    font-weight: 500;\n}\n.internal-link:hover { text-decoration: underline; }\n\n.tag {\n    background-color: var(--tag-background);\n    border: var(--tag-border-width) solid var(--tag-border-color);\n    border-radius: var(--tag-radius);\n    color: var(--tag-color);\n    font-size: var(--tag-size);\n    font-weight: var(--tag-weight);\n    padding: 0 4px;\n    text-decoration: none;\n    cursor: pointer;\n}\n.tag:hover { background-color: var(--tag-background-hover); }\n\n.obsidget-resize-handle {\n    position: absolute;\n    right: 6px;\n    bottom: 6px;\n    width: 12px;\n    height: 12px;\n    pointer-events: none;\n    opacity: 0.5;\n    background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%);\n    background-size: 6px 6px;\n    background-position: 0 0, 6px 6px;\n}\n\n@media (max-width: 600px) {\n  .kanban-board {\n    grid-template-columns: 1fr !important;\n  }\n  \n  .kanban-title-group {\n    font-size: 0.65rem;\n  }\n}",
      "js": "const { root, saveState, getState } = api;\nconst app = window.app || api.app;\n\nclass KanbanSuggest {\n    constructor(app, inputEl) {\n        this.app = app; this.inputEl = inputEl; this.suggestions = []; this.selectedIndex = 0; this.menuEl = null;\n        this.onInput = this.onInput.bind(this); this.onKeyDown = this.onKeyDown.bind(this); this.onClickOutside = this.onClickOutside.bind(this);\n        this.inputEl.addEventListener('input', this.onInput); this.inputEl.addEventListener('keydown', this.onKeyDown);\n        document.addEventListener('mousedown', this.onClickOutside); this.injectGlobalStyles();\n    }\n    injectGlobalStyles() {\n        if (document.getElementById('kanban-suggest-styles')) return;\n        const style = document.createElement('style'); style.id = 'kanban-suggest-styles';\n        style.innerHTML = `.kanban-suggest-menu { position: fixed; background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 6px; box-shadow: var(--shadow-l); z-index: 10000; min-width: 250px; max-height: 300px; overflow-y: auto; padding: 4px; font-family: var(--font-interface); } .kanban-suggest-item { padding: 8px 12px; font-size: 0.85rem; cursor: pointer; border-radius: 4px; color: var(--text-normal); display: flex; flex-direction: column; gap: 2px; } .kanban-suggest-item-path { font-size: 0.7rem; color: var(--text-muted); } .kanban-suggest-item:hover, .kanban-suggest-item.is-selected { background: var(--background-modifier-hover); color: var(--interactive-accent); }`;\n        document.head.appendChild(style);\n    }\n    onInput() {\n        const cursor = this.inputEl.selectionStart; const text = this.inputEl.value.substring(0, cursor);\n        const tagMatch = text.match(/#([^\\s#\\[\\]]*)$/); if (tagMatch) { this.showSuggestions('tag', tagMatch[1].toLowerCase()); return; }\n        const linkMatch = text.match(/\\[\\[([^\\]]*)$/); if (linkMatch) { this.showSuggestions('link', linkMatch[1].toLowerCase()); return; }\n        this.close();\n    }\n    showSuggestions(type, query) {\n        if (!this.app) return;\n        let items = [];\n        if (type === 'tag') {\n            const tags = new Set(); this.app.vault.getMarkdownFiles().forEach(f => { const cache = this.app.metadataCache.getFileCache(f); if (cache?.tags) cache.tags.forEach(t => tags.add(t.tag)); });\n            items = Array.from(tags).filter(t => t.toLowerCase().includes(query)).map(t => ({ name: t, path: '' }));\n        } else {\n            items = this.app.vault.getMarkdownFiles().filter(f => f.basename.toLowerCase().includes(query) || f.path.toLowerCase().includes(query)).map(f => ({ name: f.basename, path: f.path }));\n        }\n        if (items.length === 0) { this.close(); return; }\n        this.suggestions = items.slice(0, 15); this.selectedIndex = 0; this.renderMenu(type);\n    }\n    renderMenu(type) {\n        if (!this.menuEl) { this.menuEl = document.createElement('div'); this.menuEl.className = 'kanban-suggest-menu'; document.body.appendChild(this.menuEl); }\n        this.menuEl.innerHTML = '';\n        this.suggestions.forEach((item, i) => {\n            const div = document.createElement('div'); div.className = `kanban-suggest-item ${i === this.selectedIndex ? 'is-selected' : ''}`;\n            const nameSpan = document.createElement('span'); nameSpan.innerText = item.name; div.appendChild(nameSpan);\n            if (item.path && item.path !== item.name + '.md') { const pathSpan = document.createElement('span'); pathSpan.className = 'kanban-suggest-item-path'; pathSpan.innerText = item.path; div.appendChild(pathSpan); }\n            div.onmousedown = (e) => { e.preventDefault(); this.selectItem(item, type); }; this.menuEl.appendChild(div);\n        });\n        const rect = this.inputEl.getBoundingClientRect(); const menuHeight = Math.min(this.suggestions.length * 40, 300); const spaceBelow = window.innerHeight - rect.bottom;\n        if (spaceBelow < menuHeight && rect.top > menuHeight) this.menuEl.style.top = `${rect.top - menuHeight - 5}px`; else this.menuEl.style.top = `${rect.bottom + 5}px`;\n        this.menuEl.style.left = `${rect.left}px`; this.menuEl.style.display = 'block';\n    }\n    onKeyDown(e) {\n        if (!this.menuEl || this.menuEl.style.display === 'none') return;\n        if (e.key === 'ArrowDown') { e.preventDefault(); this.selectedIndex = (this.selectedIndex + 1) % this.suggestions.length; this.renderMenu(); }\n        else if (e.key === 'ArrowUp') { e.preventDefault(); this.selectedIndex = (this.selectedIndex - 1 + this.suggestions.length) % this.suggestions.length; this.renderMenu(); }\n        else if (e.key === 'Enter' || e.key === 'Tab') { e.preventDefault(); const textBefore = this.inputEl.value.substring(0, this.inputEl.selectionStart); const type = textBefore.includes('#') && !textBefore.includes('[[') ? 'tag' : 'link'; this.selectItem(this.suggestions[this.selectedIndex], type); }\n        else if (e.key === 'Escape') this.close();\n    }\n    selectItem(item, type) {\n        const cursor = this.inputEl.selectionStart; const text = this.inputEl.value; const before = text.substring(0, cursor); const after = text.substring(cursor);\n        let newBefore = ''; if (type === 'tag') newBefore = before.replace(/#([^\\s#\\[\\]]*)$/, item.name.startsWith('#') ? item.name : '#' + item.name); else newBefore = before.replace(/\\[\\[([^\\]]*)$/, '[[' + item.name + ']]');\n        this.inputEl.value = newBefore + after; this.inputEl.selectionStart = this.inputEl.selectionEnd = newBefore.length; this.close(); this.inputEl.focus();\n    }\n    onClickOutside(e) { if (this.menuEl && !this.menuEl.contains(e.target) && e.target !== this.inputEl) this.close(); }\n    close() { if (this.menuEl) this.menuEl.style.display = 'none'; this.selectedIndex = 0; }\n    destroy() { this.inputEl.removeEventListener('input', this.onInput); this.inputEl.removeEventListener('keydown', this.onKeyDown); document.removeEventListener('mousedown', this.onClickOutside); if (this.menuEl) this.menuEl.remove(); }\n}\n\nlet state = { items: [], isVertical: false, autoSync: true, initialized: false };\nlet draggedItem = null; let draggedElement = null; let deleteDelay = 0.75; let dragOutsideStartTime = null;\nlet selectedIds = new Set();\n\nasync function syncNoteStatus(text, newState) {\n    if (!app || !state.autoSync) return;\n    const match = text.match(/\\[\\[([^\\|\\]]+)(?:\\|([^\\]]+))?\\]\\]/);\n    if (!match) return;\n    const noteName = match[1].trim();\n    const file = app.metadataCache.getFirstLinkpathDest(noteName, \"\");\n    if (!file) return;\n    const statusMap = { 'todo': 'Todo', 'in-progress': 'InProgress', 'done': 'done' };\n    const newStatus = statusMap[newState];\n    const keywords = ['todo', 'inprogress', 'wip', 'done', 'fait', 'terminé'];\n    try {\n        await app.fileManager.processFrontMatter(file, (fm) => {\n            fm['status'] = newStatus;\n            let tags = fm['tags'] || [];\n            if (typeof tags === 'string') tags = tags.split(' ').map(t => t.replace('#', ''));\n            tags = tags.filter(t => !keywords.includes(t.toLowerCase()));\n            tags.push(newStatus);\n            fm['tags'] = [...new Set(tags)];\n        });\n    } catch (e) { console.error(\"Sync error:\", e); }\n}\n\nfunction updateSelectionUI() {\n    root.querySelectorAll('.kanban-card').forEach(card => {\n        if (selectedIds.has(card.dataset.id)) card.classList.add('kanban-card-selected');\n        else card.classList.remove('kanban-card-selected');\n    });\n}\n\nfunction render() {\n    const board = root.querySelector('.kanban-board'); if (!board) return;\n    if (state.isVertical) board.classList.add('is-vertical'); else board.classList.remove('is-vertical');\n    const syncSpan = root.getElementById('sync-status'); if (syncSpan) { syncSpan.innerText = state.autoSync ? 'ON' : 'OFF'; syncSpan.className = state.autoSync ? 'on' : 'off'; }\n    const columns = ['todo', 'in-progress', 'done'];\n    columns.forEach(colState => {\n        const colItems = state.items.filter(item => item.state === colState);\n        const colEl = board.querySelector(`[data-state=\"${colState}\"]`);\n        const listEl = colEl.querySelector('.kanban-column-items');\n        const countEl = colEl.querySelector('.kanban-column-count');\n        listEl.innerHTML = ''; countEl.innerText = colItems.length;\n        colItems.forEach(item => {\n            const card = document.createElement('div'); card.className = 'kanban-card';\n            if (item.state === 'done') card.classList.add('kanban-card-done');\n            if (selectedIds.has(item.id)) card.classList.add('kanban-card-selected');\n            card.dataset.id = item.id; card.draggable = true;\n\n            let renderedText = item.text.replace(/(!?)\\[\\[([^\\]]+)\\]\\]/g, (match, isEmbed, content) => {\n                const parts = content.split('|');\n                const linkPath = parts[0];\n                const alias = parts[1];\n                const displayText = alias || linkPath.split('/').pop().replace('.md', '');\n                const icon = isEmbed ? '🖼️ ' : '';\n                return `<a class=\"internal-link\" data-href=\"${linkPath}\" href=\"${linkPath}\">${icon}${displayText}</a>`;\n            });\n            \n            renderedText = renderedText.replace(/#([^\\s#\\[\\]]+)/g, '<span class=\"tag\">#$1</span>');\n\n            card.innerHTML = `<div class=\"kanban-card-text\">${renderedText}</div>`;\n\n            let hoverTimer = null;\n            let lastHoverKey = '';\n\n            card.addEventListener('pointerover', (e) => {\n                const linkEl = e.target.closest('a.internal-link');\n                if (!linkEl || !app) return;\n\n                const linkText = linkEl.getAttribute('data-href') || linkEl.getAttribute('href') || '';\n                const sourcePath = app.workspace.getActiveFile()?.path || '';\n                const hoverKey = linkText + '|' + sourcePath;\n\n                if (hoverKey === lastHoverKey) return;\n                lastHoverKey = hoverKey;\n\n                if (hoverTimer) clearTimeout(hoverTimer);\n                hoverTimer = setTimeout(() => {\n                    try {\n                        app.workspace.trigger('hover-link', {\n                            event: e,\n                            source: 'preview',\n                            hoverParent: { hoverPopover: null },\n                            targetEl: linkEl,\n                            linktext: linkText,\n                            sourcePath: sourcePath\n                        });\n                    } catch (err) {\n                        console.error('hover-link trigger error:', err);\n                    }\n                }, 70);\n            });\n\n            card.addEventListener('pointerout', (e) => {\n                if (hoverTimer) { clearTimeout(hoverTimer); hoverTimer = null; }\n            });\n\n            card.addEventListener('mousedown', (e) => {\n                if (e.target.closest('a.internal-link') || e.target.closest('.tag')) return;\n                e.stopPropagation();\n                \n                if (e.ctrlKey || e.metaKey) {\n                    if (selectedIds.has(item.id)) selectedIds.delete(item.id);\n                    else selectedIds.add(item.id);\n                    updateSelectionUI();\n                } else if (!selectedIds.has(item.id)) {\n                    selectedIds.clear();\n                    selectedIds.add(item.id);\n                    updateSelectionUI();\n                }\n            });\n\n            card.addEventListener('click', (e) => {\n                e.stopPropagation();\n                const link = e.target.closest('a.internal-link');\n                if (link && app) {\n                    const href = link.getAttribute('data-href') || link.getAttribute('href') || '';\n                    app.workspace.openLinkText(href, '', e.ctrlKey || e.metaKey);\n                    return;\n                }\n                const tag = e.target.closest('.tag');\n                if (tag && app) { const query = 'tag:' + tag.innerText.replace('#', ''); app.internalPlugins.getPluginById('global-search').instance.openGlobalSearch(query); return; }\n            });\n\n            card.addEventListener('dragstart', (e) => handleDragStart(e, item, card));\n            card.addEventListener('dragend', (e) => handleDragEnd(e));\n            card.addEventListener('dblclick', (e) => { e.preventDefault(); startEditing(card, item); });\n            listEl.appendChild(card);\n        });\n        setupDropZone(listEl, colState);\n    });\n    root.querySelectorAll('.kanban-add-btn').forEach(btn => { btn.onclick = () => addNewItem(btn.closest('.kanban-column').dataset.state); });\n}\n\nfunction handleDragStart(e, item, el) {\n    if (e.ctrlKey || e.metaKey) {\n        selectedIds.add(item.id);\n        el.classList.add('kanban-card-selected');\n    } else if (!selectedIds.has(item.id)) {\n        selectedIds.clear();\n        selectedIds.add(item.id);\n        root.querySelectorAll('.kanban-card-selected').forEach(c => c.classList.remove('kanban-card-selected'));\n        el.classList.add('kanban-card-selected');\n    }\n    draggedItem = item;\n    draggedElement = el;\n    dragOutsideStartTime = Date.now();\n    root.querySelectorAll('.kanban-card-selected').forEach(c => c.classList.add('kanban-card-dragging'));\n    \n    if (e.dataTransfer) {\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.setData('text/plain', Array.from(selectedIds).join(','));\n    }\n}\n\nfunction handleDragEnd(e) {\n    const isDeleteZone = draggedElement?.classList.contains('kanban-card-delete-zone');\n    \n    root.querySelectorAll('.kanban-card-dragging').forEach(c => c.classList.remove('kanban-card-dragging'));\n    \n    if (e.dataTransfer?.dropEffect === 'none' && draggedItem && isDeleteZone && e.clientX !== 0 && e.clientY !== 0) {\n        deleteItems(Array.from(selectedIds));\n        selectedIds.clear();\n    }\n    draggedItem = null; draggedElement = null; dragOutsideStartTime = null;\n    root.querySelectorAll('.kanban-drag-over').forEach(el => el.classList.remove('kanban-drag-over'));\n    root.querySelectorAll('.kanban-drop-indicator').forEach(el => el.remove());\n    root.querySelectorAll('.kanban-card-delete-zone').forEach(el => el.classList.remove('kanban-card-delete-zone'));\n}\n\nfunction deleteItems(ids) {\n    state.items = state.items.filter(i => !ids.includes(i.id));\n    render();\n    save();\n}\n\nfunction deleteItem(item) { deleteItems([item.id]); }\nfunction setupDropZone(el, colState) {\n    el.addEventListener('dragover', (e) => { e.preventDefault(); dragOutsideStartTime = Date.now(); const isExternal = e.dataTransfer?.types.includes('Files') || e.dataTransfer?.types.includes('text/plain'); if (!draggedItem && !isExternal) return; el.classList.add('kanban-drag-over'); const afterElement = getDragAfterElement(el, e.clientY); let indicator = el.querySelector('.kanban-drop-indicator'); if (!indicator) { indicator = document.createElement('div'); indicator.className = 'kanban-drop-indicator'; } if (afterElement) afterElement.before(indicator); else el.appendChild(indicator); });\n    el.addEventListener('dragleave', (e) => { if (!el.contains(e.relatedTarget)) { el.classList.remove('kanban-drag-over'); el.querySelector('.kanban-drop-indicator')?.remove(); } });\n    el.addEventListener('drop', async (e) => {\n        e.preventDefault(); e.stopPropagation();\n        el.classList.remove('kanban-drag-over'); el.querySelector('.kanban-drop-indicator')?.remove();\n        const afterElement = getDragAfterElement(el, e.clientY); const afterId = afterElement?.dataset.id;\n        if (draggedItem) await moveItems(Array.from(selectedIds), colState, afterId);\n        else {\n            const data = e.dataTransfer?.getData('text/plain');\n            if (data) {\n                const lines = data.split('\\n').map(l => l.trim()).filter(l => l !== '');\n                for (const line of lines) {\n                    let text = line;\n                    if (text.startsWith('obsidian://open?')) {\n                        try {\n                            const url = new URL(text);\n                            const filePath = url.searchParams.get('file');\n                            if (filePath) {\n                                const decodedPath = decodeURIComponent(filePath);\n                                if (app) {\n                                    const fileObj = app.vault.getAbstractFileByPath(decodedPath);\n                                    if (fileObj) {\n                                        text = app.fileManager.generateMarkdownLink(fileObj, '');\n                                    } else {\n                                        text = `[[${decodedPath.replace(/\\.md$/, '')}]]`;\n                                    }\n                                } else {\n                                    text = `[[${decodedPath.replace(/\\.md$/, '')}]]`;\n                                }\n                            }\n                        } catch (err) {}\n                    }\n                    \n                    const normalizedText = text.replace(/\\.md\\]\\]$/, ']]');\n                    const existingItem = state.items.find(i => i.text.replace(/\\.md\\]\\]$/, ']]') === normalizedText);\n                    \n                    if (existingItem) {\n                        await moveItem(existingItem, colState, afterId);\n                    } else {\n                        const newItem = { id: crypto.randomUUID(), text, state: colState };\n                        insertAt(newItem, colState, afterId); await syncNoteStatus(text, colState);\n                    }\n                }\n                render(); save();\n            }\n        }\n    });\n}\nfunction getDragAfterElement(container, y) { const cards = [...container.querySelectorAll('.kanban-card:not(.kanban-card-dragging)')]; return cards.reduce((closest, child) => { const box = child.getBoundingClientRect(); const offset = y - box.top - box.height / 2; if (offset < 0 && offset > closest.offset) return { offset: offset, element: child }; else return closest; }, { offset: Number.NEGATIVE_INFINITY }).element; }\n\nasync function moveItems(ids, newState, afterId) {\n    const itemsToMove = state.items.filter(i => ids.includes(i.id));\n    state.items = state.items.filter(i => !ids.includes(i.id));\n    \n    let targetIdx = afterId ? state.items.findIndex(i => i.id === afterId) : state.items.length;\n    if (targetIdx === -1) targetIdx = state.items.length;\n\n    for (let i = 0; i < itemsToMove.length; i++) {\n        const item = itemsToMove[i];\n        item.state = newState;\n        state.items.splice(targetIdx + i, 0, item);\n        await syncNoteStatus(item.text, newState);\n    }\n\n    render();\n    save();\n}\n\nasync function moveItem(item, newState, afterId) { await moveItems([item.id], newState, afterId); }\nfunction insertAt(item, stateName, afterId) { if (afterId) { const newIdx = state.items.findIndex(i => i.id === afterId); state.items.splice(newIdx, 0, item); } else state.items.push(item); }\nfunction addNewItem(colState) { const id = crypto.randomUUID(); const newItem = { id, text: '', state: colState }; state.items.push(newItem); selectedIds.clear(); selectedIds.add(id); render(); const card = root.querySelector(`[data-id=\"${id}\"]`); startEditing(card, newItem, true); }\nfunction startEditing(card, item, isNew = false) { card.draggable = false; const textEl = card.querySelector('.kanban-card-text'); const textarea = document.createElement('textarea'); textarea.className = 'kanban-edit-input'; textarea.value = item.text; textEl.replaceWith(textarea); const suggest = new KanbanSuggest(app, textarea); textarea.focus(); const resize = () => { textarea.style.height = 'auto'; textarea.style.height = textarea.scrollHeight + 'px'; }; resize(); textarea.addEventListener('input', resize); textarea.addEventListener('drop', (e) => { const data = e.dataTransfer?.getData('text/plain'); if (data && data.startsWith('obsidian://open?')) { e.preventDefault(); try { const url = new URL(data); const filePath = url.searchParams.get('file'); if (filePath) { const decodedPath = decodeURIComponent(filePath); let link = ''; if (app) { const fileObj = app.vault.getAbstractFileByPath(decodedPath); link = fileObj ? app.fileManager.generateMarkdownLink(fileObj, '') : `[[${decodedPath.replace(/\\.md$/, '')}]]`; } else { link = `[[${decodedPath.replace(/\\.md$/, '')}]]`; } const start = textarea.selectionStart; const end = textarea.selectionEnd; textarea.value = textarea.value.substring(0, start) + link + textarea.value.substring(end); textarea.selectionStart = textarea.selectionEnd = start + link.length; resize(); } } catch (err) {} } }); const finish = async () => { const val = textarea.value.trim(); suggest.destroy(); if (val === '') { if (isNew) deleteItem(item); else render(); } else { item.text = val; render(); save(); await syncNoteStatus(val, item.state); } }; textarea.addEventListener('blur', finish); textarea.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); textarea.blur(); } else if (e.key === 'Escape') { textarea.removeEventListener('blur', finish); suggest.destroy(); render(); } }); }\nasync function importFromVault() {\n    if (!app) return; const files = app.vault.getMarkdownFiles(); let added = 0; const todoKeywords = ['todo']; const wipKeywords = ['inprogress', 'wip', 'en cours']; const doneKeywords = ['done', 'fait', 'terminé'];\n    for (const file of files) {\n        const cache = app.metadataCache.getFileCache(file); const fm = cache?.frontmatter || {}; let targetCol = null;\n        const allValues = Object.entries(fm).flatMap(([key, val]) => { const values = Array.isArray(val) ? val : [val]; return [key, ...values].map(v => String(v).toLowerCase()); });\n        if (allValues.some(v => todoKeywords.includes(v))) targetCol = 'todo'; else if (allValues.some(v => wipKeywords.includes(v))) targetCol = 'in-progress'; else if (allValues.some(v => doneKeywords.includes(v))) targetCol = 'done';\n        if (targetCol) { const link = `[[${file.basename}]]`; if (!state.items.some(item => item.text.includes(link))) { state.items.push({ id: crypto.randomUUID(), text: link, state: targetCol }); added++; } }\n    }\n    if (added > 0) { render(); save(); alert(`Smart Import: Added ${added} new notes.`); } else alert(\"No new notes found.\");\n}\n\nfunction setupResizeObserver() {\n    var container = root.getElementById('kanban-root');\n    var observer = new ResizeObserver(function(entries) {\n        for (var i = 0; i < entries.length; i++) {\n            var entry = entries[i];\n            var h = Math.round(entry.contentRect.height);\n            var w = Math.round(entry.contentRect.width);\n            if (h && (!state.height || Math.abs(h - state.height) > 10)) state.height = h;\n            if (w && (!state.width || Math.abs(w - state.width) > 10)) state.width = w;\n            if (state.height || state.width) save();\n        }\n    });\n    observer.observe(container);\n}\n\nfunction save() { saveState(state); }\nasync function init() {\n    const saved = await getState(); \n    if (saved && saved.initialized) {\n        state = saved;\n    } else {\n        state.items = [\n            { id: \"demo-1\", text: \"Drag a note or a file from your vault here to add it!\", state: \"todo\" },\n            { id: \"demo-2\", text: \"Type # to add #tags and filter your tasks.\", state: \"todo\" },\n            { id: \"demo-3\", text: \"Type [[ to link to other notes in your vault.\", state: \"todo\" }\n        ];\n        state.initialized = true;\n        save();\n    }\n\n    if (state.width && state.height && api.reportInitialSize) {\n        api.reportInitialSize(state.width, state.height);\n    }\n    setupResizeObserver();\n\n    const settingsBtn = root.getElementById('kanban-settings-btn'); const dropdown = root.getElementById('kanban-dropdown');\n    settingsBtn.onclick = (e) => { e.stopPropagation(); dropdown.classList.toggle('is-open'); };\n    document.addEventListener('click', (e) => {\n        dropdown.classList.remove('is-open');\n        if (!e.target.closest('.kanban-card') && !e.target.closest('.kanban-add-btn') && !e.target.closest('.kanban-settings-btn')) {\n            selectedIds.clear();\n            updateSelectionUI();\n        }\n    });\n    root.getElementById('toggle-vertical').onclick = () => {\n        state.isVertical = !state.isVertical; \n        if (api.requestResize) {\n            api.requestResize(state.isVertical ? 3 : 6, state.isVertical ? 6 : 4);\n        }\n        render(); \n        save(); \n    };\n    root.getElementById('toggle-sync').onclick = () => { state.autoSync = !state.autoSync; render(); save(); };\n    root.getElementById('sync-vault').onclick = () => importFromVault();\n    document.addEventListener('dragover', (e) => {\n        if (!draggedElement || (e.clientX === 0 && e.clientY === 0)) return;\n        const board = root.querySelector('.kanban-board');\n        if (!board) return;\n        const rect = board.getBoundingClientRect();\n        const isOutside = e.clientX < rect.left - 20 || e.clientX > rect.right + 20 || e.clientY < rect.top - 20 || e.clientY > rect.bottom + 20;\n        const elapsed = (Date.now() - dragOutsideStartTime) / 1000;\n        const selectedCards = root.querySelectorAll('.kanban-card-selected');\n        if (isOutside && (e.ctrlKey || elapsed >= deleteDelay)) {\n            selectedCards.forEach(c => c.classList.add('kanban-card-delete-zone'));\n        } else {\n            selectedCards.forEach(c => c.classList.remove('kanban-card-delete-zone'));\n        }\n    });\n    render();\n}\ninit();",
      "source": "obsidget"
    },
    {
      "id": "lang-flashcards",
      "title": "Lang Flashcards",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"lingo-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">🌍 Lingo Studio Pro</h4>\n      <div class=\"header-actions\">\n        <button class=\"btn-icon\" id=\"btn-edit-toggle\" title=\"Manage Cards\">⚙️</button>\n      </div>\n    </div>\n    <div class=\"progress-bar\">\n      <div class=\"progress-fill\" id=\"progress-fill\"></div>\n    </div>\n  </div>\n\n  <div class=\"card-viewport\">\n    <div class=\"flashcard\" id=\"flashcard\">\n      <div class=\"card-face front\">\n        <div class=\"card-content\" id=\"card-front\">Bonjour</div>\n        <div class=\"card-label\">FRONT</div>\n      </div>\n      <div class=\"card-face back\">\n        <div class=\"card-content\" id=\"card-back\">Hello</div>\n        <div class=\"card-label\">BACK</div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"controls-main\">\n    <button class=\"btn-nav\" id=\"btn-prev\">←</button>\n    <div class=\"card-counter\" id=\"card-stats\">1 / 2</div>\n    <button class=\"btn-nav\" id=\"btn-next\">→</button>\n  </div>\n\n  <div class=\"edit-panel hidden\" id=\"edit-panel\">\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"input-front\" placeholder=\"Front (e.g. Bonjour)\">\n      <input type=\"text\" id=\"input-back\" placeholder=\"Back (e.g. Hello)\">\n      <div class=\"edit-actions\">\n        <button class=\"btn-save\" id=\"btn-save-card\">ADD / SAVE</button>\n        <button class=\"btn-delete\" id=\"btn-del-card\">DELETE CURRENT</button>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Saved! ✨</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.lingo-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); }\n.btn-icon.active { background: var(--interactive-accent); color: var(--text-on-accent); }\n\n.progress-bar {\n    height: 4px;\n    background: var(--background-modifier-border);\n    border-radius: 2px;\n    overflow: hidden;\n}\n\n.progress-fill {\n    height: 100%;\n    background: var(--interactive-accent);\n    width: 50%;\n    transition: width 0.3s ease;\n}\n\n.card-viewport {\n    perspective: 1000px;\n    width: 100%;\n    height: 180px;\n    cursor: pointer;\n}\n\n.flashcard {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);\n    transform-style: preserve-3d;\n}\n\n.flashcard.flipped { transform: rotateY(180deg); }\n\n.card-face {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    backface-visibility: hidden;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 20px;\n    box-shadow: var(--shadow-s);\n    padding: 20px;\n}\n\n.card-face.back {\n    transform: rotateY(180deg);\n    background: var(--background-primary-alt);\n}\n\n.card-content {\n    font-size: 1.75rem;\n    font-weight: 800;\n    text-align: center;\n    color: var(--text-normal);\n    word-break: break-word;\n}\n\n.card-label {\n    position: absolute;\n    bottom: 12px;\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n}\n\n.controls-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 15px;\n}\n\n.btn-nav {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    width: 44px;\n    height: 44px;\n    border-radius: 12px;\n    font-size: 1.2rem;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-nav:hover { background: var(--background-modifier-hover); transform: scale(1.05); }\n\n.card-counter {\n    font-size: 0.85rem;\n    font-weight: 700;\n    color: var(--text-muted);\n}\n\n.edit-panel {\n    background: rgba(0,0,0,0.05);\n    padding: 15px;\n    border-radius: 16px;\n    animation: slideDown 0.3s ease;\n}\n\n@keyframes slideDown {\n    from { opacity: 0; transform: translateY(-10px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.input-group input {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 10px 14px;\n    border-radius: 10px;\n    font-size: 0.85rem;\n    outline: none;\n}\n\n.edit-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.btn-save {\n    flex: 2;\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 10px;\n    border-radius: 10px;\n    font-weight: 800;\n    font-size: 0.75rem;\n    cursor: pointer;\n}\n\n.btn-delete {\n    flex: 1;\n    background: var(--background-modifier-error);\n    color: white;\n    border: none;\n    padding: 10px;\n    border-radius: 10px;\n    font-weight: 800;\n    font-size: 0.75rem;\n    cursor: pointer;\n}\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }\n\n.hidden { display: none !important; }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    cards: [\n        { f: 'Bonjour', b: 'Hello' },\n        { f: 'Merci', b: 'Thank you' }\n    ],\n    currentIndex: 0,\n    isEditing: false\n};\n\nfunction render() {\n    const frontEl = root.getElementById('card-front');\n    const backEl = root.getElementById('card-back');\n    const statsEl = root.getElementById('card-stats');\n    const progressFill = root.getElementById('progress-fill');\n    const flashcard = root.getElementById('flashcard');\n    const editPanel = root.getElementById('edit-panel');\n    const editBtn = root.getElementById('btn-edit-toggle');\n\n    if (state.isEditing) {\n        editPanel.classList.remove('hidden');\n        editBtn.classList.add('active');\n        // Fill inputs with current card data for easy editing\n        if (state.cards.length > 0) {\n            root.getElementById('input-front').value = state.cards[state.currentIndex].f;\n            root.getElementById('input-back').value = state.cards[state.currentIndex].b;\n        } else {\n            root.getElementById('input-front').value = '';\n            root.getElementById('input-back').value = '';\n        }\n    } else {\n        editPanel.classList.add('hidden');\n        editBtn.classList.remove('active');\n    }\n\n    if (state.cards.length === 0) {\n        frontEl.innerText = 'No cards';\n        backEl.innerText = 'Add one in settings!';\n        statsEl.innerText = '0 / 0';\n        progressFill.style.width = '0%';\n        return;\n    }\n\n    const card = state.cards[state.currentIndex];\n    frontEl.innerText = card.f;\n    backEl.innerText = card.b;\n    flashcard.classList.remove('flipped');\n    \n    statsEl.innerText = `${state.currentIndex + 1} / ${state.cards.length}`;\n    const progress = ((state.currentIndex + 1) / state.cards.length) * 100;\n    progressFill.style.width = `${progress}%`;\n}\n\nfunction flipCard() {\n    root.getElementById('flashcard').classList.toggle('flipped');\n}\n\nfunction nextCard() {\n    if (state.cards.length === 0) return;\n    state.currentIndex = (state.currentIndex + 1) % state.cards.length;\n    render();\n}\n\nfunction prevCard() {\n    if (state.cards.length === 0) return;\n    state.currentIndex = (state.currentIndex - 1 + state.cards.length) % state.cards.length;\n    render();\n}\n\nfunction saveOrUpdateCard() {\n    const fInput = root.getElementById('input-front');\n    const bInput = root.getElementById('input-back');\n    const f = fInput.value.trim();\n    const b = bInput.value.trim();\n\n    if (!f || !b) return;\n\n    // If we are editing an existing card's index, we might want to update it\n    // But for simplicity in a widget, let's treat it as \"Add New\" if inputs were empty or \"Update\" if they match current\n    // Actually, let's just make it a simple \"Add\" button and use the inputs.\n    // If the user wants to edit, they change the text and we can have a logic for that.\n    \n    // Logic: If current card exists and inputs are different, update it. Otherwise add new.\n    if (state.cards.length > 0 && (f !== state.cards[state.currentIndex].f || b !== state.cards[state.currentIndex].b)) {\n        // Update existing\n        state.cards[state.currentIndex] = { f, b };\n        showToast('Card updated! ✨');\n    } else {\n        // Add new\n        state.cards.push({ f, b });\n        state.currentIndex = state.cards.length - 1;\n        showToast('Card added! 🚀');\n    }\n\n    save();\n    render();\n}\n\nfunction deleteCard() {\n    if (state.cards.length === 0) return;\n    state.cards.splice(state.currentIndex, 1);\n    if (state.currentIndex >= state.cards.length) {\n        state.currentIndex = Math.max(0, state.cards.length - 1);\n    }\n    save();\n    render();\n    showToast('Deleted! 🗑️');\n}\n\nfunction toggleEdit() {\n    state.isEditing = !state.isEditing;\n    render();\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (Array.isArray(saved)) state.cards = saved;\n        else Object.assign(state, saved);\n    }\n\n    root.getElementById('flashcard').onclick = flipCard;\n    root.getElementById('btn-prev').onclick = prevCard;\n    root.getElementById('btn-next').onclick = nextCard;\n    root.getElementById('btn-edit-toggle').onclick = toggleEdit;\n    root.getElementById('btn-save-card').onclick = saveOrUpdateCard;\n    root.getElementById('btn-del-card').onclick = deleteCard;\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "logger-pro",
      "title": "Logger Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"logger-wrapper\" id=\"logger-root\" style=\"position: relative; resize: both; overflow: auto;\"><div class=\"logger-header\"><div class=\"logger-title-group\"><svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline></svg><span class=\"logger-title\">LOGGER PRO</span><button class=\"logger-icon-btn\" id=\"logger-switch-mode-btn\" title=\"Switch Storage Mode\"><svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"23 4 23 10 17 10\"></polyline><polyline points=\"1 20 1 14 7 14\"></polyline><path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"></path></svg></button><button class=\"logger-icon-btn\" id=\"logger-settings-btn\" title=\"Settings\"><svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg></button></div><div class=\"logger-actions\"><button class=\"logger-icon-btn\" id=\"logger-export-btn\" title=\"Export to CSV\"><svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line></svg></button></div></div><div class=\"logger-storage-config\" id=\"yaml-config-panel\"><div class=\"config-row\"><div class=\"config-item\"><label>Target Note</label><input type=\"text\" id=\"main-yaml-path\" placeholder=\"Current note\" list=\"vault-md-list\"><datalist id=\"vault-md-list\"></datalist></div><div class=\"config-item\"><label>YAML Property</label><input type=\"text\" id=\"main-yaml-key\" placeholder=\"logs\" list=\"vault-key-list\"><datalist id=\"vault-key-list\"></datalist></div></div></div><div class=\"logger-storage-config\" id=\"csv-config-panel\"><div class=\"config-row\"><div class=\"config-item\"><label>CSV File Path</label><input type=\"text\" id=\"main-csv-path\" placeholder=\"Path/to/file.csv\" list=\"vault-csv-list\"><datalist id=\"vault-csv-list\"></datalist></div></div></div><div class=\"logger-input-panel\" id=\"input-panel\"></div><div class=\"logger-list-container\"><div class=\"logger-list-header\"><div class=\"logger-list-title\"><span id=\"storage-indicator\" class=\"storage-badge\">Instance</span></div><div class=\"logger-search-box\"><svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line></svg><input type=\"text\" id=\"logger-search-input\" placeholder=\"Search...\"></div></div><div class=\"logger-table-header\" id=\"table-header\"></div><div id=\"logger-entries\" class=\"logger-entries\"></div></div><div class=\"logger-settings-panel\" id=\"logger-settings-modal\"><div class=\"settings-header\"><span>SETTINGS</span><button id=\"btn-close-settings-x\">X</button></div><div class=\"settings-body\"><div class=\"setting-group\"><label>Storage Mode</label><select id=\"setting-storage-mode\"><option value=\"instance\">Instance (JSON)</option><option value=\"csv\">Vault File (CSV)</option><option value=\"yaml\">Note YAML</option></select></div><div class=\"setting-group\"><label>CSV Delimiter</label><select id=\"setting-csv-delimiter\"><option value=\",\">Comma (,)</option><option value=\";\">Semicolon (;)</option></select></div><div class=\"setting-group\"><label>Custom Fields</label><button class=\"accent-btn\" id=\"btn-edit-schema\">Edit Schema</button></div><div class=\"setting-actions\"><button class=\"danger-btn\" id=\"btn-remove-dupes\">Clean Dupes</button><button class=\"danger-btn\" id=\"btn-clear-data\">Clear All</button></div></div></div><div class=\"logger-settings-panel\" id=\"schema-modal\"><div class=\"settings-header\"><span>EDIT SCHEMA</span><button id=\"btn-close-schema-x\">X</button></div><div class=\"settings-body\"><label class=\"schema-label\">Quick Presets (Click to add)</label><div id=\"schema-presets\" class=\"schema-presets-container\"></div><label class=\"schema-label\" style=\"margin-top:10px;\">Current Fields</label><div id=\"schema-list\"></div><button class=\"accent-btn\" id=\"btn-add-field\">+ Add Custom Field</button><div class=\"setting-actions\" style=\"margin-top:20px;\"><button class=\"accent-btn\" id=\"btn-save-schema\">Save Schema</button><button id=\"btn-cancel-schema\">Cancel</button></div></div></div><div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div></div>",
      "css": ":host{--logger-bg:var(--background-secondary);--logger-card:var(--background-primary);--logger-accent:var(--interactive-accent);--logger-border:var(--background-modifier-border);--logger-text:var(--text-normal);--logger-muted:var(--text-muted);--logger-radius:8px}.logger-wrapper{width:100%;padding:12px;font-family:var(--font-interface);color:var(--logger-text);box-sizing:border-box;background:var(--logger-bg);border-radius:var(--logger-radius);border:1px solid var(--logger-border);position:relative;display:flex;flex-direction:column;gap:10px;overflow:hidden;min-height:250px;resize:vertical}.logger-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid var(--logger-border)}.logger-title-group{display:flex;align-items:center;gap:8px}.logger-title{font-weight:700;font-size:.75rem;color:var(--logger-muted);letter-spacing:.8px}.logger-icon-btn{background:none;border:none;color:var(--logger-muted);cursor:pointer;padding:4px;border-radius:4px;display:flex;transition:all .2s}.logger-icon-btn:hover{background:var(--background-modifier-hover);color:var(--logger-text)}#logger-switch-mode-btn:hover{color:var(--logger-accent)}#logger-switch-mode-btn svg{transition:transform .3s ease}#logger-switch-mode-btn:active svg{transform:rotate(180deg)}.logger-storage-config{background:var(--background-primary-alt);padding:10px;border-radius:6px;border:1px solid var(--logger-border);display:none}.config-row{display:flex;gap:10px}.config-item{flex:1;display:flex;flex-direction:column;gap:4px}.config-item label{font-size:.65rem;font-weight:700;color:var(--logger-muted);text-transform:uppercase}.config-item input{background:var(--logger-card);border:1px solid var(--logger-border);color:var(--logger-text);padding:6px 10px;border-radius:4px;font-size:.8rem;width:100%;box-sizing:border-box}.logger-input-panel{display:flex;flex-wrap:wrap;gap:8px;align-items:flex-end}.logger-input-panel input,.logger-input-panel select{flex:1;min-width:80px;background:var(--logger-card);border:1px solid var(--logger-border);color:var(--logger-text);padding:6px 10px;border-radius:4px;font-size:.85rem}.logger-input-panel input[type=checkbox]{flex:none;width:18px;height:18px}#log-submit-btn{background:var(--logger-accent);color:#fff;border:none;padding:6px 16px;border-radius:4px;cursor:pointer;font-weight:600;font-size:.8rem;flex-shrink:0}.logger-list-container{background:var(--logger-card);border-radius:6px;border:1px solid var(--logger-border);overflow:hidden;display:flex;flex-direction:column;flex:1}.logger-list-header{padding:8px 12px;background:var(--background-secondary-alt);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--logger-border);gap:10px}.storage-badge{font-size:.65rem;padding:2px 6px;border-radius:4px;background:var(--logger-accent);color:#fff;font-weight:700}.logger-search-box{display:flex;align-items:center;background:var(--background-primary);border:1px solid var(--logger-border);border-radius:4px;padding:2px 8px;gap:6px;flex:1;max-width:140px}.logger-search-box input{background:none;border:none;color:var(--logger-text);font-size:.75rem;width:100%;outline:none}.logger-table-header{display:flex;align-items:center;padding:6px 12px;background:var(--background-primary-alt);border-bottom:1px solid var(--logger-border);font-size:.7rem;font-weight:700;color:var(--logger-muted);text-transform:uppercase;gap:10px;user-select:none}.logger-table-header>span{cursor:pointer;display:flex;align-items:center;gap:4px;transition:color .2s;min-width:50px;flex:1}.logger-table-header>span:hover{color:var(--logger-accent)}.logger-table-header>span.active{color:var(--logger-accent)}.th-action{width:20px;flex:none!important;min-width:20px!important}.sort-arrow{font-size:.6rem;opacity:.5}.active .sort-arrow{opacity:1}.logger-entries{max-height:100%;overflow-y:auto;flex:1}.logger-entry{display:flex;align-items:center;padding:8px 12px;border-bottom:1px solid var(--logger-border);font-size:.8rem;gap:10px}.logger-entry:last-child{border-bottom:none}.logger-entry>span{flex:1;min-width:50px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;border:1px solid transparent;border-radius:4px;padding:2px 4px}.logger-entry>span:first-child{color:var(--logger-muted);font-size:.7rem;cursor:default}.logger-entry>span:not(:first-child):hover{border-color:var(--logger-border);background:var(--background-modifier-hover)}.entry-delete{opacity:0;cursor:pointer;color:var(--text-error);font-size:.9rem;padding:2px;width:20px;flex:none!important;min-width:20px!important;text-align:center}.logger-entry:hover .entry-delete{opacity:1}.logger-settings-panel{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--logger-bg);display:none;z-index:100;border-radius:var(--logger-radius);flex-direction:column;overflow:hidden}.settings-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;font-weight:800;font-size:.85rem;color:var(--logger-accent);letter-spacing:1px;border-bottom:1px solid var(--logger-border);background:var(--background-primary-alt)}.settings-header button{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:1rem;padding:4px 8px;border-radius:4px}.settings-header button:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.settings-body{padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:14px;flex:1}.setting-group{display:flex;flex-direction:column;gap:6px}.setting-group label{font-size:.7rem;font-weight:700;color:var(--logger-muted);text-transform:uppercase}.setting-group select,.setting-group input{background:var(--background-primary);border:1px solid var(--logger-border);color:var(--text-normal);padding:8px 12px;border-radius:6px;font-size:.85rem;width:100%;box-sizing:border-box}.setting-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}.setting-actions button{padding:8px;border-radius:6px;font-size:.75rem;cursor:pointer;border:1px solid var(--logger-border);background:var(--interactive-normal);font-weight:700;color:var(--text-normal)}.accent-btn{background:var(--logger-accent)!important;color:#fff!important;border-color:var(--logger-accent)!important}.danger-btn{color:var(--text-error)!important;border-color:var(--text-error)!important}.schema-field{display:flex;gap:6px;align-items:center;padding:6px;background:var(--background-primary);border-radius:6px;margin-bottom:6px}.schema-field input,.schema-field select{flex:1;padding:5px 8px;border:1px solid var(--logger-border);border-radius:4px;background:var(--background-secondary);color:var(--text-normal);font-size:.75rem}.schema-field .btn-remove-field{background:none;border:none;color:var(--text-error);cursor:pointer;font-size:.9rem;padding:4px}.link-tag{color:var(--text-accent);cursor:pointer;text-decoration:none}.link-tag:hover{text-decoration:underline}.schema-presets-container{display:flex;flex-wrap:wrap;gap:6px}.preset-tag{font-size:.7rem;background:var(--background-secondary-alt);border:1px solid var(--logger-border);padding:4px 8px;border-radius:12px;cursor:pointer;transition:all .2s;color:var(--text-muted);font-weight:600}.preset-tag:hover{border-color:var(--logger-accent);color:var(--logger-accent);background:var(--background-primary)}.cell-edit-input{width:100%;height:100%;border:none;background:var(--background-primary);color:var(--text-normal);font-family:inherit;font-size:inherit;padding:0;outline:none;border-bottom:1px solid var(--logger-accent)}.schema-label{font-size:.7rem;font-weight:700;color:var(--logger-muted);text-transform:uppercase;display:block}",
      "js": "(function(){var root=api.root;var app=window.app||api.app;var storageModes=['instance','csv','yaml'];var defaultSchema=[{key:'cat',label:'Category',type:'text',options:[]},{key:'val',label:'Value',type:'text',options:[]},{key:'note',label:'Note',type:'text',options:[]}];var presets=[{label:'Date',key:'date',type:'text',val:'{{date}}'},{label:'Time',key:'time',type:'text',val:'{{time}}'},{label:'Link [[ ]]',key:'link',type:'text',val:'[[ ]]'},{label:'Tag #',key:'tag',type:'text',val:'#'},{label:'Rating (1-5)',key:'rating',type:'select',options:['1','2','3','4','5']},{label:'Status',key:'status',type:'select',options:['Todo','Doing','Done']},{label:'Checkbox',key:'check',type:'checkbox'},{label:'Amount',key:'amount',type:'number'}];var state={entries:[],settings:{storageMode:'instance',csvPath:'Logs/logger.csv',yamlPath:'',yamlKey:'logs',csvDelimiter:',',sortBy:'ts',sortDir:'desc',showLastN:30,isSettingsOpen:false,schema:null,height:null}};var instanceBuffer=[];var searchQuery='';var tempSchema=[];var focusBackup={};function clearOnFocus(el,key){if(!el)return;focusBackup[key]=el.value;el.value='';}function restoreOnBlur(el,key,settingKey){if(!el)return;if(el.value.trim()===''&&focusBackup[key]!==undefined){el.value=focusBackup[key];}else if(settingKey&&el.value.trim()!==''){state.settings[settingKey]=el.value.trim();save();}}function escapeHtml(t){if(!t)return'';var d=document.createElement('div');d.textContent=t;return d.innerHTML;}function formatCell(val){if(!val||typeof val!=='string')return escapeHtml(val)||'';var esc=escapeHtml(val);return esc.replace(/#([A-Za-z0-9_-]+)/g,function(m,tag){return'<span class=\"link-tag\" data-tag=\"'+tag+'\">#'+tag+'</span>';});}function searchTag(tag){try{if(app&&app.internalPlugins){var sp=app.internalPlugins.getPluginById('global-search');if(sp&&sp.instance)sp.instance.openGlobalSearch('tag:#'+tag);}}catch(e){}}api.getState().then(function(saved){if(saved){if(saved.instanceEntries)instanceBuffer=saved.instanceEntries;if(saved.settings){var s=saved.settings;if(s.storageMode)state.settings.storageMode=s.storageMode;if(s.csvPath)state.settings.csvPath=s.csvPath;if(s.yamlPath!==undefined)state.settings.yamlPath=s.yamlPath;if(s.yamlKey)state.settings.yamlKey=s.yamlKey;if(s.csvDelimiter)state.settings.csvDelimiter=s.csvDelimiter;if(s.sortBy)state.settings.sortBy=s.sortBy;if(s.sortDir)state.settings.sortDir=s.sortDir;if(s.showLastN)state.settings.showLastN=s.showLastN;if(s.isSettingsOpen!==undefined)state.settings.isSettingsOpen=s.isSettingsOpen;if(s.schema&&s.schema.length>0)state.settings.schema=s.schema;if(s.height)state.settings.height=s.height;}if(state.settings.storageMode==='instance'&&saved.entries){state.entries=saved.entries;}}if(!state.settings.schema||state.settings.schema.length===0){state.settings.schema=JSON.parse(JSON.stringify(defaultSchema));}if(state.settings.height){var wrap=root.getElementById('logger-root');if(wrap)wrap.style.height=state.settings.height;}buildInputPanel();buildTableHeader();setupEvents();updateAllDatalists();if(state.settings.isSettingsOpen)showPanel('logger-settings-modal');render();if(state.settings.storageMode==='yaml')refreshFromYAML();else if(state.settings.storageMode==='csv')refreshFromCSV();}).catch(function(e){console.error('Init error:',e);state.settings.schema=JSON.parse(JSON.stringify(defaultSchema));buildInputPanel();buildTableHeader();setupEvents();render();});function showPanel(id){var p=root.getElementById(id);if(p)p.style.display='flex';}function hidePanel(id){var p=root.getElementById(id);if(p)p.style.display='none';}function updateAllDatalists(){updateVaultFilesDatalist();updateYAMLKeysDatalist();updateFieldDatalistsFromEntries();}function updateVaultFilesDatalist(){if(!app||!app.vault)return;try{var mdList=root.getElementById('vault-md-list');var csvList=root.getElementById('vault-csv-list');var allFiles=app.vault.getFiles();if(mdList){var mdFiles=allFiles.filter(function(f){return f.path.endsWith('.md');});mdList.innerHTML=mdFiles.slice(0,200).map(function(f){return'<option value=\"'+f.path+'\">';}).join('');}if(csvList){var csvFiles=allFiles.filter(function(f){return f.path.endsWith('.csv');});var paths=csvFiles.map(function(f){return f.path;});if(state.settings.csvPath&&paths.indexOf(state.settings.csvPath)===-1)paths.unshift(state.settings.csvPath);csvList.innerHTML=paths.slice(0,100).map(function(p){return'<option value=\"'+p+'\">';}).join('');}}catch(e){}}function updateYAMLKeysDatalist(){var keyList=root.getElementById('vault-key-list');if(!keyList)return;var targetPath=state.settings.yamlPath||undefined;api.getFrontmatter(targetPath).then(function(fm){var currentKeys=fm?Object.keys(fm):[];var allKeys=[];if(app.metadataCache&&app.metadataCache.getAllPropertyInfos){var infos=app.metadataCache.getAllPropertyInfos();allKeys=Object.keys(infos);}var others=allKeys.filter(function(k){return currentKeys.indexOf(k)===-1;});var combined=currentKeys.concat(others);keyList.innerHTML=combined.map(function(k){return'<option value=\"'+k+'\">';}).join('');}).catch(function(e){});}function updateFieldDatalistsFromEntries(){var schema=state.settings.schema||defaultSchema;for(var i=0;i<schema.length;i++){var f=schema[i];if(f.type==='text'){var dlId='dl-'+f.key;var dl=root.getElementById(dlId);if(dl){var valSet={};for(var j=0;j<state.entries.length;j++){var v=state.entries[j][f.key];if(v&&v.toString().trim())valSet[v.toString().trim()]=true;}var opts=Object.keys(valSet).slice(0,50);dl.innerHTML=opts.map(function(o){return'<option value=\"'+o+'\">';}).join('');}}}}function updateSchemaFromKeys(keys){var newSchema=[];keys.forEach(function(k){if(k==='id')return;newSchema.push({key:k,label:k.charAt(0).toUpperCase()+k.slice(1),type:'text',options:[]});});state.settings.schema=newSchema;buildInputPanel();buildTableHeader();}function buildInputPanel(){var panel=root.getElementById('input-panel');if(!panel)return;var html='';var schema=state.settings.schema||defaultSchema;for(var i=0;i<schema.length;i++){var f=schema[i];if(f.type==='select'&&f.options&&f.options.length){html+='<select id=\"input-'+f.key+'\"><option value=\"\">'+f.label+'</option>';for(var j=0;j<f.options.length;j++)html+='<option value=\"'+f.options[j]+'\">'+f.options[j]+'</option>';html+='</select>';}else if(f.type==='checkbox'){html+='<label style=\"display:flex;align-items:center;gap:4px\"><input type=\"checkbox\" id=\"input-'+f.key+'\"> '+f.label+'</label>';}else if(f.type==='number'){html+='<input type=\"number\" id=\"input-'+f.key+'\" placeholder=\"'+f.label+'\">';}else{var ph=f.label;if(f.key==='date')ph='YYYY-MM-DD';if(f.key==='time')ph='HH:MM';html+='<input type=\"text\" id=\"input-'+f.key+'\" placeholder=\"'+ph+'\" list=\"dl-'+f.key+'\" class=\"has-datalist\">';html+='<datalist id=\"dl-'+f.key+'\"></datalist>';}}html+='<button id=\"log-submit-btn\">Log</button>';panel.innerHTML=html;var inputs=panel.querySelectorAll('.has-datalist');for(var k=0;k<inputs.length;k++){(function(inp){var key=inp.id.replace('input-','');inp.onfocus=function(){clearOnFocus(inp,key);updateFieldDatalistsFromEntries();};inp.onblur=function(){restoreOnBlur(inp,key,null);};})(inputs[k]);}}function buildTableHeader(){var header=root.getElementById('table-header');if(!header)return;var html='';var schema=state.settings.schema||defaultSchema;for(var i=0;i<schema.length;i++)html+='<span data-sort=\"'+schema[i].key+'\">'+schema[i].label+' <span class=\"sort-arrow\"></span></span>';html+='<span class=\"th-action\"></span>';header.innerHTML=html;setupSortHeaders();}function setupSortHeaders(){var ths=root.querySelectorAll('#table-header > span[data-sort]');for(var i=0;i<ths.length;i++){(function(th){th.onclick=function(){var col=th.getAttribute('data-sort');if(state.settings.sortBy===col)state.settings.sortDir=state.settings.sortDir==='asc'?'desc':'asc';else{state.settings.sortBy=col;state.settings.sortDir='asc';}render();save();};})(ths[i]);}}function setupEvents(){var wrap=root.getElementById('logger-root');if(wrap){wrap.onmouseup=function(){state.settings.height=wrap.style.height;save();};}var switchBtn=root.getElementById('logger-switch-mode-btn');if(switchBtn)switchBtn.onclick=function(){var idx=storageModes.indexOf(state.settings.storageMode);var prevMode=state.settings.storageMode;var newMode=storageModes[(idx+1)%3];if(prevMode==='instance'){instanceBuffer=JSON.parse(JSON.stringify(state.entries));}state.settings.storageMode=newMode;if(newMode==='instance'){state.entries=JSON.parse(JSON.stringify(instanceBuffer));state.settings.schema=JSON.parse(JSON.stringify(defaultSchema));buildInputPanel();buildTableHeader();}else{state.entries=[];}save();render();updateAllDatalists();if(newMode==='yaml')refreshFromYAML();if(newMode==='csv')refreshFromCSV();new Notice('Mode: '+newMode.toUpperCase());};var settingsBtn=root.getElementById('logger-settings-btn');if(settingsBtn)settingsBtn.onclick=function(){state.settings.isSettingsOpen=true;showPanel('logger-settings-modal');updateVaultFilesDatalist();save();};var closeSettings=root.getElementById('btn-close-settings-x');if(closeSettings)closeSettings.onclick=function(){state.settings.isSettingsOpen=false;hidePanel('logger-settings-modal');save();};var exportBtn=root.getElementById('logger-export-btn');if(exportBtn)exportBtn.onclick=exportToCSV;var searchInput=root.getElementById('logger-search-input');if(searchInput)searchInput.oninput=function(e){searchQuery=e.target.value.toLowerCase();render();};var yamlPath=root.getElementById('main-yaml-path');if(yamlPath){yamlPath.onfocus=function(){clearOnFocus(yamlPath,'yamlPath');updateVaultFilesDatalist();};yamlPath.onblur=function(){restoreOnBlur(yamlPath,'yamlPath','yamlPath');updateYAMLKeysDatalist();refreshFromYAML();};}var yamlKey=root.getElementById('main-yaml-key');if(yamlKey){yamlKey.onfocus=function(){clearOnFocus(yamlKey,'yamlKey');updateYAMLKeysDatalist();};yamlKey.onblur=function(){restoreOnBlur(yamlKey,'yamlKey','yamlKey');refreshFromYAML();};}var modeSelect=root.getElementById('setting-storage-mode');if(modeSelect)modeSelect.onchange=function(e){var newMode=e.target.value;if(state.settings.storageMode==='instance'){instanceBuffer=JSON.parse(JSON.stringify(state.entries));}state.settings.storageMode=newMode;if(newMode==='instance'){state.entries=JSON.parse(JSON.stringify(instanceBuffer));state.settings.schema=JSON.parse(JSON.stringify(defaultSchema));buildInputPanel();buildTableHeader();}else{state.entries=[];}save();render();updateAllDatalists();if(newMode==='yaml')refreshFromYAML();if(newMode==='csv')refreshFromCSV();};var csvPath=root.getElementById('main-csv-path');if(csvPath){csvPath.oninput=function(e){var val=e.target.value.trim();if(val){var file=app.vault.getAbstractFileByPath(val);if(file){state.settings.csvPath=val;save();refreshFromCSV();}}};csvPath.onfocus=function(){clearOnFocus(csvPath,'csvPath');updateVaultFilesDatalist();};csvPath.onblur=function(){restoreOnBlur(csvPath,'csvPath','csvPath');refreshFromCSV();};}var csvDelim=root.getElementById('setting-csv-delimiter');if(csvDelim)csvDelim.onchange=function(e){state.settings.csvDelimiter=e.target.value;save();refreshFromCSV();};var clearBtn=root.getElementById('btn-clear-data');if(clearBtn)clearBtn.onclick=function(){if(confirm('Clear all entries?')){state.entries=[];render();save().then(function(){updateFieldDatalistsFromEntries();syncToExternal();});}};var dupesBtn=root.getElementById('btn-remove-dupes');if(dupesBtn)dupesBtn.onclick=function(){var seen={};state.entries=state.entries.filter(function(e){var k=JSON.stringify(e);if(seen[k])return false;seen[k]=true;return true;});render();save().then(function(){updateFieldDatalistsFromEntries();syncToExternal();});};var editSchema=root.getElementById('btn-edit-schema');if(editSchema)editSchema.onclick=function(){tempSchema=JSON.parse(JSON.stringify(state.settings.schema||defaultSchema));renderSchemaEditor();hidePanel('logger-settings-modal');showPanel('schema-modal');};var closeSchema=root.getElementById('btn-close-schema-x');if(closeSchema)closeSchema.onclick=function(){hidePanel('schema-modal');};var cancelSchema=root.getElementById('btn-cancel-schema');if(cancelSchema)cancelSchema.onclick=function(){hidePanel('schema-modal');};var addField=root.getElementById('btn-add-field');if(addField)addField.onclick=function(){tempSchema.push({key:'field'+Date.now(),label:'New Field',type:'text',options:[]});renderSchemaEditor();};var saveSchema=root.getElementById('btn-save-schema');if(saveSchema)saveSchema.onclick=function(){readSchemaFromEditor();state.settings.schema=tempSchema;buildInputPanel();buildTableHeader();updateFieldDatalistsFromEntries();hidePanel('schema-modal');save();render();};var inputPanel=root.getElementById('input-panel');if(inputPanel){inputPanel.onclick=function(e){if(e.target&&e.target.id==='log-submit-btn')addEntry();};inputPanel.onkeydown=function(e){if(e.key==='Enter'&&e.target.tagName==='INPUT')addEntry();};}}function renderSchemaEditor(){var list=root.getElementById('schema-list');if(!list)return;var html='';for(var i=0;i<tempSchema.length;i++){var f=tempSchema[i];html+='<div class=\"schema-field\" data-index=\"'+i+'\"><input type=\"text\" class=\"field-key\" value=\"'+f.key+'\" placeholder=\"Key\"><input type=\"text\" class=\"field-label\" value=\"'+f.label+'\" placeholder=\"Label\"><select class=\"field-type\"><option value=\"text\"'+(f.type==='text'?' selected':'')+'>Text</option><option value=\"number\"'+(f.type==='number'?' selected':'')+'>Number</option><option value=\"select\"'+(f.type==='select'?' selected':'')+'>Select</option><option value=\"checkbox\"'+(f.type==='checkbox'?' selected':'')+'>Checkbox</option></select><input type=\"text\" class=\"field-options\" value=\"'+(f.options||[]).join(',')+'\" placeholder=\"Options\"><button class=\"btn-remove-field\" data-index=\"'+i+'\">X</button></div>';}list.innerHTML=html;var btns=list.querySelectorAll('.btn-remove-field');for(var j=0;j<btns.length;j++){(function(btn){btn.onclick=function(){tempSchema.splice(parseInt(btn.getAttribute('data-index')),1);renderSchemaEditor();};})(btns[j]);}renderSchemaPresets();}function renderSchemaPresets(){var cont=root.getElementById('schema-presets');if(!cont)return;cont.innerHTML='';presets.forEach(function(p){var tag=document.createElement('span');tag.className='preset-tag';tag.innerText='+ '+p.label;tag.onclick=function(){var newField={key:p.key+'_'+Date.now().toString().slice(-4),label:p.label,type:p.type,options:p.options||[]};tempSchema.push(newField);renderSchemaEditor();};cont.appendChild(tag);});}function readSchemaFromEditor(){var fields=root.querySelectorAll('.schema-field');tempSchema=[];for(var i=0;i<fields.length;i++){var el=fields[i];var key=el.querySelector('.field-key').value.trim()||'field';var label=el.querySelector('.field-label').value.trim()||'Field';var type=el.querySelector('.field-type').value;var optStr=el.querySelector('.field-options').value.trim();var options=optStr?optStr.split(',').map(function(o){return o.trim();}):[];tempSchema.push({key:key,label:label,type:type,options:options});}}function addEntry(){var entry={};entry.id=Date.now();entry.ts=new Date().toISOString();var schema=state.settings.schema||defaultSchema;for(var i=0;i<schema.length;i++){var f=schema[i];var el=root.getElementById('input-'+f.key);if(!el)continue;if(f.type==='checkbox')entry[f.key]=el.checked;else{var val=el.value.trim();if(f.key==='date'&&!val)val=new Date().toISOString().split('T')[0];if(f.key==='time'&&!val)val=new Date().toTimeString().split(' ')[0].slice(0,5);entry[f.key]=val;}}state.entries.unshift(entry);for(var j=0;j<schema.length;j++){var f2=schema[j];var el2=root.getElementById('input-'+f2.key);if(el2){if(f2.type==='checkbox')el2.checked=false;else el2.value='';}}render();updateFieldDatalistsFromEntries();save().then(function(){if(state.settings.storageMode==='yaml')setTimeout(function(){appendToYAML(entry);},100);if(state.settings.storageMode==='csv')setTimeout(function(){appendToCSV(entry);},100);});}function editCell(el,id,key,type,options){if(type==='checkbox'){var entry=state.entries.find(function(e){return e.id===id;});if(entry){entry[key]=!entry[key];render();save().then(function(){syncToExternal();});}return;}var currentVal=el.innerText;if(currentVal.indexOf('#')===0)currentVal=el.getAttribute('data-raw')||currentVal;el.innerHTML='';var input;if(type==='select'){input=document.createElement('select');options.forEach(function(o){var opt=document.createElement('option');opt.value=o;opt.innerText=o;if(o===currentVal)opt.selected=true;input.appendChild(opt);});}else{input=document.createElement('input');input.type=type==='number'?'number':'text';input.value=currentVal;}input.className='cell-edit-input';el.appendChild(input);input.focus();var saved=false;function finish(){if(saved)return;saved=true;var newVal=type==='select'?input.value:input.value.trim();var entry=state.entries.find(function(e){return e.id===id;});if(entry){entry[key]=newVal;render();save().then(function(){syncToExternal();});}else{render();}}input.onblur=finish;input.onkeydown=function(e){if(e.key==='Enter')finish();};}function appendToYAML(entry){var p=state.settings.yamlPath||undefined;api.getFrontmatter(p).then(function(fm){fm=fm||{};var k=state.settings.yamlKey||'logs';if(!Array.isArray(fm[k]))fm[k]=[];var obj={};obj.ts=entry.ts;var schema=state.settings.schema||defaultSchema;for(var i=0;i<schema.length;i++){var key=schema[i].key;if(entry[key]!==undefined)obj[key]=entry[key];}fm[k].push(obj);var upd={};upd[k]=fm[k];return api.updateFrontmatter(upd,p);}).then(function(){new Notice('YAML saved!');}).catch(function(e){console.error('YAML error:',e);new Notice('YAML Error: '+e.message);});}function appendToCSV(entry){var path=state.settings.csvPath;var d=state.settings.csvDelimiter;var schema=state.settings.schema||defaultSchema;api.readFile(path).then(function(content){content=content||'';var lines=content.split('\\n');var cols=[];if(lines.length>0&&lines[0].trim()){cols=lines[0].split(d).map(function(c){return c.replace(/^\"|\"$/g,'');});}else{cols=schema.map(function(s){return s.key;});}var vals=cols.map(function(c){return'\"'+(entry[c]||'').toString().replace(/\"/g,'\"\"')+'\"';}).join(d);var newContent=content;if(newContent&&!newContent.endsWith('\\n'))newContent+='\\n';newContent+=vals;return api.writeFile(path,newContent);}).then(function(){new Notice('CSV saved!');});}function syncToExternal(){if(state.settings.storageMode==='yaml'){var p=state.settings.yamlPath||undefined;var k=state.settings.yamlKey||'logs';var schema=state.settings.schema||defaultSchema;var entries=state.entries.slice().reverse().map(function(e){var obj={};obj.ts=e.ts;for(var i=0;i<schema.length;i++){var key=schema[i].key;if(e[key]!==undefined)obj[key]=e[key];}return obj;});var upd={};upd[k]=entries;api.updateFrontmatter(upd,p).then(function(){new Notice('YAML synced!');});}else if(state.settings.storageMode==='csv'){var d=state.settings.csvDelimiter;var schema=state.settings.schema||defaultSchema;var cols=schema.map(function(s){return s.key;});var header=cols.map(function(c){return'\"'+c+'\"';}).join(d)+'\\n';var rows=state.entries.slice().reverse().map(function(e){return cols.map(function(c){return'\"'+(e[c]||'').toString().replace(/\"/g,'\"\"')+'\"';}).join(d);}).join('\\n');api.writeFile(state.settings.csvPath,header+rows).then(function(){new Notice('CSV synced!');});}}function refreshFromYAML(){var p=state.settings.yamlPath||undefined;api.getFrontmatter(p).then(function(fm){var k=state.settings.yamlKey||'logs';if(fm&&Array.isArray(fm[k])){if(fm[k].length>0){updateSchemaFromKeys(Object.keys(fm[k][0]));}state.entries=fm[k].map(function(x){var o={};o.id=Date.now()+Math.random();for(var key in x)o[key]=x[key];return o;}).reverse();render();updateFieldDatalistsFromEntries();}});}function refreshFromCSV(){if(!app)return;var path=state.settings.csvPath;var d=state.settings.csvDelimiter;var file=app.vault.getAbstractFileByPath(path);if(file){app.vault.read(file).then(function(content){var lines=content.split('\\n').filter(function(l){return l.trim();});if(lines.length<2)return;var headerStr=lines[0];var headers=headerStr.split(d).map(function(h){return h.replace(/^\"|\"$/g,'');});updateSchemaFromKeys(headers);state.entries=lines.slice(1).map(function(line){var parts=line.split(d).map(function(p){return p.replace(/^\"|\"$/g,'');});var ent={};ent.id=Date.now()+Math.random();for(var i=0;i<headers.length;i++)ent[headers[i]]=parts[i]||'';return ent;}).reverse();render();updateFieldDatalistsFromEntries();});}}function render(){var indicator=root.getElementById('storage-indicator');if(indicator)indicator.innerText=state.settings.storageMode.toUpperCase();var yamlPanel=root.getElementById('yaml-config-panel');if(yamlPanel)yamlPanel.style.display=state.settings.storageMode==='yaml'?'block':'none';var csvPanel=root.getElementById('csv-config-panel');if(csvPanel)csvPanel.style.display=state.settings.storageMode==='csv'?'block':'none';var yPath=root.getElementById('main-yaml-path');var yKey=root.getElementById('main-yaml-key');if(yPath&&document.activeElement!==yPath)yPath.value=state.settings.yamlPath||'';if(yKey&&document.activeElement!==yKey)yKey.value=state.settings.yamlKey||'logs';var modeEl=root.getElementById('setting-storage-mode');if(modeEl)modeEl.value=state.settings.storageMode;var csvCont=root.getElementById('csv-path-cont');if(csvCont)csvCont.style.display=state.settings.storageMode==='csv'?'block':'none';var csvPathEl=root.getElementById('main-csv-path');if(csvPathEl&&document.activeElement!==csvPathEl)csvPathEl.value=state.settings.csvPath||'';var ths=root.querySelectorAll('#table-header > span[data-sort]');for(var t=0;t<ths.length;t++){ths[t].classList.remove('active');var arrow=ths[t].querySelector('.sort-arrow');if(arrow)arrow.textContent='';if(ths[t].getAttribute('data-sort')===state.settings.sortBy){ths[t].classList.add('active');if(arrow)arrow.textContent=state.settings.sortDir==='asc'?'^':'v';}}var schema=state.settings.schema||defaultSchema;var filtered=state.entries.filter(function(e){if(!searchQuery)return true;var tsStr=e.ts||'';if(tsStr.toLowerCase().indexOf(searchQuery)!==-1)return true;for(var i=0;i<schema.length;i++){var val=e[schema[i].key];if(val&&val.toString().toLowerCase().indexOf(searchQuery)!==-1)return true;}return false;});var sorted=filtered.slice();var dir=state.settings.sortDir==='asc'?1:-1;var sortKey=state.settings.sortBy;sorted.sort(function(a,b){var av=a[sortKey]||'';var bv=b[sortKey]||'';if(sortKey==='ts')return dir*(new Date(av)-new Date(bv));if(typeof av==='number'&&typeof bv==='number')return dir*(av-bv);return dir*av.toString().localeCompare(bv.toString());});var container=root.getElementById('logger-entries');if(!container)return;var html='';var toShow=sorted.slice(0,state.settings.showLastN);for(var i=0;i<toShow.length;i++){var e=toShow[i];var dt=new Date(e.ts);var time=dt.getHours()+':'+(dt.getMinutes()<10?'0':'')+dt.getMinutes();html+='<div class=\"logger-entry\"><span>'+time+'</span>';for(var j=0;j<schema.length;j++){var f=schema[j];var val=e[f.key];var displayVal=val;if(f.type==='checkbox')displayVal=val?'Y':'';html+='<span class=\"editable-cell\" data-id=\"'+e.id+'\" data-key=\"'+f.key+'\" data-type=\"'+f.type+'\" data-raw=\"'+(val||'')+'\">'+formatCell(displayVal)+'</span>';}html+='<span class=\"entry-delete\" data-id=\"'+e.id+'\">X</span></div>';}container.innerHTML=html;var delBtns=container.querySelectorAll('.entry-delete');for(var k=0;k<delBtns.length;k++){(function(btn){btn.onclick=function(){var id=parseFloat(btn.getAttribute('data-id'));state.entries=state.entries.filter(function(x){return x.id!==id;});render();save().then(function(){updateFieldDatalistsFromEntries();syncToExternal();});};})(delBtns[k]);}var cells=container.querySelectorAll('.editable-cell');for(var l=0;l<cells.length;l++){(function(c){c.onclick=function(e){if(e.target.tagName==='SPAN'&&e.target.classList.contains('link-tag')){searchTag(e.target.getAttribute('data-tag'));return;}if(c.querySelector('input,select'))return;var id=parseFloat(c.getAttribute('data-id'));var key=c.getAttribute('data-key');var type=c.getAttribute('data-type');var field=schema.find(function(s){return s.key===key;});var opts=field?field.options:[];editCell(c,id,key,type,opts);};})(cells[l]);}}function exportToCSV(){var d=state.settings.csvDelimiter;var schema=state.settings.schema||defaultSchema;var cols=schema.map(function(s){return s.key;});var header=cols.map(function(c){return'\"'+c+'\"';}).join(d)+'\\n';var rows=state.entries.map(function(e){return cols.map(function(c){return'\"'+(e[c]||'').toString().replace(/\"/g,'\"\"')+'\"';}).join(d);}).join('\\n');var blob=new Blob([header+rows],{type:'text/csv'});var url=URL.createObjectURL(blob);var a=document.createElement('a');a.href=url;a.download='export_'+Date.now()+'.csv';a.click();}function save(){var d={};if(state.settings.storageMode==='instance'){d.entries=state.entries;instanceBuffer=JSON.parse(JSON.stringify(state.entries));}else{d.entries=[];d.instanceEntries=instanceBuffer;}d.settings=state.settings;return api.saveState(d);}})();",
      "source": "obsidget"
    },
    {
      "id": "meal-planner",
      "title": "Meal Planner",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"meal-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-main\">\n      <h4 class=\"widget-title\">🥗 Meal Studio Pro</h4>\n      <div class=\"view-toggle\">\n        <button class=\"btn-toggle active\" id=\"btn-view-day\">DAY</button>\n        <button class=\"btn-toggle\" id=\"btn-view-week\">WEEK</button>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"view-container\" id=\"view-day\">\n    <div class=\"day-selector\">\n      <button class=\"day-btn\" data-day=\"0\">MON</button>\n      <button class=\"day-btn\" data-day=\"1\">TUE</button>\n      <button class=\"day-btn\" data-day=\"2\">WED</button>\n      <button class=\"day-btn\" data-day=\"3\">THU</button>\n      <button class=\"day-btn\" data-day=\"4\">FRI</button>\n      <button class=\"day-btn\" data-day=\"5\">SAT</button>\n      <button class=\"day-btn\" data-day=\"6\">SUN</button>\n    </div>\n\n    <div class=\"meal-inputs\">\n      <div class=\"meal-card\" data-type=\"b\">\n        <div class=\"meal-icon\">🍳</div>\n        <div class=\"meal-content\">\n          <label>BREAKFAST</label>\n          <input type=\"text\" id=\"input-b\" placeholder=\"What's for breakfast?\">\n        </div>\n      </div>\n      <div class=\"meal-card\" data-type=\"l\">\n        <div class=\"meal-icon\">🍱</div>\n        <div class=\"meal-content\">\n          <label>LUNCH</label>\n          <input type=\"text\" id=\"input-l\" placeholder=\"What's for lunch?\">\n        </div>\n      </div>\n      <div class=\"meal-card\" data-type=\"d\">\n        <div class=\"meal-icon\">🍝</div>\n        <div class=\"meal-content\">\n          <label>DINNER</label>\n          <input type=\"text\" id=\"input-d\" placeholder=\"What's for dinner?\">\n        </div>\n      </div>\n    </div>\n\n    <div class=\"day-actions\">\n      <button class=\"btn-clear-day\" id=\"btn-clear-day\">Clear Day</button>\n    </div>\n  </div>\n\n  <div class=\"view-container hidden\" id=\"view-week\">\n    <div class=\"week-grid\" id=\"week-grid\">\n      <!-- Days will be injected here -->\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Saved! ✨</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.meal-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    position: relative;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.header-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.view-toggle {\n    display: flex;\n    background: var(--background-primary);\n    padding: 4px;\n    border-radius: 10px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.btn-toggle {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    padding: 4px 12px;\n    border-radius: 6px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-toggle.active {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n}\n\n.view-container {\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    animation: fadeIn 0.3s ease;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(5px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.day-selector {\n    display: flex;\n    justify-content: space-between;\n    gap: 4px;\n}\n\n.day-btn {\n    flex: 1;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    padding: 8px 0;\n    border-radius: 8px;\n    font-size: 0.65rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.day-btn.active {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    border-color: var(--interactive-accent);\n    transform: translateY(-2px);\n}\n\n.meal-inputs {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.meal-card {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    padding: 12px 16px;\n    transition: all 0.2s;\n}\n.meal-card:focus-within {\n    border-color: var(--interactive-accent);\n    box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.1);\n}\n\n.meal-icon {\n    font-size: 1.5rem;\n}\n\n.meal-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.meal-content label {\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    letter-spacing: 0.05em;\n}\n\n.meal-content input {\n    background: transparent;\n    border: none;\n    color: var(--text-normal);\n    font-size: 0.95rem;\n    font-weight: 500;\n    padding: 0;\n    outline: none;\n    width: 100%;\n}\n\n.day-actions {\n    display: flex;\n    justify-content: flex-end;\n}\n\n.btn-clear-day {\n    background: transparent;\n    border: none;\n    color: var(--text-error);\n    font-size: 0.7rem;\n    font-weight: 600;\n    cursor: pointer;\n    opacity: 0.7;\n    transition: opacity 0.2s;\n}\n.btn-clear-day:hover { opacity: 1; }\n\n.week-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n    gap: 10px;\n}\n\n.week-day-card {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 14px;\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.week-day-name {\n    font-size: 0.7rem;\n    font-weight: 800;\n    color: var(--interactive-accent);\n    text-transform: uppercase;\n    border-bottom: 1px solid var(--background-modifier-border);\n    padding-bottom: 4px;\n    margin-bottom: 2px;\n}\n\n.week-meal-item {\n    display: flex;\n    gap: 6px;\n    align-items: center;\n    font-size: 0.75rem;\n    color: var(--text-normal);\n}\n\n.week-meal-item span {\n    font-size: 0.8rem;\n    opacity: 0.8;\n}\n\n.week-meal-text {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    opacity: 0.9;\n}\n\n.week-meal-empty {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    font-style: italic;\n}\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }\n\n.hidden { display: none !important; }",
      "js": "const { root, saveState, getState } = api;\n\nconst DAYS = ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'];\n\nlet state = {\n    currentDay: 0,\n    view: 'day', // 'day' or 'week'\n    plan: [\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' },\n        { b: '', l: '', d: '' }\n    ]\n};\n\nfunction render() {\n    const viewDay = root.getElementById('view-day');\n    const viewWeek = root.getElementById('view-week');\n    const btnDay = root.getElementById('btn-view-day');\n    const btnWeek = root.getElementById('btn-view-week');\n\n    if (state.view === 'day') {\n        viewDay.classList.remove('hidden');\n        viewWeek.classList.add('hidden');\n        btnDay.classList.add('active');\n        btnWeek.classList.remove('active');\n        renderDayView();\n    } else {\n        viewDay.classList.add('hidden');\n        viewWeek.classList.remove('hidden');\n        btnDay.classList.remove('active');\n        btnWeek.classList.add('active');\n        renderWeekView();\n    }\n}\n\nfunction renderDayView() {\n    const dayBtns = root.querySelectorAll('.day-btn');\n    dayBtns.forEach((btn, idx) => {\n        btn.classList.toggle('active', idx === state.currentDay);\n    });\n\n    const dayPlan = state.plan[state.currentDay];\n    root.getElementById('input-b').value = dayPlan.b;\n    root.getElementById('input-l').value = dayPlan.l;\n    root.getElementById('input-d').value = dayPlan.d;\n}\n\nfunction renderWeekView() {\n    const grid = root.getElementById('week-grid');\n    grid.innerHTML = '';\n\n    state.plan.forEach((day, idx) => {\n        const card = document.createElement('div');\n        card.className = 'week-day-card';\n        \n        let content = `<div class=\"week-day-name\">${DAYS[idx]}</div>`;\n        \n        const meals = [\n            { icon: '🍳', text: day.b },\n            { icon: '🍱', text: day.l },\n            { icon: '🍝', text: day.d }\n        ];\n\n        let hasAnyMeal = false;\n        meals.forEach(m => {\n            if (m.text) {\n                hasAnyMeal = true;\n                content += `\n                    <div class=\"week-meal-item\">\n                        <span>${m.icon}</span>\n                        <div class=\"week-meal-text\">${m.text}</div>\n                    </div>`;\n            }\n        });\n\n        if (!hasAnyMeal) {\n            content += `<div class=\"week-meal-empty\">No meals planned</div>`;\n        }\n\n        card.innerHTML = content;\n        card.onclick = () => {\n            state.currentDay = idx;\n            state.view = 'day';\n            render();\n        };\n        grid.appendChild(card);\n    });\n}\n\nfunction handleInput(type, val) {\n    state.plan[state.currentDay][type] = val;\n    save();\n}\n\nfunction clearDay() {\n    state.plan[state.currentDay] = { b: '', l: '', d: '' };\n    save();\n    render();\n    showToast('Day cleared! 🧹');\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        // Migration check: if saved is just the plan array\n        if (Array.isArray(saved)) state.plan = saved;\n        else Object.assign(state, saved);\n    }\n\n    // Event Listeners\n    root.getElementById('btn-view-day').onclick = () => { state.view = 'day'; render(); };\n    root.getElementById('btn-view-week').onclick = () => { state.view = 'week'; render(); };\n    \n    root.querySelectorAll('.day-btn').forEach((btn, idx) => {\n        btn.onclick = () => { state.currentDay = idx; render(); };\n    });\n\n    root.getElementById('input-b').oninput = (e) => handleInput('b', e.target.value);\n    root.getElementById('input-l').oninput = (e) => handleInput('l', e.target.value);\n    root.getElementById('input-d').oninput = (e) => handleInput('d', e.target.value);\n    \n    root.getElementById('btn-clear-day').onclick = clearDay;\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "mindful-breathing",
      "title": "Mindful Breathing",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"zen-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🧘 Zen Studio Pro</h4>\n    <select id=\"exercise-select\" class=\"exercise-select\">\n      <option value=\"box\">Box Breathing (4-4-4-4)</option>\n      <option value=\"478\">Relaxing (4-7-8)</option>\n      <option value=\"calm\">Calm (4-8)</option>\n      <option value=\"equal\">Equal (5-5)</option>\n    </select>\n  </div>\n\n  <div class=\"breathing-viewport\">\n    <div class=\"breathing-glow\" id=\"breathing-glow\"></div>\n    <div class=\"circle-outer\">\n      <div class=\"circle-inner\" id=\"breathing-circle\"></div>\n    </div>\n    <div class=\"instruction-container\">\n      <div class=\"phase-text\" id=\"instruction\">Ready?</div>\n      <div class=\"timer-text\" id=\"timer-text\">0</div>\n    </div>\n  </div>\n\n  <div class=\"controls\">\n    <button class=\"btn-main\" id=\"btn-breath\">START SESSION</button>\n    <button class=\"btn-reset\" id=\"btn-reset\">Reset Stats</button>\n  </div>\n\n  <div class=\"stats-panel\">\n    <div class=\"stat-item\">\n      <span class=\"stat-label\">TOTAL PRACTICE</span>\n      <span class=\"stat-value\" id=\"session-info\">0:00</span>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.zen-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 28px;\n    padding: 2rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.2em;\n    color: var(--text-muted);\n}\n\n.exercise-select {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px 16px;\n    border-radius: 12px;\n    font-size: 0.85rem;\n    font-weight: 600;\n    outline: none;\n    cursor: pointer;\n    width: 100%;\n    max-width: 240px;\n}\n\n.breathing-viewport {\n    position: relative;\n    height: 240px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin: 1rem 0;\n}\n\n.breathing-glow {\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    border-radius: 50%;\n    background: var(--breath-color, #10b981);\n    filter: blur(60px);\n    opacity: 0.15;\n    transition: background 1.5s ease, transform 1.5s ease;\n    z-index: 0;\n}\n\n.circle-outer {\n    width: 200px;\n    height: 200px;\n    border-radius: 50%;\n    border: 2px solid var(--background-modifier-border);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n}\n\n.circle-inner {\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: var(--breath-color, #10b981);\n    box-shadow: 0 0 30px var(--breath-color, #10b981);\n    transition: width var(--breath-duration, 4s) ease-in-out, \n                height var(--breath-duration, 4s) ease-in-out, \n                background 1.5s ease, \n                box-shadow 1.5s ease;\n}\n\n.instruction-container {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    z-index: 2;\n    pointer-events: none;\n}\n\n.phase-text {\n    font-size: 1.5rem;\n    font-weight: 800;\n    color: var(--text-normal);\n    text-shadow: 0 2px 10px rgba(0,0,0,0.2);\n}\n\n.timer-text {\n    font-size: 0.9rem;\n    font-weight: 700;\n    color: var(--text-muted);\n    opacity: 0.8;\n}\n\n.controls {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    align-items: center;\n}\n\n.btn-main {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 14px 48px;\n    border-radius: 100px;\n    font-weight: 800;\n    font-size: 0.9rem;\n    letter-spacing: 0.05em;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    box-shadow: 0 4px 15px rgba(var(--interactive-accent-rgb), 0.3);\n}\n.btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(var(--interactive-accent-rgb), 0.4); }\n.btn-main.active { background: var(--background-modifier-error); box-shadow: 0 4px 15px rgba(var(--text-error-rgb), 0.3); }\n\n.btn-reset {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    font-size: 0.7rem;\n    font-weight: 600;\n    text-decoration: underline;\n    cursor: pointer;\n    opacity: 0.6;\n}\n.btn-reset:hover { opacity: 1; }\n\n.stats-panel {\n    background: var(--background-primary);\n    border-radius: 16px;\n    padding: 12px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.stat-item {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.stat-label {\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    letter-spacing: 0.1em;\n}\n\n.stat-value {\n    font-size: 1.1rem;\n    font-weight: 700;\n    color: var(--text-normal);\n}",
      "js": "const { root, saveState, getState } = api;\n\nconst EXERCISES = {\n    box: { name: 'Box Breathing', inhale: 4, hold1: 4, exhale: 4, hold2: 4 },\n    '478': { name: 'Relaxing', inhale: 4, hold1: 7, exhale: 8, hold2: 0 },\n    calm: { name: 'Calm', inhale: 4, hold1: 0, exhale: 8, hold2: 0 },\n    equal: { name: 'Equal', inhale: 5, hold1: 0, exhale: 5, hold2: 0 }\n};\n\nconst COLORS = {\n    green: '#10b981',\n    blue: '#0ea5e9',\n    violet: '#8b5cf6'\n};\n\nlet isBreathing = false;\nlet totalTime = 0;\nlet currentExercise = 'box';\nlet timerId = null;\nlet sessionStartTime = null;\nlet countdownInterval = null;\n\nfunction renderStats() {\n    const mins = Math.floor(totalTime / 60);\n    const secs = totalTime % 60;\n    root.getElementById('session-info').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n}\n\nfunction setBreathStyle(size, color, duration) {\n    const circle = root.getElementById('breathing-circle');\n    const glow = root.getElementById('breathing-glow');\n    \n    root.host.style.setProperty('--breath-color', color);\n    root.host.style.setProperty('--breath-duration', `${duration}s`);\n    \n    circle.style.width = `${size}px`;\n    circle.style.height = `${size}px`;\n    glow.style.transform = `scale(${size / 60})`;\n}\n\nfunction updateTimer(seconds) {\n    const timerEl = root.getElementById('timer-text');\n    let current = seconds;\n    timerEl.innerText = current;\n    \n    if (countdownInterval) clearInterval(countdownInterval);\n    countdownInterval = setInterval(() => {\n        current--;\n        if (current >= 0) timerEl.innerText = current;\n        else clearInterval(countdownInterval);\n    }, 1000);\n}\n\nasync function cycle() {\n    if (!isBreathing) return;\n\n    const ex = EXERCISES[currentExercise];\n    const instruction = root.getElementById('instruction');\n\n    // INHALE\n    instruction.innerText = 'Inhale';\n    setBreathStyle(180, COLORS.blue, ex.inhale);\n    updateTimer(ex.inhale);\n    await wait(ex.inhale * 1000);\n    if (!isBreathing) return;\n\n    // HOLD 1\n    if (ex.hold1 > 0) {\n        instruction.innerText = 'Hold';\n        setBreathStyle(180, COLORS.violet, 0.5);\n        updateTimer(ex.hold1);\n        await wait(ex.hold1 * 1000);\n        if (!isBreathing) return;\n    }\n\n    // EXHALE\n    instruction.innerText = 'Exhale';\n    setBreathStyle(60, COLORS.green, ex.exhale);\n    updateTimer(ex.exhale);\n    await wait(ex.exhale * 1000);\n    if (!isBreathing) return;\n\n    // HOLD 2\n    if (ex.hold2 > 0) {\n        instruction.innerText = 'Hold';\n        setBreathStyle(60, COLORS.violet, 0.5);\n        updateTimer(ex.hold2);\n        await wait(ex.hold2 * 1000);\n        if (!isBreathing) return;\n    }\n\n    cycle();\n}\n\nfunction wait(ms) {\n    return new Promise(resolve => {\n        timerId = setTimeout(resolve, ms);\n    });\n}\n\nfunction toggleBreathing() {\n    const btn = root.getElementById('btn-breath');\n    if (isBreathing) {\n        isBreathing = false;\n        btn.innerText = 'START SESSION';\n        btn.classList.remove('active');\n        root.getElementById('instruction').innerText = 'Ready?';\n        root.getElementById('timer-text').innerText = '0';\n        setBreathStyle(60, COLORS.green, 1);\n        \n        clearTimeout(timerId);\n        clearInterval(countdownInterval);\n        \n        const duration = Math.floor((Date.now() - sessionStartTime) / 1000);\n        totalTime += duration;\n        renderStats();\n        save();\n    } else {\n        isBreathing = true;\n        sessionStartTime = Date.now();\n        btn.innerText = 'STOP SESSION';\n        btn.classList.add('active');\n        currentExercise = root.getElementById('exercise-select').value;\n        cycle();\n    }\n}\n\nfunction resetStats() {\n    totalTime = 0;\n    renderStats();\n    save();\n}\n\nfunction save() {\n    saveState({ totalTime });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) totalTime = saved.totalTime || 0;\n\n    root.getElementById('btn-breath').onclick = toggleBreathing;\n    root.getElementById('btn-reset').onclick = resetStats;\n    \n    renderStats();\n    setBreathStyle(60, COLORS.green, 1);\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "mini-plotter",
      "title": "Mini Plotter",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"plot-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">📈 Plot Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button class=\"btn-icon\" id=\"btn-edit-toggle\" title=\"Toggle Edit Mode\">⚙️</button>\n      <button class=\"btn-icon\" id=\"btn-clear\" title=\"Clear Data\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"chart-container\">\n    <svg id=\"sparkline\" viewBox=\"0 0 400 120\" preserveAspectRatio=\"none\">\n      <defs>\n        <linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n          <stop offset=\"0%\" stop-color=\"var(--interactive-accent)\" stop-opacity=\"0.3\" />\n          <stop offset=\"100%\" stop-color=\"var(--interactive-accent)\" stop-opacity=\"0\" />\n        </linearGradient>\n      </defs>\n      <path id=\"area-path\" d=\"\" fill=\"url(#gradient)\" />\n      <path id=\"line-path\" d=\"\" fill=\"none\" stroke=\"var(--interactive-accent)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <g id=\"points-group\"></g>\n    </svg>\n    <div class=\"chart-overlay\" id=\"chart-overlay\">Enter data below to visualize</div>\n  </div>\n\n  <div class=\"input-section\">\n    <div class=\"input-group\">\n      <label>DATA POINTS (COMMA SEPARATED)</label>\n      <textarea id=\"data-input\" placeholder=\"Ex: 10, 25, 15, 40, 35, 50, 45, 60\" spellcheck=\"false\"></textarea>\n    </div>\n  </div>\n\n  <div class=\"stats-grid\">\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">MIN</span>\n      <span class=\"stat-value\" id=\"stat-min\">-</span>\n    </div>\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">MAX</span>\n      <span class=\"stat-value\" id=\"stat-max\">-</span>\n    </div>\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">AVG</span>\n      <span class=\"stat-value\" id=\"stat-avg\">-</span>\n    </div>\n    <div class=\"stat-card\">\n      <span class=\"stat-label\">COUNT</span>\n      <span class=\"stat-value\" id=\"stat-count\">0</span>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.plot-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); }\n\n.chart-container {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 16px;\n    height: 160px;\n    position: relative;\n    overflow: hidden;\n    padding: 10px 0;\n}\n\nsvg {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.chart-overlay {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 0.75rem;\n    color: var(--text-muted);\n    font-weight: 600;\n    pointer-events: none;\n    text-align: center;\n    width: 80%;\n}\n\n.input-section {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.input-group label {\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    letter-spacing: 0.05em;\n}\n\ntextarea {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 12px;\n    border-radius: 12px;\n    font-size: 0.9rem;\n    font-family: var(--font-monospace);\n    min-height: 80px;\n    resize: vertical;\n    outline: none;\n    transition: border-color 0.2s;\n}\ntextarea:focus {\n    border-color: var(--interactive-accent);\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 8px;\n}\n\n.stat-card {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 10px 6px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n}\n\n.stat-label {\n    font-size: 0.55rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    text-transform: uppercase;\n}\n\n.stat-value {\n    font-size: 0.9rem;\n    font-weight: 700;\n    color: var(--text-normal);\n}\n\n.hidden { display: none !important; }",
      "js": "const { root, saveState, getState } = api;\n\nconst COLORS = [\n    '#0ea5e9', // Blue\n    '#10b981', // Green\n    '#f59e0b', // Amber\n    '#ef4444', // Red\n    '#8b5cf6', // Violet\n    '#ec4899'  // Pink\n];\n\nlet state = {\n    data: '',\n    isEditing: true\n};\n\nfunction draw() {\n    const input = root.getElementById('data-input');\n    const overlay = root.getElementById('chart-overlay');\n    const lineGroup = root.getElementById('line-path').parentElement;\n    const pointsGroup = root.getElementById('points-group');\n    const areaPath = root.getElementById('area-path');\n\n    // Clear previous lines\n    const existingLines = lineGroup.querySelectorAll('.dynamic-line');\n    existingLines.forEach(l => l.remove());\n    areaPath.setAttribute('d', '');\n    pointsGroup.innerHTML = '';\n\n    const lines = state.data.split('\\n')\n        .map(line => line.split(/[\\s,]+/)\n            .map(n => parseFloat(n.trim()))\n            .filter(n => !isNaN(n)))\n        .filter(series => series.length >= 2);\n\n    if (lines.length === 0) {\n        overlay.classList.remove('hidden');\n        updateStats(null);\n        return;\n    }\n\n    overlay.classList.add('hidden');\n\n    // Find global min/max for scaling\n    const allValues = lines.flat();\n    const min = Math.min(...allValues);\n    const max = Math.max(...allValues);\n    const range = max - min || 1;\n    const width = 400;\n    const height = 120;\n    const padding = 15;\n\n    lines.forEach((series, sIdx) => {\n        const color = COLORS[sIdx % COLORS.length];\n        const points = series.map((val, i) => {\n            const x = (i / (series.length - 1)) * width;\n            const y = height - ((val - min) / range) * (height - padding * 2) - padding;\n            return { x, y };\n        });\n\n        const d = `M ${points[0].x},${points[0].y} ` + points.slice(1).map(p => `L ${p.x},${p.y}`).join(' ');\n        \n        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        path.setAttribute('d', d);\n        path.setAttribute('fill', 'none');\n        path.setAttribute('stroke', color);\n        path.setAttribute('stroke-width', '3');\n        path.setAttribute('stroke-linecap', 'round');\n        path.setAttribute('stroke-linejoin', 'round');\n        path.classList.add('dynamic-line');\n        lineGroup.appendChild(path);\n\n        // Area for the first line only for aesthetic\n        if (sIdx === 0) {\n            const areaD = `${d} L ${points[points.length - 1].x},${height} L ${points[0].x},${height} Z`;\n            areaPath.setAttribute('d', areaD);\n            root.host.style.setProperty('--interactive-accent', color);\n        }\n\n        // Draw points\n        points.forEach(p => {\n            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n            circle.setAttribute('cx', p.x);\n            circle.setAttribute('cy', p.y);\n            circle.setAttribute('r', '3');\n            circle.setAttribute('fill', 'var(--background-primary)');\n            circle.setAttribute('stroke', color);\n            circle.setAttribute('stroke-width', '2');\n            pointsGroup.appendChild(circle);\n        });\n    });\n\n    updateStats(allValues);\n}\n\nfunction updateStats(data) {\n    const minEl = root.getElementById('stat-min');\n    const maxEl = root.getElementById('stat-max');\n    const avgEl = root.getElementById('stat-avg');\n    const countEl = root.getElementById('stat-count');\n\n    if (!data || data.length === 0) {\n        minEl.innerText = '-';\n        maxEl.innerText = '-';\n        avgEl.innerText = '-';\n        countEl.innerText = '0';\n        return;\n    }\n\n    const min = Math.min(...data);\n    const max = Math.max(...data);\n    const avg = data.reduce((a, b) => a + b, 0) / data.length;\n\n    minEl.innerText = min.toLocaleString();\n    maxEl.innerText = max.toLocaleString();\n    avgEl.innerText = avg.toFixed(1);\n    countEl.innerText = data.length;\n}\n\nfunction toggleEdit() {\n    state.isEditing = !state.isEditing;\n    const inputSection = root.querySelector('.input-section');\n    const editBtn = root.getElementById('btn-edit-toggle');\n    \n    if (state.isEditing) {\n        inputSection.classList.remove('hidden');\n        editBtn.classList.add('active');\n    } else {\n        inputSection.classList.add('hidden');\n        editBtn.classList.remove('active');\n    }\n    save();\n}\n\nfunction clearData() {\n    state.data = '';\n    root.getElementById('data-input').value = '';\n    draw();\n    save();\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const input = root.getElementById('data-input');\n    const saved = await getState();\n    \n    if (saved) {\n        if (typeof saved === 'string') state.data = saved;\n        else Object.assign(state, saved);\n    }\n\n    input.value = state.data;\n    \n    // Initial UI state\n    const inputSection = root.querySelector('.input-section');\n    const editBtn = root.getElementById('btn-edit-toggle');\n    if (state.isEditing) {\n        inputSection.classList.remove('hidden');\n        editBtn.classList.add('active');\n    } else {\n        inputSection.classList.add('hidden');\n        editBtn.classList.remove('active');\n    }\n\n    input.oninput = (e) => {\n        state.data = e.target.value;\n        draw();\n    };\n\n    input.onblur = () => {\n        save();\n    };\n\n    root.getElementById('btn-clear').onclick = clearData;\n    root.getElementById('btn-edit-toggle').onclick = toggleEdit;\n\n    draw();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "photo-gallery",
      "title": "Photo Gallery",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"gallery-container\" id=\"gallery-root\" style=\"position: relative; resize: both; overflow: auto; height: 100%;\">\n  <div class=\"gallery-header\">\n    <div class=\"header-main\">\n      <div class=\"layout-toggle-mini\">\n        <button id=\"btn-layout-square\" title=\"Square Grid\">\n          <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\"><rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect></svg>\n        </button>\n        <button id=\"btn-layout-justified\" title=\"Justified Layout\">\n          <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"7\"></rect><rect x=\"3\" y=\"14\" width=\"10\" height=\"7\"></rect><rect x=\"15\" y=\"14\" width=\"6\" height=\"7\"></rect></svg>\n        </button>\n      </div>\n      \n      <div class=\"search-wrapper\" id=\"search-wrapper\">\n        <div class=\"search-icon-btn\" id=\"btn-search-toggle\">\n           <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line></svg>\n        </div>\n        <input type=\"text\" id=\"gal-search\" placeholder=\"Search...\" autocomplete=\"off\">\n        <button id=\"btn-clear-search\" class=\"clear-btn\">\n          <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\n        </button>\n      </div>\n    </div>\n\n    <div class=\"header-controls\">\n      <div class=\"control-group\">\n        <div class=\"sort-wrapper\">\n           <button id=\"btn-sort\" class=\"icon-btn\" title=\"Sort By\">\n             <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><polyline points=\"19 12 12 19 5 12\"></polyline></svg>\n           </button>\n           <div id=\"sort-popup\" class=\"folder-popup sort-popup\">\n              <div class=\"sort-option\" data-val=\"mtime-desc\">Date (Newest)</div>\n              <div class=\"sort-option\" data-val=\"mtime-asc\">Date (Oldest)</div>\n              <div class=\"sort-option\" data-val=\"ctime-desc\">Created (Newest)</div>\n              <div class=\"sort-option\" data-val=\"name-asc\">Name (A-Z)</div>\n              <div class=\"sort-option\" data-val=\"size-desc\">Size (Largest)</div>\n           </div>\n        </div>\n\n        <div class=\"folder-wrapper\">\n          <button id=\"btn-folders\" class=\"icon-btn\" title=\"Filter Folders\">\n            <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"></path></svg>\n          </button>\n          <div id=\"folder-popup\" class=\"folder-popup\">\n             <div class=\"popup-header\">\n               <input type=\"text\" id=\"folder-search\" placeholder=\"Filter folders...\" class=\"folder-search-input\">\n               <label class=\"checkbox-label\">\n                 <input type=\"checkbox\" id=\"opt-include-all\"> All Vault\n               </label>\n             </div>\n             <div id=\"folder-list\" class=\"folder-list\"></div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"separator\"></div>\n\n      <button id=\"btn-toggle-names\" class=\"icon-btn\" title=\"Toggle Filenames\">\n        <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 7V4h16v3M9 20h6M12 4v16\"></path></svg>\n      </button>\n      \n      <button id=\"btn-edit-mode\" class=\"icon-btn\" title=\"Edit Mode\">\n        <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path><path d=\"M18.5 2.5a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path></svg>\n      </button>\n\n      <div class=\"zoom-controls\">\n        <button id=\"btn-zoom-out\">−</button>\n        <input type=\"range\" id=\"zoom-slider\" min=\"50\" max=\"1000\" step=\"1\">\n        <button id=\"btn-zoom-in\">+</button>\n      </div>\n      \n      <button class=\"icon-btn\" id=\"btn-help\" title=\"Help & Shortcuts\">\n        <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line><line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line></svg>\n      </button>\n\n      <button class=\"icon-btn\" id=\"btn-fullscreen\" title=\"Toggle Fullscreen\">\n        <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"></path></svg>\n      </button>\n    </div>\n  </div>\n\n  <div class=\"edit-toolbar\" id=\"edit-toolbar\">\n    <div class=\"selection-info\"><span id=\"selection-count\">0</span> selected</div>\n    <div class=\"toolbar-actions\">\n      <button id=\"btn-add-to-note\" class=\"action-btn\">\n        <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline><line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"12\"></line><line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"></line></svg>\n        Add to Note\n      </button>\n      <button id=\"btn-copy-selection\" class=\"action-btn\">\n        <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>\n        Copy Links\n      </button>\n      <button id=\"btn-delete-selection\" class=\"action-btn danger\">\n        <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path></svg>\n        Delete\n      </button>\n      <button id=\"btn-cancel-edit\" class=\"action-btn secondary\">Cancel</button>\n    </div>\n  </div>\n\n  <div class=\"gallery-main\">\n    <canvas id=\"gallery-canvas\"></canvas>\n    <div id=\"date-scrubber\" class=\"date-scrubber\">\n      <div class=\"scrubber-track\" id=\"scrubber-track\"></div>\n    </div>\n  </div>\n\n  <div class=\"gallery-footer\">\n    <div class=\"resize-handle\">\n       <svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"22\" y1=\"2\" x2=\"2\" y2=\"22\"></line><line x1=\"22\" y1=\"12\" x2=\"12\" y2=\"22\"></line><line x1=\"22\" y1=\"22\" x2=\"22\" y2=\"22\"></line></svg>\n    </div>\n  </div>\n\n  <div id=\"lightbox\" class=\"lightbox\">\n    <button class=\"lightbox-nav prev\" id=\"btn-lb-prev\">❮</button>\n    <div class=\"lightbox-content\" id=\"lightbox-content\">\n      <img id=\"lightbox-img\" src=\"\" draggable=\"false\">\n    </div>\n    <button class=\"lightbox-nav next\" id=\"btn-lb-next\">❯</button>\n    <div class=\"lightbox-info\">\n      <span id=\"lightbox-name\"></span>\n      <span id=\"lightbox-meta\"></span>\n      <div class=\"lightbox-actions\">\n        <button id=\"btn-lb-copy\" class=\"lb-action-btn\" title=\"Copy Markdown Link\">\n          <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>\n          Copy Link\n        </button>\n      </div>\n    </div>\n    <button class=\"lightbox-close\">✕</button>\n    <div class=\"lightbox-hint\">Scroll to zoom • Drag to pan • Swipe/Arrows to navigate</div>\n  </div>\n\n  <div class=\"modal-overlay\" id=\"note-selector-modal\">\n    <div class=\"modal-box\">\n      <div class=\"modal-header\">\n        <span>Add to Note</span>\n        <button class=\"modal-close\" id=\"btn-close-note-modal\">✕</button>\n      </div>\n      <div class=\"modal-body\">\n        <input type=\"text\" id=\"note-search\" placeholder=\"Search notes...\" class=\"full-width-input\">\n        <div id=\"note-list\" class=\"note-list\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"modal-overlay\" id=\"help-modal\">\n    <div class=\"modal-box help-box\">\n      <div class=\"modal-header\">\n        <span>Gallery Guide & Shortcuts</span>\n        <button class=\"modal-close\" id=\"btn-close-help\">✕</button>\n      </div>\n      <div class=\"modal-body help-content\">\n        <div class=\"help-section\">\n          <h4>🖱️ Interactions</h4>\n          <ul>\n            <li><b>DOUBLE Click:</b> Open photo in Lightbox (fullscreen).</li>\n            <li><b>RIGHT Click:</b> Open photo (Alternative).</li>\n            <li><b>LEFT Click:</b> Select an image (when in Edit Mode).</li>\n            <li><b>Drag:</b> Scroll the gallery or pan a zoomed photo.</li>\n            <li><b>CTRL + Wheel:</b> Smoothly zoom the gallery grid size.</li>\n          </ul>\n        </div>\n        <div class=\"help-section\">\n          <h4>🖼️ Lightbox (Viewer)</h4>\n          <ul>\n            <li><b>Arrows / Swipe:</b> Navigate between photos.</li>\n            <li><b>Wheel:</b> Zoom in/out on the current photo.</li>\n            <li><b>Escape:</b> Close the viewer.</li>\n          </ul>\n        </div>\n        <div class=\"help-section\">\n          <h4>🛠️ Features</h4>\n          <ul>\n            <li><b>Folders:</b> Filter by folder with integrated search.</li>\n            <li><b>Sort:</b> Sort by date, name, or file size.</li>\n            <li><b>Layout:</b> Toggle Square or Justified (real size) modes, and show/hide names.</li>\n            <li><b>Edit Mode:</b> Delete selection, \"Add to Note\" (.md), or Copy markdown links.</li>\n            <li><b>Fullscreen:</b> Toggle fullscreen mode using the button in the header.</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ":host {\n  --gal-bg: var(--background-primary);\n  --gal-header: var(--background-secondary);\n  --gal-accent: var(--interactive-accent);\n  --gal-text: var(--text-normal);\n  --gal-muted: var(--text-muted);\n  --gal-border: var(--background-modifier-border);\n  --gal-radius: 12px;\n}\n\n.gallery-container {\n  width: 100%;\n  height: 100%;\n  background: var(--gal-bg);\n  border-radius: var(--gal-radius);\n  border: 1px solid var(--gal-border);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  position: relative;\n  font-family: var(--font-interface);\n  resize: both;\n  min-height: 250px;\n  min-width: 300px;\n}\n\n.gallery-header {\n  padding: 8px 12px;\n  background: var(--gal-header);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid var(--gal-border);\n  z-index: 10;\n  gap: 15px;\n  flex-shrink: 0;\n  height: 46px;\n  transition: all 0.2s;\n}\n\n.gallery-footer {\n  height: 8px;\n  background: var(--gal-header);\n  border-top: 1px solid var(--gal-border);\n  flex-shrink: 0;\n  border-radius: 0 0 var(--gal-radius) var(--gal-radius);\n  position: relative;\n  display: flex;\n  justify-content: flex-end;\n  align-items: flex-end;\n  cursor: ns-resize;\n}\n\n.resize-handle {\n  color: var(--gal-muted);\n  padding: 0 2px 0 0;\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.header-main {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  min-width: 0;\n}\n\n.layout-toggle-mini {\n  display: flex; background: var(--background-primary-alt); padding: 2px; border-radius: 6px; border: 1px solid var(--gal-border); flex-shrink: 0;\n}\n\n.layout-toggle-mini button {\n  background: none; border: none; color: var(--gal-muted); cursor: pointer; padding: 4px; border-radius: 4px; display: flex; transition: all 0.2s;\n}\n\n.layout-toggle-mini button.active { background: var(--gal-accent); color: white; }\n\n.search-wrapper {\n  background: var(--background-primary-alt); border: 1px solid var(--gal-border); border-radius: 6px; padding: 4px 10px; display: flex; align-items: center; gap: 8px; color: var(--gal-muted); transition: all 0.2s; flex: 1; max-width: 400px; position: relative;\n}\n\n.search-wrapper:focus-within { border-color: var(--gal-accent); box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.1); }\n.search-wrapper input { background: none; border: none; color: var(--gal-text); font-size: 0.85rem; width: 100%; outline: none; padding: 2px 0; transition: all 0.2s; }\n.search-icon-btn { display: flex; align-items: center; justify-content: center; }\n\n.clear-btn {\n  background: none; border: none; color: var(--gal-muted); cursor: pointer; padding: 2px; display: none; align-items: center; justify-content: center; border-radius: 50%;\n}\n.clear-btn:hover { background: var(--background-modifier-hover); color: var(--gal-text); }\n.search-wrapper input:not(:placeholder-shown) + .clear-btn { display: flex; }\n\n/* Compact Mode Styles */\n.gallery-container.compact .search-wrapper {\n    flex: 0 0 auto;\n    padding: 6px;\n    border-radius: 6px;\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n.gallery-container.compact .search-wrapper:hover { background: var(--background-modifier-hover); color: var(--gal-text); }\n.gallery-container.compact .search-wrapper input {\n    display: none;\n}\n/* Expanded search in compact mode */\n.gallery-container.compact .search-wrapper.expanded {\n    position: absolute;\n    left: 4px;\n    top: 4px;\n    bottom: 4px;\n    z-index: 50;\n    width: 250px;\n    max-width: 80vw;\n    background: var(--background-primary-alt);\n    border: 1px solid var(--gal-accent);\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n}\n.gallery-container.compact .search-wrapper.expanded input {\n    display: block;\n}\n\n.gallery-container.compact .zoom-controls input {\n    display: none;\n}\n.gallery-container.compact .header-main { gap: 4px; }\n.gallery-container.compact .header-controls { gap: 4px; }\n\n.header-controls {\n  display: flex; align-items: center; gap: 8px; flex-shrink: 0;\n}\n\n.control-group {\n  display: flex; align-items: center; gap: 4px;\n  background: var(--background-primary-alt);\n  padding: 3px 6px;\n  border-radius: 8px;\n  border: 1px solid var(--gal-border);\n}\n\n.sort-wrapper { position: relative; }\n.sort-popup { width: 160px; right: auto; left: 0; }\n.sort-option { padding: 6px 10px; cursor: pointer; font-size: 0.8rem; border-radius: 4px; }\n.sort-option:hover { background: var(--background-modifier-hover); }\n.sort-option.active { color: var(--gal-accent); font-weight: bold; background: rgba(var(--interactive-accent-rgb), 0.1); }\n\n.folder-wrapper { position: relative; }\n.folder-popup {\n  position: absolute; top: 100%; right: 0; margin-top: 8px; width: 280px; background: var(--gal-bg); border: 1px solid var(--gal-border); border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 100; display: none; flex-direction: column; overflow: hidden;\n}\n.folder-popup.active { display: flex; }\n.popup-header { padding: 8px 10px; border-bottom: 1px solid var(--gal-border); background: var(--gal-header); font-size: 0.8rem; font-weight: 600; display: flex; flex-direction: column; gap: 8px; }\n.folder-search-input { width: 100%; background: var(--background-primary); border: 1px solid var(--gal-border); padding: 4px 8px; border-radius: 4px; color: var(--gal-text); font-size: 0.8rem; }\n.folder-list { max-height: 250px; overflow-y: auto; padding: 5px; }\n.folder-item { display: flex; align-items: center; gap: 8px; padding: 6px 8px; font-size: 0.8rem; border-radius: 4px; cursor: pointer; }\n.folder-item:hover { background: var(--background-modifier-hover); }\n.folder-item.selected { background: rgba(var(--interactive-accent-rgb), 0.1); color: var(--gal-accent); font-weight: 600; }\n\n.separator { width: 1px; height: 20px; background: var(--gal-border); margin: 0 4px; }\n\n.icon-btn {\n  background: none; border: none; color: var(--gal-muted); cursor: pointer; padding: 6px; border-radius: 6px; display: flex; transition: all 0.2s;\n}\n.icon-btn:hover { background: var(--background-modifier-hover); color: var(--gal-text); }\n.icon-btn.active { background: var(--gal-accent); color: white; }\n\n.zoom-controls {\n  display: flex; align-items: center; gap: 4px; background: var(--background-primary-alt); padding: 2px 8px; border-radius: 20px; border: 1px solid var(--gal-border);\n}\n.zoom-controls input { width: 120px; accent-color: var(--gal-accent); }\n.zoom-controls button { background: none; border: none; color: var(--gal-text); cursor: pointer; font-weight: bold; font-size: 1.1rem; padding: 0 6px; }\n.zoom-controls button:hover { color: var(--gal-accent); }\n\n.edit-toolbar {\n  position: absolute; top: 60px; left: 50%; transform: translateX(-50%); background: var(--gal-accent); color: white; padding: 8px 20px; border-radius: 30px; display: none; align-items: center; gap: 20px; z-index: 20; box-shadow: 0 10px 30px rgba(0,0,0,0.3); font-size: 0.85rem; font-weight: 600;\n}\n.edit-toolbar.active { display: flex; }\n.toolbar-actions { display: flex; gap: 10px; }\n.action-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.75rem; transition: all 0.2s; }\n.action-btn:hover { background: rgba(255,255,255,0.3); }\n.action-btn.danger:hover { background: #ff4444; }\n\n.gallery-main {\n  flex: 1; display: flex; position: relative; overflow: hidden; background: #000;\n}\n#gallery-canvas { flex: 1; width: 100%; height: 100%; cursor: grab; touch-action: none; }\n#gallery-canvas:active { cursor: grabbing; }\n\n.lightbox {\n  position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: none; z-index: 10000; flex-direction: column; overflow: hidden;\n}\n.lightbox-content {\n  flex: 1; display: flex; align-items: center; justify-content: center; cursor: grab; overflow: hidden; position: relative; touch-action: none;\n}\n#lightbox-img {\n  width: 100%; height: 100%; object-fit: contain; box-shadow: 0 0 50px rgba(0,0,0,0.5); transform-origin: center; transition: transform 0.1s ease-out; pointer-events: none; user-select: none; -webkit-user-select: none;\n}\n.lightbox-info {\n  padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); text-align: center; color: white; z-index: 10;\n}\n.lightbox-close {\n  position: absolute; top: 30px; right: 30px; background: rgba(0,0,0,0.5); border: none; color: white; font-size: 1.5rem; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; z-index: 100; display: flex; align-items: center; justify-content: center; transition: all 0.2s;\n}\n.lightbox-nav {\n  position: absolute; top: 50%; transform: translateY(-50%);\n  background: rgba(0,0,0,0.2); color: rgba(255,255,255,0.7); border: none;\n  font-size: 3rem; padding: 20px; cursor: pointer; z-index: 100;\n  transition: all 0.2s; border-radius: 50%; width: 60px; height: 60px;\n  display: flex; align-items: center; justify-content: center;\n}\n.lightbox-nav:hover { background: rgba(255,255,255,0.2); color: white; }\n.lightbox-nav.prev { left: 20px; }\n.lightbox-nav.next { right: 20px; }\n\n.modal-overlay {\n  position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: none; z-index: 200; justify-content: center; align-items: center;\n}\n.modal-box {\n  background: var(--gal-bg); width: 400px; max-width: 90%; border-radius: 12px; border: 1px solid var(--gal-border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden; display: flex; flex-direction: column;\n}\n.modal-header {\n  padding: 12px 16px; background: var(--gal-header); display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: var(--gal-text); border-bottom: 1px solid var(--gal-border);\n}\n.modal-close { background: none; border: none; color: var(--gal-muted); cursor: pointer; font-size: 1.2rem; }\n.modal-body { padding: 16px; display: flex; flex-direction: column; gap: 12px; }\n.full-width-input { width: 100%; padding: 8px; border: 1px solid var(--gal-border); border-radius: 6px; background: var(--background-primary); color: var(--gal-text); }\n.note-list { max-height: 200px; overflow-y: auto; border: 1px solid var(--gal-border); border-radius: 6px; display: none; }\n.note-list.active { display: block; }\n.note-item { padding: 8px; cursor: pointer; font-size: 0.9rem; border-bottom: 1px solid var(--gal-border); }\n.note-item:hover { background: var(--background-modifier-hover); }\n\n.help-box { width: 450px; }\n.help-content { font-size: 0.85rem; line-height: 1.4; color: var(--gal-text); }\n.help-section h4 { margin: 12px 0 6px 0; color: var(--gal-accent); border-bottom: 1px solid var(--gal-border); padding-bottom: 4px; }\n.help-section ul { margin: 0; padding-left: 20px; }\n.help-section li { margin-bottom: 4px; }\n",
      "js": "var root = api.root;\nvar app = window.app || api.app;\nvar canvas = root.getElementById('gallery-canvas');\nvar ctx = canvas.getContext('2d', { alpha: false });\nvar state = {\n  allImages: [],\n  filteredImages: [],\n  settings: {\n    folders: [],\n    includeAll: true,\n    sortBy: 'mtime-desc',\n    zoom: 200,\n    layout: 'justified',\n    height: 600,\n    search: '',\n    showNames: false\n  },\n  scroll: 0,\n  targetScroll: 0,\n  isDragging: false,\n  isPointerDown: false,\n  startY: 0,\n  startScroll: 0,\n  hasMoved: false,\n  selection: new Set(),\n  lastMouseY: 0,\n  rowHeight: 200,\n  gap: 10,\n  cache: new Map(),\n  layoutData: [],\n  currentIndex: 0,\n  folderSearch: '',\n  velocity: 0,\n  lastY: 0,\n  lastTime: 0\n};\n\nvar lbState = { zoom: 1, x: 0, y: 0, isDragging: false, lastX: 0, lastY: 0, startX: 0 };\nvar saveTimeout;\n\nasync function init() {\n  var saved = await api.getState();\n  if (saved && saved.settings) state.settings = Object.assign(state.settings, saved.settings);\n  if (state.settings.zoom < 10) state.settings.zoom = [100, 150, 200, 250, 300, 400][state.settings.zoom - 1] || 200;\n  if (saved && (saved.allImages || saved.layoutData)) save(false);\n  \n  // Restore saved dimensions (data)\n  var el = root.getElementById('gallery-root');\n  if (state.settings.height) el.style.height = state.settings.height + 'px';\n  if (state.settings.width) el.style.width = state.settings.width + 'px';\n  \n  setupUI();\n  await refreshGallery();\n  setupEventListeners();\n  setupResizeObserver();\n  requestAnimationFrame(loop);\n  \n  if (state.settings.search) {\n    var input = root.getElementById('gal-search');\n    input.focus();\n    input.setSelectionRange(input.value.length, input.value.length);\n  }\n}\n\nfunction setupUI() {\n  root.getElementById('zoom-slider').value = state.settings.zoom;\n  root.getElementById('gal-search').value = state.settings.search || '';\n  root.getElementById('btn-toggle-names').classList.toggle('active', state.settings.showNames);\n  updateLayoutButtons();\n  updateMetrics();\n  root.getElementById('opt-include-all').checked = state.settings.includeAll;\n  updateSortUI();\n}\n\nfunction updateSortUI() {\n    var map = {\n        'mtime-desc': 'Date (Newest)',\n        'mtime-asc': 'Date (Oldest)',\n        'ctime-desc': 'Created (Newest)',\n        'name-asc': 'Name (A-Z)',\n        'size-desc': 'Size (Largest)'\n    };\n    root.querySelectorAll('.sort-option').forEach(el => {\n        el.classList.toggle('active', el.dataset.val === state.settings.sortBy);\n    });\n}\n\nfunction updateLayoutButtons() {\n  root.getElementById('btn-layout-square').classList.toggle('active', state.settings.layout === 'square');\n  root.getElementById('btn-layout-justified').classList.toggle('active', state.settings.layout === 'justified');\n}\n\nfunction updateMetrics() {\n  var rect = canvas.getBoundingClientRect();\n  if (rect.width === 0) return;\n  canvas.width = rect.width * window.devicePixelRatio;\n  canvas.height = rect.height * window.devicePixelRatio;\n  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n  state.rowHeight = state.settings.zoom;\n  calculateLayout();\n}\n\nfunction calculateLayout() {\n  var rect = canvas.getBoundingClientRect();\n  var width = rect.width;\n  if (width === 0) return;\n  state.layoutData = [];\n  var textH = state.settings.showNames ? 25 : 0;\n  \n  if (state.settings.layout === 'square') {\n    var cols = Math.max(1, Math.floor((width - state.gap) / (state.rowHeight + state.gap)));\n    var itemW = (width - (cols + 1) * state.gap) / cols;\n    state.filteredImages.forEach((img, i) => {\n      var col = i % cols, row = Math.floor(i / cols);\n      state.layoutData.push({ x: state.gap + col * (itemW + state.gap), y: state.gap + row * (itemW + state.gap + textH), w: itemW, h: itemW });\n    });\n  } else {\n    var currentRow = [], currentRowWidth = 0, y = state.gap;\n    state.filteredImages.forEach((imgData, i) => {\n      var cached = state.cache.get(imgData.path);\n      var aspect = (cached && cached.width) ? cached.width / cached.height : 1.5;\n      var itemW = state.rowHeight * aspect;\n      if (currentRowWidth + itemW + state.gap > width - state.gap && currentRow.length > 0) {\n        var scale = (width - (currentRow.length + 1) * state.gap) / currentRowWidth;\n        var x = state.gap;\n        currentRow.forEach(item => { item.w *= scale; item.h *= scale; item.x = x; item.y = y; x += item.w + state.gap; });\n        y += currentRow[0].h + state.gap + textH; currentRow = []; currentRowWidth = 0;\n      }\n      var item = { x: 0, y: 0, w: itemW, h: state.rowHeight, index: i };\n      currentRow.push(item); state.layoutData.push(item); currentRowWidth += itemW;\n    });\n    var lx = state.gap;\n    currentRow.forEach(item => { item.x = lx; item.y = y; lx += item.w + state.gap; });\n  }\n}\n\nasync function refreshGallery() {\n  if (!app) return;\n  var allFiles = app.vault.getFiles();\n  var imgExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'];\n  state.allImages = allFiles.filter(f => imgExtensions.includes(f.extension.toLowerCase())).map(f => ({\n    name: f.name, path: f.path, url: app.vault.getResourcePath(f), mtime: f.stat.mtime, ctime: f.stat.ctime, size: f.stat.size\n  }));\n  sortImages(); applyFilter(); updateScrubber(); updateFolderList();\n}\n\nfunction sortImages() {\n  var mode = state.settings.sortBy;\n  state.allImages.sort((a, b) => {\n    if (mode === 'mtime-desc') return b.mtime - a.mtime;\n    if (mode === 'mtime-asc') return a.mtime - b.mtime;\n    if (mode === 'ctime-desc') return b.ctime - a.ctime;\n    if (mode === 'name-asc') return a.name.localeCompare(b.name);\n    if (mode === 'size-desc') return b.size - a.size;\n    return 0;\n  });\n}\n\nfunction applyFilter() {\n  var query = (state.settings.search || '').toLowerCase();\n  state.filteredImages = state.allImages.filter(img => {\n    var inFolder = state.settings.includeAll || state.settings.folders.some(f => img.path.startsWith(f));\n    var matchesSearch = !query || img.name.toLowerCase().includes(query);\n    return inFolder && matchesSearch;\n  });\n  calculateLayout();\n}\n\nfunction loop() {\n  render();\n  requestAnimationFrame(loop);\n}\n\nfunction render() {\n  var rect = canvas.getBoundingClientRect();\n  if (rect.width === 0) return;\n  if (!state.isDragging) {\n    state.scroll += (state.targetScroll - state.scroll) * 0.08;\n    if (Math.abs(state.targetScroll - state.scroll) < 0.1) state.scroll = state.targetScroll;\n  }\n  ctx.fillStyle = '#000';\n  ctx.fillRect(0, 0, rect.width, rect.height);\n  state.layoutData.forEach((layout, i) => {\n    var y = layout.y - state.scroll;\n    if (y + layout.h + 30 < 0 || y > rect.height) return;\n    drawItem(state.filteredImages[i], layout.x, y, layout.w, layout.h);\n  });\n}\n\nfunction drawItem(imgData, x, y, w, h) {\n  var cached = state.cache.get(imgData.path);\n  var isSelected = state.selection.has(imgData.path);\n  if (!cached) {\n    var img = new Image(); img.src = imgData.url; img.onload = () => { state.cache.set(imgData.path, img); calculateLayout(); };\n    state.cache.set(imgData.path, 'loading'); return;\n  }\n  ctx.save(); ctx.beginPath(); ctx.roundRect(x, y, w, h, 8); ctx.clip();\n  if (cached === 'loading') { ctx.fillStyle = '#111'; ctx.fillRect(x, y, w, h); }\n  else { var iw = cached.width, ih = cached.height, r = Math.max(w / iw, h / ih), nw = iw * r, nh = ih * r; ctx.drawImage(cached, x + (w - nw) / 2, y + (h - nh) / 2, nw, nh); }\n  ctx.restore();\n  if (isSelected) { ctx.strokeStyle = state.isEditMode ? '#ff4444' : 'var(--gal-accent)'; ctx.lineWidth = 4; ctx.strokeRect(x + 2, y + 2, w - 4, h - 4); ctx.fillStyle = 'rgba(0, 210, 255, 0.2)'; ctx.fillRect(x, y, w, h); }\n  if (state.settings.showNames) { ctx.fillStyle = '#fff'; ctx.font = '10px sans-serif'; ctx.textAlign = 'center'; var displayName = imgData.name.length > 20 ? imgData.name.substring(0, 17) + '...' : imgData.name; ctx.fillText(displayName, x + w / 2, y + h + 15); }\n}\n\nfunction setupEventListeners() {\n  var searchInput = root.getElementById('gal-search');\n  var searchWrapper = root.getElementById('search-wrapper');\n  \n  searchInput.oninput = (e) => { state.settings.search = e.target.value; applyFilter(); save(false); };\n  root.getElementById('btn-clear-search').onclick = () => { \n      state.settings.search = ''; searchInput.value = ''; applyFilter(); save(true); searchInput.focus(); \n  };\n\n  // Responsive Search Toggle\n  root.getElementById('btn-search-toggle').onclick = (e) => {\n      // Only react if we are in compact mode (handled by CSS primarily but logic here helps focus)\n      if (root.getElementById('gallery-root').classList.contains('compact')) {\n          searchWrapper.classList.toggle('expanded');\n          if (searchWrapper.classList.contains('expanded')) searchInput.focus();\n      }\n  };\n  \n  // Close expanded search when clicking outside\n  document.addEventListener('click', (e) => {\n      if (searchWrapper.classList.contains('expanded') && !searchWrapper.contains(e.target)) {\n          searchWrapper.classList.remove('expanded');\n      }\n  });\n\n  // Robust Drag & Click Handling\n  canvas.onpointerdown = (e) => {\n    state.isPointerDown = true;\n    state.startY = e.clientY;\n    state.startScroll = state.scroll;\n    state.hasMoved = false;\n    state.lastY = e.clientY;\n    state.lastTime = performance.now();\n    state.velocity = 0;\n    canvas.setPointerCapture(e.pointerId);\n  };\n\n  canvas.onpointermove = (e) => {\n    if (!state.isPointerDown) return;\n    var now = performance.now();\n    var dt = now - state.lastTime;\n    if (dt > 0) {\n      var v = (state.lastY - e.clientY) / dt; // pixels per millisecond\n      state.velocity = state.velocity * 0.7 + v * 0.3; // Exponential moving average\n      state.lastY = e.clientY;\n      state.lastTime = now;\n    }\n    var delta = e.clientY - state.startY;\n    if (Math.abs(delta) > 5) state.hasMoved = true;\n    if (state.hasMoved) {\n      state.isDragging = true;\n      state.targetScroll = state.startScroll - delta;\n      state.scroll = state.targetScroll;\n      clampScroll();\n    }\n  };\n\n  canvas.onpointerup = (e) => {\n    if (!state.isPointerDown) return;\n    state.isPointerDown = false;\n    state.isDragging = false;\n    canvas.releasePointerCapture(e.pointerId);\n    if (!state.hasMoved) handleCanvasClick(e);\n    else {\n      // Apply momentum if there was significant velocity\n      if (Math.abs(state.velocity) > 0.1) { // Threshold for considering it a swipe\n        state.targetScroll += state.velocity * 350; // Increased multiplier for longer inertia effect\n      }\n      clampScroll();\n    }\n  };\n\n  canvas.onpointercancel = (e) => {\n    state.isPointerDown = false;\n    state.isDragging = false;\n    canvas.releasePointerCapture(e.pointerId);\n  };\n\n  canvas.onwheel = (e) => { \n    e.preventDefault(); \n    if (e.ctrlKey) {\n      var delta = e.deltaY * -0.5;\n      updateZoom(state.settings.zoom + delta);\n    } else {\n      state.targetScroll += e.deltaY; \n      clampScroll(); \n    }\n  };\n\n  // Add Double Click Support\n  canvas.ondblclick = (e) => {\n      var rect = canvas.getBoundingClientRect();\n      var mx = e.clientX - rect.left, my = e.clientY - rect.top + state.scroll;\n      var hit = state.layoutData.find(l => mx >= l.x && mx <= l.x + l.w && my >= l.y && my <= l.y + l.h);\n      if (hit) {\n          var img = state.filteredImages[state.layoutData.indexOf(hit)];\n          openLightbox(img.path);\n      }\n  };\n\n  // Prevent context menu to allow right click usage\n  canvas.oncontextmenu = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  };\n\n  function handleCanvasClick(e) {\n    var rect = canvas.getBoundingClientRect();\n    var mx = e.clientX - rect.left, my = e.clientY - rect.top + state.scroll;\n    var hit = state.layoutData.find(l => mx >= l.x && mx <= l.x + l.w && my >= l.y && my <= l.y + l.h);\n    if (!hit) return;\n    var img = state.filteredImages[state.layoutData.indexOf(hit)];\n    \n    // Right click (button 2) opens lightbox\n    if (e.button === 2) {\n        if (!state.isEditMode) openLightbox(img.path);\n        return;\n    }\n\n    // Left click (button 0) handles selection\n    if (e.button === 0) {\n        if (state.isEditMode) {\n          if (state.selection.has(img.path)) state.selection.delete(img.path);\n          else state.selection.add(img.path);\n          updateEditToolbar();\n        } else {\n          state.selection.clear();\n          state.selection.add(img.path);\n        }\n    }\n  }\n\n  root.getElementById('btn-toggle-names').onclick = () => { state.settings.showNames = !state.settings.showNames; root.getElementById('btn-toggle-names').classList.toggle('active', state.settings.showNames); calculateLayout(); save(true); };\n  root.getElementById('btn-edit-mode').onclick = () => { state.isEditMode = !state.isEditMode; state.selection.clear(); root.getElementById('btn-edit-mode').classList.toggle('active', state.isEditMode); updateEditToolbar(); };\n  root.getElementById('btn-cancel-edit').onclick = () => { state.isEditMode = false; state.selection.clear(); root.getElementById('btn-edit-mode').classList.remove('active'); updateEditToolbar(); };\n  root.getElementById('btn-copy-selection').onclick = async () => {\n    var links = Array.from(state.selection).map(path => { var img = state.allImages.find(i => i.path === path); return `![[${img.name}]]`; }).join('\\n');\n    await navigator.clipboard.writeText(links); alert('Copied ' + state.selection.size + ' links!');\n  };\n  root.getElementById('btn-delete-selection').onclick = async () => {\n    if (!confirm(`Delete ${state.selection.size} images?`)) return;\n    for (let path of state.selection) { var file = app.vault.getAbstractFileByPath(path); if (file) await app.vault.trash(file, true); }\n    state.selection.clear(); state.isEditMode = false; root.getElementById('btn-edit-mode').classList.remove('active'); updateEditToolbar(); await refreshGallery();\n  };\n  root.getElementById('btn-lb-copy').onclick = async () => { var path = root.getElementById('lightbox-img').dataset.path; var img = state.allImages.find(i => i.path === path); await navigator.clipboard.writeText(`![[${img.name}]]`); alert('Copied!'); };\n  \n  var lb = root.getElementById('lightbox'), lbContent = root.getElementById('lightbox-content');\n  lbContent.onwheel = (e) => { e.preventDefault(); var delta = e.deltaY > 0 ? 0.9 : 1.1; lbState.zoom = Math.max(0.5, Math.min(lbState.zoom * delta, 10)); updateLightboxTransform(); };\n  lbContent.onpointerdown = (e) => { \n    lbState.isDragging = true; \n    lbState.startX = e.clientX;\n    lbState.lastX = e.clientX; \n    lbState.lastY = e.clientY; \n    lbContent.setPointerCapture(e.pointerId); \n  };\n  lbContent.onpointermove = (e) => { \n    if (!lbState.isDragging) return; \n    lbState.x += e.clientX - lbState.lastX; \n    lbState.y += e.clientY - lbState.lastY; \n    lbState.lastX = e.clientX; \n    lbState.lastY = e.clientY; \n    updateLightboxTransform(); \n  };\n  lbContent.onpointerup = (e) => { \n    lbState.isDragging = false; \n    lbContent.releasePointerCapture(e.pointerId); \n    if (lbState.zoom === 1) {\n        var dx = e.clientX - lbState.startX;\n        if (dx > 50) navigateLightbox(-1);\n        else if (dx < -50) navigateLightbox(1);\n        else { lbState.x = 0; lbState.y = 0; updateLightboxTransform(); }\n    }\n  };\n  \n  root.getElementById('btn-lb-prev').onclick = (e) => { e.stopPropagation(); navigateLightbox(-1); };\n  root.getElementById('btn-lb-next').onclick = (e) => { e.stopPropagation(); navigateLightbox(1); };\n\n  // Zoom Controls Logic\n  root.getElementById('zoom-slider').oninput = (e) => { updateZoom(parseInt(e.target.value)); };\n  root.getElementById('btn-zoom-in').onclick = () => { updateZoom(state.settings.zoom + 50); };\n  root.getElementById('btn-zoom-out').onclick = () => { updateZoom(state.settings.zoom - 50); };\n\n  function updateZoom(newVal) {\n      state.settings.zoom = Math.max(50, Math.min(newVal, 1000));\n      state.rowHeight = state.settings.zoom;\n      root.getElementById('zoom-slider').value = state.settings.zoom;\n      calculateLayout();\n      save(false);\n      updateMetrics();\n  }\n\n  root.getElementById('btn-layout-square').onclick = () => { state.settings.layout = 'square'; updateLayoutButtons(); calculateLayout(); save(true); };\n  root.getElementById('btn-layout-justified').onclick = () => { state.settings.layout = 'justified'; updateLayoutButtons(); calculateLayout(); save(true); };\n  root.getElementById('btn-fullscreen').onclick = () => { var container = root.getElementById('gallery-root'); if (!document.fullscreenElement) container.requestFullscreen().catch(() => container.classList.add('fullscreen')); else document.exitFullscreen(); };\n  document.addEventListener('fullscreenchange', () => { \n    var isFs = !!document.fullscreenElement;\n    root.getElementById('gallery-root').classList.toggle('fullscreen', isFs); \n    setTimeout(updateMetrics, 100);\n    if (!isFs && state.pendingSave) { state.pendingSave = false; save(true); }\n  });\n  lb.onclick = (e) => { if (e.target === lb || e.target === lbContent) closeLightbox(); };\n  root.querySelector('.lightbox-close').onclick = closeLightbox;\n  \n  // New folder popup logic\n  var folderBtn = root.getElementById('btn-folders');\n  var folderPopup = root.getElementById('folder-popup');\n  folderBtn.onclick = (e) => { e.stopPropagation(); folderPopup.classList.toggle('active'); folderBtn.classList.toggle('active', folderPopup.classList.contains('active')); };\n  folderPopup.onclick = (e) => e.stopPropagation();\n  document.addEventListener('click', (e) => { if (folderPopup.classList.contains('active') && !folderBtn.contains(e.target)) { folderPopup.classList.remove('active'); folderBtn.classList.remove('active'); } });\n  \n  root.getElementById('folder-search').oninput = (e) => { state.folderSearch = e.target.value.toLowerCase(); updateFolderList(); };\n\n  root.getElementById('opt-include-all').onchange = (e) => { state.settings.includeAll = e.target.checked; save(true); refreshGallery(); };\n  \n  // Sort Popup Logic\n  var sortBtn = root.getElementById('btn-sort');\n  var sortPopup = root.getElementById('sort-popup');\n  sortBtn.onclick = (e) => { e.stopPropagation(); sortPopup.classList.toggle('active'); sortBtn.classList.toggle('active', sortPopup.classList.contains('active')); };\n  document.addEventListener('click', (e) => { if (sortPopup.classList.contains('active') && !sortBtn.contains(e.target)) { sortPopup.classList.remove('active'); sortBtn.classList.remove('active'); } });\n  \n  root.querySelectorAll('.sort-option').forEach(opt => {\n      opt.onclick = () => {\n          state.settings.sortBy = opt.dataset.val;\n          save(true);\n          sortImages();\n          applyFilter();\n          updateSortUI();\n      };\n  });\n\n  // Help Logic\n  root.getElementById('btn-help').onclick = () => { root.getElementById('help-modal').style.display = 'flex'; };\n  root.getElementById('btn-close-help').onclick = () => { root.getElementById('help-modal').style.display = 'none'; };\n\n  // Add to Note Logic\n  root.getElementById('btn-add-to-note').onclick = () => { root.getElementById('note-selector-modal').style.display = 'flex'; root.getElementById('note-search').focus(); updateNoteList(''); };\n  root.getElementById('btn-close-note-modal').onclick = () => { root.getElementById('note-selector-modal').style.display = 'none'; };\n  root.getElementById('note-search').oninput = (e) => updateNoteList(e.target.value);\n}\n\nfunction updateNoteList(query) {\n  var list = root.getElementById('note-list');\n  var files = app.vault.getMarkdownFiles().filter(f => f.path.toLowerCase().includes(query.toLowerCase()));\n  list.innerHTML = files.slice(0, 50).map(f => `<div class=\"note-item\" data-path=\"${f.path}\">${f.path}</div>`).join('');\n  list.classList.add('active');\n  list.querySelectorAll('.note-item').forEach(item => {\n    item.onclick = async () => {\n      var file = app.vault.getAbstractFileByPath(item.dataset.path);\n      var links = Array.from(state.selection).map(path => { var img = state.allImages.find(i => i.path === path); return `![[${img.name}]]`; }).join('\\n');\n      var content = await app.vault.read(file);\n      await app.vault.modify(file, content + '\\n' + links);\n      alert('Added to note!');\n      root.getElementById('note-selector-modal').style.display = 'none';\n      state.isEditMode = false; root.getElementById('btn-edit-mode').classList.remove('active'); updateEditToolbar();\n    };\n  });\n}\n\nfunction navigateLightbox(dir) {\n    var newIndex = state.currentIndex + dir;\n    if (newIndex < 0) newIndex = state.filteredImages.length - 1;\n    if (newIndex >= state.filteredImages.length) newIndex = 0;\n    openLightbox(state.filteredImages[newIndex].path);\n}\n\nfunction handleKey(e) {\n    if (root.getElementById('lightbox').style.display !== 'flex') return;\n    if (e.key === 'ArrowLeft') navigateLightbox(-1);\n    if (e.key === 'ArrowRight') navigateLightbox(1);\n    if (e.key === 'Escape') closeLightbox();\n}\n\nfunction updateLightboxTransform() { var lbImg = root.getElementById('lightbox-img'); lbImg.style.transform = `translate(${lbState.x}px, ${lbState.y}px) scale(${lbState.zoom})`; }\nfunction updateEditToolbar() { \n    var bar = root.getElementById('edit-toolbar'); \n    bar.classList.toggle('active', state.isEditMode); \n    root.getElementById('selection-count').innerText = state.selection.size;\n}\nfunction setupResizeObserver() { \n    var container = root.getElementById('gallery-root'); \n    var observer = new ResizeObserver(entries => { \n        for (let entry of entries) { \n            updateMetrics(); \n            \n            // Save dimensions (data) when resized manually\n            var h = Math.round(entry.contentRect.height);\n            var w = Math.round(entry.contentRect.width);\n            if (!document.fullscreenElement) {\n                if (h && Math.abs(h - (state.settings.height || 0)) > 10) state.settings.height = h;\n                if (w && Math.abs(w - (state.settings.width || 0)) > 10) state.settings.width = w;\n                if (state.settings.height || state.settings.width) save(false);\n            }\n\n            // Responsive logic\n            if (entry.contentRect.width < 550) container.classList.add('compact');\n            else container.classList.remove('compact');\n        } \n    }); \n    observer.observe(container); \n}\nfunction clampScroll() { var rect = canvas.getBoundingClientRect(); var lastItem = state.layoutData[state.layoutData.length - 1], textH = state.settings.showNames ? 25 : 0;\n  var maxScroll = lastItem ? Math.max(0, lastItem.y + lastItem.h + state.gap + textH - rect.height) : 0; state.targetScroll = Math.max(0, Math.min(state.targetScroll, maxScroll)); }\nfunction updateScrubber() { var track = root.getElementById('scrubber-track'); if (state.filteredImages.length < 10) { track.innerHTML = ''; return; } var years = new Set(); state.filteredImages.forEach(img => years.add(new Date(img.mtime).getFullYear()));\n  var markers = Array.from(years).sort((a,b)=>b-a).map(y => ({ label: y, index: state.filteredImages.findIndex(img => new Date(img.mtime).getFullYear() === y) }));\n  track.innerHTML = markers.map(m => `<div class=\"scrubber-point\" data-label=\"${m.label}\" data-index=\"${m.index}\"></div>`).join('');\n  track.querySelectorAll('.scrubber-point').forEach(p => { p.onclick = () => { var layout = state.layoutData[parseInt(p.dataset.index)]; if (layout) { state.targetScroll = layout.y - state.gap; clampScroll(); } }; }); }\nfunction updateFolderList() { \n  if (!app) return; \n  var folders = new Set(); \n  app.vault.getFiles().forEach(f => { var parts = f.path.split('/'); if (parts.length > 1) folders.add(parts.slice(0, -1).join('/')); });\n  var sortedFolders = Array.from(folders).sort((a, b) => {\n      var aSel = state.settings.folders.includes(a) ? 1 : 0;\n      var bSel = state.settings.folders.includes(b) ? 1 : 0;\n      return (bSel - aSel) || a.localeCompare(b);\n  });\n  if (state.folderSearch) sortedFolders = sortedFolders.filter(f => f.toLowerCase().includes(state.folderSearch));\n  \n  var list = root.getElementById('folder-list'); \n  list.innerHTML = sortedFolders.map(f => { \n      var checked = state.settings.folders.indexOf(f) !== -1 ? 'checked' : ''; \n      var selClass = checked ? 'selected' : '';\n      return `<div class=\"folder-item ${selClass}\"><input type=\"checkbox\" class=\"folder-check\" data-folder=\"${f}\" ${checked}><span>${f}</span></div>`; \n  }).join('');\n  \n  list.querySelectorAll('.folder-check').forEach(cb => { \n      cb.onchange = () => {\n          var folder = cb.dataset.folder; \n          if (cb.checked) { if (state.settings.folders.indexOf(folder) === -1) state.settings.folders.push(folder); } \n          else { state.settings.folders = state.settings.folders.filter(x => x !== folder); } \n          save(true); \n          applyFilter(); \n          updateFolderList(); \n      }; \n  }); \n}\nfunction openLightbox(path) { \n    var index = state.filteredImages.findIndex(x => x.path === path);\n    if (index === -1) return;\n    state.currentIndex = index;\n    var img = state.filteredImages[index];\n    var lb = root.getElementById('lightbox'), lbImg = root.getElementById('lightbox-img');\n    lbImg.src = img.url; lbImg.dataset.path = img.path; lbState.zoom = 1; lbState.x = 0; lbState.y = 0; updateLightboxTransform();\n    root.getElementById('lightbox-name').innerText = img.name; \n    root.getElementById('lightbox-meta').innerText = (img.size / 1024 / 1024).toFixed(2) + ' MB • ' + new Date(img.mtime).toLocaleString(); \n    lb.style.display = 'flex'; \n    document.addEventListener('keydown', handleKey);\n}\nfunction closeLightbox() {\n    root.getElementById('lightbox').style.display = 'none';\n    document.removeEventListener('keydown', handleKey);\n}\nfunction save(immediate) { \n  if (document.fullscreenElement) { state.pendingSave = true; return; }\n  var clean = { settings: state.settings }; \n  if (immediate) { api.saveState(clean); return; } \n  clearTimeout(saveTimeout); \n  saveTimeout = setTimeout(() => api.saveState(clean), 2000); \n}\ninit();",
      "source": "obsidget"
    },
    {
      "id": "pomodoro-timer",
      "title": "Pomodoro Timer",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\" id=\"pomo-card\">\n  <div class=\"header-actions\">\n    <button class=\"btn-icon\" id=\"btn-pip\" title=\"Picture in Picture\">📺</button>\n    <button class=\"btn-icon\" id=\"btn-settings\" title=\"Settings\">⚙️</button>\n  </div>\n\n  <div class=\"timer-modes\">\n    <button class=\"mode-btn active\" id=\"mode-pomo\">Pomodoro</button>\n    <button class=\"mode-btn\" id=\"mode-short\">Short Break</button>\n    <button class=\"mode-btn\" id=\"mode-long\">Long Break</button>\n  </div>\n  \n  <div class=\"timer-display\" id=\"timer-display\">25:00</div>\n  \n  <div class=\"controls\">\n    <button class=\"btn-main\" id=\"start-btn\">START</button>\n    <button class=\"btn-reset\" id=\"reset-btn\" title=\"Reset\">↻</button>\n  </div>\n  \n  <div class=\"stats\">\n    <div class=\"session-info\">\n      Sessions: <b id=\"session-count\">0</b>\n    </div>\n    <button class=\"btn-clear\" id=\"btn-clear\">Clear Stats</button>\n  </div>\n\n  <div class=\"settings-overlay\" id=\"settings-overlay\">\n    <div class=\"settings-content\">\n      <div class=\"settings-header\">\n        <h3>Settings</h3>\n        <button class=\"btn-icon\" id=\"btn-close-settings\">✕</button>\n      </div>\n      \n      <div class=\"settings-group\">\n        <label>Time (minutes)</label>\n        <div class=\"input-row\">\n          <div class=\"input-field\">\n            <span>Pomo</span>\n            <input type=\"number\" id=\"input-pomo\" min=\"1\" max=\"60\" value=\"25\">\n          </div>\n          <div class=\"input-field\">\n            <span>Short</span>\n            <input type=\"number\" id=\"input-short\" min=\"1\" max=\"30\" value=\"5\">\n          </div>\n          <div class=\"input-field\">\n            <span>Long</span>\n            <input type=\"number\" id=\"input-long\" min=\"1\" max=\"60\" value=\"15\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"settings-group\">\n        <div class=\"toggle-row\">\n          <label>Sound Alert</label>\n          <label class=\"switch\">\n            <input type=\"checkbox\" id=\"toggle-sound\" checked>\n            <span class=\"slider\"></span>\n          </label>\n        </div>\n        <div class=\"toggle-row\" style=\"margin-top: 12px;\">\n          <label>Auto PiP on Start</label>\n          <label class=\"switch\">\n            <input type=\"checkbox\" id=\"toggle-autopip\">\n            <span class=\"slider\"></span>\n          </label>\n        </div>\n      </div>\n\n      <button class=\"btn-save\" id=\"btn-save-settings\">SAVE</button>\n    </div>\n  </div>\n  \n  <canvas id=\"pip-canvas\" width=\"300\" height=\"150\" style=\"display:none\"></canvas>\n  <video id=\"pip-video\" autoplay muted loop style=\"display:none\"></video>\n  <audio id=\"silent-audio\" loop style=\"display:none\">\n    <source src=\"data:audio/wav;base64,UklGRigAAABXQVZFRm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==\" type=\"audio/wav\">\n  </audio>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: #ba4949;\n    color: white;\n    border-radius: 32px;\n    padding: 1.5rem;\n    text-align: center;\n    transition: background 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 0 15px 35px rgba(0,0,0,0.2);\n    position: relative;\n    overflow: hidden;\n    width: 100%;\n}\n\n.header-actions {\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n    margin-bottom: 0.5rem;\n}\n\n.btn-icon {\n    background: rgba(255,255,255,0.15);\n    border: none;\n    color: white;\n    width: 32px;\n    height: 32px;\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1rem;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: rgba(255,255,255,0.25); }\n\n.timer-modes {\n    display: flex;\n    justify-content: center;\n    gap: 8px;\n    margin-bottom: 1.5rem;\n}\n\n.mode-btn {\n    background: transparent;\n    border: none;\n    color: white;\n    padding: 8px 16px;\n    border-radius: 12px;\n    font-weight: 700;\n    font-size: 0.85rem;\n    cursor: pointer;\n    transition: all 0.2s;\n    opacity: 0.7;\n}\n.mode-btn.active {\n    background: rgba(0,0,0,0.15);\n    opacity: 1;\n}\n.mode-btn:hover { opacity: 1; }\n\n.timer-display {\n    font-size: 5.5rem;\n    font-weight: 800;\n    font-family: var(--font-monospace);\n    margin: 1rem 0 2rem;\n    line-height: 1;\n    letter-spacing: -2px;\n    text-shadow: 0 4px 10px rgba(0,0,0,0.1);\n}\n\n.controls {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 20px;\n    margin-bottom: 1.5rem;\n}\n\n.btn-main {\n    background: white;\n    color: #ba4949;\n    border: none;\n    padding: 14px 40px;\n    border-radius: 16px;\n    font-size: 1.4rem;\n    font-weight: 900;\n    cursor: pointer;\n    box-shadow: 0 6px 0 rgba(0,0,0,0.1);\n    transition: all 0.1s;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n.btn-main:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.1); }\n\n.btn-reset {\n    background: rgba(255,255,255,0.15);\n    border: none;\n    color: white;\n    width: 48px;\n    height: 48px;\n    border-radius: 16px;\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.btn-reset:hover { background: rgba(255,255,255,0.25); transform: rotate(-45deg); }\n\n.stats {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-top: 1rem;\n    border-top: 1px solid rgba(255,255,255,0.1);\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.session-info { opacity: 0.8; }\n.btn-clear {\n    background: none;\n    border: none;\n    color: white;\n    text-decoration: underline;\n    cursor: pointer;\n    opacity: 0.6;\n    font-size: 0.75rem;\n}\n.btn-clear:hover { opacity: 1; }\n\n/* Settings Overlay */\n.settings-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0,0,0,0.8);\n    backdrop-filter: blur(10px);\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 100;\n    padding: 1rem;\n}\n.settings-overlay.show { display: flex; }\n\n.settings-content {\n    background: var(--background-primary);\n    color: var(--text-normal);\n    width: 100%;\n    max-width: 280px;\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: 0 20px 50px rgba(0,0,0,0.3);\n}\n\n.settings-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n.settings-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n.settings-header .btn-icon {\n    background: var(--background-modifier-border);\n    color: var(--text-muted);\n}\n\n.settings-group {\n    margin-bottom: 1.5rem;\n    text-align: left;\n}\n.settings-group label {\n    display: block;\n    font-size: 0.75rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    margin-bottom: 10px;\n}\n\n.input-row {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 8px;\n}\n\n.input-field {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n.input-field span {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-faint);\n}\n.input-field input {\n    width: 100%;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px;\n    border-radius: 8px;\n    font-size: 0.9rem;\n    font-weight: 700;\n    text-align: center;\n}\n\n.toggle-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.btn-save {\n    width: 100%;\n    background: #ba4949;\n    color: white;\n    border: none;\n    padding: 12px;\n    border-radius: 12px;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-save:hover { opacity: 0.9; }\n\n/* Switch Toggle */\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 40px;\n  height: 20px;\n}\n.switch input { opacity: 0; width: 0; height: 0; }\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0; left: 0; right: 0; bottom: 0;\n  background-color: var(--background-modifier-border);\n  transition: .4s; border-radius: 20px;\n}\n.slider:before {\n  position: absolute;\n  content: \"\";\n  height: 14px; width: 14px;\n  left: 3px; bottom: 3px;\n  background-color: white;\n  transition: .4s; border-radius: 50%;\n}\ninput:checked + .slider { background-color: #ba4949; }\ninput:checked + .slider:before { transform: translateX(20px); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    timeLeft: 1500,\n    sessions: 0,\n    currentMode: 'pomo',\n    pomoTime: 25,\n    shortTime: 5,\n    longTime: 15,\n    soundEnabled: true,\n    autoPiP: false\n};\n\nlet timerId = null;\nlet pipVideo = null;\nlet pipCanvas = null;\nlet silentAudio = null;\n\nconst MODES = {\n    pomo: { label: 'Pomodoro', color: '#ba4949' },\n    short: { label: 'Short Break', color: '#38858a' },\n    long: { label: 'Long Break', color: '#397097' }\n};\n\nfunction playSound() {\n    if (!state.soundEnabled) return;\n    try {\n        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n        const oscillator = audioCtx.createOscillator();\n        const gainNode = audioCtx.createGain();\n        oscillator.type = 'sine';\n        oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);\n        oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);\n        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);\n        oscillator.connect(gainNode);\n        gainNode.connect(audioCtx.destination);\n        oscillator.start();\n        oscillator.stop(audioCtx.currentTime + 0.5);\n    } catch (e) { console.error('Audio error:', e); }\n}\n\nfunction updateMediaSession() {\n    if (!('mediaSession' in navigator)) return;\n\n    const mins = Math.floor(state.timeLeft / 60);\n    const secs = state.timeLeft % 60;\n    const timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n\n    navigator.mediaSession.metadata = new MediaMetadata({\n        title: `${MODES[state.currentMode].label} (${timeStr})`,\n        artist: 'Pomodoro Timer Pro',\n        album: 'Obsidget Gallery',\n        artwork: [{ src: 'https://cdn-icons-png.flaticon.com/512/3663/3663335.png', sizes: '512x512', type: 'image/png' }]\n    });\n\n    navigator.mediaSession.playbackState = timerId ? 'playing' : 'paused';\n}\n\nasync function nudgePiP() {\n    // If paused in PiP, briefly play/pause to force a frame refresh\n    if (pipVideo && pipVideo.paused && document.pictureInPictureElement === pipVideo) {\n        try {\n            await pipVideo.play();\n            pipVideo.pause();\n        } catch (e) {}\n    }\n}\n\nfunction updatePiP() {\n    if (!pipCanvas) return;\n    const ctx = pipCanvas.getContext('2d');\n    const mins = Math.floor(state.timeLeft / 60);\n    const secs = state.timeLeft % 60;\n    const timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n    \n    ctx.fillStyle = MODES[state.currentMode].color;\n    ctx.fillRect(0, 0, pipCanvas.width, pipCanvas.height);\n    \n    ctx.fillStyle = 'white';\n    ctx.font = 'bold 80px monospace';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(timeStr, pipCanvas.width / 2, pipCanvas.height / 2 + 5);\n    \n    ctx.font = 'bold 20px sans-serif';\n    ctx.fillText(MODES[state.currentMode].label.toUpperCase(), pipCanvas.width / 2, 25);\n    \n    updateMediaSession();\n    nudgePiP(); // Force refresh if paused\n}\n\nasync function enterPiP() {\n    if (document.pictureInPictureElement) return;\n    try {\n        if (!pipVideo.srcObject) {\n            const stream = pipCanvas.captureStream(10);\n            pipVideo.srcObject = stream;\n        }\n        await pipVideo.play();\n        await pipVideo.requestPictureInPicture();\n        if (silentAudio) silentAudio.play();\n        if (!timerId) pipVideo.pause(); // Stay paused if timer is not running\n    } catch (e) { console.error('PiP enter error:', e); }\n}\n\nasync function exitPiP() {\n    if (document.pictureInPictureElement === pipVideo) {\n        try { \n            await document.exitPictureInPicture(); \n            if (silentAudio) silentAudio.pause();\n        } catch (e) { console.error('PiP exit error:', e); }\n    }\n}\n\nasync function togglePiP() {\n    if (document.pictureInPictureElement) {\n        await exitPiP();\n    } else {\n        await enterPiP();\n    }\n}\n\nfunction updateDisplay() {\n    const mins = Math.floor(state.timeLeft / 60);\n    const secs = state.timeLeft % 60;\n    root.getElementById('timer-display').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n    updatePiP();\n}\n\nfunction setMode(mode) {\n    state.currentMode = mode;\n    const duration = state[`${mode}Time`] * 60;\n    state.timeLeft = duration;\n    \n    const card = root.getElementById('pomo-card');\n    root.querySelectorAll('.mode-btn').forEach(btn => {\n        btn.classList.toggle('active', btn.id === `mode-${mode}`);\n    });\n    \n    card.style.background = MODES[mode].color;\n    \n    resetTimer();\n    updatePiP();\n}\n\nfunction nextMode() {\n    const modes = ['pomo', 'short', 'long'];\n    const idx = modes.indexOf(state.currentMode);\n    setMode(modes[(idx + 1) % modes.length]);\n}\n\nfunction prevMode() {\n    const modes = ['pomo', 'short', 'long'];\n    const idx = modes.indexOf(state.currentMode);\n    setMode(modes[(idx - 1 + modes.length) % modes.length]);\n}\n\nfunction toggleTimer() {\n    const startBtn = root.getElementById('start-btn');\n    if (timerId) {\n        clearInterval(timerId);\n        timerId = null;\n        startBtn.innerText = 'START';\n        if (silentAudio) silentAudio.pause();\n        if (pipVideo) pipVideo.pause();\n        if (state.autoPiP) exitPiP();\n        if ('mediaSession' in navigator) {\n            navigator.mediaSession.playbackState = 'paused';\n        }\n    } else {\n        startBtn.innerText = 'PAUSE';\n        if (silentAudio) silentAudio.play();\n        if (pipVideo) pipVideo.play();\n        if (state.autoPiP) enterPiP();\n        if ('mediaSession' in navigator) {\n            navigator.mediaSession.playbackState = 'playing';\n        }\n        timerId = setInterval(() => {\n            state.timeLeft--;\n            updateDisplay();\n            if (state.timeLeft <= 0) {\n                clearInterval(timerId);\n                timerId = null;\n                startBtn.innerText = 'START';\n                playSound();\n                if (silentAudio) silentAudio.pause();\n                if (pipVideo) pipVideo.pause();\n                if (state.autoPiP) exitPiP();\n                if ('mediaSession' in navigator) {\n                    navigator.mediaSession.playbackState = 'paused';\n                }\n                if (state.currentMode === 'pomo') {\n                    state.sessions++;\n                    root.getElementById('session-count').innerText = state.sessions;\n                }\n                saveState(state);\n            }\n        }, 1000);\n    }\n    updateMediaSession();\n}\n\nfunction resetTimer() {\n    if (timerId) {\n        clearInterval(timerId);\n        timerId = null;\n    }\n    state.timeLeft = state[`${state.currentMode}Time`] * 60;\n    root.getElementById('start-btn').innerText = 'START';\n    if (silentAudio) silentAudio.pause();\n    if (pipVideo) pipVideo.pause();\n    if (state.autoPiP) exitPiP();\n    updateDisplay();\n    updateMediaSession();\n}\n\nfunction clearSessions() {\n    state.sessions = 0;\n    root.getElementById('session-count').innerText = 0;\n    saveState(state);\n}\n\nfunction openSettings() {\n    root.getElementById('input-pomo').value = state.pomoTime;\n    root.getElementById('input-short').value = state.shortTime;\n    root.getElementById('input-long').value = state.longTime;\n    root.getElementById('toggle-sound').checked = state.soundEnabled;\n    root.getElementById('toggle-autopip').checked = state.autoPiP;\n    root.getElementById('settings-overlay').classList.add('show');\n}\n\nfunction closeSettings() {\n    root.getElementById('settings-overlay').classList.remove('show');\n}\n\nfunction saveSettings() {\n    state.pomoTime = parseInt(root.getElementById('input-pomo').value) || 25;\n    state.shortTime = parseInt(root.getElementById('input-short').value) || 5;\n    state.longTime = parseInt(root.getElementById('input-long').value) || 15;\n    state.soundEnabled = root.getElementById('toggle-sound').checked;\n    state.autoPiP = root.getElementById('toggle-autopip').checked;\n    \n    closeSettings();\n    resetTimer();\n    saveState(state);\n}\n\nasync function init() {\n    pipCanvas = root.getElementById('pip-canvas');\n    pipVideo = root.getElementById('pip-video');\n    silentAudio = root.getElementById('silent-audio');\n\n    root.getElementById('mode-pomo').onclick = () => setMode('pomo');\n    root.getElementById('mode-short').onclick = () => setMode('short');\n    root.getElementById('mode-long').onclick = () => setMode('long');\n    root.getElementById('start-btn').onclick = toggleTimer;\n    root.getElementById('reset-btn').onclick = resetTimer;\n    root.getElementById('btn-clear').onclick = clearSessions;\n    root.getElementById('btn-settings').onclick = openSettings;\n    root.getElementById('btn-close-settings').onclick = closeSettings;\n    root.getElementById('btn-save-settings').onclick = saveSettings;\n    root.getElementById('btn-pip').onclick = togglePiP;\n\n    try {\n        const saved = await getState();\n        if (saved) {\n             Object.assign(state, saved);\n             root.getElementById('session-count').innerText = state.sessions;\n        }\n    } catch(e) { console.error('API Error', e); }\n\n    if ('mediaSession' in navigator) {\n        navigator.mediaSession.setActionHandler('play', toggleTimer);\n        navigator.mediaSession.setActionHandler('pause', toggleTimer);\n        navigator.mediaSession.setActionHandler('nexttrack', nextMode);\n        navigator.mediaSession.setActionHandler('previoustrack', prevMode);\n    }\n\n    setMode(state.currentMode);\n    updateDisplay();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "project-timeline",
      "title": "Project Timeline",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"timeline-widget\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <h4 class=\"widget-title\">🚀 Project Timeline</h4>\n      <div class=\"progress-mini\"><span id=\"progress-text\">0%</span> Complete</div>\n    </div>\n    <div class=\"header-actions\">\n      <div class=\"zoom-control\" id=\"zoom-control\" style=\"display:none\">\n        <span class=\"zoom-icon\">🔍</span>\n        <input type=\"range\" id=\"input-zoom\" min=\"10\" max=\"120\" value=\"40\">\n      </div>\n      <button class=\"btn-icon secondary\" id=\"btn-view-toggle\" title=\"Switch View\">📊</button>\n      <button class=\"btn-icon\" id=\"btn-add-toggle\" title=\"Add Milestone\">+</button>\n    </div>\n  </div>\n\n  <div class=\"progress-bar-container\">\n    <div id=\"main-progress-bar\" class=\"progress-bar-fill\"></div>\n  </div>\n\n  <div class=\"milestone-form\" id=\"milestone-form\">\n    <input type=\"text\" id=\"input-title\" placeholder=\"Milestone Title...\">\n    <div class=\"date-row\">\n      <div class=\"date-input\">\n        <label>Start Date</label>\n        <input type=\"date\" id=\"input-start\">\n      </div>\n      <div class=\"date-input\">\n        <label>End Date</label>\n        <input type=\"date\" id=\"input-end\">\n      </div>\n    </div>\n    <div class=\"form-actions\">\n      <button class=\"btn-cancel\" id=\"btn-cancel\">Cancel</button>\n      <button class=\"btn-save\" id=\"btn-save\">Add</button>\n    </div>\n  </div>\n\n  <div id=\"view-container\">\n    <div class=\"timeline-container\" id=\"timeline-list\"></div>\n    <div class=\"gantt-container\" id=\"gantt-view\" style=\"display:none\">\n      <div class=\"gantt-header\" id=\"gantt-header\"></div>\n      <div class=\"gantt-body\" id=\"gantt-body\"></div>\n    </div>\n  </div>\n\n  <div class=\"timeline-footer\">\n    <div class=\"stat-item\">\n      <span id=\"done-count\">0</span>\n      <label>Completed</label>\n    </div>\n    <div class=\"stat-item\">\n      <span id=\"total-count\">0</span>\n      <label>Total</label>\n    </div>\n    <button class=\"btn-clear\" id=\"btn-clear-all\">Clear All</button>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.timeline-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.header-actions { display: flex; gap: 12px; align-items: center; }\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.progress-mini {\n    font-size: 0.65rem;\n    font-weight: 600;\n    color: var(--text-faint);\n    margin-top: 2px;\n}\n\n.zoom-control {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    background: var(--background-primary);\n    padding: 4px 10px;\n    border-radius: 8px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.zoom-icon { font-size: 0.7rem; opacity: 0.6; }\n\n#input-zoom {\n    width: 60px;\n    height: 4px;\n    accent-color: var(--interactive-accent);\n    cursor: pointer;\n}\n\n.btn-icon {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    width: 28px;\n    height: 28px;\n    border-radius: 8px;\n    font-size: 1.1rem;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n.btn-icon.secondary { background: var(--background-modifier-border); color: var(--text-muted); }\n.btn-icon:hover { transform: scale(1.1); }\n\n.progress-bar-container {\n    height: 6px;\n    background: var(--background-primary);\n    border-radius: 3px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    background: var(--interactive-accent);\n    transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);\n    box-shadow: 0 0 10px rgba(var(--interactive-accent-rgb), 0.3);\n}\n\n/* Form Styling */\n.milestone-form {\n    display: none;\n    flex-direction: column;\n    gap: 12px;\n    background: var(--background-primary);\n    padding: 1rem;\n    border-radius: 16px;\n    border: 1px solid var(--background-modifier-border);\n    animation: slideDown 0.3s ease-out;\n}\n.milestone-form.show { display: flex; }\n\n.date-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 10px;\n}\n\n.date-input label {\n    display: block;\n    font-size: 0.6rem;\n    font-weight: 700;\n    color: var(--text-faint);\n    text-transform: uppercase;\n    margin-bottom: 4px;\n}\n\n.milestone-form input {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px 12px;\n    border-radius: 8px;\n    font-size: 0.85rem;\n    outline: none;\n    width: 100%;\n}\n\n.form-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n}\n\n.btn-save, .btn-cancel {\n    padding: 6px 16px;\n    border-radius: 8px;\n    font-size: 0.75rem;\n    font-weight: 700;\n    cursor: pointer;\n    border: none;\n}\n.btn-save { background: var(--interactive-accent); color: var(--text-on-accent); }\n.btn-cancel { background: transparent; color: var(--text-muted); }\n\n/* Timeline List */\n.timeline-container {\n    position: relative;\n    padding-left: 24px;\n    margin-top: 0.5rem;\n    max-height: 400px;\n    overflow-y: auto;\n}\n\n.timeline-container::before {\n    content: '';\n    position: absolute;\n    left: 7px;\n    top: 0;\n    bottom: 0;\n    width: 2px;\n    background: var(--background-modifier-border);\n}\n\n.milestone-item {\n    position: relative;\n    margin-bottom: 20px;\n    display: flex;\n    align-items: flex-start;\n    gap: 12px;\n}\n\n.milestone-dot {\n    position: absolute;\n    left: -24px;\n    top: 4px;\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: var(--background-primary);\n    border: 3px solid var(--background-modifier-border);\n    z-index: 1;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n\n.milestone-item.done .milestone-dot {\n    background: var(--interactive-accent);\n    border-color: var(--interactive-accent);\n}\n\n.milestone-content {\n    flex: 1;\n    background: rgba(255,255,255,0.03);\n    padding: 10px 14px;\n    border-radius: 12px;\n    border: 1px solid transparent;\n    cursor: pointer;\n}\n\n.milestone-title {\n    display: block;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n.milestone-item.done .milestone-title { text-decoration: line-through; color: var(--text-faint); }\n\n.milestone-date {\n    font-size: 0.7rem;\n    font-weight: 600;\n    color: var(--text-muted);\n}\n\n.milestone-actions {\n    display: flex;\n    gap: 4px;\n    opacity: 0;\n}\n.milestone-item:hover .milestone-actions { opacity: 1; }\n\n.btn-action {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 0.9rem;\n    color: var(--text-muted);\n}\n\n/* Gantt View */\n.gantt-container {\n    overflow-x: auto;\n    background: var(--background-primary);\n    border-radius: 16px;\n    border: 1px solid var(--background-modifier-border);\n    padding: 1rem;\n    min-height: 200px;\n    scrollbar-width: none; /* Firefox */\n    -ms-overflow-style: none; /* IE/Edge */\n    cursor: grab;\n    user-select: none;\n}\n\n.gantt-container:active { cursor: grabbing; }\n\n.gantt-container::-webkit-scrollbar {\n    display: none; /* Chrome/Safari */\n}\n\n.gantt-header {\n    display: flex;\n    border-bottom: 1px solid var(--background-modifier-border);\n    padding-bottom: 8px;\n    margin-bottom: 12px;\n    position: sticky;\n    top: 0;\n    background: var(--background-primary);\n    z-index: 5;\n    pointer-events: none;\n}\n\n.gantt-tick {\n    flex-shrink: 0;\n    font-size: 0.6rem;\n    font-weight: 800;\n    color: var(--text-faint);\n    text-align: center;\n    border-left: 1px solid rgba(255,255,255,0.05);\n}\n\n.gantt-row {\n    display: flex;\n    align-items: center;\n    height: 32px;\n    margin-bottom: 8px;\n    position: relative;\n}\n\n.gantt-bar {\n    position: absolute;\n    height: 20px;\n    background: var(--background-modifier-border);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    padding: 0 10px;\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-normal);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    transition: left 0.3s, width 0.3s, background 0.3s;\n    cursor: pointer;\n}\n\n.gantt-bar.done {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    box-shadow: 0 2px 8px rgba(var(--interactive-accent-rgb), 0.3);\n}\n\n/* Footer */\n.timeline-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-top: 1rem;\n    border-top: 1px solid var(--background-modifier-border);\n}\n\n.stat-item { text-align: left; }\n.stat-item span { display: block; font-size: 1rem; font-weight: 800; }\n.stat-item label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    milestones: [\n        { id: 1, title: 'Project Kickoff', start: '2026-01-10', end: '2026-01-12', done: true },\n        { id: 2, title: 'Design Phase', start: '2026-01-13', end: '2026-01-20', done: false },\n        { id: 3, title: 'Development', start: '2026-01-21', end: '2026-02-15', done: false }\n    ],\n    viewMode: 'timeline',\n    zoom: 40,\n    editingId: null\n};\n\nlet isDragging = false;\nlet startX, scrollLeft;\n\nfunction formatDate(dateStr) {\n    if (!dateStr || dateStr === 'TBD') return 'TBD';\n    const d = new Date(dateStr);\n    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n}\n\nfunction render() {\n    const timelineList = root.getElementById('timeline-list');\n    const ganttView = root.getElementById('gantt-view');\n    const zoomControl = root.getElementById('zoom-control');\n    \n    if (state.viewMode === 'timeline') {\n        timelineList.style.display = 'block';\n        ganttView.style.display = 'none';\n        zoomControl.style.display = 'none';\n        renderTimeline();\n    } else {\n        timelineList.style.display = 'none';\n        ganttView.style.display = 'block';\n        zoomControl.style.display = 'flex';\n        renderGantt();\n    }\n\n    // Update Stats\n    const doneCount = state.milestones.filter(m => m.done).length;\n    root.getElementById('done-count').innerText = doneCount;\n    root.getElementById('total-count').innerText = state.milestones.length;\n    \n    const progress = state.milestones.length > 0 ? Math.round((doneCount / state.milestones.length) * 100) : 0;\n    root.getElementById('progress-text').innerText = `${progress}%`;\n    \n    // Fix animation: only update width if it changed to avoid resets\n    const bar = root.getElementById('main-progress-bar');\n    if (bar.style.width !== `${progress}%`) {\n        bar.style.width = `${progress}%`;\n    }\n}\n\nfunction renderTimeline() {\n    const container = root.getElementById('timeline-list');\n    container.innerHTML = '';\n    \n    state.milestones.sort((a,b) => new Date(a.start) - new Date(b.start)).forEach((m) => {\n        const item = document.createElement('div');\n        item.className = `milestone-item ${m.done ? 'done' : ''}`;\n        item.innerHTML = `\n            <div class=\"milestone-dot\"></div>\n            <div class=\"milestone-content\">\n                <span class=\"milestone-title\">${m.title}</span>\n                <span class=\"milestone-date\">${formatDate(m.start)} - ${formatDate(m.end)}</span>\n            </div>\n            <div class=\"milestone-actions\">\n                <button class=\"btn-action edit\">✏️</button>\n                <button class=\"btn-action del\">🗑️</button>\n            </div>\n        `;\n        \n        item.querySelector('.milestone-dot').onclick = () => toggleMilestone(m.id);\n        item.querySelector('.milestone-content').onclick = () => toggleMilestone(m.id);\n        item.querySelector('.edit').onclick = (e) => { e.stopPropagation(); startEdit(m.id); };\n        item.querySelector('.del').onclick = (e) => { e.stopPropagation(); deleteMilestone(m.id); };\n        \n        container.appendChild(item);\n    });\n}\n\nfunction renderGantt() {\n    const header = root.getElementById('gantt-header');\n    const body = root.getElementById('gantt-body');\n    \n    if (state.milestones.length === 0) {\n        header.innerHTML = '';\n        body.innerHTML = '<div style=\"text-align:center; padding: 2rem; color: var(--text-faint);\">No milestones to display</div>';\n        return;\n    }\n\n    const dates = state.milestones.flatMap(m => [new Date(m.start), new Date(m.end)]);\n    const minDate = new Date(Math.min(...dates));\n    const maxDate = new Date(Math.max(...dates));\n    \n    minDate.setDate(minDate.getDate() - 2);\n    maxDate.setDate(maxDate.getDate() + 5);\n\n    const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));\n    const dayWidth = state.zoom || 40;\n\n    header.innerHTML = '';\n    body.innerHTML = '';\n    body.style.width = `${totalDays * dayWidth}px`;\n    header.style.width = `${totalDays * dayWidth}px`;\n\n    for (let i = 0; i < totalDays; i++) {\n        const d = new Date(minDate);\n        d.setDate(d.getDate() + i);\n        const tick = document.createElement('div');\n        tick.className = 'gantt-tick';\n        tick.style.width = `${dayWidth}px`;\n        tick.innerText = d.getDate() === 1 || i === 0 ? d.toLocaleDateString('en-US', {month:'short'}) : d.getDate();\n        header.appendChild(tick);\n    }\n\n    state.milestones.forEach(m => {\n        const start = new Date(m.start);\n        const end = new Date(m.end);\n        const left = Math.ceil((start - minDate) / (1000 * 60 * 60 * 24)) * dayWidth;\n        const width = Math.max(1, Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1) * dayWidth;\n\n        const row = document.createElement('div');\n        row.className = 'gantt-row';\n        row.innerHTML = `<div class=\"gantt-bar ${m.done ? 'done' : ''}\" style=\"left: ${left}px; width: ${width}px;\" title=\"${m.title}\">${m.title}</div>`;\n        \n        // Use mousedown/up to distinguish between drag and click\n        let clickStartTime;\n        row.onmousedown = () => clickStartTime = Date.now();\n        row.onmouseup = () => {\n            if (Date.now() - clickStartTime < 200 && !isDragging) {\n                toggleMilestone(m.id);\n            }\n        };\n        \n        body.appendChild(row);\n    });\n}\n\nfunction initDrag() {\n    const slider = root.getElementById('gantt-view');\n    \n    slider.onmousedown = (e) => {\n        isDragging = true;\n        slider.classList.add('active');\n        startX = e.pageX - slider.offsetLeft;\n        scrollLeft = slider.scrollLeft;\n    };\n\n    slider.onmouseleave = () => {\n        isDragging = false;\n        slider.classList.remove('active');\n    };\n\n    slider.onmouseup = () => {\n        isDragging = false;\n        slider.classList.remove('active');\n    };\n\n    slider.onmousemove = (e) => {\n        if (!isDragging) return;\n        e.preventDefault();\n        const x = e.pageX - slider.offsetLeft;\n        const walk = (x - startX) * 2; // Scroll speed\n        slider.scrollLeft = scrollLeft - walk;\n    };\n}\n\nfunction toggleForm(show) {\n    const form = root.getElementById('milestone-form');\n    if (show) {\n        form.classList.add('show');\n        root.getElementById('input-title').focus();\n        if (!root.getElementById('input-start').value) {\n            const today = new Date().toISOString().split('T')[0];\n            root.getElementById('input-start').value = today;\n            root.getElementById('input-end').value = today;\n        }\n    } else {\n        form.classList.remove('show');\n        state.editingId = null;\n        root.getElementById('input-title').value = '';\n        root.getElementById('btn-save').innerText = 'Add';\n    }\n}\n\nfunction startEdit(id) {\n    const m = state.milestones.find(x => x.id === id);\n    if (!m) return;\n    \n    state.editingId = id;\n    root.getElementById('input-title').value = m.title;\n    root.getElementById('input-start').value = m.start;\n    root.getElementById('input-end').value = m.end;\n    root.getElementById('btn-save').innerText = 'Update';\n    toggleForm(true);\n}\n\nfunction saveMilestone() {\n    const title = root.getElementById('input-title').value.trim();\n    const start = root.getElementById('input-start').value;\n    const end = root.getElementById('input-end').value || start;\n    \n    if (!title || !start) return;\n\n    if (state.editingId) {\n        const idx = state.milestones.findIndex(x => x.id === state.editingId);\n        if (idx !== -1) {\n            state.milestones[idx].title = title;\n            state.milestones[idx].start = start;\n            state.milestones[idx].end = end;\n        }\n    } else {\n        state.milestones.push({ id: Date.now(), title, start, end, done: false });\n    }\n\n    toggleForm(false);\n    render();\n    saveState(state);\n}\n\nfunction toggleMilestone(id) {\n    const idx = state.milestones.findIndex(x => x.id === id);\n    if (idx !== -1) {\n        state.milestones[idx].done = !state.milestones[idx].done;\n        render();\n        saveState(state);\n    }\n}\n\nfunction deleteMilestone(id) {\n    state.milestones = state.milestones.filter(x => x.id !== id);\n    render();\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) Object.assign(state, saved);\n    \n    root.getElementById('btn-add-toggle').onclick = () => toggleForm(true);\n    root.getElementById('btn-cancel').onclick = () => toggleForm(false);\n    root.getElementById('btn-save').onclick = saveMilestone;\n    root.getElementById('btn-view-toggle').onclick = () => {\n        state.viewMode = state.viewMode === 'timeline' ? 'gantt' : 'timeline';\n        render();\n        saveState(state);\n    };\n    root.getElementById('btn-clear-all').onclick = () => {\n        if (confirm('Clear all?')) { state.milestones = []; render(); saveState(state); }\n    };\n    \n    const zoomInput = root.getElementById('input-zoom');\n    zoomInput.value = state.zoom || 40;\n    zoomInput.oninput = (e) => {\n        state.zoom = parseInt(e.target.value);\n        renderGantt();\n        saveState(state);\n    };\n\n    initDrag();\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "python-ds-studio-test",
      "title": "Python Data Science StudioTest",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"ds-container\" style=\"position: relative; resize: both; overflow: auto;\">\n  <div class=\"ds-header\">\n    <div class=\"ds-title-wrap\">\n      <div class=\"ds-logo\">\n        <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" stroke=\"currentColor\" stroke-width=\"2.5\" fill=\"none\"><path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\"></path></svg>\n      </div>\n      <div class=\"ds-title-text\">\n        <span class=\"ds-main-title\">PYTHON DATA SCIENCE</span>\n        <span class=\"ds-sub-title\">STUDIO PRO</span>\n      </div>\n    </div>\n    <div class=\"ds-top-actions\">\n      <button id=\"btn-clear\" class=\"ds-btn-tool\">\n        <svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path></svg>\n        Clear\n      </button>\n      <button id=\"btn-copy\" class=\"ds-btn-tool\">\n        <svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n        Copy\n      </button>\n    </div>\n  </div>\n\n  <div class=\"ds-editor-card\">\n    <div class=\"ds-editor-wrapper\">\n      <pre id=\"highlighting\" aria-hidden=\"true\"><code class=\"language-python\" id=\"highlighting-content\"></code></pre>\n      <textarea id=\"code-editor\" spellcheck=\"false\">import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.ensemble import IsolationForest\n\n# Aesthetic configuration\nsns.set_theme(style=\"whitegrid\")\n\n# 1. Generate synthetic data\nnp.random.seed(42)\nX_normal = 0.3 * np.random.randn(100, 2)\nX_normal = np.r_[X_normal + 2, X_normal - 2]\n\n# Add outliers\nX_outliers = np.random.uniform(low=-4, high=4, size=(20, 2))\nX = np.r_[X_normal, X_outliers]\n\n# 2. Train Isolation Forest model\nclf = IsolationForest(contamination=0.1, random_state=42)\npreds = clf.fit_predict(X)\n\n# 3. Prepare results\ndf = pd.DataFrame(X, columns=['Feature 1', 'Feature 2'])\ndf['Result'] = np.where(preds == 1, 'Normal', 'Anomaly')\n\nprint(f\"Total points: {len(df)}\")\nprint(f\"Anomalies detected: {len(df[df['Result'] == 'Anomaly'])}\")\n\n# 4. Visualization with Seaborn\nplt.figure(figsize=(10, 6))\nsns.scatterplot(data=df, x='Feature 1', y='Feature 2', \n                hue='Result', style='Result', \n                palette={'Normal': 'skyblue', 'Anomaly': 'red'},\n                s=100, edgecolor='black')\n\nplt.title(\"Anomaly Detection (Isolation Forest + Seaborn)\")\nplt.show()</textarea>\n    </div>\n    <div class=\"ds-editor-footer\">\n      <span>Press Ctrl+Enter to run</span>\n    </div>\n  </div>\n\n  <button id=\"btn-execute\" class=\"ds-btn-execute\">\n    <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"currentColor\"><polygon points=\"5 3 19 12 5 21 5 3\"></polygon></svg>\n    Execute\n  </button>\n\n  <div id=\"results-section\" class=\"ds-results-container\" style=\"display: none;\">\n    <div class=\"ds-results-header\">\n      <div class=\"ds-results-icon\">\n        <div style=\"background: #4285f4;\"></div>\n        <div style=\"background: #ea4335;\"></div>\n        <div style=\"background: #fbbc05;\"></div>\n        <div style=\"background: #34a853;\"></div>\n      </div>\n      RESULTS\n    </div>\n    <div class=\"ds-results-content\">\n      <div id=\"output-text\" class=\"ds-output-text\"></div>\n      <div id=\"output-plot\" class=\"ds-output-plot\"></div>\n    </div>\n  </div>\n\n  <div id=\"loader\" class=\"ds-loader\" style=\"display: none;\">\n    <div class=\"ds-spinner\"></div>\n    <span id=\"loader-text\">Loading Python...</span>\n  </div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ":host {\n  --ds-bg: #1a1a1a;\n  --ds-card-bg: #242424;\n  --ds-accent: #2ecc71;\n  --ds-text: #888888;\n  --ds-text-bright: #dddddd;\n  --ds-border: #333333;\n  --ds-font-code: 'Fira Code', 'Cascadia Code', Consolas, monospace;\n}\n\n.ds-container {\n  font-family: var(--font-interface);\n  background: var(--ds-bg);\n  border-radius: 8px;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  color: var(--ds-text-bright);\n}\n\n.ds-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 4px;\n}\n\n.ds-title-wrap {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.ds-logo {\n  color: var(--ds-accent);\n  display: flex;\n  align-items: center;\n}\n\n.ds-title-text {\n  display: flex;\n  flex-direction: column;\n  line-height: 1.1;\n}\n\n.ds-main-title {\n  font-size: 12px;\n  font-weight: 700;\n  letter-spacing: 0.5px;\n  color: #aaa;\n}\n\n.ds-sub-title {\n  font-size: 9px;\n  font-weight: 600;\n  color: #666;\n}\n\n.ds-top-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.ds-btn-tool {\n  background: #333;\n  border: none;\n  color: #aaa;\n  padding: 4px 10px;\n  border-radius: 4px;\n  font-size: 11px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ds-btn-tool:hover {\n  background: #444;\n  color: #fff;\n}\n\n.ds-editor-card {\n  background: var(--ds-card-bg);\n  border: 1px solid var(--ds-border);\n  border-radius: 6px;\n  padding: 12px;\n  display: flex;\n  flex-direction: column;\n}\n\n.ds-editor-wrapper {\n  position: relative;\n  width: 100%;\n  height: 250px;\n  min-height: 100px;\n  resize: vertical;\n  overflow: hidden;\n  background: #1e1e1e;\n  border-radius: 4px;\n}\n\n#code-editor, #highlighting {\n  margin: 0;\n  padding: 10px;\n  padding-bottom: 30px; /* Space for footer and last line */\n  border: 0;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n  font-family: var(--ds-font-code);\n  font-size: 13px;\n  line-height: 1.5;\n  tab-size: 4;\n  white-space: pre;\n  word-wrap: normal;\n  overflow: auto;\n  box-sizing: border-box;\n}\n\n#code-editor {\n  z-index: 1;\n  white-space: pre;\n  color: transparent;\n  background: transparent;\n  caret-color: white;\n  resize: none;\n  outline: none;\n}\n\n#highlighting {\n  z-index: 0;\n  pointer-events: none;\n}\n\n.ds-editor-footer {\n  display: flex;\n  justify-content: flex-end;\n  padding-top: 6px;\n  font-size: 10px;\n  color: #555;\n}\n\n/* Prism Theme Overrides */\n.token.comment { color: #6a9955; }\n.token.keyword { color: #569cd6; }\n.token.string { color: #ce9178; }\n.token.function { color: #dcdcaa; }\n.token.number { color: #b5cea8; }\n.token.operator { color: #d4d4d4; }\n.token.class-name { color: #4ec9b0; }\n.token.builtin { color: #4fc1ff; }\n.token.property { color: #9cdcfe; }\n\n.ds-btn-execute {\n  background: #333;\n  border: none;\n  color: #eee;\n  padding: 8px;\n  border-radius: 6px;\n  font-size: 13px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.ds-btn-execute:hover {\n  background: #444;\n}\n\n.ds-results-container {\n  background: #000;\n  border-left: 3px solid var(--ds-accent);\n  border-radius: 2px;\n  margin-top: 4px;\n  transition: opacity 0.3s;\n}\n\n.ds-results-container.ds-loading {\n  opacity: 0.4;\n  pointer-events: none;\n}\n\n.ds-results-header {\n  padding: 8px 12px;\n  font-size: 10px;\n  font-weight: 700;\n  color: #888;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  border-bottom: 1px solid #111;\n}\n\n.ds-results-icon {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1px;\n  width: 10px;\n  height: 10px;\n}\n\n.ds-results-icon div {\n  width: 4px;\n  height: 4px;\n}\n\n.ds-results-content {\n  padding: 12px;\n  min-height: 40px;\n}\n\n.ds-output-text {\n  font-family: var(--ds-font-code);\n  font-size: 12px;\n  color: #aaa;\n  white-space: pre-wrap;\n}\n\n.ds-output-plot {\n  display: flex;\n  justify-content: center;\n  background: white;\n  padding: 10px;\n  border-radius: 4px;\n  margin-top: 10px;\n}\n\n.ds-output-plot img {\n  max-width: 100%;\n  height: auto;\n}\n\n.ds-loader {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 10px;\n}\n\n.ds-spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid var(--ds-accent);\n  border-top-color: transparent;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n#loader-text {\n  font-size: 11px;\n  color: #666;\n}\n\n/* 🔧 FIX: caret / Prism alignment (hard lock metrics) */\n#code-editor,\n#highlighting,\n#highlighting-content,\n#highlighting-content * {\n  font-family: var(--ds-font-code) !important;\n  font-size: 13px !important;\n  line-height: 1.5 !important;\n  font-weight: 400 !important;\n  letter-spacing: 0 !important;\n  word-spacing: 0 !important;\n  font-kerning: none !important;\n  font-synthesis: none !important;\n  font-variant-ligatures: none !important;\n  font-feature-settings: \"liga\" 0, \"calt\" 0, \"clig\" 0, \"dlig\" 0, \"hlig\" 0 !important;\n}\n\n#highlighting-content {\n  display: block;\n  white-space: pre;\n  tab-size: 4;\n}\n",
      "js": "let pyodide = null;\nconst PYODIDE_VERSION = 'v0.23.4';\nconst PYODIDE_BASE = `https://cdn.jsdelivr.net/pyodide/${PYODIDE_VERSION}/full/`;\nconst PRISM_JS = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js';\nconst PRISM_PYTHON = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js';\n\nasync function init() {\n  const editorWrapper = api.root.querySelector('.ds-editor-wrapper');\n  const editor = api.root.querySelector('#code-editor');\n  const highlightContent = api.root.querySelector('#highlighting-content');\n  const highlightPre = api.root.querySelector('#highlighting');\n  const btnExecute = api.root.querySelector('#btn-execute');\n  const btnClear = api.root.querySelector('#btn-clear');\n  const btnCopy = api.root.querySelector('#btn-copy');\n  const resultsSection = api.root.querySelector('#results-section');\n  const outputText = api.root.querySelector('#output-text');\n  const outputPlot = api.root.querySelector('#output-plot');\n  const loader = api.root.querySelector('#loader');\n  const loaderText = api.root.querySelector('#loader-text');\n\n  // Load Prism\n  await loadScriptOnce(PRISM_JS);\n  await loadScriptOnce(PRISM_PYTHON);\n\n  // Helper: merge-save state (so we can add editorHeight without wiping other fields)\n  const saveStatePartial = async (partial) => {\n    try {\n      const currentState = await api.getState();\n      const newState = Object.assign({}, currentState || {}, partial);\n      await api.saveState(newState);\n    } catch (e) {\n      console.error('Save state error:', e);\n    }\n  };\n\n  const updateHighlighting = () => {\n    let code = editor.value;\n    if (code[code.length - 1] === \"\\n\") code += \" \";\n    highlightContent.textContent = code;\n    if (window.Prism) window.Prism.highlightElement(highlightContent);\n  };\n\n  // Sync scrolling\n  editor.onscroll = () => {\n    highlightPre.scrollTop = editor.scrollTop;\n    highlightPre.scrollLeft = editor.scrollLeft;\n  };\n\n  editor.oninput = () => {\n    updateHighlighting();\n  };\n\n  // Restore state (code/output/plot + editor height)\n  let isInitializing = true;\n  const state = await api.getState?.();\n  if (state?.editorHeight && editorWrapper) {\n    editorWrapper.style.height = String(state.editorHeight) + 'px';\n  }\n\n  if (state?.code) {\n    editor.value = state.code;\n    updateHighlighting();\n  }\n\n  if (state?.lastOutput || state?.lastPlot) {\n    if (state.lastOutput) {\n      outputText.innerText = state.lastOutput;\n      outputText.style.display = 'block';\n    }\n    if (state.lastPlot) {\n      const img = document.createElement('img');\n      img.src = state.lastPlot;\n      outputPlot.innerHTML = '';\n      outputPlot.appendChild(img);\n      outputPlot.style.display = 'flex';\n    }\n    resultsSection.style.display = 'block';\n  }\n\n  // Persist editor resize (wrapper is resizable)\n  if (editorWrapper && typeof ResizeObserver !== 'undefined') {\n    let resizeT = null;\n    const ro = new ResizeObserver(() => {\n      if (isInitializing) return;\n      clearTimeout(resizeT);\n      resizeT = setTimeout(async () => {\n        const rect = editorWrapper.getBoundingClientRect();\n        const h = Math.round(rect.height);\n        if (h > 0 && (!state || state.editorHeight !== h)) {\n          await saveStatePartial({ editorHeight: h });\n        }\n      }, 500);\n    });\n    ro.observe(editorWrapper);\n  } else if (editorWrapper) {\n    // Fallback: save on pointerup/mouseup\n    const saveHeight = () => {\n      const h = Math.max(100, Math.round(editorWrapper.getBoundingClientRect().height));\n      saveStatePartial({ editorHeight: h });\n    };\n    editorWrapper.addEventListener('pointerup', saveHeight);\n    editorWrapper.addEventListener('mouseup', saveHeight);\n    editorWrapper.addEventListener('touchend', saveHeight);\n  }\n\n  // Allow ResizeObserver to start saving after a short delay\n  setTimeout(() => { isInitializing = false; }, 1000);\n\n  // Editing helpers\n  const INDENT = '    '; // 4 spaces\n\n  const getLineStart = (text, index) => {\n    const i = text.lastIndexOf('\\n', index - 1);\n    return i === -1 ? 0 : i + 1;\n  };\n\n  const getLineEnd = (text, index) => {\n    const i = text.indexOf('\\n', index);\n    return i === -1 ? text.length : i;\n  };\n\n  const getSelectedLineRange = (text, selStart, selEnd) => {\n    const startLineStart = getLineStart(text, selStart);\n    // if selection ends exactly at line start of next line, keep previous line\n    const adjustedEnd = selEnd > 0 && text[selEnd - 1] === '\\n' ? selEnd - 1 : selEnd;\n    const endLineEnd = getLineEnd(text, adjustedEnd);\n    return { start: startLineStart, end: endLineEnd };\n  };\n\n  const indentSelection = () => {\n    const text = editor.value;\n    const selStart = editor.selectionStart;\n    const selEnd = editor.selectionEnd;\n    const range = getSelectedLineRange(text, selStart, selEnd);\n    const before = text.slice(0, range.start);\n    const block = text.slice(range.start, range.end);\n    const after = text.slice(range.end);\n\n    const lines = block.split('\\n');\n    const indented = lines.map(l => INDENT + l).join('\\n');\n\n    editor.value = before + indented + after;\n\n    // Selection adjustment\n    const addedPerLine = INDENT.length;\n    const lineCount = lines.length;\n    const newSelStart = selStart + (selStart >= range.start ? addedPerLine : 0);\n    const newSelEnd = selEnd + addedPerLine * lineCount;\n\n    editor.selectionStart = newSelStart;\n    editor.selectionEnd = newSelEnd;\n    updateHighlighting();\n  };\n\n  const unindentSelection = () => {\n    const text = editor.value;\n    let selStart = editor.selectionStart;\n    let selEnd = editor.selectionEnd;\n\n    const range = getSelectedLineRange(text, selStart, selEnd);\n    const before = text.slice(0, range.start);\n    const block = text.slice(range.start, range.end);\n    const after = text.slice(range.end);\n\n    const lines = block.split('\\n');\n    let removedTotal = 0;\n    let removedBeforeSelStart = 0;\n    let removedBeforeSelEnd = 0;\n\n    // Compute line starts relative to block to adjust selection accurately\n    let cursor = 0;\n    const relSelStart = selStart - range.start;\n    const relSelEnd = selEnd - range.start;\n\n    const newLines = lines.map((line) => {\n      let removed = 0;\n      if (line.startsWith(INDENT)) {\n        removed = INDENT.length;\n        line = line.slice(INDENT.length);\n      } else if (line.startsWith('\\t')) {\n        removed = 1;\n        line = line.slice(1);\n      } else {\n        // remove up to 4 leading spaces\n        const m = line.match(/^ {1,4}/);\n        if (m) {\n          removed = m[0].length;\n          line = line.slice(removed);\n        }\n      }\n\n      // selection shift accounting\n      const lineStartRel = cursor;\n      const lineEndRel = cursor + line.length + removed; // + removed because original line had them\n\n      // if selection start is on/after this line start, it may shift\n      if (relSelStart >= lineStartRel) {\n        // if caret is within this line's original indent region, clamp shift\n        const withinIndent = relSelStart < lineStartRel + removed;\n        removedBeforeSelStart += withinIndent ? (relSelStart - lineStartRel) : removed;\n      }\n      if (relSelEnd >= lineStartRel) {\n        const withinIndentEnd = relSelEnd < lineStartRel + removed;\n        removedBeforeSelEnd += withinIndentEnd ? (relSelEnd - lineStartRel) : removed;\n      }\n\n      removedTotal += removed;\n      cursor += (line.length + removed) + 1; // +1 for newline in split representation\n      return line;\n    });\n\n    const unindented = newLines.join('\\n');\n    editor.value = before + unindented + after;\n\n    // Restore selection\n    const newStart = Math.max(range.start, selStart - removedBeforeSelStart);\n    const newEnd = Math.max(newStart, selEnd - removedBeforeSelEnd);\n    editor.selectionStart = newStart;\n    editor.selectionEnd = newEnd;\n\n    updateHighlighting();\n  };\n\n  const commentSelection = () => {\n    const text = editor.value;\n    const selStart = editor.selectionStart;\n    const selEnd = editor.selectionEnd;\n    const range = getSelectedLineRange(text, selStart, selEnd);\n\n    const before = text.slice(0, range.start);\n    const block = text.slice(range.start, range.end);\n    const after = text.slice(range.end);\n\n    const lines = block.split('\\n');\n    const commented = lines.map(l => '# ' + l).join('\\n');\n\n    editor.value = before + commented + after;\n\n    // Adjust selection: add 2 chars per line\n    const added = 2;\n    const newSelStart = selStart + (selStart >= range.start ? added : 0);\n    const newSelEnd = selEnd + added * lines.length;\n    editor.selectionStart = newSelStart;\n    editor.selectionEnd = newSelEnd;\n\n    updateHighlighting();\n  };\n\n  const uncommentSelection = () => {\n    const text = editor.value;\n    let selStart = editor.selectionStart;\n    let selEnd = editor.selectionEnd;\n    const range = getSelectedLineRange(text, selStart, selEnd);\n\n    const before = text.slice(0, range.start);\n    const block = text.slice(range.start, range.end);\n    const after = text.slice(range.end);\n\n    const lines = block.split('\\n');\n    let removedBeforeSelStart = 0;\n    let removedBeforeSelEnd = 0;\n\n    let cursor = 0;\n    const relSelStart = selStart - range.start;\n    const relSelEnd = selEnd - range.start;\n\n    const newLines = lines.map((line) => {\n      const m = line.match(/^(\\s*)(#\\s?)/);\n      let removed = 0;\n      if (m) {\n        removed = m[2].length;\n        line = m[1] + line.slice(m[1].length + removed);\n      }\n\n      const lineStartRel = cursor;\n      if (relSelStart >= lineStartRel && removed > 0) {\n        const indentLen = m ? m[1].length : 0;\n        const hashStart = lineStartRel + indentLen;\n        const within = relSelStart < hashStart + removed;\n        removedBeforeSelStart += within ? Math.max(0, relSelStart - hashStart) : removed;\n      }\n      if (relSelEnd >= lineStartRel && removed > 0) {\n        const indentLen = m ? m[1].length : 0;\n        const hashStart = lineStartRel + indentLen;\n        const withinEnd = relSelEnd < hashStart + removed;\n        removedBeforeSelEnd += withinEnd ? Math.max(0, relSelEnd - hashStart) : removed;\n      }\n\n      cursor += (line.length + removed) + 1;\n      return line;\n    });\n\n    const newBlock = newLines.join('\\n');\n    editor.value = before + newBlock + after;\n\n    const newStart = Math.max(range.start, selStart - removedBeforeSelStart);\n    const newEnd = Math.max(newStart, selEnd - removedBeforeSelEnd);\n    editor.selectionStart = newStart;\n    editor.selectionEnd = newEnd;\n\n    updateHighlighting();\n  };\n\n  // Ctrl+K chord handling (K then C/U)\n  let ctrlKPending = false;\n  let ctrlKTimer = null;\n  const resetCtrlK = () => {\n    ctrlKPending = false;\n    if (ctrlKTimer) clearTimeout(ctrlKTimer);\n    ctrlKTimer = null;\n  };\n\n  // Handle Keys\n  editor.onkeydown = (e) => {\n    const isCmd = e.metaKey;\n    const isCtrl = e.ctrlKey;\n    const mod = isCmd || isCtrl;\n\n    // Handle Ctrl/Cmd+K (start chord)\n    if (mod && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'k') {\n      e.preventDefault();\n      ctrlKPending = true;\n      if (ctrlKTimer) clearTimeout(ctrlKTimer);\n      ctrlKTimer = setTimeout(resetCtrlK, 1000);\n      return;\n    }\n\n    // Handle chord second key\n    if (ctrlKPending && !mod && !e.shiftKey && !e.altKey) {\n      const k = e.key.toLowerCase();\n      if (k === 'c') {\n        e.preventDefault();\n        commentSelection();\n        resetCtrlK();\n        return;\n      }\n      if (k === 'u') {\n        e.preventDefault();\n        uncommentSelection();\n        resetCtrlK();\n        return;\n      }\n      // any other key cancels chord\n      resetCtrlK();\n    }\n\n    // Tab / Shift+Tab\n    if (e.key === 'Tab') {\n      e.preventDefault();\n      if (e.shiftKey) {\n        unindentSelection();\n      } else {\n        // If selection is collapsed, keep original behavior (insert 4 spaces)\n        const start = editor.selectionStart;\n        const end = editor.selectionEnd;\n        if (start === end) {\n          editor.value = editor.value.substring(0, start) + INDENT + editor.value.substring(end);\n          editor.selectionStart = editor.selectionEnd = start + INDENT.length;\n          updateHighlighting();\n        } else {\n          indentSelection();\n        }\n      }\n      return;\n    }\n\n    // Ctrl+Enter to run\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      btnExecute.click();\n      return;\n    }\n  };\n\n  btnExecute.onclick = async () => {\n    if (btnExecute.disabled) return;\n\n    btnExecute.disabled = true;\n    loader.style.display = 'flex';\n    resultsSection.classList.add('ds-loading');\n\n    try {\n      if (!pyodide) {\n        loaderText.innerText = 'Loading Python & DS Libraries...';\n        await ensureBrowserPyodideLoader();\n        pyodide = await createPyodideInstance();\n        // ICI: Ajout de l'API ObsidGet dans Python\n        try { pyodide.registerJsModule(\"obsidget_api\", api); } catch (e) {}\n      }\n\n      loaderText.innerText = 'Executing...';\n\n      let stdout = '';\n      let stderr = '';\n      pyodide.setStdout({ batched: (str) => { stdout += str + '\\n'; } });\n      pyodide.setStderr({ batched: (str) => { stderr += str + '\\n'; } });\n\n      const code = editor.value;\n\n      // FIX BACKEND AGG: On ajoute le switch_backend('Agg') avant tout le reste\n      const runCode = \"import io, base64, sys\\nimport matplotlib\\nmatplotlib.use('Agg')\\nimport matplotlib.pyplot as plt\\nimport numpy as np\\nimport pandas as pd\\nimport micropip\\n\\n# Force backend non-interactif\\nplt.switch_backend('Agg')\\n\\ndef custom_show():\\n    fig = plt.gcf()\\n    if fig.get_axes():\\n        buf = io.BytesIO()\\n        plt.savefig(buf, format='png', dpi=100, bbox_inches='tight', facecolor='white')\\n        buf.seek(0)\\n        img_base64 = base64.b64encode(buf.read()).decode('UTF-8')\\n        print(f'__PLOT_DATA__:{img_base64}')\\n    plt.close('all')\\n\\nplt.show = custom_show\\nplt.close('all')\\n\\n\" + code + \"\\n\\ncustom_show()\";\n\n      await pyodide.runPythonAsync(runCode);\n\n      const plotMatch = stdout.match(/__PLOT_DATA__:([A-Za-z0-9+/=]+)/);\n      const cleanStdout = stdout.replace(/__PLOT_DATA__:[A-Za-z0-9+/=]+\\n?/, '').trim();\n\n      let lastPlot = null;\n      if (plotMatch) {\n        lastPlot = 'data:image/png;base64,' + plotMatch[1];\n        const img = document.createElement('img');\n        img.src = lastPlot;\n        outputPlot.innerHTML = '';\n        outputPlot.appendChild(img);\n        outputPlot.style.display = 'flex';\n      } else {\n        outputPlot.innerHTML = '';\n        outputPlot.style.display = 'none';\n      }\n\n      const lastOutput = cleanStdout + (stderr ? '\\n[stderr]\\n' + stderr : '');\n      if (lastOutput) {\n        outputText.innerText = lastOutput;\n        outputText.style.display = 'block';\n      } else {\n        outputText.innerText = '';\n        outputText.style.display = 'none';\n      }\n\n      resultsSection.style.display = 'block';\n      resultsSection.classList.remove('ds-loading');\n\n      await saveStatePartial({ code, lastOutput, lastPlot });\n\n    } catch (err) {\n      console.error('Pyodide Error:', err);\n      outputText.innerHTML = `<span style=\"color: #e74c3c\">Error: ${err?.message || String(err)}</span>`;\n      outputText.style.display = 'block';\n      resultsSection.style.display = 'block';\n      resultsSection.classList.remove('ds-loading');\n    } finally {\n      loader.style.display = 'none';\n      btnExecute.disabled = false;\n    }\n  };\n\n  btnClear.onclick = async () => {\n    editor.value = '';\n    updateHighlighting();\n    resultsSection.style.display = 'none';\n    await saveStatePartial({ code: '', lastOutput: null, lastPlot: null });\n  };\n\n  btnCopy.onclick = () => {\n    navigator.clipboard.writeText(editor.value);\n    try { new Notice('Code copied!'); } catch (e) {}\n  };\n\n  updateHighlighting();\n}\n\nfunction loadScriptOnce(url) {\n  return new Promise((resolve, reject) => {\n    const existing = document.querySelector(\"script[data-src='\" + url + \"']\");\n    if (existing) return resolve();\n    const script = document.createElement('script');\n    script.src = url;\n    script.async = true;\n    script.dataset.src = url;\n    script.onload = resolve;\n    script.onerror = () => reject(new Error('Failed to load script: ' + url));\n    document.head.appendChild(script);\n  });\n}\n\nasync function withNodeGlobalsHidden(fn) {\n  const g = globalThis;\n  const keys = ['process', 'require', 'module', 'exports', 'Buffer', 'global'];\n  const saved = {};\n  for (const k of keys) {\n    if (k in g) saved[k] = g[k];\n    try { g[k] = undefined; delete g[k]; } catch (e) {}\n  }\n  try { return await fn(); } finally {\n    for (const k of keys) { if (k in saved) g[k] = saved[k]; }\n  }\n}\n\nasync function ensureBrowserPyodideLoader() {\n  if (window.__PYODIDE_BROWSER_LOADER_READY__) return;\n  try { delete window.loadPyodide; } catch (e) {}\n  await withNodeGlobalsHidden(async () => {\n    await loadScriptOnce(PYODIDE_BASE + 'pyodide.js');\n    if (typeof window.loadPyodide !== 'function') throw new Error('Pyodide loader not found.');\n    window.__PYODIDE_BROWSER_LOADER_READY__ = true;\n  });\n}\n\nasync function createPyodideInstance() {\n  return await withNodeGlobalsHidden(async () => {\n    const instance = await window.loadPyodide({ indexURL: PYODIDE_BASE });\n    await instance.loadPackage(['numpy', 'matplotlib', 'pandas', 'scikit-learn', 'scipy', 'sympy', 'micropip']);\n    await instance.runPythonAsync('import micropip; await micropip.install(\"seaborn\")');\n    return instance;\n  });\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "reading-list",
      "title": "Reading List",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <span class=\"widget-icon\">📚</span>\n      <h4 class=\"widget-title\">Reading List Pro</h4>\n    </div>\n    <button class=\"btn-add\" id=\"btn-add\" title=\"Add New Book\">+</button>\n  </div>\n\n  <div class=\"book-grid\" id=\"book-grid\">\n    <!-- Dynamic book cards -->\n  </div>\n\n  <div class=\"stats-row\">\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"books-read\">0</span>\n      <label class=\"stat-lbl\">Finished</label>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-val\" id=\"pages-total\">0</span>\n      <label class=\"stat-lbl\">Pages Read</label>\n    </div>\n  </div>\n\n  <!-- Detail/Update Overlay -->\n  <div class=\"overlay\" id=\"detail-overlay\">\n    <div class=\"overlay-content\">\n      <div class=\"overlay-header\">\n        <h3 id=\"detail-title\">Book Title</h3>\n        <div class=\"header-btns\">\n          <button class=\"btn-icon-small\" id=\"btn-edit-book\" title=\"Edit Details\">✏️</button>\n          <button class=\"btn-close\" id=\"btn-close-detail\">✕</button>\n        </div>\n      </div>\n      \n      <div class=\"detail-body\">\n        <div class=\"detail-main-info\">\n            <div id=\"detail-cover-container\" class=\"detail-cover\"></div>\n            <div class=\"progress-visual\">\n              <svg viewBox=\"0 0 36 36\" class=\"circular-chart\">\n                <path class=\"circle-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" />\n                <path id=\"detail-circle\" class=\"circle\" stroke-dasharray=\"0, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" />\n                <text x=\"18\" y=\"20.35\" class=\"percentage\" id=\"detail-percent\">0%</text>\n              </svg>\n            </div>\n        </div>\n\n        <div class=\"progress-controls\">\n          <div class=\"input-group\">\n            <label>Current Progress</label>\n            <div class=\"slider-container\">\n              <input type=\"range\" id=\"input-slider\" min=\"0\" max=\"100\" value=\"0\" class=\"range-slider\">\n            </div>\n            <div class=\"number-input-row\">\n              <div class=\"number-input\">\n                <button class=\"step-btn\" id=\"btn-step-minus\">-</button>\n                <input type=\"number\" id=\"input-current-page\" value=\"0\">\n                <button class=\"step-btn\" id=\"btn-step-plus\">+</button>\n              </div>\n              <span class=\"total-pages-label\" id=\"detail-total-pages\">/ 300p</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"overlay-actions\">\n        <button class=\"btn-delete-book\" id=\"btn-delete-book\">Delete</button>\n        <button class=\"btn-save-progress\" id=\"btn-save-progress\">Update</button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Form Overlay (Add/Edit) -->\n  <div class=\"overlay\" id=\"form-overlay\">\n    <div class=\"overlay-content\">\n      <h3 id=\"form-title\">Add New Book</h3>\n      <div class=\"form-body\">\n        <div class=\"input-field\">\n          <label>Title</label>\n          <input type=\"text\" id=\"book-title-input\" placeholder=\"e.g. Atomic Habits\">\n        </div>\n        <div class=\"input-field\">\n          <label>Author</label>\n          <input type=\"text\" id=\"book-author-input\" placeholder=\"e.g. James Clear\">\n        </div>\n        <div class=\"input-row\">\n          <div class=\"input-field\">\n            <label>Total Pages</label>\n            <input type=\"number\" id=\"book-total-input\" value=\"300\">\n          </div>\n          <div class=\"input-field\">\n            <label>Emoji</label>\n            <input type=\"text\" id=\"book-emoji-input\" placeholder=\"📖\">\n          </div>\n        </div>\n        <div class=\"cover-search-box\">\n           <button class=\"btn-secondary\" id=\"btn-search-books\">🔍 Search Online (FR/EN)</button>\n           <div id=\"cover-preview-container\" class=\"cover-preview\" style=\"display:none\">\n              <img id=\"cover-preview-img\" src=\"\" alt=\"Cover Preview\">\n              <button class=\"btn-remove-cover\" id=\"btn-remove-cover\">×</button>\n           </div>\n        </div>\n      </div>\n      <div class=\"overlay-actions\">\n        <button class=\"btn-cancel\" id=\"btn-close-form\">Cancel</button>\n        <button class=\"btn-save-progress\" id=\"btn-confirm-form\">Save</button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Search Results Overlay -->\n  <div class=\"overlay\" id=\"search-overlay\">\n    <div class=\"overlay-content search-results-content\">\n      <div class=\"overlay-header\">\n        <h3>Search Results</h3>\n        <button class=\"btn-close\" id=\"btn-close-search\">✕</button>\n      </div>\n      <div id=\"search-results-list\" class=\"search-results-list\">\n        <!-- Results here -->\n      </div>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.25rem;\n    box-shadow: var(--shadow-s);\n    position: relative;\n    overflow: hidden;\n    min-height: 400px;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.widget-icon { font-size: 1.2rem; }\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 800;\n    color: var(--text-normal);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.btn-add {\n    background: var(--interactive-accent);\n    color: white;\n    border: none;\n    width: 28px;\n    height: 28px;\n    border-radius: 8px;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-add:hover { transform: scale(1.1); }\n\n.book-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 15px;\n    margin-bottom: 1rem;\n    max-height: 450px;\n    overflow-y: auto;\n    padding: 10px 5px;\n}\n\n.book-item {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    cursor: pointer;\n    transition: all 0.2s;\n    position: relative;\n}\n\n.book-card-visual {\n    width: 100%;\n    aspect-ratio: 2/3;\n    background: var(--background-primary);\n    border-radius: 12px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n    box-shadow: var(--shadow-s);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n}\n\n.book-item:hover .book-card-visual {\n    transform: translateY(-4px);\n    border-color: var(--interactive-accent);\n    box-shadow: var(--shadow-m);\n}\n\n.card-cover-img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.card-emoji {\n    font-size: 2.5rem;\n}\n\n.card-progress-overlay {\n    position: absolute;\n    bottom: 0; left: 0; width: 100%;\n    height: 4px;\n    background: rgba(255,255,255,0.2);\n}\n\n.card-progress-fill {\n    height: 100%;\n    background: var(--interactive-accent);\n    transition: width 0.3s;\n}\n\n.card-info {\n    text-align: center;\n}\n\n.book-title {\n    display: block;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: var(--text-normal);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-bottom: 2px;\n}\n\n.book-author {\n    display: block;\n    font-size: 0.6rem;\n    color: var(--text-muted);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.stats-row {\n    display: flex;\n    justify-content: space-around;\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 0.75rem;\n}\n\n.stat-item { text-align: center; }\n.stat-val { display: block; font-size: 1.1rem; font-weight: 800; color: var(--text-normal); }\n.stat-lbl { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-faint); }\n\n/* Overlays */\n.overlay {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: rgba(0,0,0,0.7);\n    backdrop-filter: blur(8px);\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 100;\n    padding: 0.5rem;\n}\n.overlay.show { display: flex; }\n\n.overlay-content {\n    background: var(--background-primary);\n    padding: 1rem;\n    border-radius: 20px;\n    width: 100%;\n    max-width: 280px;\n    max-height: 98%;\n    overflow-y: auto;\n    box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n    display: flex;\n    flex-direction: column;\n}\n\n.overlay-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.overlay-header h3 {\n    margin: 0;\n    font-size: 0.9rem;\n    color: var(--text-accent);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 180px;\n}\n\n.detail-main-info {\n    display: flex;\n    gap: 15px;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.detail-cover {\n    width: 80px;\n    aspect-ratio: 2/3;\n    background: var(--background-secondary);\n    border-radius: 8px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.detail-cover img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.detail-cover span {\n    font-size: 2rem;\n}\n\n.circular-chart {\n    max-width: 70px;\n}\n.circle-bg { fill: none; stroke: var(--background-modifier-border); stroke-width: 2.8; }\n.circle { fill: none; stroke: var(--interactive-accent); stroke-width: 2.8; stroke-linecap: round; transition: stroke-dasharray 0.3s; }\n.percentage { fill: var(--text-normal); font-size: 0.5rem; font-weight: 800; text-anchor: middle; }\n\n.progress-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin-bottom: 1rem;\n}\n\n.slider-container {\n    margin-bottom: 8px;\n}\n\n.range-slider {\n    width: 100%;\n    height: 6px;\n    background: var(--background-modifier-border);\n    border-radius: 10px;\n    appearance: none;\n    outline: none;\n}\n\n.range-slider::-webkit-slider-thumb {\n    appearance: none;\n    width: 16px;\n    height: 16px;\n    background: var(--interactive-accent);\n    border-radius: 50%;\n    cursor: pointer;\n    border: 2px solid var(--background-primary);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n}\n\n.number-input-row {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n}\n\n.total-pages-label {\n    font-size: 0.75rem;\n    font-weight: 700;\n    color: var(--text-faint);\n}\n\n.number-input {\n    display: flex;\n    align-items: center;\n    background: var(--background-secondary);\n    border-radius: 8px;\n    padding: 2px;\n    border: 1px solid var(--background-modifier-border);\n}\n.number-input input {\n    width: 45px;\n    background: transparent;\n    border: none;\n    color: var(--text-normal);\n    text-align: center;\n    font-weight: 700;\n    outline: none;\n    font-size: 0.85rem;\n}\n.step-btn {\n    background: var(--background-modifier-hover);\n    border: none;\n    color: var(--text-normal);\n    width: 22px;\n    height: 22px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-weight: 800;\n}\n\n.input-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 8px;\n}\n\n.input-field input {\n    width: 100%;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 6px 10px;\n    border-radius: 8px;\n    outline: none;\n    font-size: 0.8rem;\n}\n\n.cover-search-box {\n    margin-top: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.btn-secondary {\n    background: var(--background-modifier-border);\n    color: var(--text-normal);\n    border: none;\n    padding: 8px;\n    border-radius: 8px;\n    font-size: 0.75rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-secondary:hover { background: var(--background-modifier-hover); }\n\n.cover-preview {\n    position: relative;\n    width: 60px;\n    height: 90px;\n    margin: 0 auto;\n    border-radius: 6px;\n    overflow: hidden;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.cover-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.btn-remove-cover {\n    position: absolute;\n    top: 2px; right: 2px;\n    background: rgba(0,0,0,0.5);\n    color: white;\n    border: none;\n    width: 18px; height: 18px;\n    border-radius: 50%;\n    cursor: pointer;\n    font-size: 10px;\n    display: flex; align-items: center; justify-content: center;\n}\n\n.search-results-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin-top: 10px;\n}\n\n.search-result-item {\n    display: flex;\n    gap: 12px;\n    padding: 8px;\n    background: var(--background-secondary);\n    border-radius: 12px;\n    cursor: pointer;\n    transition: all 0.2s;\n    border: 1px solid transparent;\n}\n\n.search-result-item:hover {\n    background: var(--background-modifier-hover);\n    border-color: var(--interactive-accent);\n}\n\n.search-result-cover {\n    width: 40px;\n    height: 60px;\n    background: var(--background-primary);\n    border-radius: 4px;\n    object-fit: cover;\n}\n\n.search-result-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    min-width: 0;\n}\n\n.search-result-title {\n    font-weight: 700;\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.search-result-author {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n}\n\n.search-result-meta {\n    font-size: 0.6rem;\n    color: var(--text-faint);\n    margin-top: 2px;\n}\n\n.overlay-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: auto;\n}\n\n.btn-save-progress, .btn-delete-book, .btn-cancel {\n    flex: 1;\n    padding: 8px;\n    border-radius: 10px;\n    font-weight: 700;\n    cursor: pointer;\n    border: none;\n    font-size: 0.75rem;\n}\n\n.btn-save-progress { background: var(--interactive-accent); color: white; }\n.btn-delete-book { background: var(--background-modifier-error); color: white; }\n.btn-cancel { background: var(--background-modifier-border); color: var(--text-normal); }\n\n/* Custom Scrollbar */\n.book-grid::-webkit-scrollbar, .overlay-content::-webkit-scrollbar, .search-results-list::-webkit-scrollbar {\n    width: 4px;\n}\n.book-grid::-webkit-scrollbar-thumb, .overlay-content::-webkit-scrollbar-thumb, .search-results-list::-webkit-scrollbar-thumb {\n    background: var(--background-modifier-border);\n    border-radius: 10px;\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet books = [\n    { title: 'Atomic Habits', author: 'James Clear', pages: 320, current: 150, emoji: '🔋', cover: null },\n    { title: 'Deep Work', author: 'Cal Newport', pages: 296, current: 296, emoji: '🧠', cover: null }\n];\n\nlet selectedIdx = null;\nlet isEditing = false;\nlet tempCover = null;\n\nfunction render() {\n    const grid = root.getElementById('book-grid');\n    grid.innerHTML = '';\n    \n    let readCount = 0;\n    let totalPagesRead = 0;\n\n    books.forEach((book, idx) => {\n        const isRead = book.current >= book.pages;\n        if (isRead) readCount++;\n        totalPagesRead += book.current;\n\n        const percent = Math.min(100, Math.round((book.current / book.pages) * 100));\n        \n        const card = document.createElement('div');\n        card.className = 'book-item';\n        \n        const visualContent = book.cover \n            ? `<img src=\"${book.cover}\" class=\"card-cover-img\" alt=\"Cover\">` \n            : `<span class=\"card-emoji\">${book.emoji || '📖'}</span>`;\n\n        card.innerHTML = `\n            <div class=\"book-card-visual\">\n                ${visualContent}\n                <div class=\"card-progress-overlay\">\n                    <div class=\"card-progress-fill\" style=\"width: ${percent}%\"></div>\n                </div>\n            </div>\n            <div class=\"card-info\">\n                <span class=\"book-title\">${book.title}</span>\n                <span class=\"book-author\">${book.author}</span>\n            </div>\n        `;\n        \n        card.onclick = () => openDetail(idx);\n        grid.appendChild(card);\n    });\n\n    root.getElementById('books-read').innerText = readCount;\n    root.getElementById('pages-total').innerText = totalPagesRead;\n}\n\nfunction updateDetailVisuals(current, total) {\n    const percent = Math.min(100, Math.round((current / total) * 100));\n    root.getElementById('detail-percent').textContent = percent + '%';\n    root.getElementById('detail-circle').setAttribute('stroke-dasharray', `${percent}, 100`);\n    \n    const slider = root.getElementById('input-slider');\n    slider.max = total;\n    slider.value = current;\n    \n    root.getElementById('input-current-page').value = current;\n}\n\nfunction openDetail(idx) {\n    selectedIdx = idx;\n    const book = books[idx];\n\n    root.getElementById('detail-title').innerText = book.title;\n    root.getElementById('detail-total-pages').innerText = `/ ${book.pages}p`;\n    \n    const coverContainer = root.getElementById('detail-cover-container');\n    if (book.cover) {\n        coverContainer.innerHTML = `<img src=\"${book.cover}\" alt=\"Cover\">`;\n    } else {\n        coverContainer.innerHTML = `<span>${book.emoji || '📖'}</span>`;\n    }\n\n    updateDetailVisuals(book.current, book.pages);\n    root.getElementById('detail-overlay').classList.add('show');\n}\n\nfunction closeDetail() {\n    root.getElementById('detail-overlay').classList.remove('show');\n    selectedIdx = null;\n}\n\nfunction saveProgress() {\n    if (selectedIdx === null) return;\n    const newVal = parseInt(root.getElementById('input-current-page').value);\n    books[selectedIdx].current = Math.max(0, Math.min(books[selectedIdx].pages, newVal));\n    \n    closeDetail();\n    render();\n    saveState(books);\n}\n\nfunction deleteBook() {\n    if (selectedIdx === null) return;\n    if (confirm(`Delete \"${books[selectedIdx].title}\"?`)) {\n        books.splice(selectedIdx, 1);\n        closeDetail();\n        render();\n        saveState(books);\n    }\n}\n\nasync function searchBooks() {\n    const title = root.getElementById('book-title-input').value;\n    const author = root.getElementById('book-author-input').value;\n    if (!title) return alert('Please enter a title first.');\n\n    const btn = root.getElementById('btn-search-books');\n    btn.innerText = '⌛ Searching...';\n    btn.disabled = true;\n\n    try {\n        const query = encodeURIComponent(`${title} ${author}`);\n        // Open Library search with multiple languages support\n        const response = await fetch(`https://openlibrary.org/search.json?q=${query}&limit=10`);\n        const data = await response.json();\n\n        if (data.docs && data.docs.length > 0) {\n            displaySearchResults(data.docs);\n        } else {\n            alert('No books found.');\n        }\n    } catch (e) {\n        console.error(e);\n        alert('Error searching books.');\n    } finally {\n        btn.innerText = '🔍 Search Online (FR/EN)';\n        btn.disabled = false;\n    }\n}\n\nfunction displaySearchResults(docs) {\n    const list = root.getElementById('search-results-list');\n    list.innerHTML = '';\n    \n    docs.forEach(doc => {\n        const pages = doc.number_of_pages_median || doc.number_of_pages || 0;\n        const author = doc.author_name ? doc.author_name[0] : 'Unknown Author';\n        const lang = doc.language ? doc.language.join(', ') : '';\n        const coverUrl = doc.cover_i ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-S.jpg` : null;\n\n        const item = document.createElement('div');\n        item.className = 'search-result-item';\n        item.innerHTML = `\n            ${coverUrl ? `<img src=\"${coverUrl}\" class=\"search-result-cover\">` : '<div class=\"search-result-cover\" style=\"display:flex;align-items:center;justify-content:center;font-size:20px\">📖</div>'}\n            <div class=\"search-result-info\">\n                <div class=\"search-result-title\">${doc.title}</div>\n                <div class=\"search-result-author\">${author}</div>\n                <div class=\"search-result-meta\">${pages > 0 ? pages + 'p' : ''} ${lang ? '• ' + lang.toUpperCase() : ''}</div>\n            </div>\n        `;\n        \n        item.onclick = () => selectBook(doc);\n        list.appendChild(item);\n    });\n\n    root.getElementById('search-overlay').classList.add('show');\n}\n\nfunction selectBook(doc) {\n    root.getElementById('book-title-input').value = doc.title;\n    root.getElementById('book-author-input').value = doc.author_name ? doc.author_name[0] : '';\n    \n    let pages = doc.number_of_pages_median || doc.number_of_pages || 300;\n    if (Array.isArray(pages)) pages = pages[0];\n    root.getElementById('book-total-input').value = pages;\n\n    if (doc.cover_i) {\n        tempCover = `https://covers.openlibrary.org/b/id/${doc.cover_i}-M.jpg`;\n        showCoverPreview(tempCover);\n    } else if (doc.isbn && doc.isbn.length > 0) {\n        tempCover = `https://covers.openlibrary.org/b/isbn/${doc.isbn[0]}-M.jpg`;\n        showCoverPreview(tempCover);\n    } else {\n        removeCover();\n    }\n\n    root.getElementById('search-overlay').classList.remove('show');\n}\n\nfunction showCoverPreview(url) {\n    const container = root.getElementById('cover-preview-container');\n    const img = root.getElementById('cover-preview-img');\n    img.src = url;\n    container.style.display = 'block';\n}\n\nfunction removeCover() {\n    tempCover = null;\n    root.getElementById('cover-preview-container').style.display = 'none';\n}\n\nfunction openForm(idx = null) {\n    isEditing = idx !== null;\n    selectedIdx = idx;\n    \n    const title = root.getElementById('form-title');\n    const inputTitle = root.getElementById('book-title-input');\n    const inputAuthor = root.getElementById('book-author-input');\n    const inputTotal = root.getElementById('book-total-input');\n    const inputEmoji = root.getElementById('book-emoji-input');\n\n    if (isEditing) {\n        const book = books[idx];\n        title.innerText = \"Edit Book\";\n        inputTitle.value = book.title;\n        inputAuthor.value = book.author;\n        inputTotal.value = book.pages;\n        inputEmoji.value = book.emoji || '📖';\n        tempCover = book.cover;\n        if (tempCover) showCoverPreview(tempCover);\n        else removeCover();\n        root.getElementById('detail-overlay').classList.remove('show');\n    } else {\n        title.innerText = \"Add New Book\";\n        inputTitle.value = '';\n        inputAuthor.value = '';\n        inputTotal.value = 300;\n        inputEmoji.value = '📖';\n        removeCover();\n    }\n\n    root.getElementById('form-overlay').classList.add('show');\n}\n\nfunction closeForm() {\n    root.getElementById('form-overlay').classList.remove('show');\n    if (isEditing && selectedIdx !== null) {\n        openDetail(selectedIdx);\n    }\n}\n\nfunction confirmForm() {\n    const title = root.getElementById('book-title-input').value || 'New Book';\n    const author = root.getElementById('book-author-input').value || 'Unknown';\n    const total = parseInt(root.getElementById('book-total-input').value) || 300;\n    const emoji = root.getElementById('book-emoji-input').value || '📖';\n\n    if (isEditing && selectedIdx !== null) {\n        books[selectedIdx].title = title;\n        books[selectedIdx].author = author;\n        books[selectedIdx].pages = total;\n        books[selectedIdx].emoji = emoji;\n        books[selectedIdx].cover = tempCover;\n        books[selectedIdx].current = Math.min(books[selectedIdx].current, total);\n    } else {\n        books.push({\n            title: title,\n            author: author,\n            pages: total,\n            current: 0,\n            emoji: emoji,\n            cover: tempCover\n        });\n    }\n\n    root.getElementById('form-overlay').classList.remove('show');\n    render();\n    saveState(books);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) books = saved;\n\n    root.getElementById('btn-add').onclick = () => openForm();\n    root.getElementById('btn-close-form').onclick = closeForm;\n    root.getElementById('btn-confirm-form').onclick = confirmForm;\n    root.getElementById('btn-search-books').onclick = searchBooks;\n    root.getElementById('btn-close-search').onclick = () => root.getElementById('search-overlay').classList.remove('show');\n    root.getElementById('btn-remove-cover').onclick = removeCover;\n    \n    root.getElementById('btn-close-detail').onclick = closeDetail;\n    root.getElementById('btn-save-progress').onclick = saveProgress;\n    root.getElementById('btn-delete-book').onclick = deleteBook;\n    root.getElementById('btn-edit-book').onclick = () => openForm(selectedIdx);\n\n    const pageInput = root.getElementById('input-current-page');\n    const slider = root.getElementById('input-slider');\n\n    slider.oninput = (e) => {\n        const val = parseInt(e.target.value);\n        pageInput.value = val;\n        updateDetailVisuals(val, books[selectedIdx].pages);\n    };\n\n    pageInput.oninput = (e) => {\n        const val = Math.max(0, Math.min(books[selectedIdx].pages, parseInt(e.target.value) || 0));\n        slider.value = val;\n        updateDetailVisuals(val, books[selectedIdx].pages);\n    };\n\n    root.getElementById('btn-step-minus').onclick = () => {\n        const val = Math.max(0, parseInt(pageInput.value) - 1);\n        pageInput.value = val;\n        slider.value = val;\n        updateDetailVisuals(val, books[selectedIdx].pages);\n    };\n    root.getElementById('btn-step-plus').onclick = () => {\n        const val = Math.min(books[selectedIdx].pages, parseInt(pageInput.value) + 1);\n        pageInput.value = val;\n        slider.value = val;\n        updateDetailVisuals(val, books[selectedIdx].pages);\n    };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "regex-studio",
      "title": "Regex Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <span class=\"widget-icon\">🔍</span>\n      <h4 class=\"widget-title\">Regex Studio Pro</h4>\n    </div>\n    <div class=\"header-actions\">\n      <button class=\"btn-icon\" id=\"btn-copy-header\" title=\"Copy Result\">📋</button>\n    </div>\n  </div>\n\n  <div class=\"presets-container\">\n    <div class=\"presets-header\">\n        <div class=\"presets-label\">Presets</div>\n        <button class=\"btn-add-preset\" id=\"btn-add-preset\" title=\"Add New Preset\">+</button>\n    </div>\n    <div class=\"presets-list\" id=\"presets-list\">\n      <!-- Presets will be injected here -->\n    </div>\n  </div>\n\n  <div class=\"input-section\">\n    <div class=\"input-group\">\n      <div class=\"label-row\">\n        <label>Pattern</label>\n        <div class=\"flags-group\">\n          <button class=\"flag-btn active\" data-flag=\"g\" title=\"Global\">g</button>\n          <button class=\"flag-btn\" data-flag=\"i\" title=\"Case Insensitive\">i</button>\n          <button class=\"flag-btn\" data-flag=\"m\" title=\"Multiline\">m</button>\n        </div>\n      </div>\n      <div class=\"pattern-input-wrapper\">\n        <span class=\"slash\">/</span>\n        <input type=\"text\" id=\"regex-pattern\" placeholder=\"[a-z]+\">\n        <span class=\"slash\">/</span>\n        <span id=\"active-flags\" class=\"active-flags-text\">g</span>\n      </div>\n    </div>\n\n    <div class=\"input-group\">\n      <label>Test String</label>\n      <textarea id=\"regex-input\" placeholder=\"Paste your text here to test the regex...\"></textarea>\n    </div>\n  </div>\n\n  <div class=\"output-section\">\n    <div class=\"output-header\">\n      <div class=\"output-label-group\">\n        <label>Result</label>\n        <button class=\"btn-copy-small\" id=\"btn-copy-result\" title=\"Copy Result\">Copy</button>\n      </div>\n      <div class=\"output-controls\">\n        <div class=\"separator-select\" id=\"sep-container\" style=\"display:none\">\n          <button class=\"sep-btn active\" data-sep=\"\\n\" title=\"New Line\">↵</button>\n          <button class=\"sep-btn\" data-sep=\",\" title=\"Comma\">,</button>\n          <button class=\"sep-btn\" data-sep=\";\" title=\"Semicolon\">;</button>\n          <button class=\"sep-btn\" data-sep=\" \" title=\"Space\">␣</button>\n        </div>\n        <div class=\"mode-toggle\">\n          <button class=\"mode-btn active\" id=\"mode-highlight\">Highlight</button>\n          <button class=\"mode-btn\" id=\"mode-extract\">Extract</button>\n        </div>\n      </div>\n    </div>\n    <div id=\"regex-result\" class=\"regex-match-box\">Waiting for input...</div>\n    <div id=\"match-stats\" class=\"match-stats\">0 matches found</div>\n  </div>\n\n  <!-- Add Preset Overlay -->\n  <div class=\"overlay\" id=\"preset-overlay\">\n    <div class=\"overlay-content\">\n      <h3>Add New Preset</h3>\n      <div class=\"form-body\">\n        <div class=\"input-field\">\n          <label>Name</label>\n          <input type=\"text\" id=\"new-preset-name\" placeholder=\"e.g. My Pattern\">\n        </div>\n        <div class=\"input-field\">\n          <label>Pattern</label>\n          <input type=\"text\" id=\"new-preset-pattern\" placeholder=\"e.g. \\d+\">\n        </div>\n      </div>\n      <div class=\"overlay-actions\">\n        <button class=\"btn-cancel\" id=\"btn-close-preset\">Cancel</button>\n        <button class=\"btn-save\" id=\"btn-save-preset\">Save</button>\n      </div>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.25rem;\n    box-shadow: var(--shadow-s);\n    position: relative;\n    overflow: hidden;\n    min-height: 450px;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.widget-icon { font-size: 1.2rem; }\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 800;\n    color: var(--text-normal);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    width: 32px;\n    height: 32px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); transform: scale(1.05); }\n\n/* Presets */\n.presets-container {\n    margin-bottom: 1.25rem;\n}\n.presets-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n.presets-label {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-faint);\n    text-transform: uppercase;\n}\n.btn-add-preset {\n    background: var(--interactive-accent);\n    color: white;\n    border: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 800;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n.btn-add-preset:hover { transform: scale(1.1); }\n\n.presets-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-top: 4px;\n}\n\n.preset-chip {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    padding: 6px 10px;\n    border-radius: 20px;\n    font-size: 0.75rem;\n    font-weight: 600;\n    white-space: nowrap;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n.preset-chip:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    border-color: var(--interactive-accent);\n}\n\n.btn-del-preset {\n    font-size: 0.6rem;\n    opacity: 0.4;\n    transition: opacity 0.2s;\n    padding: 2px;\n}\n.preset-chip:hover .btn-del-preset {\n    opacity: 1;\n}\n.btn-del-preset:hover {\n    color: var(--text-error);\n}\n\n/* Inputs */\n.input-section {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    margin-bottom: 1.25rem;\n}\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 6px;\n}\n\nlabel {\n    font-size: 0.65rem;\n    font-weight: 700;\n    color: var(--text-faint);\n    text-transform: uppercase;\n}\n\n.flags-group {\n    display: flex;\n    gap: 4px;\n}\n\n.flag-btn {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-faint);\n    width: 24px;\n    height: 24px;\n    border-radius: 6px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.flag-btn.active {\n    background: var(--interactive-accent);\n    color: white;\n    border-color: var(--interactive-accent);\n}\n\n.pattern-input-wrapper {\n    display: flex;\n    align-items: center;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 0 12px;\n    gap: 4px;\n}\n.pattern-input-wrapper:focus-within {\n    border-color: var(--interactive-accent);\n    box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.1);\n}\n\n.slash {\n    color: var(--text-faint);\n    font-family: var(--font-monospace);\n    font-weight: 700;\n}\n\n#regex-pattern {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--text-accent);\n    padding: 10px 0;\n    font-family: var(--font-monospace);\n    font-size: 0.9rem;\n    outline: none;\n}\n\n.active-flags-text {\n    color: var(--text-accent);\n    font-family: var(--font-monospace);\n    font-weight: 700;\n    font-size: 0.9rem;\n}\n\n#regex-input {\n    width: 100%;\n    height: 100px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 12px;\n    border-radius: 12px;\n    font-family: var(--font-monospace);\n    font-size: 0.85rem;\n    outline: none;\n    resize: vertical;\n}\n#regex-input:focus { border-color: var(--interactive-accent); }\n\n/* Output */\n.output-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.output-label-group {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.output-controls {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.separator-select {\n    display: flex;\n    background: var(--background-primary);\n    padding: 2px;\n    border-radius: 8px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.sep-btn {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    width: 24px;\n    height: 24px;\n    border-radius: 6px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.sep-btn.active {\n    background: var(--background-modifier-hover);\n    color: var(--interactive-accent);\n}\n\n.btn-copy-small {\n    background: var(--background-modifier-border);\n    border: none;\n    color: var(--text-muted);\n    font-size: 0.6rem;\n    padding: 2px 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 700;\n    text-transform: uppercase;\n    transition: all 0.2s;\n}\n.btn-copy-small:hover { background: var(--background-modifier-hover); color: var(--text-normal); }\n\n.mode-toggle {\n    display: flex;\n    background: var(--background-primary);\n    padding: 2px;\n    border-radius: 8px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.mode-btn {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    padding: 4px 10px;\n    border-radius: 6px;\n    font-size: 0.65rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.mode-btn.active {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n}\n\n.regex-match-box {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    padding: 12px;\n    border-radius: 12px;\n    font-family: var(--font-monospace);\n    font-size: 0.85rem;\n    line-height: 1.6;\n    min-height: 60px;\n    max-height: 200px;\n    overflow-y: auto;\n    word-break: break-all;\n    white-space: pre-wrap;\n}\n\n.highlight {\n    background: rgba(var(--interactive-accent-rgb), 0.2);\n    border-bottom: 2px solid var(--interactive-accent);\n    border-radius: 2px;\n    color: var(--text-normal);\n}\n\n.match-stats {\n    font-size: 0.65rem;\n    color: var(--text-faint);\n    margin-top: 6px;\n    text-align: right;\n    font-weight: 600;\n}\n\n.extract-item {\n    display: inline-block;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    padding: 2px 8px;\n    border-radius: 4px;\n    color: var(--text-accent);\n}\n\n.sep-visual {\n    color: var(--text-faint);\n    font-weight: 800;\n    margin: 0 4px;\n}\n\n/* Overlays */\n.overlay {\n    position: absolute;\n    top: 0; left: 0; width: 100%; height: 100%;\n    background: rgba(0,0,0,0.7);\n    backdrop-filter: blur(88px);\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 100;\n    padding: 0.5rem;\n}\n.overlay.show { display: flex; }\n\n.overlay-content {\n    background: var(--background-primary);\n    padding: 1.25rem;\n    border-radius: 20px;\n    width: 100%;\n    max-width: 280px;\n    box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n}\n\n.overlay-content h3 { margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--text-accent); }\n\n.form-body { display: flex; flex-direction: column; gap: 12px; }\n\n.input-field input {\n    width: 100%;\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 8px 12px;\n    border-radius: 8px;\n    outline: none;\n    font-size: 0.8rem;\n}\n\n.overlay-actions {\n    display: flex;\n    gap: 8px;\n    margin-top: 1.25rem;\n}\n\n.btn-save, .btn-cancel {\n    flex: 1;\n    padding: 8px;\n    border-radius: 8px;\n    font-weight: 700;\n    cursor: pointer;\n    border: none;\n    font-size: 0.75rem;\n}\n.btn-save { background: var(--interactive-accent); color: white; }\n.btn-cancel { background: var(--background-modifier-border); color: var(--text-normal); }\n\n/* Custom Scrollbar */\n.regex-match-box::-webkit-scrollbar {\n    width: 4px;\n}\n.regex-match-box::-webkit-scrollbar-thumb {\n    background: var(--background-modifier-border);\n    border-radius: 10px;\n}",
      "js": "const { root, saveState, getState } = api;\n\nconst defaultPresets = [\n    { name: 'Email', pattern: '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}', canDelete: false },\n    { name: 'URL', pattern: 'https?:\\\\/\\\\/(?:www\\\\.)?[-a-zA-Z0-9@:%._\\\\+~#=]{1,256}\\\\.[a-zA-Z0-9()]{1,6}\\\\b(?:[-a-zA-Z0-9()@:%_\\\\+.~#?&\\\\/=]*)', canDelete: false },\n    { name: 'Hashtag', pattern: '#[a-zA-Z0-9_/]+', canDelete: false },\n    { name: 'MD Link', pattern: '\\\\[([^\\\\]]+)\\\\]\\\\(([^)]+)\\\\)', canDelete: false },\n    { name: 'IPv4', pattern: '\\\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\b', canDelete: false },\n    { name: 'MAC Addr', pattern: '([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})', canDelete: false },\n    { name: 'CVE', pattern: 'CVE-\\\\d{4}-\\\\d{4,7}', canDelete: false },\n    { name: 'Hex Color', pattern: '#(?:[0-9a-fA-F]{3}){1,2}', canDelete: false },\n    { name: 'HTML Tag', pattern: '<[^>]+>', canDelete: false },\n    { name: 'UUID', pattern: '[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}', canDelete: false },\n    { name: 'AI Prompt', pattern: '{{[^}]+}}', canDelete: false },\n    { name: 'Date (ISO)', pattern: '\\\\d{4}-\\\\d{2}-\\\\d{2}', canDelete: false },\n    { name: 'Digits', pattern: '\\\\d+', canDelete: false }\n];\n\nlet userPresets = [];\nlet currentMode = 'highlight';\nlet currentFlags = 'g';\nlet currentSeparator = '\\\\n';\n\nfunction renderPresets() {\n    const list = root.getElementById('presets-list');\n    list.innerHTML = '';\n    \n    const allPresets = [...defaultPresets, ...userPresets];\n    \n    allPresets.forEach((p, idx) => {\n        const chip = document.createElement('div');\n        chip.className = 'preset-chip';\n        chip.innerHTML = `\n            <span>${p.name}</span>\n            ${p.canDelete !== false ? `<span class=\"btn-del-preset\" data-idx=\"${idx - defaultPresets.length}\">✕</span>` : ''}\n        `;\n        \n        chip.onclick = (e) => {\n            if (e.target.classList.contains('btn-del-preset')) {\n                deletePreset(parseInt(e.target.dataset.idx));\n                return;\n            }\n            root.getElementById('regex-pattern').value = p.pattern;\n            updateRegex();\n            saveAll();\n        };\n        list.appendChild(chip);\n    });\n}\n\nfunction deletePreset(idx) {\n    if (confirm(`Delete preset \"${userPresets[idx].name}\"?`)) {\n        userPresets.splice(idx, 1);\n        renderPresets();\n        saveAll();\n    }\n}\n\nfunction addPreset() {\n    const name = root.getElementById('new-preset-name').value;\n    const pattern = root.getElementById('new-preset-pattern').value;\n    \n    if (!name || !pattern) return alert('Please fill both name and pattern.');\n    \n    userPresets.push({ name, pattern, canDelete: true });\n    root.getElementById('preset-overlay').classList.remove('show');\n    renderPresets();\n    saveAll();\n}\n\nfunction updateRegex() {\n    const patternStr = root.getElementById('regex-pattern').value;\n    const inputText = root.getElementById('regex-input').value;\n    const resultBox = root.getElementById('regex-result');\n    const statsBox = root.getElementById('match-stats');\n    const sepContainer = root.getElementById('sep-container');\n\n    if (!patternStr || !inputText) {\n        resultBox.innerText = 'Waiting for input...';\n        statsBox.innerText = '0 matches found';\n        return;\n    }\n\n    sepContainer.style.display = currentMode === 'extract' ? 'flex' : 'none';\n\n    try {\n        const re = new RegExp(patternStr, currentFlags);\n        const matches = inputText.match(re);\n        const matchCount = matches ? matches.length : 0;\n        statsBox.innerText = `${matchCount} matches found`;\n\n        if (currentMode === 'highlight') {\n            const highlightRe = new RegExp('(' + patternStr + ')', currentFlags);\n            const highlighted = inputText.replace(highlightRe, '<span class=\"highlight\">$1</span>');\n            resultBox.innerHTML = highlighted;\n        } else {\n            if (matches) {\n                const displaySep = currentSeparator === '\\\\n' ? '<br>' : `<span class=\"sep-visual\">${currentSeparator}</span>`;\n                resultBox.innerHTML = matches.map(m => `<span class=\"extract-item\">${escapeHtml(m)}</span>`).join(displaySep);\n            } else {\n                resultBox.innerText = 'No matches found.';\n            }\n        }\n    } catch (e) {\n        resultBox.innerText = 'Invalid RegEx: ' + e.message;\n        statsBox.innerText = 'Error';\n    }\n}\n\nfunction escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\nfunction copyResult() {\n    const resultBox = root.getElementById('regex-result');\n    let textToCopy = '';\n\n    if (currentMode === 'highlight') {\n        textToCopy = root.getElementById('regex-input').value;\n    } else {\n        const items = resultBox.querySelectorAll('.extract-item');\n        const sep = currentSeparator === '\\\\n' ? '\\n' : currentSeparator;\n        textToCopy = Array.from(items).map(i => i.textContent).join(sep);\n    }\n\n    if (!textToCopy) return;\n\n    navigator.clipboard.writeText(textToCopy).then(() => {\n        const btns = [root.getElementById('btn-copy-header'), root.getElementById('btn-copy-result')];\n        btns.forEach(btn => {\n            const original = btn.innerText;\n            btn.innerText = '✅';\n            setTimeout(() => btn.innerText = original, 1500);\n        });\n    });\n}\n\nfunction saveAll() {\n    saveState({\n        pattern: root.getElementById('regex-pattern').value,\n        text: root.getElementById('regex-input').value,\n        flags: currentFlags,\n        mode: currentMode,\n        separator: currentSeparator,\n        userPresets: userPresets\n    });\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (saved.pattern) root.getElementById('regex-pattern').value = saved.pattern;\n        if (saved.text) root.getElementById('regex-input').value = saved.text;\n        if (saved.userPresets) userPresets = saved.userPresets;\n        if (saved.flags) {\n            currentFlags = saved.flags;\n            root.querySelectorAll('.flag-btn').forEach(btn => {\n                btn.classList.toggle('active', currentFlags.includes(btn.dataset.flag));\n            });\n            root.getElementById('active-flags').innerText = currentFlags;\n        }\n        if (saved.mode) {\n            currentMode = saved.mode;\n            root.getElementById('mode-highlight').classList.toggle('active', currentMode === 'highlight');\n            root.getElementById('mode-extract').classList.toggle('active', currentMode === 'extract');\n        }\n        if (saved.separator) {\n            currentSeparator = saved.separator;\n            root.querySelectorAll('.sep-btn').forEach(btn => {\n                btn.classList.toggle('active', btn.dataset.sep === currentSeparator);\n            });\n        }\n    }\n\n    renderPresets();\n\n    const patternInput = root.getElementById('regex-pattern');\n    const textInput = root.getElementById('regex-input');\n\n    patternInput.oninput = updateRegex;\n    textInput.oninput = updateRegex;\n    \n    // Save ONLY on blur to prevent focus loss during typing\n    patternInput.onblur = saveAll;\n    textInput.onblur = saveAll;\n\n    root.getElementById('btn-copy-header').onclick = copyResult;\n    root.getElementById('btn-copy-result').onclick = copyResult;\n\n    root.getElementById('btn-add-preset').onclick = () => root.getElementById('preset-overlay').classList.add('show');\n    root.getElementById('btn-close-preset').onclick = () => root.getElementById('preset-overlay').classList.remove('show');\n    root.getElementById('btn-save-preset').onclick = addPreset;\n\n    root.querySelectorAll('.flag-btn').forEach(btn => {\n        btn.onclick = () => {\n            const flag = btn.dataset.flag;\n            if (currentFlags.includes(flag)) {\n                currentFlags = currentFlags.replace(flag, '');\n            } else {\n                currentFlags += flag;\n            }\n            btn.classList.toggle('active');\n            root.getElementById('active-flags').innerText = currentFlags;\n            updateRegex();\n            saveAll();\n        };\n    });\n\n    root.querySelectorAll('.sep-btn').forEach(btn => {\n        btn.onclick = () => {\n            currentSeparator = btn.dataset.sep;\n            root.querySelectorAll('.sep-btn').forEach(b => b.classList.remove('active'));\n            btn.classList.add('active');\n            updateRegex();\n            saveAll();\n        };\n    });\n\n    root.getElementById('mode-highlight').onclick = () => {\n        currentMode = 'highlight';\n        root.getElementById('mode-highlight').classList.add('active');\n        root.getElementById('mode-extract').classList.remove('active');\n        updateRegex();\n        saveAll();\n    };\n\n    root.getElementById('mode-extract').onclick = () => {\n        currentMode = 'extract';\n        root.getElementById('mode-extract').classList.add('active');\n        root.getElementById('mode-highlight').classList.remove('active');\n        updateRegex();\n        saveAll();\n    };\n\n    updateRegex();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "scratchpad",
      "title": "Scratchpad",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <span class=\"widget-icon\">📝</span>\n      <h4 class=\"widget-title\">Scratchpad Pro</h4>\n    </div>\n    <div class=\"header-actions\">\n      <div class=\"slot-container\">\n        <div class=\"slot-selector\" id=\"slot-list\">\n          <!-- Dynamic slots -->\n        </div>\n        <div class=\"slot-controls\">\n          <button class=\"ctrl-btn\" id=\"btn-add-slot\" title=\"Add Slot\">+</button>\n          <button class=\"ctrl-btn btn-danger\" id=\"btn-remove-slot\" title=\"Remove Current Slot\">-</button>\n        </div>\n      </div>\n      <button class=\"btn-icon\" id=\"btn-preview\" title=\"Toggle Preview\">👁️</button>\n      <button class=\"btn-icon\" id=\"btn-copy\" title=\"Copy to Clipboard\">📋</button>\n      <button class=\"btn-icon btn-danger\" id=\"btn-clear\" title=\"Clear Note\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"toolbar\" id=\"editor-toolbar\">\n    <button class=\"tool-btn\" data-prefix=\"**\" data-suffix=\"**\" title=\"Bold\"><b>B</b></button>\n    <button class=\"tool-btn\" data-prefix=\"*\" data-suffix=\"*\" title=\"Italic\"><i>I</i></button>\n    <button class=\"tool-btn\" data-prefix=\"~~\" data-suffix=\"~~\" title=\"Strikethrough\"><del>S</del></button>\n    <button class=\"tool-btn\" data-prefix=\"- \" data-suffix=\"\" title=\"List\">•</button>\n    <button class=\"tool-btn\" data-prefix=\"### \" data-suffix=\"\" title=\"Heading\">H</button>\n    <button class=\"tool-btn\" data-prefix=\"`\" data-suffix=\"`\" title=\"Code\">[ ]</button>\n  </div>\n\n  <div class=\"editor-container\">\n    <textarea id=\"note-area\" placeholder=\"Start typing your thoughts...\"></textarea>\n    <div id=\"preview-area\" class=\"preview-mode\" style=\"display: none;\"></div>\n    <div class=\"copy-badge\" id=\"copy-badge\">Copied!</div>\n  </div>\n\n  <div class=\"widget-footer\">\n    <div class=\"stat-item\">\n      <span class=\"stat-label\">Words:</span>\n      <span class=\"stat-value\" id=\"word-count\">0</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-label\">Chars:</span>\n      <span class=\"stat-value\" id=\"char-count\">0</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-label\">Mode:</span>\n      <span class=\"stat-value\" id=\"current-view\">Editor</span>\n    </div>\n  </div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 20px;\n    padding: 1.25rem;\n    box-shadow: var(--shadow-s);\n    transition: all 0.3s ease;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n    flex-wrap: wrap;\n    gap: 12px;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.widget-icon { font-size: 1.2rem; }\n.widget-title {\n    margin: 0;\n    font-size: 0.95rem;\n    font-weight: 700;\n    color: var(--text-normal);\n    letter-spacing: -0.01em;\n}\n\n.header-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.slot-container {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    background: var(--background-primary);\n    padding: 3px 6px;\n    border-radius: 12px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.slot-selector {\n    display: flex;\n    gap: 4px;\n    max-width: 150px;\n    overflow-x: auto;\n    padding-bottom: 2px;\n    cursor: grab;\n    user-select: none;\n    scrollbar-width: none; /* Firefox */\n}\n\n.slot-selector::-webkit-scrollbar {\n    display: none; /* Chrome/Safari */\n}\n\n.slot-selector:active {\n    cursor: grabbing;\n}\n\n.slot-btn {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    min-width: 24px;\n    height: 24px;\n    padding: 0 6px;\n    border-radius: 7px;\n    font-size: 0.75rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s;\n    pointer-events: auto;\n}\n\n.slot-btn.active {\n    background: var(--interactive-accent);\n    color: white;\n}\n\n.slot-controls {\n    display: flex;\n    gap: 2px;\n    border-left: 1px solid var(--background-modifier-border);\n    padding-left: 6px;\n}\n\n.ctrl-btn {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    width: 20px;\n    height: 20px;\n    border-radius: 5px;\n    font-size: 0.8rem;\n    font-weight: 700;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n\n.ctrl-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n}\n\n.ctrl-btn.btn-danger:hover {\n    background: var(--background-modifier-error);\n    color: white;\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-muted);\n    width: 32px;\n    height: 32px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.btn-icon:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    transform: translateY(-1px);\n}\n\n.btn-icon.active {\n    background: var(--interactive-accent);\n    color: white;\n    border-color: transparent;\n}\n\n.btn-danger:hover {\n    background: var(--background-modifier-error);\n    color: white;\n    border-color: transparent;\n}\n\n.toolbar {\n    display: flex;\n    gap: 4px;\n    margin-bottom: 0.75rem;\n    padding-bottom: 0.75rem;\n    border-bottom: 1px solid var(--background-modifier-border);\n}\n\n.tool-btn {\n    background: transparent;\n    border: none;\n    color: var(--text-muted);\n    padding: 4px 8px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n\n.tool-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-accent);\n}\n\n.editor-container {\n    position: relative;\n    margin-bottom: 1rem;\n}\n\ntextarea, .preview-mode {\n    width: 100%;\n    height: 220px;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 1rem;\n    font-size: 0.9rem;\n    resize: vertical;\n    outline: none;\n    line-height: 1.6;\n    transition: all 0.2s ease;\n    overflow-y: auto;\n}\n\ntextarea {\n    font-family: var(--font-monospace);\n}\n\n.preview-mode {\n    font-family: var(--font-interface);\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n.preview-mode h1, .preview-mode h2, .preview-mode h3 { margin-top: 0; color: var(--text-accent); }\n.preview-mode b, .preview-mode strong { color: var(--text-accent); }\n.preview-mode code { background: var(--background-secondary); padding: 2px 4px; border-radius: 4px; font-family: var(--font-monospace); }\n\ntextarea:focus {\n    border-color: var(--interactive-accent);\n    box-shadow: 0 0 0 3px var(--background-modifier-border);\n}\n\n.copy-badge {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    background: var(--interactive-accent);\n    color: white;\n    padding: 4px 10px;\n    border-radius: 6px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    opacity: 0;\n    transform: translateY(-5px);\n    transition: all 0.3s ease;\n    pointer-events: none;\n    z-index: 10;\n}\n\n.copy-badge.show {\n    opacity: 1;\n    transform: translateY(0);\n}\n\n.widget-footer {\n    display: flex;\n    justify-content: flex-start;\n    gap: 16px;\n    padding-top: 0.5rem;\n}\n\n.stat-item {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 0.75rem;\n}\n\n.stat-label {\n    color: var(--text-faint);\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.stat-value {\n    color: var(--text-muted);\n    font-weight: 700;\n}\n\n/* Custom Scrollbar */\ntextarea::-webkit-scrollbar, .preview-mode::-webkit-scrollbar {\n    width: 6px;\n}\ntextarea::-webkit-scrollbar-thumb, .preview-mode::-webkit-scrollbar-thumb {\n    background: var(--background-modifier-border);\n    border-radius: 10px;\n}\ntextarea::-webkit-scrollbar-thumb:hover, .preview-mode::-webkit-scrollbar-thumb:hover {\n    background: var(--text-faint);\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    currentSlot: '1',\n    notes: { '1': '' },\n    isPreview: false,\n    scrollPos: 0\n};\n\nlet isDragging = false;\nlet startX;\nlet scrollLeft;\nlet saveTimeout;\n\nfunction parseMarkdown(text) {\n    if (!text) return '<i style=\"color:var(--text-faint)\">Nothing to preview...</i>';\n    let html = text\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/^### (.*$)/gim, '<h3>$1</h3>')\n        .replace(/^## (.*$)/gim, '<h2>$1</h2>')\n        .replace(/^# (.*$)/gim, '<h1>$1</h1>')\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<b>$1</b>')\n        .replace(/\\*(.*?)\\*/g, '<i>$1</i>')\n        .replace(/~~(.*?)~~/g, '<del>$1</del>')\n        .replace(/`(.*?)`/g, '<code>$1</code>')\n        .replace(/^\\s*-\\s+(.*$)/gim, '• $1')\n        .replace(/\\n/g, '<br>');\n    return html;\n}\n\nfunction updateStats() {\n    const area = root.getElementById('note-area');\n    if (!area) return;\n    const text = area.value;\n    root.getElementById('char-count').innerText = text.length;\n    root.getElementById('word-count').innerText = text.trim() ? text.trim().split(/\\s+/).length : 0;\n}\n\nfunction save() {\n    const area = root.getElementById('note-area');\n    if (!area) return;\n    state.notes[state.currentSlot] = area.value;\n    state.scrollPos = root.getElementById('slot-list').scrollLeft;\n    saveState(state);\n}\n\nfunction debouncedSave() {\n    updateStats();\n    clearTimeout(saveTimeout);\n    saveTimeout = setTimeout(save, 1000);\n}\n\nfunction renderSlots() {\n    const list = root.getElementById('slot-list');\n    list.innerHTML = '';\n    \n    const sortedSlots = Object.keys(state.notes).sort((a, b) => parseInt(a) - parseInt(b));\n    \n    sortedSlots.forEach(slot => {\n        const btn = document.createElement('button');\n        btn.className = `slot-btn ${slot === state.currentSlot ? 'active' : ''}`;\n        btn.innerText = slot;\n        \n        let clickStartTime;\n        btn.onmousedown = (e) => {\n            clickStartTime = Date.now();\n            e.stopPropagation();\n        };\n        btn.onmouseup = (e) => {\n            if (Date.now() - clickStartTime < 200) {\n                switchSlot(slot);\n            }\n            e.stopPropagation();\n        };\n        list.appendChild(btn);\n    });\n    \n    // Restore scroll position\n    list.scrollLeft = state.scrollPos || 0;\n}\n\nfunction initDragScroll() {\n    const slider = root.getElementById('slot-list');\n    \n    slider.addEventListener('mousedown', (e) => {\n        isDragging = true;\n        startX = e.pageX - slider.offsetLeft;\n        scrollLeft = slider.scrollLeft;\n    });\n\n    slider.addEventListener('mouseleave', () => {\n        isDragging = false;\n    });\n\n    slider.addEventListener('mouseup', () => {\n        isDragging = false;\n        state.scrollPos = slider.scrollLeft;\n        save();\n    });\n\n    slider.addEventListener('mousemove', (e) => {\n        if (!isDragging) return;\n        e.preventDefault();\n        const x = e.pageX - slider.offsetLeft;\n        const walk = (x - startX) * 2;\n        slider.scrollLeft = scrollLeft - walk;\n    });\n\n    slider.addEventListener('scroll', () => {\n        if (!isDragging) {\n            state.scrollPos = slider.scrollLeft;\n        }\n    });\n}\n\nfunction switchSlot(slot) {\n    const area = root.getElementById('note-area');\n    state.notes[state.currentSlot] = area.value;\n    state.currentSlot = slot;\n    \n    const newText = state.notes[slot] || '';\n    area.value = newText;\n    \n    if (state.isPreview) {\n        root.getElementById('preview-area').innerHTML = parseMarkdown(newText);\n    }\n\n    renderSlots();\n    updateStats();\n    save();\n}\n\nfunction addSlot() {\n    const slots = Object.keys(state.notes).map(s => parseInt(s));\n    const nextSlot = (slots.length > 0 ? Math.max(...slots) + 1 : 1).toString();\n    \n    state.notes[nextSlot] = '';\n    switchSlot(nextSlot);\n}\n\nfunction removeSlot() {\n    const slots = Object.keys(state.notes);\n    if (slots.length <= 1) {\n        alert('Cannot remove the last slot.');\n        return;\n    }\n    \n    if (confirm(`Remove slot ${state.currentSlot}? All content in this slot will be lost.`)) {\n        delete state.notes[state.currentSlot];\n        const remaining = Object.keys(state.notes).sort((a, b) => parseInt(a) - parseInt(b));\n        switchSlot(remaining[0]);\n    }\n}\n\nfunction togglePreview() {\n    state.isPreview = !state.isPreview;\n    const area = root.getElementById('note-area');\n    const preview = root.getElementById('preview-area');\n    const toolbar = root.getElementById('editor-toolbar');\n    const btn = root.getElementById('btn-preview');\n    const modeLabel = root.getElementById('current-view');\n\n    if (state.isPreview) {\n        preview.innerHTML = parseMarkdown(area.value);\n        area.style.display = 'none';\n        preview.style.display = 'block';\n        toolbar.style.opacity = '0.3';\n        toolbar.style.pointerEvents = 'none';\n        btn.classList.add('active');\n        modeLabel.innerText = 'Preview';\n    } else {\n        area.style.display = 'block';\n        preview.style.display = 'none';\n        toolbar.style.opacity = '1';\n        toolbar.style.pointerEvents = 'auto';\n        btn.classList.remove('active');\n        modeLabel.innerText = 'Editor';\n        area.focus();\n    }\n    save();\n}\n\nfunction clearNote() {\n    if (confirm('Clear this note?')) {\n        root.getElementById('note-area').value = '';\n        save();\n        if (state.isPreview) root.getElementById('preview-area').innerHTML = parseMarkdown('');\n    }\n}\n\nfunction copyToClipboard() {\n    const text = root.getElementById('note-area').value;\n    if (!text) return;\n    navigator.clipboard.writeText(text).then(() => {\n        const badge = root.getElementById('copy-badge');\n        badge.classList.add('show');\n        setTimeout(() => badge.classList.remove('show'), 2000);\n    });\n}\n\nfunction insertTool(prefix, suffix) {\n    const area = root.getElementById('note-area');\n    const start = area.selectionStart;\n    const end = area.selectionEnd;\n    const text = area.value;\n    const selected = text.substring(start, end);\n    area.value = text.substring(0, start) + prefix + selected + suffix + text.substring(end);\n    area.focus();\n    area.setSelectionRange(start + prefix.length, start + prefix.length + selected.length);\n    save();\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && typeof saved === 'object' && saved.notes) {\n        Object.assign(state, saved);\n    } else if (typeof saved === 'string') {\n        state.notes['1'] = saved;\n    }\n\n    const area = root.getElementById('note-area');\n    area.value = state.notes[state.currentSlot] || '';\n    \n    // Re-enable oninput with debounce to fix \"impossible to write\"\n    // while still preventing constant re-renders\n    area.oninput = debouncedSave;\n    area.onblur = save;\n    \n    root.getElementById('btn-clear').onclick = clearNote;\n    root.getElementById('btn-copy').onclick = copyToClipboard;\n    root.getElementById('btn-preview').onclick = togglePreview;\n    root.getElementById('btn-add-slot').onclick = addSlot;\n    root.getElementById('btn-remove-slot').onclick = removeSlot;\n    \n    root.querySelectorAll('.tool-btn').forEach(btn => {\n        btn.onclick = () => insertTool(btn.dataset.prefix, btn.dataset.suffix);\n    });\n\n    if (state.isPreview) {\n        state.isPreview = false;\n        togglePreview();\n    }\n\n    renderSlots();\n    initDragScroll();\n    updateStats();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "sleep-studio",
      "title": "Sleep Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🌙 Sleep Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-view-toggle\" class=\"btn-icon-small\" title=\"Toggle Graph/List\">📊</button>\n      <button id=\"btn-reset\" class=\"btn-icon-small\" title=\"Clear All Data\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"hero-stats\">\n    <div class=\"main-stat\">\n      <div id=\"avg-hours\" class=\"stat-value\">0.0</div>\n      <div class=\"stat-label\">Avg Hours</div>\n    </div>\n    <div class=\"stat-divider\"></div>\n    <div class=\"main-stat\">\n      <div id=\"avg-quality\" class=\"stat-value\">0</div>\n      <div class=\"stat-label\">Avg Quality</div>\n    </div>\n  </div>\n\n  <div class=\"input-card\">\n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Hours Slept</label>\n        <span id=\"val-hours\" class=\"slider-val\">8.0h</span>\n      </div>\n      <input type=\"range\" id=\"sleep-hours\" min=\"0\" max=\"15\" step=\"0.5\" value=\"8.0\" class=\"modern-slider\">\n    </div>\n    \n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Sleep Quality</label>\n        <span id=\"val-quality\" class=\"slider-val\">7/10</span>\n      </div>\n      <input type=\"range\" id=\"sleep-quality\" min=\"1\" max=\"10\" step=\"1\" value=\"7\" class=\"modern-slider quality-slider\">\n    </div>\n    \n    <button class=\"btn-log\" id=\"btn-log\">Log Night ✨</button>\n  </div>\n\n  <div id=\"view-list\" class=\"view-container active\">\n    <div class=\"section-label\">Recent History (Drag to scroll, click to edit)</div>\n    <div class=\"history-list\" id=\"sleep-history\"></div>\n  </div>\n\n  <div id=\"view-graph\" class=\"view-container\">\n    <div class=\"section-label\">Sleep Trends</div>\n    <div class=\"graph-wrapper\">\n      <svg id=\"sleep-graph\" viewBox=\"0 0 300 120\" preserveAspectRatio=\"none\"></svg>\n      <div class=\"graph-labels\">\n        <button id=\"btn-graph-range\" class=\"btn-range-toggle\">30 days</button>\n        <span>Today</span>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); color: var(--text-normal); border-radius: 28px; padding: 1.5rem; box-shadow: var(--shadow-s); border: 1px solid var(--background-modifier-border); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1.5px; } .header-actions { display: flex; gap: 8px; } .btn-icon-small { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-muted); width: 32px; height: 32px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; } .btn-icon-small:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .hero-stats { display: flex; justify-content: space-around; align-items: center; background: var(--background-primary-alt); border-radius: 20px; padding: 1rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); } .stat-value { font-size: 1.8rem; font-weight: 800; color: var(--interactive-accent); line-height: 1; margin-bottom: 4px; } .stat-label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.5px; } .stat-divider { width: 1px; height: 30px; background: var(--background-modifier-border); } .input-card { background: var(--background-primary); border-radius: 20px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); } .slider-group { margin-bottom: 1.25rem; } .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; } .slider-header label { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; } .slider-val { font-size: 0.9rem; font-weight: 800; color: var(--interactive-accent); } .modern-slider { -webkit-appearance: none; width: 100%; height: 6px; background: var(--background-secondary-alt); border-radius: 10px; outline: none; } .modern-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--interactive-accent); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px rgba(var(--interactive-accent-rgb), 0.3); transition: transform 0.2s; } .modern-slider::-webkit-slider-thumb:hover { transform: scale(1.2); } .quality-slider::-webkit-slider-thumb { background: var(--text-accent); } .btn-log { width: 100%; background: var(--interactive-accent); color: var(--text-on-accent); border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: all 0.3s; } .btn-log:hover { opacity: 0.9; transform: translateY(-2px); } .view-container { display: none; } .view-container.active { display: block; } .section-label { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; color: var(--text-faint); margin-bottom: 10px; letter-spacing: 1px; } .history-list { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; scrollbar-width: none; cursor: grab; user-select: none; } .history-list:active { cursor: grabbing; } .history-list::-webkit-scrollbar { display: none; } .history-item { background: var(--background-primary-alt); padding: 10px; border-radius: 14px; min-width: 70px; text-align: center; border: 1px solid var(--background-modifier-border); transition: transform 0.2s, background 0.2s; } .history-item:hover { background: var(--background-modifier-hover); transform: translateY(-2px); } .h-val { display: block; font-weight: 800; font-size: 1rem; color: var(--interactive-accent); pointer-events: none; } .h-date { font-size: 0.55rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; pointer-events: none; } .graph-wrapper { background: var(--background-primary-alt); border-radius: 16px; padding: 12px; border: 1px solid var(--background-modifier-border); } #sleep-graph { width: 100%; height: 100px; stroke-linecap: round; stroke-linejoin: round; } .graph-labels { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.6rem; color: var(--text-faint); font-weight: 700; text-transform: uppercase; } .btn-range-toggle { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-accent); padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 0.6rem; font-weight: 800; text-transform: uppercase; transition: all 0.2s; } .btn-range-toggle:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 8px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
      "js": "const { root, saveState, getState } = api;\n\nconst RANGES = [\n    { label: '7 days', val: 7 },\n    { label: '30 days', val: 30 },\n    { label: '3 months', val: 90 },\n    { label: '6 months', val: 180 },\n    { label: '1 year', val: 365 }\n];\n\nlet state = {\n    history: [],\n    view: 'list',\n    rangeIdx: 1,\n    editingDate: null\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const list = root.querySelector('#sleep-history');\n    if (!list) return;\n    \n    let totalH = 0, totalQ = 0;\n    state.history.forEach(item => {\n        totalH += parseFloat(item.hours);\n        totalQ += parseInt(item.quality);\n    });\n    \n    const avgH = state.history.length > 0 ? (totalH / state.history.length).toFixed(1) : '0.0';\n    const avgQ = state.history.length > 0 ? Math.round(totalQ / state.history.length) : '0';\n    \n    root.querySelector('#avg-hours').innerText = avgH;\n    root.querySelector('#avg-quality').innerText = avgQ;\n\n    list.innerHTML = '';\n    state.history.forEach((item, idx) => {\n        const el = document.createElement('div');\n        el.className = 'history-item';\n        el.innerHTML = `\n            <span class=\"h-val\">${item.hours}h</span>\n            <span class=\"h-date\">${item.date}</span>\n        `;\n        el.onclick = () => editEntry(idx);\n        list.appendChild(el);\n    });\n\n    renderGraph();\n\n    root.querySelector('#view-list').className = 'view-container' + (state.view === 'list' ? ' active' : '');\n    root.querySelector('#view-graph').className = 'view-container' + (state.view === 'graph' ? ' active' : '');\n    root.querySelector('#btn-view-toggle').innerText = state.view === 'list' ? '📊' : '📜';\n    root.querySelector('#btn-graph-range').innerText = RANGES[state.rangeIdx].label;\n    \n    const logBtn = root.querySelector('#btn-log');\n    logBtn.innerText = state.editingDate ? `Update ${state.editingDate} ✨` : 'Log Night ✨';\n}\n\nfunction editEntry(idx) {\n    const item = state.history[idx];\n    state.editingDate = item.date;\n    \n    const hSlider = root.querySelector('#sleep-hours');\n    const qSlider = root.querySelector('#sleep-quality');\n    \n    hSlider.value = item.hours;\n    qSlider.value = item.quality;\n    \n    root.querySelector('#val-hours').innerText = item.hours + 'h';\n    root.querySelector('#val-quality').innerText = item.quality + '/10';\n    \n    showToast(`Editing log from ${item.date} ✏️`);\n    render();\n}\n\nfunction renderGraph() {\n    const svg = root.querySelector('#sleep-graph');\n    if (!svg) return;\n    if (state.history.length < 2) {\n        svg.innerHTML = '<text x=\"50%\" y=\"50%\" text-anchor=\"middle\" fill=\"var(--text-faint)\" font-size=\"10\">Need more data...</text>';\n        return;\n    }\n    const range = RANGES[state.rangeIdx].val;\n    const data = state.history.slice(0, range).reverse();\n    const maxH = 15, width = 300, height = 120, padding = 10;\n    let points = '';\n    data.forEach((item, i) => {\n        const x = (i / (data.length - 1)) * (width - padding * 2) + padding;\n        const y = height - ((parseFloat(item.hours) / maxH) * (height - padding * 2)) - padding;\n        points += `${x},${y} `;\n    });\n    \n    // Get accent color from CSS variable or fallback\n    const accentColor = getComputedStyle(root).getPropertyValue('--interactive-accent').trim() || '#818cf8';\n    \n    svg.innerHTML = `\n        <defs>\n            <linearGradient id=\"grad\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                <stop offset=\"0%\" style=\"stop-color:${accentColor};stop-opacity:0.3\" />\n                <stop offset=\"100%\" style=\"stop-color:${accentColor};stop-opacity:0\" />\n            </linearGradient>\n        </defs>\n        <polyline points=\"${points}\" fill=\"none\" stroke=\"${accentColor}\" stroke-width=\"${range > 100 ? 1 : 2}\" />\n        <path d=\"M ${padding},${height} L ${points} L ${width-padding},${height} Z\" fill=\"url(#grad)\" />\n    `;\n}\n\nfunction logSleep() {\n    const hours = root.querySelector('#sleep-hours').value;\n    const quality = root.querySelector('#sleep-quality').value;\n    const date = state.editingDate || new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n\n    const existingIdx = state.history.findIndex(h => h.date === date);\n    if (existingIdx !== -1) {\n        state.history[existingIdx] = { hours, quality, date };\n    } else {\n        state.history.unshift({ hours, quality, date });\n    }\n\n    state.editingDate = null;\n    saveState(state);\n    render();\n    showToast('Night saved! 🌙');\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (Array.isArray(saved)) state.history = saved;\n        else state = Object.assign(state, saved);\n    }\n\n    const hSlider = root.querySelector('#sleep-hours');\n    const qSlider = root.querySelector('#sleep-quality');\n    hSlider.oninput = (e) => root.querySelector('#val-hours').innerText = e.target.value + 'h';\n    qSlider.oninput = (e) => root.querySelector('#val-quality').innerText = e.target.value + '/10';\n\n    root.querySelector('#btn-log').onclick = logSleep;\n    root.querySelector('#btn-view-toggle').onclick = () => {\n        state.view = state.view === 'list' ? 'graph' : 'list';\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-graph-range').onclick = () => {\n        state.rangeIdx = (state.rangeIdx + 1) % RANGES.length;\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-reset').onclick = () => {\n        if (confirm('Clear all data?')) {\n            state.history = [];\n            render();\n            saveState(state);\n            showToast('Data cleared 🗑️');\n        }\n    };\n\n    const list = root.querySelector('#sleep-history');\n    let isDown = false, startX, scrollLeft;\n    list.onmousedown = (e) => {\n        isDown = true;\n        startX = e.pageX - list.offsetLeft;\n        scrollLeft = list.scrollLeft;\n    };\n    list.onmouseleave = () => isDown = false;\n    list.onmouseup = () => isDown = false;\n    list.onmousemove = (e) => {\n        if (!isDown) return;\n        e.preventDefault();\n        const x = e.pageX - list.offsetLeft;\n        const walk = (x - startX) * 2;\n        list.scrollLeft = scrollLeft - walk;\n    };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "smart-grocery",
      "title": "Smart Grocery",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div id=\"widget-anchor\"></div>\n<div class=\"widget-card\" style=\"position: relative; resize: both; overflow: auto;\">\n  <div class=\"widget-header\">\n    <h3 class=\"widget-title\">🛒 Smart Grocery</h3>\n    <div class=\"header-actions\">\n      <button id=\"btn-sort\" class=\"btn-icon\" title=\"Sort by Dictionary order\">🪄 Sort</button>\n      <button id=\"btn-clear-all\" class=\"btn-icon\" title=\"Clear all items\">🗑️ All</button>\n      <button id=\"btn-clear\" class=\"btn-icon\" title=\"Clear checked items\">🧹 Done</button>\n      <button id=\"btn-edit-dict\" class=\"btn-icon\" title=\"Manage dictionary\">⚙️ Dict</button>\n    </div>\n  </div>\n\n  <div class=\"input-container\">\n    <div class=\"input-wrapper\">\n      <input type=\"text\" id=\"item-input\" placeholder=\"Add item...\" autocomplete=\"off\" />\n      <div id=\"autocomplete-list\" class=\"autocomplete-dropdown\"></div>\n    </div>\n    <button id=\"btn-add\" class=\"btn-add\">+</button>\n  </div>\n\n  <div id=\"grocery-list\" class=\"grocery-list\"></div>\n\n  <div class=\"footer\">\n    <div class=\"stats\">\n      <div id=\"item-count\">0 items</div>\n      <button id=\"btn-auto-learn\" class=\"btn-toggle\" title=\"Toggle auto-learning on check\">🧠 Auto: OFF</button>\n    </div>\n    <button id=\"btn-learn\" class=\"btn-icon\" title=\"Save current list order to Dictionary\">Learn this order</button>\n  </div>\n\n  <div id=\"dict-modal\" class=\"modal-overlay\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h3>Manage Dictionary</h3>\n        <button id=\"btn-close-dict\" class=\"btn-icon\">×</button>\n      </div>\n      <div class=\"dict-tip\">Drag handle to reorder</div>\n      <div id=\"dict-list\" class=\"dict-list\"></div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-s);\n    border: 1px solid var(--background-modifier-border);\n    min-width: 320px;\n    position: relative;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n.widget-title { margin: 0; font-size: 1.1rem; font-weight: 800; color: #38bdf8; text-transform: uppercase; letter-spacing: 1px; }\n\n.header-actions { display: flex; gap: 6px; }\n.btn-icon {\n    background: #334155; border: none; color: #94a3b8;\n    padding: 6px 10px; border-radius: 8px; font-size: 0.7rem;\n    font-weight: 700; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: #475569; color: white; }\n\n.btn-toggle {\n    background: #334155; border: none; color: #94a3b8;\n    padding: 4px 8px; border-radius: 6px; font-size: 0.65rem;\n    font-weight: 700; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-toggle.active { background: #0ea5e9; color: white; }\n\n.input-container {\n    display: flex; gap: 10px; margin-bottom: 1.5rem; position: relative;\n}\n\n.input-wrapper { flex: 1; position: relative; }\n\ninput[type=\"text\"] {\n    width: 100%;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 12px 16px;\n    border-radius: 12px;\n    font-size: 16px;\n    outline: none;\n}\ninput[type=\"text\"]:focus { border-color: var(--interactive-accent); }\n\n.autocomplete-dropdown {\n    position: absolute;\n    top: 100%; left: 0; right: 0;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    margin-top: 4px;\n    max-height: 200px;\n    overflow-y: auto;\n    z-index: 1000;\n    box-shadow: var(--shadow-s);\n    display: none;\n}\n.autocomplete-item {\n    padding: 14px 16px;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255,255,255,0.05);\n}\n.autocomplete-item:hover { background: #334155; color: #38bdf8; }\n\n.btn-add {\n    background: #38bdf8; color: #0f172a; border: none;\n    width: 46px; height: 46px; border-radius: 12px;\n    font-size: 1.5rem; font-weight: 800; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-add:hover { transform: scale(1.05); background: #7dd3fc; }\n\n.grocery-list {\n    display: flex; flex-direction: column; gap: 10px; margin-bottom: 1.5rem;\n    min-height: 50px;\n}\n\n.list-item {\n    display: flex; align-items: center; gap: 12px;\n    padding: 12px 16px; background: rgba(255,255,255,0.03);\n    border-radius: 14px; border: 1px solid rgba(255,255,255,0.05);\n    transition: transform 0.1s, box-shadow 0.1s;\n    position: relative;\n}\n\n.list-item.dragging {\n    opacity: 0.4;\n    background: rgba(56, 189, 248, 0.1);\n    border: 2px dashed #38bdf8;\n}\n\n.list-item.drag-over {\n    border-top: 2px solid #38bdf8;\n}\n\n.drag-handle {\n    color: #475569;\n    font-size: 1.2rem;\n    cursor: grab;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n}\n.drag-handle:active { cursor: grabbing; }\n\n.checkbox {\n    width: 22px; height: 22px; border: 2px solid #38bdf8;\n    border-radius: 6px; flex-shrink: 0;\n    display: flex; align-items: center; justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.checkbox.checked { background: #38bdf8; }\n.checkbox.checked::after { content: \"✓\"; color: #0f172a; font-size: 14px; font-weight: 900; }\n\n.item-text { flex: 1; font-weight: 600; font-size: 0.95rem; pointer-events: none; }\n.list-item.checked .item-text {\n    text-decoration: line-through;\n    opacity: 0.5;\n}\n\n.btn-del { \n    background: none; border: none; color: #ef4444; \n    cursor: pointer; font-size: 1.2rem; padding: 8px;\n    opacity: 0.6; transition: opacity 0.2s;\n}\n.btn-del:hover { opacity: 1; }\n\n.footer {\n    display: flex; justify-content: space-between; align-items: center;\n    border-top: 1px solid #334155; padding-top: 1.25rem;\n}\n\n.stats { display: flex; align-items: center; gap: 10px; }\n\n.modal-overlay {\n    position: absolute; top: 0; left: 0; right: 0; bottom: 0;\n    background: var(--background-modifier-cover);\n    display: none; align-items: center; justify-content: center;\n    z-index: 2000; border-radius: 24px; backdrop-filter: blur(4px);\n}\n.modal-content {\n    background: var(--background-primary);\n    width: 90%; max-height: 80%;\n    border-radius: 16px; display: flex; flex-direction: column; padding: 1rem;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.modal-header {\n    display: flex; justify-content: space-between; align-items: center;\n    margin-bottom: 0.5rem;\n}\n\n.dict-tip {\n    font-size: 0.65rem; color: var(--text-faint); text-align: center; margin-bottom: 1rem;\n    text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;\n}\n\n.dict-list {\n    overflow-y: auto;\n    display: flex; flex-direction: column; gap: 8px;\n}\n\n.dict-item {\n    display: flex; justify-content: space-between; align-items: center;\n    padding: 10px 12px; background: rgba(255,255,255,0.03);\n    border-radius: 10px; border: 1px solid rgba(255,255,255,0.05);\n    transition: all 0.2s;\n    position: relative;\n}\n.dict-item:hover { background: rgba(255,255,255,0.06); }\n.dict-item.dragging { opacity: 0.4; border: 2px dashed #38bdf8; }\n.dict-item.drag-over { border-top: 2px solid #38bdf8; }\n\n.dict-item .item-text {\n    flex: 1;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-left: 8px;\n}\n\n.dict-actions {\n    display: flex;\n    gap: 4px;\n}\n\n.btn-del-dict {\n    background: none; border: none; \n    cursor: pointer; font-size: 1rem; padding: 4px;\n    opacity: 0.6; transition: opacity 0.2s;\n    color: #ef4444;\n}\n.btn-del-dict:hover { opacity: 1; }\n\n.toast-msg {\n    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);\n    background: #0ea5e9; color: white; padding: 8px 16px; border-radius: 100px;\n    font-size: 0.8rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;\n    pointer-events: none; z-index: 3000;\n}",
      "js": "const { root, saveState, getState } = api;\n\nlet state = { items: [], dictionary: [], isDictOpen: false, autoLearn: false };\nlet draggedItem = null;\nlet draggedElement = null;\nlet draggedDictIdx = null;\nlet draggedDictElement = null;\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const list = root.querySelector('#grocery-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.items.forEach((item, idx) => {\n        const div = document.createElement('div');\n        div.className = 'list-item' + (item.checked ? ' checked' : '');\n        div.draggable = true;\n        div.dataset.idx = idx;\n        \n        div.innerHTML = `\n            <span class=\"drag-handle\">☰</span>\n            <div class=\"checkbox ${item.checked ? 'checked' : ''}\"></div>\n            <span class=\"item-text\">${item.name}</span>\n            <button class=\"btn-del\">🗑️</button>\n        `;\n        \n        div.querySelector('.checkbox').onclick = (e) => {\n            e.stopPropagation();\n            toggleItem(idx);\n        };\n        \n        div.querySelector('.btn-del').onclick = (e) => {\n            e.stopPropagation();\n            deleteItem(idx);\n        };\n\n        div.ondragstart = (e) => {\n            draggedItem = item;\n            draggedElement = div;\n            div.classList.add('dragging');\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/plain', idx);\n        };\n\n        div.ondragend = () => {\n            div.classList.remove('dragging');\n            root.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n            draggedItem = null;\n            draggedElement = null;\n        };\n\n        div.ondragover = (e) => {\n            e.preventDefault();\n            if (div !== draggedElement) {\n                div.classList.add('drag-over');\n            }\n        };\n\n        div.ondragleave = () => {\n            div.classList.remove('drag-over');\n        };\n\n        div.ondrop = (e) => {\n            e.preventDefault();\n            const fromIdx = parseInt(e.dataTransfer.getData('text/plain'));\n            const toIdx = idx;\n            \n            if (!isNaN(fromIdx) && fromIdx !== toIdx) {\n                const moved = state.items.splice(fromIdx, 1)[0];\n                state.items.splice(toIdx, 0, moved);\n                saveAndRender();\n            }\n        };\n        \n        list.appendChild(div);\n    });\n    \n    root.querySelector('#item-count').innerText = state.items.length + ' items';\n    \n    const autoBtn = root.querySelector('#btn-auto-learn');\n    if (autoBtn) {\n        autoBtn.innerText = `🧠 Auto: ${state.autoLearn ? 'ON' : 'OFF'}`;\n        autoBtn.className = 'btn-toggle' + (state.autoLearn ? ' active' : '');\n    }\n}\n\nfunction renderDictionary() {\n    const list = root.querySelector('#dict-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.dictionary.forEach((name, idx) => {\n        const div = document.createElement('div');\n        div.className = 'dict-item';\n        div.draggable = true;\n        div.innerHTML = `\n            <span class=\"drag-handle\">☰</span>\n            <span class=\"item-text\">${name}</span>\n            <div class=\"dict-actions\">\n                <button class=\"btn-del-dict\" title=\"Remove\">×</button>\n            </div>\n        `;\n        \n        div.querySelector('.btn-del-dict').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            state.dictionary.splice(idx, 1);\n            saveState(state);\n            renderDictionary();\n        });\n\n        div.ondragstart = (e) => {\n            if (e.target.className !== 'drag-handle' && !e.target.closest('.drag-handle')) {\n                if (e.target.closest('.dict-actions')) {\n                    e.preventDefault();\n                    return;\n                }\n            }\n            draggedDictIdx = idx;\n            draggedDictElement = div;\n            div.classList.add('dragging');\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/dict', idx);\n        };\n\n        div.ondragend = () => {\n            div.classList.remove('dragging');\n            root.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n            draggedDictIdx = null;\n            draggedDictElement = null;\n        };\n\n        div.ondragover = (e) => {\n            e.preventDefault();\n            if (div !== draggedDictElement) {\n                div.classList.add('drag-over');\n            }\n        };\n\n        div.ondragleave = () => {\n            div.classList.remove('drag-over');\n        };\n\n        div.ondrop = (e) => {\n            e.preventDefault();\n            const fromIdx = parseInt(e.dataTransfer.getData('text/dict'));\n            const toIdx = idx;\n            \n            if (!isNaN(fromIdx) && fromIdx !== toIdx) {\n                const moved = state.dictionary.splice(fromIdx, 1)[0];\n                state.dictionary.splice(toIdx, 0, moved);\n                saveState(state);\n                renderDictionary();\n            }\n        };\n        \n        list.appendChild(div);\n    });\n}\n\nasync function addItem() {\n    const input = root.querySelector('#item-input');\n    const name = input.value.trim();\n    if (name) {\n        state.items.push({ name: name, checked: false });\n        if (!state.dictionary.includes(name)) state.dictionary.push(name);\n        input.value = '';\n        root.querySelector('#autocomplete-list').style.display = 'none';\n        saveAndRender();\n        setTimeout(() => input.focus(), 50);\n    }\n}\n\nfunction toggleItem(idx) {\n    const item = state.items[idx];\n    item.checked = !item.checked;\n    \n    if (item.checked && state.autoLearn) {\n        const name = item.name;\n        const dIdx = state.dictionary.indexOf(name);\n        if (dIdx !== -1) {\n            state.dictionary.splice(dIdx, 1);\n            state.dictionary.push(name);\n        }\n    }\n    saveAndRender();\n}\n\nfunction deleteItem(idx) {\n    state.items.splice(idx, 1);\n    saveAndRender();\n}\n\nfunction saveAndRender() {\n    render();\n    saveState(state);\n}\n\nfunction handleInput(e) {\n    const val = e.target.value.trim().toLowerCase();\n    const dropdown = root.querySelector('#autocomplete-list');\n    \n    const availableItems = state.dictionary.filter(item => \n        !state.items.some(i => i.name.toLowerCase() === item.toLowerCase())\n    ).sort((a, b) => a.localeCompare(b));\n    \n    const matches = val \n        ? availableItems.filter(item => item.toLowerCase().includes(val)).slice(0, 10) \n        : availableItems;\n    \n    dropdown.innerHTML = '';\n    if (matches.length > 0) {\n        matches.forEach(m => {\n            const div = document.createElement('div');\n            div.className = 'autocomplete-item';\n            div.innerText = m;\n            div.onclick = (ev) => {\n                ev.stopPropagation();\n                root.querySelector('#item-input').value = m;\n                addItem();\n            };\n            dropdown.appendChild(div);\n        });\n        dropdown.style.display = 'block';\n    } else {\n        dropdown.style.display = 'none';\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n    \n    root.querySelector('#btn-add').onclick = addItem;\n    root.querySelector('#btn-sort').onclick = () => {\n        const order = state.dictionary;\n        if (order.length === 0) return;\n        state.items.sort((a, b) => {\n            const idxA = order.indexOf(a.name);\n            const idxB = order.indexOf(b.name);\n            if (idxA !== -1 && idxB !== -1) return idxA - idxB;\n            if (idxA !== -1) return -1;\n            if (idxB !== -1) return 1;\n            return 0;\n        });\n        saveAndRender();\n        showToast('Sorted by Dict! ✨');\n    };\n    \n    root.querySelector('#btn-clear').onclick = () => {\n        state.items = state.items.filter(i => !i.checked);\n        saveAndRender();\n    };\n    \n    root.querySelector('#btn-clear-all').onclick = () => {\n        if (confirm('Clear all?')) {\n            state.items = [];\n            saveAndRender();\n        }\n    };\n    \n    root.querySelector('#btn-learn').onclick = () => {\n        const currentNames = state.items.map(i => i.name);\n        if (currentNames.length === 0) {\n            showToast('List is empty! 🛒');\n            return;\n        }\n        \n        // Filter out current items from dictionary to re-insert them at the end (learned order)\n        let otherItems = state.dictionary.filter(name => !currentNames.includes(name));\n        state.dictionary = [...otherItems, ...currentNames];\n        \n        showToast('Order learned! 🧠');\n        saveAndRender();\n        if (state.isDictOpen) renderDictionary();\n    };\n\n    root.querySelector('#btn-auto-learn').onclick = () => {\n        state.autoLearn = !state.autoLearn;\n        saveAndRender();\n        showToast(`Auto-Learn: ${state.autoLearn ? 'ON' : 'OFF'} 🧠`);\n    };\n    \n    root.querySelector('#btn-edit-dict').onclick = () => { \n        state.isDictOpen = true;\n        saveState(state);\n        renderDictionary();\n        root.querySelector('#dict-modal').style.display = 'flex'; \n    };\n    root.querySelector('#btn-close-dict').onclick = () => { \n        state.isDictOpen = false;\n        saveState(state);\n        root.querySelector('#dict-modal').style.display = 'none'; \n    };\n\n    const input = root.querySelector('#item-input');\n    input.oninput = handleInput;\n    input.onfocus = handleInput;\n    input.onkeydown = (e) => { if (e.key === 'Enter') addItem(); };\n\n    root.onclick = (e) => {\n        if (!root.querySelector('.input-container').contains(e.target)) {\n            root.querySelector('#autocomplete-list').style.display = 'none';\n        }\n    };\n    \n    render();\n    if (state.isDictOpen) {\n        renderDictionary();\n        root.querySelector('#dict-modal').style.display = 'flex';\n    }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "step-studio",
      "title": "Step Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">👟 Step Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-view-toggle\" class=\"btn-icon-small\" title=\"Toggle Graph/List\">📊</button>\n      <button id=\"btn-reset\" class=\"btn-icon-small\" title=\"Clear All Data\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"main-progress\">\n    <svg class=\"progress-ring\" width=\"160\" height=\"160\">\n      <circle class=\"progress-ring-bg\" stroke=\"rgba(251, 191, 36, 0.1)\" stroke-width=\"12\" fill=\"transparent\" r=\"70\" cx=\"80\" cy=\"80\"/>\n      <circle id=\"progress-bar\" class=\"progress-ring-fill\" stroke=\"#fbbf24\" stroke-width=\"12\" stroke-dasharray=\"440 440\" stroke-dashoffset=\"440\" stroke-linecap=\"round\" fill=\"transparent\" r=\"70\" cx=\"80\" cy=\"80\"/>\n    </svg>\n    <div class=\"progress-content\">\n      <div id=\"step-count\" class=\"step-value\">0</div>\n      <div class=\"step-label\">Steps</div>\n      <div id=\"step-goal-text\" class=\"goal-label\">Goal: 10,000</div>\n    </div>\n  </div>\n\n  <div class=\"stats-grid\">\n    <div class=\"stat-box\">\n      <span id=\"stat-calories\" class=\"stat-val\">0</span>\n      <label>kcal</label>\n    </div>\n    <div class=\"stat-box\">\n      <span id=\"stat-distance\" class=\"stat-val\">0.0</span>\n      <label>km</label>\n    </div>\n    <div class=\"stat-box\">\n      <span id=\"stat-avg\" class=\"stat-val\">0</span>\n      <label>Avg</label>\n    </div>\n  </div>\n\n  <div class=\"input-card\">\n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Add Steps</label>\n        <span id=\"val-add\" class=\"slider-val\">+1,000</span>\n      </div>\n      <input type=\"range\" id=\"input-add\" min=\"0\" max=\"5000\" step=\"100\" value=\"1000\" class=\"modern-slider\">\n    </div>\n    <div class=\"control-buttons\">\n      <button class=\"btn-log\" id=\"btn-log\">Add Steps ✨</button>\n      <button class=\"btn-secondary\" id=\"btn-set-goal\">Set Goal 🎯</button>\n    </div>\n  </div>\n\n  <div id=\"view-list\" class=\"view-container active\">\n    <div class=\"section-label\">Recent Activity (Drag to scroll, click to edit)</div>\n    <div class=\"history-list\" id=\"step-history\"></div>\n  </div>\n\n  <div id=\"view-graph\" class=\"view-container\">\n    <div class=\"section-label\">Activity Trends</div>\n    <div class=\"graph-wrapper\">\n      <svg id=\"step-graph\" viewBox=\"0 0 300 120\" preserveAspectRatio=\"none\"></svg>\n      <div class=\"graph-labels\">\n        <button id=\"btn-graph-range\" class=\"btn-range-toggle\">30 days</button>\n        <span>Today</span>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 28px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-s);\n    border: 1px solid var(--background-modifier-border);\n    max-width: 360px;\n    margin: 0 auto;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1rem;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.85rem;\n    font-weight: 800;\n    color: #fbbf24;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n}\n\n.header-actions { display: flex; gap: 8px; }\n\n.btn-icon-small {\n    background: rgba(255, 255, 255, 0.05);\n    border: none;\n    color: #fde68a;\n    width: 32px;\n    height: 32px;\n    border-radius: 10px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n}\n.btn-icon-small:hover { background: rgba(251, 191, 36, 0.2); color: white; }\n\n.main-progress {\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.progress-ring {\n    transform: rotate(-90deg);\n}\n\n.progress-ring-fill {\n    transition: stroke-dashoffset 0.5s ease;\n    filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.4));\n}\n\n.progress-content {\n    position: absolute;\n    text-align: center;\n}\n\n.step-value {\n    font-size: 2.2rem;\n    font-weight: 900;\n    color: #fbbf24;\n    line-height: 1;\n}\n\n.step-label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: #fde68a;\n    opacity: 0.6;\n    margin-top: 4px;\n}\n\n.goal-label {\n    font-size: 0.6rem;\n    font-weight: 700;\n    color: #94a3b8;\n    margin-top: 2px;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 10px;\n    margin-bottom: 1.5rem;\n}\n\n.stat-box {\n    background: rgba(255, 255, 255, 0.03);\n    padding: 12px 8px;\n    border-radius: 16px;\n    text-align: center;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.stat-val {\n    display: block;\n    font-size: 1.1rem;\n    font-weight: 800;\n    color: #fbbf24;\n}\n\n.stat-box label {\n    font-size: 0.55rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: #94a3b8;\n}\n\n.input-card {\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 20px;\n    padding: 1.25rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.slider-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n}\n\n.slider-header label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: #fde68a;\n    text-transform: uppercase;\n}\n\n.slider-val {\n    font-size: 0.9rem;\n    font-weight: 800;\n    color: #fbbf24;\n}\n\n.modern-slider {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 6px;\n    background: #0f172a;\n    border-radius: 10px;\n    outline: none;\n    margin-bottom: 1rem;\n}\n\n.modern-slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 18px;\n    height: 18px;\n    background: #fbbf24;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\n}\n\n.control-buttons {\n    display: grid;\n    grid-template-columns: 2fr 1fr;\n    gap: 8px;\n}\n\n.btn-log {\n    background: linear-gradient(135deg, #fbbf24, #f59e0b);\n    color: #451a03;\n    border: none;\n    padding: 10px;\n    border-radius: 12px;\n    font-weight: 800;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n.btn-log:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4); }\n\n.btn-secondary {\n    background: rgba(255, 255, 255, 0.05);\n    color: #fde68a;\n    border: 1px solid rgba(251, 191, 36, 0.2);\n    padding: 10px;\n    border-radius: 12px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n}\n\n.view-container { display: none; }\n.view-container.active { display: block; }\n\n.section-label {\n    font-size: 0.65rem;\n    font-weight: 800;\n    text-transform: uppercase;\n    color: #94a3b8;\n    margin-bottom: 10px;\n    letter-spacing: 1px;\n}\n\n.history-list {\n    display: flex;\n    gap: 8px;\n    overflow-x: auto;\n    padding-bottom: 8px;\n    scrollbar-width: none;\n    cursor: grab;\n    user-select: none;\n}\n.history-list:active { cursor: grabbing; }\n.history-list::-webkit-scrollbar { display: none; }\n\n.history-item {\n    background: rgba(255, 255, 255, 0.03);\n    padding: 10px;\n    border-radius: 14px;\n    min-width: 75px;\n    text-align: center;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    transition: transform 0.2s, background 0.2s;\n}\n.history-item:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); }\n\n.h-val { display: block; font-weight: 800; font-size: 1rem; color: #fbbf24; pointer-events: none; }\n.h-date { font-size: 0.55rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; pointer-events: none; }\n\n.graph-wrapper {\n    background: rgba(0,0,0,0.2);\n    border-radius: 16px;\n    padding: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n#step-graph {\n    width: 100%;\n    height: 100px;\n}\n\n.graph-labels {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 8px;\n    font-size: 0.6rem;\n    color: #94a3b8;\n    font-weight: 700;\n    text-transform: uppercase;\n}\n\n.btn-range-toggle {\n    background: rgba(251, 191, 36, 0.1);\n    border: 1px solid rgba(251, 191, 36, 0.2);\n    color: #fbbf24;\n    padding: 2px 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.6rem;\n    font-weight: 800;\n    text-transform: uppercase;\n}\n\n.toast-msg {\n    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);\n    background: #fbbf24; color: #451a03; padding: 8px 16px; border-radius: 100px;\n    font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;\n    pointer-events: none; z-index: 100;\n}",
      "js": "const { root, saveState, getState } = api;\n\nconst RANGES = [\n    { label: '7 days', val: 7 },\n    { label: '30 days', val: 30 },\n    { label: '3 months', val: 90 },\n    { label: '6 months', val: 180 },\n    { label: '1 year', val: 365 }\n];\n\nlet state = {\n    history: [],\n    goal: 10000,\n    view: 'list',\n    rangeIdx: 1,\n    editingDate: null\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const todayData = state.history[0] || { steps: 0, date: '' };\n    const steps = todayData.steps;\n    \n    const circle = root.querySelector('#progress-bar');\n    const radius = 70;\n    const circumference = 2 * Math.PI * radius;\n    const offset = circumference - (Math.min(steps / state.goal, 1.2) * circumference);\n    circle.style.strokeDashoffset = offset;\n    \n    root.querySelector('#step-count').innerText = steps.toLocaleString();\n    root.querySelector('#step-goal-text').innerText = `Goal: ${state.goal.toLocaleString()}`;\n    \n    const calories = Math.round(steps * 0.04);\n    const distance = (steps * 0.00076).toFixed(1);\n    let totalAll = 0;\n    state.history.forEach(h => totalAll += h.steps);\n    const avg = state.history.length > 0 ? Math.round(totalAll / state.history.length) : 0;\n    \n    root.querySelector('#stat-calories').innerText = calories.toLocaleString();\n    root.querySelector('#stat-distance').innerText = distance;\n    root.querySelector('#stat-avg').innerText = avg.toLocaleString();\n\n    const list = root.querySelector('#step-history');\n    list.innerHTML = '';\n    state.history.forEach((item, idx) => {\n        const el = document.createElement('div');\n        el.className = 'history-item';\n        el.innerHTML = `\n            <span class=\"h-val\">${item.steps.toLocaleString()}</span>\n            <span class=\"h-date\">${item.date}</span>\n        `;\n        el.onclick = () => editEntry(idx);\n        list.appendChild(el);\n    });\n\n    renderGraph();\n\n    root.querySelector('#view-list').className = 'view-container' + (state.view === 'list' ? ' active' : '');\n    root.querySelector('#view-graph').className = 'view-container' + (state.view === 'graph' ? ' active' : '');\n    root.querySelector('#btn-view-toggle').innerText = state.view === 'list' ? '📊' : '📜';\n    root.querySelector('#btn-graph-range').innerText = RANGES[state.rangeIdx].label;\n    \n    const logBtn = root.querySelector('#btn-log');\n    logBtn.innerText = state.editingDate ? `Update ${state.editingDate} ✨` : 'Add Steps ✨';\n}\n\nfunction editEntry(idx) {\n    const item = state.history[idx];\n    state.editingDate = item.date;\n    const input = root.querySelector('#input-add');\n    input.value = item.steps > 5000 ? 5000 : item.steps;\n    root.querySelector('#val-add').innerText = '+' + item.steps.toLocaleString();\n    showToast(`Editing steps for ${item.date} ✏️`);\n    render();\n}\n\nfunction renderGraph() {\n    const svg = root.querySelector('#step-graph');\n    if (!svg) return;\n    if (state.history.length < 2) {\n        svg.innerHTML = '<text x=\"50%\" y=\"50%\" text-anchor=\"middle\" fill=\"#94a3b8\" font-size=\"10\">Need more data...</text>';\n        return;\n    }\n    const range = RANGES[state.rangeIdx].val;\n    const data = state.history.slice(0, range).reverse();\n    const maxSteps = Math.max(...data.map(d => d.steps), state.goal) * 1.1;\n    const width = 300, height = 120, padding = 10;\n    let points = '';\n    data.forEach((item, i) => {\n        const x = (i / (data.length - 1)) * (width - padding * 2) + padding;\n        const y = height - ((item.steps / maxSteps) * (height - padding * 2)) - padding;\n        points += `${x},${y} `;\n    });\n    svg.innerHTML = `\n        <defs>\n            <linearGradient id=\"grad-steps\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                <stop offset=\"0%\" style=\"stop-color:#fbbf24;stop-opacity:0.3\" />\n                <stop offset=\"100%\" style=\"stop-color:#fbbf24;stop-opacity:0\" />\n            </linearGradient>\n        </defs>\n        <polyline points=\"${points}\" fill=\"none\" stroke=\"#fbbf24\" stroke-width=\"${range > 100 ? 1 : 2}\" />\n        <path d=\"M ${padding},${height} L ${points} L ${width-padding},${height} Z\" fill=\"url(#grad-steps)\" />\n    `;\n}\n\nfunction addSteps() {\n    const amount = parseInt(root.querySelector('#input-add').value);\n    const date = state.editingDate || new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    const existingIdx = state.history.findIndex(h => h.date === date);\n    if (existingIdx !== -1) {\n        if (state.editingDate) state.history[existingIdx].steps = amount;\n        else state.history[existingIdx].steps += amount;\n    } else {\n        state.history.unshift({ steps: amount, date: date });\n    }\n    if (state.history.length > 365) state.history.pop();\n    state.editingDate = null;\n    saveState(state);\n    render();\n    showToast('Steps saved! 👟');\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n\n    root.querySelector('#input-add').oninput = (e) => {\n        root.querySelector('#val-add').innerText = '+' + parseInt(e.target.value).toLocaleString();\n    };\n    root.querySelector('#btn-log').onclick = addSteps;\n    root.querySelector('#btn-set-goal').onclick = () => {\n        const currentGoal = state.goal;\n        const newGoal = window.prompt('Enter your daily step goal:', currentGoal);\n        if (newGoal !== null && newGoal !== '' && !isNaN(newGoal)) {\n            const goalNum = parseInt(newGoal);\n            if (goalNum > 0) {\n                state.goal = goalNum;\n                showToast(`Goal set to ${goalNum.toLocaleString()}! 🎯`);\n                render();\n                saveState(state);\n            }\n        }\n    };\n    root.querySelector('#btn-view-toggle').onclick = () => {\n        state.view = state.view === 'list' ? 'graph' : 'list';\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-graph-range').onclick = () => {\n        state.rangeIdx = (state.rangeIdx + 1) % RANGES.length;\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-reset').onclick = () => {\n        if (confirm('Clear all step data?')) {\n            state.history = [];\n            render();\n            saveState(state);\n            showToast('Data cleared 🗑️');\n        }\n    };\n\n    const list = root.querySelector('#step-history');\n    let isDown = false, startX, scrollLeft;\n    list.onmousedown = (e) => {\n        isDown = true;\n        startX = e.pageX - list.offsetLeft;\n        scrollLeft = list.scrollLeft;\n    };\n    list.onmouseleave = () => isDown = false;\n    list.onmouseup = () => isDown = false;\n    list.onmousemove = (e) => {\n        if (!isDown) return;\n        e.preventDefault();\n        const x = e.pageX - list.offsetLeft;\n        const walk = (x - startX) * 2;\n        list.scrollLeft = scrollLeft - walk;\n    };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "stock-watchlist",
      "title": "Stock Watchlist",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"title-group\">\n      <h4 class=\"widget-title\">📈 Stock Studio Pro</h4>\n      <div id=\"market-status\" class=\"market-status\">Market Open</div>\n    </div>\n    <div class=\"header-actions\">\n      <button id=\"btn-auto-refresh\" class=\"btn-icon-small\" title=\"Toggle Auto-Refresh\">⏱️</button>\n      <button id=\"btn-refresh\" class=\"btn-icon-small\" title=\"Refresh Prices\">🔄</button>\n      <button id=\"btn-portfolio-toggle\" class=\"btn-icon-small\" title=\"Toggle Portfolio Mode\">💼</button>\n    </div>\n  </div>\n\n  <div id=\"portfolio-summary\" class=\"portfolio-summary hidden\">\n    <div class=\"summary-item\">\n      <label>Total Value</label>\n      <div id=\"total-value\" class=\"summary-val\">$0.00</div>\n    </div>\n    <div class=\"summary-item\">\n      <label>24h Change</label>\n      <div id=\"total-change\" class=\"summary-val\">+0.00%</div>\n    </div>\n  </div>\n\n  <div class=\"stock-list\" id=\"stock-list\"></div>\n\n  <div class=\"input-card\">\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"stock-symbol\" placeholder=\"Symbol (ex: AAPL)\" maxlength=\"6\">\n      <button id=\"btn-add\">Ajouter ✨</button>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
      "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-l);\n    border: 1px solid var(--background-modifier-border);\n    max-width: 400px;\n    margin: 0 auto;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem; }\n.widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1.5px; }\n\n.market-status { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-success); margin-top: 4px; display: flex; align-items: center; gap: 4px; }\n.market-status::before { content: ''; width: 6px; height: 6px; background: currentColor; border-radius: 50%; display: inline-block; box-shadow: 0 0 8px currentColor; }\n\n.header-actions { display: flex; gap: 6px; }\n.btn-icon-small {\n    background: var(--background-modifier-hover); border: none; color: var(--text-muted); width: 32px; height: 32px;\n    border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;\n}\n.btn-icon-small:hover { background: var(--background-modifier-border-hover); color: var(--text-normal); }\n.btn-icon-small.active { background: var(--interactive-accent); color: var(--text-on-accent); }\n\n.portfolio-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: var(--background-primary-alt); padding: 1rem; border-radius: 16px; margin-bottom: 1.5rem; border: 1px solid var(--background-modifier-border); }\n.portfolio-summary.hidden { display: none; }\n\n.summary-item label { display: block; font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px; }\n.summary-val { font-size: 1.1rem; font-weight: 800; color: var(--text-normal); }\n\n.stock-list { display: grid; gap: 12px; margin-bottom: 1.5rem; }\n.stock-item {\n    background: var(--background-primary); border-radius: 16px; padding: 12px 16px;\n    border: 1px solid var(--background-modifier-border); display: grid; grid-template-columns: 1fr 80px 1fr; align-items: center; gap: 12px;\n    transition: transform 0.2s;\n}\n.stock-item:hover { transform: translateY(-2px); border-color: var(--interactive-accent); }\n\n.symbol { font-weight: 900; font-size: 1.1rem; color: var(--text-normal); display: block; }\n.company { font-size: 0.6rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n\n.sparkline-box { height: 30px; width: 100%; }\n.sparkline { width: 100%; height: 100%; overflow: visible; }\n\n.stock-price-box { text-align: right; display: flex; flex-direction: column; align-items: flex-end; }\n.price { font-weight: 800; font-size: 1rem; color: var(--text-normal); font-family: var(--font-monospace); }\n.change { font-size: 0.65rem; font-weight: 800; padding: 2px 6px; border-radius: 6px; margin-top: 4px; }\n.change.up { background: rgba(var(--mono-rgb-100), 0.1); color: var(--text-success); }\n.change.down { background: rgba(var(--mono-rgb-100), 0.1); color: var(--text-error); }\n\n.portfolio-controls { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--background-modifier-border); }\n.portfolio-controls.hidden { display: none; }\n\n.qty-input {\n    background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-normal);\n    width: 80px; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; outline: none;\n}\n.qty-input:focus { border-color: var(--interactive-accent); }\n\n.btn-del { background: none; border: none; color: var(--text-error); cursor: pointer; opacity: 0.6; font-size: 1rem; transition: opacity 0.2s; }\n.btn-del:hover { opacity: 1; }\n\n.input-card { background: var(--background-primary-alt); border-radius: 16px; padding: 1rem; border: 1px solid var(--background-modifier-border); }\n.input-group { display: flex; gap: 8px; }\n.input-group input { flex: 1; background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-normal); border-radius: 10px; padding: 10px 14px; font-size: 0.85rem; outline: none; font-weight: 700; }\n.input-group input:focus { border-color: var(--interactive-accent); }\n.input-group button { background: var(--interactive-accent); color: var(--text-on-accent); border: none; padding: 0 16px; border-radius: 10px; font-weight: 800; cursor: pointer; transition: filter 0.2s; }\n.input-group button:hover { filter: brightness(1.1); }\n\n.toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 8px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
      "js": "const { root, saveState, getState } = api;\n\nvar state = {\n    stocks: [],\n    showPortfolio: false,\n    autoRefresh: true\n};\n\nvar refreshInterval = null;\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (toast) {\n        toast.innerText = msg;\n        toast.style.opacity = '1';\n        setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n    }\n}\n\nfunction generateHistory(base) {\n    let h = [], curr = base;\n    for(let i=0; i<20; i++) {\n        curr *= (1 + (Math.random() * 0.04 - 0.02));\n        h.push(curr);\n    }\n    return h;\n}\n\nfunction updateUI() {\n    const list = root.querySelector('#stock-list');\n    if (!list) return;\n\n    // Update Header Buttons\n    root.querySelector('#btn-auto-refresh').classList.toggle('active', state.autoRefresh);\n    root.querySelector('#btn-portfolio-toggle').classList.toggle('active', state.showPortfolio);\n\n    // Update Market Status\n    const now = new Date(), h = now.getHours(), d = now.getDay();\n    const isOpen = d >= 1 && d <= 5 && h >= 9 && h < 17;\n    const statusEl = root.querySelector('#market-status');\n    statusEl.innerText = isOpen ? 'Market Open' : 'Market Closed';\n    statusEl.style.color = isOpen ? 'var(--text-success)' : 'var(--text-error)';\n\n    // Update Portfolio Summary\n    const summary = root.querySelector('#portfolio-summary');\n    summary.classList.toggle('hidden', !state.showPortfolio);\n    \n    if (state.showPortfolio) {\n        let total = 0;\n        state.stocks.forEach(s => {\n            total += (s.price || 0) * (s.qty || 0);\n        });\n        root.querySelector('#total-value').innerText = '$' + total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});\n    }\n\n    // Render List\n    list.innerHTML = '';\n    state.stocks.forEach((s, idx) => {\n        const item = document.createElement('div');\n        item.className = 'stock-item';\n        \n        const isUp = s.change >= 0;\n        const history = s.history || generateHistory(s.price);\n        const min = Math.min(...history);\n        const max = Math.max(...history);\n        const range = max - min || 1;\n        const points = history.map((p, i) => `${i * 5},${30 - ((p - min) / range * 25)}`).join(' ');\n\n        item.innerHTML = `\n            <div class=\"stock-main\">\n                <span class=\"symbol\">${s.symbol}</span>\n                <span class=\"company\">${s.name || s.symbol}</span>\n            </div>\n            <div class=\"sparkline-box\">\n                <svg class=\"sparkline\" viewBox=\"0 0 100 30\">\n                    <polyline fill=\"none\" stroke=\"${isUp ? 'var(--text-success)' : 'var(--text-error)'}\" stroke-width=\"2\" points=\"${points}\" />\n                </svg>\n            </div>\n            <div class=\"stock-price-box\">\n                <div class=\"price\">$${(s.price || 0).toFixed(2)}</div>\n                <div class=\"change ${isUp ? 'up' : 'down'}\">${isUp ? '+' : ''}${s.change.toFixed(2)}%</div>\n            </div>\n            <div class=\"portfolio-controls ${state.showPortfolio ? '' : 'hidden'}\">\n                <input type=\"number\" class=\"qty-input\" value=\"${s.qty || 0}\" min=\"0\" placeholder=\"Qty\">\n                <button class=\"btn-del\">🗑️</button>\n            </div>\n        `;\n\n        // Attach events to the new elements\n        const qtyInput = item.querySelector('.qty-input');\n        qtyInput.onchange = (e) => {\n            state.stocks[idx].qty = parseFloat(e.target.value) || 0;\n            saveState(state);\n            updateUI();\n        };\n\n        const delBtn = item.querySelector('.btn-del');\n        delBtn.onclick = () => {\n            state.stocks.splice(idx, 1);\n            saveState(state);\n            updateUI();\n            showToast(s.symbol + ' removed');\n        };\n\n        list.appendChild(item);\n    });\n}\n\nasync function fetchPrices() {\n    // Mock fetching prices\n    state.stocks = state.stocks.map(s => {\n        const change = (Math.random() * 4 - 2);\n        const newPrice = s.price * (1 + change / 100);\n        const history = s.history || generateHistory(s.price);\n        history.shift();\n        history.push(newPrice);\n        return { ...s, price: newPrice, change: change, history: history };\n    });\n    updateUI();\n}\n\nfunction addStock() {\n    const input = root.querySelector('#stock-symbol');\n    const symbol = input.value.toUpperCase().trim();\n    if (!symbol) return;\n    \n    if (state.stocks.some(s => s.symbol === symbol)) {\n        showToast('Already in list');\n        return;\n    }\n\n    const newStock = {\n        symbol: symbol,\n        name: symbol,\n        price: 100 + Math.random() * 400,\n        change: Math.random() * 2 - 1,\n        qty: 0,\n        history: generateHistory(100 + Math.random() * 400)\n    };\n\n    state.stocks.push(newStock);\n    input.value = '';\n    saveState(state);\n    updateUI();\n    showToast(symbol + ' added');\n}\n\nfunction togglePortfolio() {\n    state.showPortfolio = !state.showPortfolio;\n    saveState(state);\n    updateUI();\n}\n\nfunction toggleAutoRefresh() {\n    state.autoRefresh = !state.autoRefresh;\n    if (state.autoRefresh) {\n        startAutoRefresh();\n    } else {\n        stopAutoRefresh();\n    }\n    saveState(state);\n    updateUI();\n}\n\nfunction startAutoRefresh() {\n    stopAutoRefresh();\n    refreshInterval = setInterval(fetchPrices, 5000);\n}\n\nfunction stopAutoRefresh() {\n    if (refreshInterval) clearInterval(refreshInterval);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && saved.stocks) {\n        state = saved;\n    } else {\n        // Default stocks\n        state.stocks = [\n            { symbol: 'AAPL', name: 'Apple Inc.', price: 185.92, change: 1.2, qty: 5, history: generateHistory(185) },\n            { symbol: 'TSLA', name: 'Tesla, Inc.', price: 238.45, change: -2.4, qty: 10, history: generateHistory(238) },\n            { symbol: 'BTC', name: 'Bitcoin', price: 42500, change: 0.5, qty: 0.1, history: generateHistory(42500) }\n        ];\n    }\n\n    // Attach static events\n    root.getElementById('btn-add').onclick = addStock;\n    root.getElementById('btn-refresh').onclick = fetchPrices;\n    root.getElementById('btn-portfolio-toggle').onclick = togglePortfolio;\n    root.getElementById('btn-auto-refresh').onclick = toggleAutoRefresh;\n    root.getElementById('stock-symbol').onkeypress = (e) => { if(e.key === 'Enter') addStock(); };\n\n    if (state.autoRefresh) startAutoRefresh();\n    \n    updateUI();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "time-studio",
      "title": "Time Studio Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <h4 class=\"widget-title\">⏳ Time Studio</h4>\n    </div>\n    <div class=\"header-right\">\n      <button id=\"btn-pip\" class=\"icon-btn\" title=\"Picture in Picture\">📺</button>\n      <div class=\"time-group\">\n        <span id=\"current-time\">--:--</span>\n        <span class=\"sep\">|</span>\n        <span id=\"header-date\">--</span>\n      </div>\n      <button id=\"btn-settings\" class=\"icon-btn\" title=\"Settings\">⚙️</button>\n    </div>\n  </div>\n\n  <div id=\"settings-panel\" class=\"settings-overlay hidden\">\n    <div class=\"settings-content\">\n      <h5>Widget Settings</h5>\n      \n      <div class=\"setting-row\">\n        <label>Format</label>\n        <select id=\"set-fmt\">\n          <option value=\"12\">12h (US Date)</option>\n          <option value=\"24\">24h (EU Date)</option>\n        </select>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>PiP Content</label>\n        <select id=\"set-pip-source\">\n          <option value=\"work\">Work Progress</option>\n          <option value=\"day\">Day Progress</option>\n          <option value=\"week\">Week Progress</option>\n          <option value=\"month\">Month Progress</option>\n          <option value=\"year\">Year Progress</option>\n          <option value=\"clock\">Clock Only</option>\n        </select>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>Show Work Bar</label>\n        <div class=\"toggle-container\">\n             <input type=\"checkbox\" id=\"set-show-work\">\n        </div>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>Start</label>\n        <input type=\"time\" id=\"set-start\">\n      </div>\n      \n      <div class=\"setting-row\">\n        <label>End</label>\n        <input type=\"time\" id=\"set-end\">\n      </div>\n\n      <div class=\"settings-actions\">\n        <button id=\"btn-cancel\" class=\"btn-sec\">Cancel</button>\n        <button id=\"btn-save\" class=\"btn-pri\">Save</button>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"progress-grid\">\n    <div class=\"progress-item\" id=\"work-container\" data-type=\"work\">\n      <div class=\"item-header\">\n        <span class=\"label\">💼 Work Day</span>\n        <span class=\"value\" id=\"work-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"work-bar\" class=\"bar-fill work-gradient\"></div>\n        <div class=\"bar-glow work-glow\"></div>\n      </div>\n      <div class=\"sub-label\" id=\"work-range\">--:-- - --:--</div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Day</span>\n        <span class=\"value\" id=\"day-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"day-bar\" class=\"bar-fill day-gradient\"></div>\n      </div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Week</span>\n        <span class=\"value\" id=\"week-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"week-bar\" class=\"bar-fill week-gradient\"></div>\n      </div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Month</span>\n        <span class=\"value\" id=\"month-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"month-bar\" class=\"bar-fill month-gradient\"></div>\n      </div>\n    </div>\n    \n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Year</span>\n        <span class=\"value\" id=\"year-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"year-bar\" class=\"bar-fill year-gradient\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"footer-info\">\n    <div id=\"date-display\" class=\"date-display\">Loading...</div>\n  </div>\n\n  <div class=\"pip-active-area\">\n    <canvas id=\"pip-canvas\" width=\"300\" height=\"150\"></canvas>\n    <video id=\"pip-video\" autoplay muted loop playsinline></video>\n    <audio id=\"silent-audio\" loop>\n      <source src=\"data:audio/wav;base64,UklGRigAAABXQVZFRm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==\" type=\"audio/wav\">\n    </audio>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; } .header-right { display: flex; align-items: center; gap: 8px; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1px; } .time-group { font-family: var(--font-monospace); font-size: 0.8rem; font-weight: 700; color: var(--text-normal); background: var(--background-primary-alt); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--background-modifier-border); display: flex; align-items: center; gap: 8px; } .sep { color: var(--text-faint); font-weight: 400; font-size: 0.7rem; } #header-date { color: var(--text-muted); font-size: 0.75rem; } .icon-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; border-radius: 4px; font-size: 1rem; line-height: 1; } .icon-btn:hover { color: var(--text-normal); background: var(--background-modifier-hover); } .settings-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 10; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; } .settings-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .settings-content { background: var(--background-primary); padding: 1.5rem; border-radius: 12px; width: 90%; border: 1px solid var(--background-modifier-border); } .settings-content h5 { margin: 0 0 1rem 0; text-align: center; } .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; font-size: 0.9rem; } .setting-row input[type=\"time\"], .setting-row select { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); color: var(--text-normal); padding: 4px; border-radius: 4px; } .setting-row input[type=\"checkbox\"] { accent-color: var(--interactive-accent); width: 1.2rem; height: 1.2rem; cursor: pointer; } .settings-actions { display: flex; gap: 10px; margin-top: 1.5rem; } .settings-actions button { flex: 1; padding: 8px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; font-size: 0.8rem; } .btn-sec { background: var(--background-modifier-error); color: white; } .btn-pri { background: var(--interactive-accent); color: var(--text-on-accent); } .progress-grid { display: grid; gap: 1rem; } .progress-item { display: flex; flex-direction: column; gap: 6px; } .item-header { display: flex; justify-content: space-between; align-items: flex-end; } .label { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; } .sub-label { font-size: 0.65rem; color: var(--text-faint); margin-top: 2px; text-align: right; } .value { font-size: 0.8rem; font-weight: 800; font-family: var(--font-monospace); color: var(--text-normal); } .bar-container { height: 8px; background: var(--background-primary); border-radius: 100px; position: relative; overflow: hidden; border: 1px solid var(--background-modifier-border); } .bar-fill { height: 100%; width: 0%; border-radius: 100px; transition: width 0.5s ease; position: relative; z-index: 2; } .bar-glow { position: absolute; top:0; left:0; width:100%; height:100%; filter: blur(6px); opacity: 0.4; z-index: 1; } .day-gradient { background: linear-gradient(90deg, #3b82f6, #60a5fa); } .week-gradient { background: linear-gradient(90deg, #8b5cf6, #a78bfa); } .month-gradient { background: linear-gradient(90deg, #f59e0b, #fbbf24); } .year-gradient { background: linear-gradient(90deg, #10b981, #34d399); } .work-gradient { background: linear-gradient(90deg, #ec4899, #f472b6); } .work-glow { background: #ec4899; } .footer-info { margin-top: 1.5rem; padding-top: 0.75rem; border-top: 1px solid var(--background-modifier-border); text-align: center; } .date-display { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); } .pip-active-area { position: fixed; top: -10000px; left: -10000px; width: 300px; height: 150px; opacity: 1; visibility: visible; pointer-events: none; } .error-shake { animation: shake 0.5s; background: rgba(255, 0, 0, 0.2); } @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar config = {\n  start: '09:00',\n  end: '17:40',\n  fmt: '12',\n  showWork: true,\n  pipSource: 'work'\n};\n\nvar pipCanvas, pipVideo, silentAudio;\n\nvar COLORS = {\n  work: '#ec4899', day: '#3b82f6', week: '#8b5cf6', \n  month: '#f59e0b', year: '#10b981', clock: '#ffffff'\n};\n\nfunction formatTime(t) {\n  if (config.fmt === '24') return t;\n  var parts = t.split(':');\n  var h = parseInt(parts[0]);\n  var m = parts[1];\n  var ampm = h >= 12 ? 'PM' : 'AM';\n  h = h % 12;\n  h = h ? h : 12;\n  return h + ':' + m + ' ' + ampm;\n}\n\nasync function togglePiP() {\n    var btn = root.getElementById('btn-pip');\n    if (document.pictureInPictureElement) {\n        try { await document.exitPictureInPicture(); } catch(e) {}\n    } else {\n        try {\n            drawPiP(new Date());\n            if (pipVideo.readyState === 0) await pipVideo.play();\n            await pipVideo.requestPictureInPicture();\n            if(silentAudio) silentAudio.play();\n        } catch(e) {\n             console.error('PiP Failed:', e);\n             if(btn) {\n                 btn.classList.add('error-shake');\n                 setTimeout(function(){ btn.classList.remove('error-shake'); }, 500);\n             }\n        }\n    }\n}\n\nfunction drawPiP(now) {\n    if (!pipCanvas) return;\n    var ctx = pipCanvas.getContext('2d');\n    ctx.fillStyle = '#111';\n    ctx.fillRect(0, 0, 300, 150);\n\n    if (config.pipSource === 'clock') {\n        var is12 = config.fmt === '12';\n        var timeStr = now.toLocaleTimeString([], { hour12: is12, hour: '2-digit', minute:'2-digit', second:'2-digit' });\n        ctx.fillStyle = '#fff';\n        ctx.font = 'bold 50px monospace';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(timeStr, 150, 75);\n        return;\n    }\n\n    var pct = 0; \n    if (config.pipSource === 'work') {\n        var sParts = config.start.split(':');\n        var eParts = config.end.split(':');\n        var sDate = new Date(now); sDate.setHours(parseInt(sParts[0]), parseInt(sParts[1]), 0, 0);\n        var eDate = new Date(now); eDate.setHours(parseInt(eParts[0]), parseInt(eParts[1]), 0, 0);\n        if (now > eDate) pct = 100;\n        else if (now > sDate) pct = ((now - sDate) / (eDate - sDate)) * 100;\n    } else if (config.pipSource === 'day') {\n        var dStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n        pct = ((now - dStart) / 86400000) * 100;\n    } else if (config.pipSource === 'week') {\n        var d = new Date(now); var day = d.getDay(); var diff = d.getDate() - day + (day === 0 ? -6 : 1);\n        var wStart = new Date(d.setDate(diff)); wStart.setHours(0,0,0,0);\n        pct = ((now - wStart) / (86400000 * 7)) * 100;\n    } else if (config.pipSource === 'month') {\n        var mStart = new Date(now.getFullYear(), now.getMonth(), 1);\n        var mEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n        pct = ((now - mStart) / (mEnd - mStart)) * 100;\n    } else if (config.pipSource === 'year') {\n        var yStart = new Date(now.getFullYear(), 0, 1);\n        var yEnd = new Date(now.getFullYear(), 11, 31, 23, 59, 59);\n        pct = ((now - yStart) / (yEnd - yStart)) * 100;\n    }\n\n    pct = Math.max(0, Math.min(100, pct));\n    \n    ctx.fillStyle = '#aaa';\n    ctx.font = 'bold 18px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText(config.pipSource.toUpperCase(), 20, 45);\n    ctx.fillStyle = '#fff';\n    ctx.textAlign = 'right';\n    ctx.fillText(pct.toFixed(1) + '%', 280, 45);\n    ctx.fillStyle = '#333';\n    ctx.fillRect(20, 60, 260, 20);\n    ctx.fillStyle = COLORS[config.pipSource] || '#fff';\n    var w = (pct / 100) * 260;\n    ctx.fillRect(20, 60, w, 20);\n    var tShort = now.toLocaleTimeString([], { hour12: config.fmt==='12', hour: '2-digit', minute:'2-digit' });\n    ctx.fillStyle = '#666';\n    ctx.font = '16px monospace';\n    ctx.textAlign = 'center';\n    ctx.fillText(tShort, 150, 110);\n}\n\nfunction update() {\n  var now = new Date();\n  drawPiP(now);\n\n  var workContainer = root.getElementById('work-container');\n  if (workContainer) workContainer.style.display = config.showWork ? 'flex' : 'none';\n\n  var clockEl = root.getElementById('current-time');\n  if (clockEl) {\n    var is12 = config.fmt === '12';\n    clockEl.innerText = now.toLocaleTimeString([], { hour12: is12, hour: '2-digit', minute: '2-digit', second: '2-digit' });\n  }\n\n  // Header Date Logic\n  var headDate = root.getElementById('header-date');\n  if (headDate) {\n    var locale = config.fmt === '12' ? 'en-US' : 'en-GB';\n    // 12h = Jan 16 | 24h = 16 Jan\n    headDate.innerText = now.toLocaleDateString(locale, { day: 'numeric', month: 'short' });\n  }\n\n  var dateEl = root.getElementById('date-display');\n  if (dateEl) dateEl.innerText = now.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'long' });\n\n  var set = function(id, pct, txt) {\n    var bar = root.getElementById(id + '-bar');\n    var text = root.getElementById(id + '-val');\n    var safePct = Math.max(0, Math.min(100, pct));\n    if (bar) bar.style.width = safePct.toFixed(2) + '%';\n    if (text) text.innerText = txt || (safePct.toFixed(1) + '%');\n  };\n\n  if (config.showWork) {\n      var sParts = config.start.split(':');\n      var eParts = config.end.split(':');\n      var sDate = new Date(now); sDate.setHours(parseInt(sParts[0]), parseInt(sParts[1]), 0, 0);\n      var eDate = new Date(now); eDate.setHours(parseInt(eParts[0]), parseInt(eParts[1]), 0, 0);\n      var workPct = 0; var workText = '';\n      if (now < sDate) { workPct = 0; workText = 'Not Started'; }\n      else if (now > eDate) { workPct = 100; workText = 'Done'; }\n      else { workPct = ((now - sDate) / (eDate - sDate)) * 100; }\n      set('work', workPct, (workPct > 0 && workPct < 100) ? null : workText);\n      var rangeEl = root.getElementById('work-range');\n      if(rangeEl) rangeEl.innerText = formatTime(config.start) + ' - ' + formatTime(config.end);\n  }\n\n  var dStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  set('day', ((now - dStart) / 86400000) * 100);\n\n  var d = new Date(now); var day = d.getDay(); var diff = d.getDate() - day + (day === 0 ? -6 : 1);\n  var wStart = new Date(d.setDate(diff)); wStart.setHours(0,0,0,0);\n  set('week', ((now - wStart) / (86400000 * 7)) * 100);\n\n  var mStart = new Date(now.getFullYear(), now.getMonth(), 1);\n  var mEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n  set('month', ((now - mStart) / (mEnd - mStart)) * 100);\n\n  var yStart = new Date(now.getFullYear(), 0, 1);\n  var yEnd = new Date(now.getFullYear(), 11, 31, 23, 59, 59);\n  set('year', ((now - yStart) / (yEnd - yStart)) * 100);\n}\n\nfunction toggleSettings(show) {\n  var el = root.getElementById('settings-panel');\n  if (el) el.classList.toggle('hidden', !show);\n}\n\nfunction loadUI() {\n  var iS = root.getElementById('set-start');\n  var iE = root.getElementById('set-end');\n  var iF = root.getElementById('set-fmt');\n  var iShow = root.getElementById('set-show-work');\n  var iPip = root.getElementById('set-pip-source');\n  \n  if(iS) iS.value = config.start;\n  if(iE) iE.value = config.end;\n  if(iF) iF.value = config.fmt;\n  if(iShow) iShow.checked = config.showWork;\n  if(iPip) iPip.value = config.pipSource;\n}\n\nfunction saveUI() {\n  var iS = root.getElementById('set-start');\n  var iE = root.getElementById('set-end');\n  var iF = root.getElementById('set-fmt');\n  var iShow = root.getElementById('set-show-work');\n  var iPip = root.getElementById('set-pip-source');\n  \n  if(iS) config.start = iS.value;\n  if(iE) config.end = iE.value;\n  if(iF) config.fmt = iF.value;\n  if(iShow) config.showWork = iShow.checked;\n  if(iPip) config.pipSource = iPip.value;\n  \n  saveState(config).then(function() {\n    toggleSettings(false);\n    update();\n  });\n}\n\nasync function init() {\n  pipCanvas = root.getElementById('pip-canvas');\n  pipVideo = root.getElementById('pip-video');\n  silentAudio = root.getElementById('silent-audio');\n\n  var saved = await getState();\n  if (saved) Object.assign(config, saved);\n\n  var btnSet = root.getElementById('btn-settings');\n  var btnCan = root.getElementById('btn-cancel');\n  var btnSav = root.getElementById('btn-save');\n  var btnPip = root.getElementById('btn-pip');\n\n  if(btnSet) btnSet.onclick = function() { loadUI(); toggleSettings(true); };\n  if(btnCan) btnCan.onclick = function() { toggleSettings(false); };\n  if(btnSav) btnSav.onclick = saveUI;\n  if(btnPip) btnPip.onclick = togglePiP;\n\n  if(pipVideo && pipCanvas) {\n     pipVideo.srcObject = pipCanvas.captureStream(10);\n     pipVideo.play().catch(function(e){});\n  }\n\n  update();\n  setInterval(update, 1000);\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "timezone-scrubber",
      "title": "Timezone Scrubber",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"title-row\">\n      <span class=\"icon\">🌍</span>\n      <h4 class=\"widget-title\">World Scrubber</h4>\n    </div>\n    <div class=\"controls\">\n      <button id=\"btn-now\" class=\"btn-pill active\">LIVE</button>\n      <button id=\"btn-fmt\" class=\"btn-icon\">24h</button>\n    </div>\n  </div>\n\n  <div class=\"scrubber-section\">\n    <div class=\"main-time-display\">\n      <span id=\"local-time-display\">--:--</span>\n      <span id=\"local-ampm\" class=\"ampm\"></span>\n    </div>\n    <div class=\"slider-container\">\n      <span class=\"sun-icon\">☀️</span>\n      <input type=\"range\" id=\"time-slider\" min=\"0\" max=\"1439\" value=\"720\">\n      <span class=\"moon-icon\">🌙</span>\n    </div>\n    <div class=\"date-subtitle\" id=\"local-date\">Loading...</div>\n  </div>\n\n  <div class=\"cities-list\" id=\"cities-container\">\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); --h-accent: #38bdf8; --bg-card: var(--background-secondary); } * { box-sizing: border-box; } .widget-card { background: var(--bg-card); border: 1px solid var(--background-modifier-border); border-radius: 16px; padding: 1.25rem; box-shadow: var(--shadow-s); max-width: 380px; margin: 0 auto; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; } .title-row { display: flex; align-items: center; gap: 8px; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-normal); text-transform: uppercase; letter-spacing: 0.5px; } .controls { display: flex; gap: 8px; } .btn-pill { background: var(--background-modifier-border); border: none; color: var(--text-muted); padding: 4px 10px; border-radius: 100px; font-size: 0.7rem; font-weight: 700; cursor: pointer; transition: all 0.2s; } .btn-pill.active { background: var(--interactive-accent); color: var(--text-on-accent); } .btn-icon { background: transparent; border: 1px solid var(--background-modifier-border); color: var(--text-muted); width: 32px; height: 24px; border-radius: 6px; font-size: 0.7rem; cursor: pointer; } .btn-icon:hover { color: var(--text-normal); border-color: var(--text-muted); } .scrubber-section { text-align: center; margin-bottom: 1.5rem; padding: 1rem; background: var(--background-primary); border-radius: 12px; border: 1px solid var(--background-modifier-border); } .main-time-display { font-family: var(--font-monospace); font-size: 2.2rem; font-weight: 800; color: var(--h-accent); line-height: 1; margin-bottom: 0.5rem; } .ampm { font-size: 1rem; color: var(--text-muted); font-weight: 600; margin-left: 4px; } .slider-container { display: flex; align-items: center; gap: 10px; margin: 10px 0; } input[type=range] { -webkit-appearance: none; width: 100%; height: 6px; background: var(--background-modifier-border); border-radius: 5px; outline: none; cursor: pointer; } input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--h-accent); cursor: pointer; transition: transform 0.1s; box-shadow: 0 0 10px rgba(56, 189, 248, 0.4); } input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); } .date-subtitle { font-size: 0.75rem; color: var(--text-faint); font-weight: 600; } .cities-list { display: grid; gap: 8px; } .city-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; border-radius: 8px; transition: background 0.2s; border-bottom: 1px solid transparent; } .city-row:hover { background: var(--background-modifier-hover); } .city-info { display: flex; align-items: center; gap: 10px; } .flag { font-size: 1.1rem; } .city-name { font-size: 0.85rem; font-weight: 600; color: var(--text-normal); } .city-time-group { text-align: right; } .city-time { font-family: var(--font-monospace); font-size: 0.95rem; font-weight: 700; color: var(--text-normal); } .city-meta { font-size: 0.7rem; color: var(--text-muted); display: flex; align-items: center; justify-content: flex-end; gap: 4px; } .diff-day { color: var(--interactive-accent); font-weight: 700; background: rgba(var(--interactive-accent-rgb), 0.1); padding: 0 4px; border-radius: 4px; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar cities = [\n  { name: 'Los Angeles', zone: 'America/Los_Angeles', flag: '🇺🇸' },\n  { name: 'New York', zone: 'America/New_York', flag: '🇺🇸' },\n  { name: 'London', zone: 'Europe/London', flag: '🇬🇧' },\n  { name: 'Paris', zone: 'Europe/Paris', flag: '🇫🇷' },\n  { name: 'Tokyo', zone: 'Asia/Tokyo', flag: '🇯🇵' },\n  { name: 'Sydney', zone: 'Australia/Sydney', flag: '🇦🇺' }\n];\n\nvar state = {\n  minutes: 720,\n  isLive: true,\n  is24h: true\n};\n\nvar liveInterval = null;\n\nfunction getFormattedTime(date, zone) {\n  var options = {\n    timeZone: zone,\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: !state.is24h\n  };\n  \n  var timeStr = new Intl.DateTimeFormat('en-US', options).format(date);\n  \n  // Day Diff Logic\n  var localParts = new Intl.DateTimeFormat('en-US', { \n      year:'numeric', month:'numeric', day:'numeric', \n      timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone \n  }).formatToParts(date);\n  \n  var targetParts = new Intl.DateTimeFormat('en-US', { \n      year:'numeric', month:'numeric', day:'numeric', hour:'numeric', timeZoneName: 'short',\n      timeZone: zone \n  }).formatToParts(date);\n  \n  var lDay = parseInt(localParts.find(function(p){ return p.type==='day'; }).value);\n  var tDay = parseInt(targetParts.find(function(p){ return p.type==='day'; }).value);\n  var tHour = parseInt(targetParts.find(function(p){ return p.type==='hour'; }).value);\n  var tAmPm = targetParts.find(function(p){ return p.type==='dayPeriod'; });\n  \n  var diff = 0;\n  if (tDay !== lDay) {\n      if (tDay === lDay + 1 || (lDay > 28 && tDay === 1)) diff = 1;\n      else diff = -1;\n  }\n\n  var hour24 = tHour;\n  if (tAmPm && tAmPm.value === 'PM' && tHour !== 12) hour24 += 12;\n  if (tAmPm && tAmPm.value === 'AM' && tHour === 12) hour24 = 0;\n  \n  var isNight = (hour24 < 6 || hour24 >= 18);\n  var tzName = targetParts.find(function(p){ return p.type==='timeZoneName'; });\n  var abbr = tzName ? tzName.value : '';\n\n  return { timeStr: timeStr, diff: diff, isNight: isNight, abbr: abbr };\n}\n\nfunction renderCities(baseDate) {\n    var container = root.getElementById('cities-container');\n    container.innerHTML = '';\n\n    cities.forEach(function(city) {\n        var data = getFormattedTime(baseDate, city.zone);\n        var diffHtml = '';\n        if (data.diff !== 0) {\n            var txt = data.diff > 0 ? '+1' : '-1';\n            diffHtml = '<span class=\"diff-day\">' + txt + ' Day</span>';\n        }\n\n        var icon = data.isNight ? '🌙' : '☀️';\n        \n        var div = document.createElement('div');\n        div.className = 'city-row';\n        div.innerHTML = \n            '<div class=\"city-info\">' +\n                '<span class=\"flag\">' + city.flag + '</span>' +\n                '<div><div class=\"city-name\">' + city.name + '</div></div>' +\n            '</div>' +\n            '<div class=\"city-time-group\">' +\n                '<div class=\"city-time\">' + data.timeStr + '</div>' +\n                '<div class=\"city-meta\">' + icon + ' ' + diffHtml + ' ' + data.abbr + '</div>' +\n            '</div>';\n        container.appendChild(div);\n    });\n}\n\nfunction updateUI() {\n    var now = new Date();\n    var baseDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n    baseDate.setMinutes(state.minutes);\n\n    var localData = getFormattedTime(baseDate, Intl.DateTimeFormat().resolvedOptions().timeZone);\n    var parts = localData.timeStr.split(' ');\n    \n    var displayEl = root.getElementById('local-time-display');\n    var ampmEl = root.getElementById('local-ampm');\n    var dateEl = root.getElementById('local-date');\n    \n    if(displayEl) displayEl.innerText = parts[0];\n    if(ampmEl) ampmEl.innerText = parts[1] || '';\n    if(dateEl) dateEl.innerText = baseDate.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });\n    \n    var slider = root.getElementById('time-slider');\n    if (slider && document.activeElement !== slider) {\n        slider.value = state.minutes;\n    }\n\n    renderCities(baseDate);\n    \n    var btnNow = root.getElementById('btn-now');\n    var btnFmt = root.getElementById('btn-fmt');\n    if(btnNow) {\n        if(state.isLive) btnNow.classList.add('active');\n        else btnNow.classList.remove('active');\n    }\n    if(btnFmt) btnFmt.innerText = state.is24h ? '24h' : '12h';\n}\n\nfunction setLiveMode(isLive) {\n    state.isLive = isLive;\n    if (isLive) {\n        updateFromRealTime();\n        if(!liveInterval) liveInterval = setInterval(updateFromRealTime, 10000);\n    } else {\n        if(liveInterval) clearInterval(liveInterval);\n        liveInterval = null;\n    }\n    updateUI();\n}\n\nfunction updateFromRealTime() {\n    var now = new Date();\n    state.minutes = (now.getHours() * 60) + now.getMinutes();\n    updateUI();\n}\n\nasync function init() {\n    var saved = await getState();\n    if (saved) {\n        state.is24h = saved.is24h !== undefined ? saved.is24h : true;\n    }\n\n    var slider = root.getElementById('time-slider');\n    if(slider) {\n        slider.oninput = function(e) {\n            state.minutes = parseInt(e.target.value);\n            if (state.isLive) setLiveMode(false);\n            updateUI();\n        };\n        slider.onchange = function() {\n            saveState({ is24h: state.is24h });\n        };\n    }\n\n    var btnNow = root.getElementById('btn-now');\n    if(btnNow) btnNow.onclick = function() { setLiveMode(true); };\n\n    var btnFmt = root.getElementById('btn-fmt');\n    if(btnFmt) btnFmt.onclick = function() {\n        state.is24h = !state.is24h;\n        saveState({ is24h: state.is24h });\n        updateUI();\n    };\n\n    setLiveMode(true);\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "unit-converter",
      "title": "Unit Converter",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">🔄 Universal Converter</h4>\n  </div>\n\n  \n  <div class=\"tabs\">\n    <button class=\"tab-btn active\" data-cat=\"length\" title=\"Length\">📏</button>\n    <button class=\"tab-btn\" data-cat=\"weight\" title=\"Weight\">⚖️</button>\n    <button class=\"tab-btn\" data-cat=\"temp\" title=\"Temperature\">🌡️</button>\n    <button class=\"tab-btn\" data-cat=\"speed\" title=\"Speed\">🚀</button>\n  </div>\n\n  <div class=\"converter-box\">\n    \n    <div class=\"input-group\">\n      <input type=\"number\" id=\"val-a\" placeholder=\"0\">\n      <select id=\"unit-a\"></select>\n    </div>\n\n    \n    <div class=\"swap-container\">\n      <button id=\"btn-swap\" class=\"swap-btn\">⇅</button>\n    </div>\n\n    \n    <div class=\"input-group\">\n      <input type=\"number\" id=\"val-b\" placeholder=\"0\">\n      <select id=\"unit-b\"></select>\n    </div>\n  </div>\n\n  <div class=\"footer\">\n    <span id=\"formula-display\">1 = 1</span>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 20px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 380px; margin: 0 auto; transition: height 0.3s; } .widget-header { text-align: center; margin-bottom: 1rem; } .widget-title { margin: 0; font-size: 0.9rem; font-weight: 800; color: var(--text-normal); text-transform: uppercase; letter-spacing: 1px; } .tabs { display: flex; gap: 8px; justify-content: center; margin-bottom: 1.5rem; background: var(--background-primary); padding: 6px; border-radius: 12px; border: 1px solid var(--background-modifier-border); } .tab-btn { flex: 1; background: transparent; border: none; font-size: 1.2rem; cursor: pointer; padding: 8px; border-radius: 8px; transition: all 0.2s; opacity: 0.6; filter: grayscale(0.8); } .tab-btn:hover { opacity: 1; background: var(--background-modifier-hover); } .tab-btn.active { opacity: 1; filter: grayscale(0); background: var(--background-secondary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); transform: scale(1.05); } .converter-box { display: flex; flex-direction: column; gap: 8px; position: relative; } .input-group { display: flex; background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 12px; padding: 4px; transition: border-color 0.2s; } .input-group:focus-within { border-color: var(--interactive-accent); } .input-group input { flex: 1; background: transparent; border: none; font-size: 1.4rem; font-weight: 700; color: var(--text-normal); padding: 12px; width: 100px; outline: none; } .input-group select { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 8px; padding: 0 12px; font-weight: 600; color: var(--text-muted); cursor: pointer; max-width: 120px; outline: none; } .swap-container { display: flex; justify-content: center; margin: -18px 0; z-index: 2; pointer-events: none; } .swap-btn { pointer-events: auto; width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--background-modifier-border); background: var(--background-secondary); color: var(--interactive-accent); font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; box-shadow: var(--shadow-s); } .swap-btn:hover { transform: rotate(180deg) scale(1.1); color: var(--text-normal); } .footer { text-align: center; margin-top: 1rem; font-size: 0.8rem; color: var(--text-faint); font-family: var(--font-monospace); }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\n// Configuration\nvar cats = {\n  length: {\n    base: 'm',\n    units: { m: 1, km: 1000, cm: 0.01, mm: 0.001, mi: 1609.34, yd: 0.9144, ft: 0.3048, in: 0.0254 }\n  },\n  weight: {\n    base: 'g',\n    units: { g: 1, kg: 1000, mg: 0.001, lb: 453.592, oz: 28.3495 }\n  },\n  speed: {\n    base: 'kph',\n    units: { kph: 1, mph: 1.60934, mps: 3.6, knot: 1.852 }\n  },\n  temp: {\n    type: 'func' // Special handling\n  }\n};\n\nvar state = {\n  cat: 'length',\n  valA: 1,\n  unitA: 'm',\n  unitB: 'km'\n};\n\nfunction tempConvert(val, from, to) {\n  if(from === to) return val;\n  var c = val;\n  // Convert to Celsius first\n  if(from === 'F') c = (val - 32) * 5/9;\n  if(from === 'K') c = val - 273.15;\n  // Convert from Celsius to Target\n  if(to === 'F') return (c * 9/5) + 32;\n  if(to === 'K') return c + 273.15;\n  return c;\n}\n\nfunction update(source) {\n  var catData = cats[state.cat];\n  var valA = parseFloat(root.getElementById('val-a').value);\n  var valB = parseFloat(root.getElementById('val-b').value);\n  \n  if(source === 'a') {\n     if(isNaN(valA)) { root.getElementById('val-b').value = ''; return; }\n     var res;\n     if(state.cat === 'temp') {\n        res = tempConvert(valA, state.unitA, state.unitB);\n     } else {\n        var base = valA * catData.units[state.unitA];\n        res = base / catData.units[state.unitB];\n     }\n     // Smart rounding\n     var str = res.toFixed(6).replace(/\\.0+$/, '').replace(/(\\.\\d*[1-9])0+$/, '$1');\n     if(Math.abs(res) > 10000 || (Math.abs(res) < 0.001 && res !== 0)) str = res.toExponential(4);\n     root.getElementById('val-b').value = str;\n     state.valA = valA;\n  } else {\n     if(isNaN(valB)) { root.getElementById('val-a').value = ''; return; }\n     var res;\n     if(state.cat === 'temp') {\n        res = tempConvert(valB, state.unitB, state.unitA);\n     } else {\n        var base = valB * catData.units[state.unitB];\n        res = base / catData.units[state.unitA];\n     }\n     var str = res.toFixed(6).replace(/\\.0+$/, '').replace(/(\\.\\d*[1-9])0+$/, '$1');\n     if(Math.abs(res) > 10000 || (Math.abs(res) < 0.001 && res !== 0)) str = res.toExponential(4);\n     root.getElementById('val-a').value = str;\n     state.valA = parseFloat(str);\n  }\n\n  // Footer Formula\n  root.getElementById('formula-display').innerText = '1 ' + state.unitA + ' = ' + calculateRatio() + ' ' + state.unitB;\n  saveState(state);\n}\n\nfunction calculateRatio() {\n    if(state.cat === 'temp') return '...';\n    var r = cats[state.cat].units[state.unitA] / cats[state.cat].units[state.unitB];\n    return r.toPrecision(4);\n}\n\nfunction populateSelects() {\n  var uA = root.getElementById('unit-a');\n  var uB = root.getElementById('unit-b');\n  uA.innerHTML = ''; uB.innerHTML = '';\n  \n  var units = [];\n  if(state.cat === 'temp') units = ['C', 'F', 'K'];\n  else units = Object.keys(cats[state.cat].units);\n  \n  units.forEach(function(u) {\n      var o1 = document.createElement('option'); o1.value = u; o1.innerText = u;\n      var o2 = document.createElement('option'); o2.value = u; o2.innerText = u;\n      uA.appendChild(o1);\n      uB.appendChild(o2);\n  });\n  \n  // Verify selection valid\n  if(units.indexOf(state.unitA) === -1) state.unitA = units[0];\n  if(units.indexOf(state.unitB) === -1) state.unitB = units[1] || units[0];\n  \n  uA.value = state.unitA;\n  uB.value = state.unitB;\n}\n\nfunction setCat(cat) {\n  state.cat = cat;\n  populateSelects();\n  // Reset values for cleanliness\n  root.getElementById('val-a').value = 1;\n  update('a');\n  \n  // UI Tabs\n  var tabs = root.querySelectorAll('.tab-btn');\n  tabs.forEach(function(t) {\n      if(t.getAttribute('data-cat') === cat) t.classList.add('active');\n      else t.classList.remove('active');\n  });\n}\n\nasync function init() {\n  var saved = await getState();\n  if(saved) Object.assign(state, saved);\n  \n  // Setup DOM\n  var tabs = root.querySelectorAll('.tab-btn');\n  tabs.forEach(function(t) {\n      t.onclick = function() { setCat(t.getAttribute('data-cat')); };\n  });\n\n  var uA = root.getElementById('unit-a');\n  var uB = root.getElementById('unit-b');\n  var vA = root.getElementById('val-a');\n  var vB = root.getElementById('val-b');\n  var swp = root.getElementById('btn-swap');\n\n  uA.onchange = function(e) { state.unitA = e.target.value; update('a'); };\n  uB.onchange = function(e) { state.unitB = e.target.value; update('a'); };\n  vA.oninput = function() { update('a'); };\n  vB.oninput = function() { update('b'); };\n  \n  swp.onclick = function() {\n      var temp = state.unitA;\n      state.unitA = state.unitB;\n      state.unitB = temp;\n      uA.value = state.unitA;\n      uB.value = state.unitB;\n      update('a');\n  };\n\n  setCat(state.cat);\n  if(state.valA) { vA.value = state.valA; update('a'); }\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "vibe-studio",
      "title": "Vibe Studio",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"vibe-widget\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">✨ Vibe Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button class=\"btn-icon\" id=\"btn-history-toggle\" title=\"View History\">📜</button>\n      <button class=\"btn-icon\" id=\"btn-reset\" title=\"Reset Data\">🗑️</button>\n    </div>\n  </div>\n\n  <div class=\"main-view\" id=\"main-view\">\n    <div class=\"section\">\n      <label>HOW ARE YOU FEELING?</label>\n      <div class=\"mood-grid\" id=\"mood-list\">\n        <div class=\"mood-item\" data-val=\"😢\" title=\"Sad\">😢</div>\n        <div class=\"mood-item\" data-val=\"😐\" title=\"Neutral\">😐</div>\n        <div class=\"mood-item\" data-val=\"🙂\" title=\"Good\">🙂</div>\n        <div class=\"mood-item\" data-val=\"🤩\" title=\"Amazing\">🤩</div>\n        <div class=\"mood-item\" data-val=\"🔥\" title=\"Unstoppable\">🔥</div>\n      </div>\n    </div>\n\n    <div class=\"section\">\n      <div class=\"label-row\">\n        <label>ENERGY LEVEL</label>\n        <span class=\"value-badge\" id=\"energy-val\">3</span>\n      </div>\n      <div class=\"energy-container\">\n        <input type=\"range\" id=\"energy-slider\" min=\"1\" max=\"10\" step=\"1\" value=\"5\">\n      </div>\n    </div>\n\n    <div class=\"section\">\n      <label>QUICK NOTE</label>\n      <input type=\"text\" id=\"note-input\" placeholder=\"What's on your mind?\" maxlength=\"50\">\n    </div>\n\n    <button class=\"btn-save\" id=\"btn-save\">LOG VIBE 🚀</button>\n  </div>\n\n  <div class=\"history-view hidden\" id=\"history-view\">\n    <div class=\"history-header\">\n      <label>RECENT VIBES</label>\n      <button class=\"btn-back\" id=\"btn-back\">← Back</button>\n    </div>\n    <div class=\"history-list\" id=\"history-list\">\n      <!-- History items injected here -->\n    </div>\n  </div>\n\n  <div id=\"toast\" class=\"toast\">Vibe Logged! ✨</div>\n</div>",
      "css": ":host { display: block; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.vibe-widget {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 24px;\n    padding: 1.5rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1.25rem;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.widget-title {\n    margin: 0;\n    font-size: 0.8rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    color: var(--text-muted);\n}\n\n.btn-icon {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 8px;\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: var(--background-modifier-hover); }\n\n.section {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\nlabel {\n    font-size: 0.65rem;\n    font-weight: 800;\n    color: var(--text-muted);\n    letter-spacing: 0.05em;\n}\n\n.mood-grid {\n    display: flex;\n    justify-content: space-between;\n    background: var(--background-primary);\n    padding: 10px;\n    border-radius: 16px;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.mood-item {\n    font-size: 1.75rem;\n    cursor: pointer;\n    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    filter: grayscale(100%);\n    opacity: 0.4;\n}\n.mood-item:hover { transform: scale(1.2); opacity: 0.8; filter: grayscale(0%); }\n.mood-item.active { filter: grayscale(0%); opacity: 1; transform: scale(1.25); }\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.value-badge {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    font-size: 0.7rem;\n    font-weight: 800;\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n.energy-container {\n    padding: 15px 0;\n    display: flex;\n    align-items: center;\n}\n\n#energy-slider {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 6px;\n    background: var(--background-modifier-border);\n    border-radius: 3px;\n    outline: none;\n    cursor: pointer;\n}\n\n/* Thumb */\n#energy-slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    height: 18px;\n    width: 18px;\n    border-radius: 50%;\n    background: var(--background-primary);\n    border: 2px solid var(--interactive-accent);\n    box-shadow: var(--shadow-s);\n    transition: transform 0.1s ease, background 0.1s ease;\n}\n\n#energy-slider:active::-webkit-slider-thumb {\n    transform: scale(1.2);\n    background: var(--interactive-accent);\n}\n\ninput[type=\"text\"] {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 10px 14px;\n    border-radius: 12px;\n    font-size: 0.85rem;\n    outline: none;\n    transition: border-color 0.2s;\n}\ninput[type=\"text\"]:focus { border-color: var(--interactive-accent); }\n\n.btn-save {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 14px;\n    border-radius: 16px;\n    font-weight: 800;\n    font-size: 0.9rem;\n    cursor: pointer;\n    transition: all 0.2s;\n    box-shadow: 0 4px 12px rgba(var(--interactive-accent-rgb), 0.3);\n}\n.btn-save:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(var(--interactive-accent-rgb), 0.4); }\n\n.history-view {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    animation: slideIn 0.3s ease;\n}\n\n@keyframes slideIn {\n    from { transform: translateX(20px); opacity: 0; }\n    to { transform: translateX(0); opacity: 1; }\n}\n\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.btn-back {\n    background: transparent;\n    border: none;\n    color: var(--interactive-accent);\n    font-size: 0.7rem;\n    font-weight: 700;\n    cursor: pointer;\n}\n\n.history-list {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-height: 250px;\n    overflow-y: auto;\n    padding-right: 4px;\n}\n\n.history-item {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 10px 12px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.hist-mood { font-size: 1.25rem; }\n.hist-content { flex: 1; display: flex; flex-direction: column; gap: 2px; }\n.hist-meta { display: flex; justify-content: space-between; align-items: center; }\n.hist-date { font-size: 0.6rem; color: var(--text-muted); font-weight: 600; }\n.hist-energy { font-size: 0.6rem; font-weight: 800; color: #f59e0b; }\n.hist-note { font-size: 0.75rem; color: var(--text-normal); font-style: italic; }\n\n.toast {\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%) translateY(100px);\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    padding: 8px 16px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    z-index: 100;\n}\n.toast.show { transform: translateX(-50%) translateY(0); }\n\n.hidden { display: none !important; }",
      "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    currentMood: '',\n    currentEnergy: 5,\n    currentNote: '',\n    history: []\n};\n\nfunction render() {\n    // Update Mood Selection\n    root.querySelectorAll('.mood-item').forEach(item => {\n        item.classList.toggle('active', item.getAttribute('data-val') === state.currentMood);\n    });\n\n    // Update Energy Slider\n    const slider = root.getElementById('energy-slider');\n    const valBadge = root.getElementById('energy-val');\n    \n    slider.value = state.currentEnergy;\n    valBadge.innerText = state.currentEnergy;\n    \n    // Dynamic fill effect\n    const percent = ((state.currentEnergy - slider.min) / (slider.max - slider.min)) * 100;\n    slider.style.background = `linear-gradient(to right, var(--interactive-accent) ${percent}%, var(--background-modifier-border) ${percent}%)`;\n\n    // Update Note\n    root.getElementById('note-input').value = state.currentNote;\n\n    renderHistory();\n}\n\nfunction renderHistory() {\n    const list = root.getElementById('history-list');\n    list.innerHTML = '';\n\n    if (state.history.length === 0) {\n        list.innerHTML = '<div style=\"text-align:center; font-size:0.7rem; color:var(--text-muted); padding:20px;\">No vibes logged yet.</div>';\n        return;\n    }\n\n    // Show last 10 entries\n    state.history.slice(-10).reverse().forEach(item => {\n        const div = document.createElement('div');\n        div.className = 'history-item';\n        div.innerHTML = `\n            <div class=\"hist-mood\">${item.mood}</div>\n            <div class=\"hist-content\">\n                <div class=\"hist-meta\">\n                    <span class=\"hist-date\">${item.date}</span>\n                    <span class=\"hist-energy\">E: ${item.energy}/10</span>\n                </div>\n                ${item.note ? `<div class=\"hist-note\">\"${item.note}\"</div>` : ''}\n            </div>\n        `;\n        list.appendChild(div);\n    });\n}\n\nfunction logVibe() {\n    if (!state.currentMood) {\n        showToast('Please select a mood! 😶');\n        return;\n    }\n\n    const entry = {\n        mood: state.currentMood,\n        energy: state.currentEnergy,\n        note: state.currentNote,\n        date: new Date().toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })\n    };\n\n    state.history.push(entry);\n    state.currentNote = ''; // Clear note after logging\n    \n    save();\n    render();\n    showToast('Vibe Logged! 🚀');\n}\n\nfunction toggleView(view) {\n    const main = root.getElementById('main-view');\n    const hist = root.getElementById('history-view');\n    if (view === 'history') {\n        main.classList.add('hidden');\n        hist.classList.remove('hidden');\n    } else {\n        main.classList.remove('hidden');\n        hist.classList.add('hidden');\n    }\n}\n\nfunction showToast(msg) {\n    const toast = root.getElementById('toast');\n    if (toast) {\n        toast.innerText = msg;\n        toast.classList.add('show');\n        setTimeout(() => toast.classList.remove('show'), 2000);\n    }\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        // Migration check\n        if (saved.history) Object.assign(state, saved);\n        else if (saved.mood) { // Old format\n            state.currentMood = saved.mood;\n            state.currentEnergy = saved.energy || 5;\n        }\n    }\n\n    // Event Listeners\n    root.querySelectorAll('.mood-item').forEach(item => {\n        item.onclick = () => {\n            state.currentMood = item.getAttribute('data-val');\n            render();\n        };\n    });\n\n    const slider = root.getElementById('energy-slider');\n    slider.oninput = (e) => {\n        state.currentEnergy = parseInt(e.target.value);\n        render();\n    };\n\n    root.getElementById('note-input').oninput = (e) => {\n        state.currentNote = e.target.value;\n    };\n\n    root.getElementById('btn-save').onclick = logVibe;\n    root.getElementById('btn-history-toggle').onclick = () => toggleView('history');\n    root.getElementById('btn-back').onclick = () => toggleView('main');\n    \n    root.getElementById('btn-reset').onclick = () => {\n        if (confirm('Clear all history?')) {\n            state.history = [];\n            save();\n            render();\n        }\n    };\n\n    render();\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "weather-atmosphere",
      "title": "Atmosphere",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"widget-card\" id=\"main-card\">\n  \n  <div class=\"header\">\n    <div class=\"location-group\">\n      <span class=\"pin-icon\">📍</span>\n      <span id=\"city-name\" class=\"city-name\">Locating...</span>\n    </div>\n    <button id=\"btn-search\" class=\"icon-btn\">🔍</button>\n  </div>\n\n  \n  <div id=\"search-panel\" class=\"search-overlay hidden\">\n    <div class=\"search-box\">\n      <input type=\"text\" id=\"inp-city\" placeholder=\"City name (e.g. Tokyo)\">\n      <div class=\"search-actions\">\n        <button id=\"btn-go\" class=\"btn-primary\">Search</button>\n        <button id=\"btn-cancel\" class=\"btn-sec\">Cancel</button>\n      </div>\n      <div id=\"search-status\" class=\"status-msg\"></div>\n    </div>\n  </div>\n\n  \n  <div class=\"current-weather\">\n    <div class=\"icon-area\" id=\"weather-icon\">☀️</div>\n    <div class=\"temp-area\">\n      <span id=\"temp-val\">--</span><span class=\"unit\">°</span>\n    </div>\n    <div class=\"condition\" id=\"condition-text\">Loading</div>\n  </div>\n\n  \n  <div class=\"details-row\">\n    <div class=\"detail\">\n      <span class=\"lbl\">Wind</span>\n      <span class=\"val\" id=\"wind-val\">--</span>\n    </div>\n    <div class=\"detail\">\n      <span class=\"lbl\">Humidity</span>\n      <span class=\"val\" id=\"hum-val\">--</span>\n    </div>\n  </div>\n\n  \n  <div class=\"forecast-row\" id=\"forecast-container\">\n    \n  </div>\n\n  <div class=\"footer-update\">\n    <span id=\"last-update\">Updated: Just now</span>\n    <button id=\"btn-refresh\" class=\"refresh-btn\">↻</button>\n  </div>\n</div>",
      "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border-radius: 24px; padding: 1.5rem; box-shadow: var(--shadow-l); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; transition: background 0.5s ease; } /* Dynamic Backgrounds */ .bg-sunny { background: linear-gradient(135deg, #f59e0b, #ea580c); } .bg-cloudy { background: linear-gradient(135deg, #64748b, #475569); } .bg-rain { background: linear-gradient(135deg, #374151, #1f2937); } .bg-night { background: linear-gradient(135deg, #0f172a, #1e293b); } .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; } .location-group { display: flex; align-items: center; gap: 6px; font-weight: 700; font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; } .icon-btn { background: rgba(255,255,255,0.2); border: none; width: 32px; height: 32px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; } .icon-btn:hover { background: rgba(255,255,255,0.4); } .current-weather { text-align: center; margin: 1.5rem 0; } .icon-area { font-size: 4rem; margin-bottom: 0.5rem; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2)); animation: float 3s ease-in-out infinite; } @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } } .temp-area { font-size: 3.5rem; font-weight: 800; line-height: 1; } .unit { font-size: 1.5rem; vertical-align: top; opacity: 0.8; } .condition { font-size: 1rem; font-weight: 600; opacity: 0.9; text-transform: capitalize; margin-top: 4px; } .details-row { display: flex; justify-content: space-around; background: rgba(255,255,255,0.15); border-radius: 12px; padding: 10px; margin-bottom: 1.5rem; backdrop-filter: blur(4px); } .detail { display: flex; flex-direction: column; align-items: center; } .lbl { font-size: 0.65rem; text-transform: uppercase; opacity: 0.8; } .val { font-size: 0.9rem; font-weight: 700; } .forecast-row { display: flex; justify-content: space-between; margin-top: 1rem; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 1rem; } .day-col { display: flex; flex-direction: column; align-items: center; gap: 4px; } .day-name { font-size: 0.75rem; font-weight: 700; opacity: 0.8; } .day-icon { font-size: 1.2rem; } .day-temp { font-size: 0.9rem; font-weight: 700; } .footer-update { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; font-size: 0.7rem; opacity: 0.6; } .refresh-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1rem; transition: transform 0.5s; } .refresh-btn:hover { transform: rotate(180deg); } /* Search Overlay */ .search-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 10; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; backdrop-filter: blur(5px); } .search-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .search-box { background: white; padding: 1.5rem; border-radius: 16px; width: 85%; color: #1e293b; text-align: center; } .search-box input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; outline: none; } .search-actions { display: flex; gap: 8px; } .search-actions button { flex: 1; padding: 8px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; } .btn-primary { background: #3b82f6; color: white; } .btn-sec { background: #e2e8f0; color: #475569; } .status-msg { margin-top: 8px; font-size: 0.8rem; color: #ef4444; min-height: 1.2em; }",
      "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar state = {\n  city: 'Paris',\n  lat: 48.8566,\n  lon: 2.3522,\n  lastFetch: 0,\n  data: null\n};\n\nfunction getIcon(code, isDay) {\n  // WMO Weather Codes\n  if(code === 0) return isDay ? '☀️' : '🌙';\n  if(code >= 1 && code <= 3) return isDay ? '⛅' : '☁️';\n  if(code >= 45 && code <= 48) return '🌫️';\n  if(code >= 51 && code <= 67) return '🌧️';\n  if(code >= 71 && code <= 77) return '❄️';\n  if(code >= 80 && code <= 82) return '🌧️';\n  if(code >= 95) return '⛈️';\n  return '🌡️';\n}\n\nfunction getThemeClass(code, isDay) {\n  if(!isDay) return 'bg-night';\n  if(code <= 1) return 'bg-sunny';\n  if(code <= 48) return 'bg-cloudy';\n  return 'bg-rain';\n}\n\nfunction render() {\n  root.getElementById('city-name').innerText = state.city;\n  \n  if (!state.data) return;\n  \n  var current = state.data.current;\n  var daily = state.data.daily;\n  \n  // Current\n  var code = current.weather_code;\n  var isDay = current.is_day === 1;\n  \n  root.getElementById('temp-val').innerText = Math.round(current.temperature_2m);\n  root.getElementById('condition-text').innerText = 'Code ' + code;\n  root.getElementById('wind-val').innerText = current.wind_speed_10m + ' km/h';\n  root.getElementById('hum-val').innerText = current.relative_humidity_2m + '%';\n  \n  // Icon & Theme\n  root.getElementById('weather-icon').innerText = getIcon(code, isDay);\n  var card = root.getElementById('main-card');\n  card.className = 'widget-card ' + getThemeClass(code, isDay);\n  \n  // Forecast (Next 3 Days)\n  var forecastHtml = '';\n  // We skip index 0 because it is today, we want next days\n  for(var i=1; i<=3; i++) {\n      var date = new Date(daily.time[i]);\n      var dayName = date.toLocaleDateString('en-US', { weekday: 'short' });\n      var maxTemp = Math.round(daily.temperature_2m_max[i]);\n      var dCode = daily.weather_code[i];\n      var dIcon = getIcon(dCode, true);\n      \n      forecastHtml += '<div class=\"day-col\">' +\n        '<span class=\"day-name\">' + dayName + '</span>' +\n        '<span class=\"day-icon\">' + dIcon + '</span>' +\n        '<span class=\"day-temp\">' + maxTemp + '°</span>' +\n      '</div>';\n  }\n  root.getElementById('forecast-container').innerHTML = forecastHtml;\n  \n  // Update Time\n  var d = new Date(state.lastFetch);\n  root.getElementById('last-update').innerText = 'Updated: ' + d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\n}\n\nfunction fetchData() {\n  var url = 'https://api.open-meteo.com/v1/forecast?latitude=' + state.lat + '&longitude=' + state.lon + '&current=temperature_2m,relative_humidity_2m,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max&timezone=auto';\n  \n  root.getElementById('condition-text').innerText = 'Updating...';\n  \n  fetch(url).then(function(r){ return r.json(); }).then(function(data) {\n      state.data = data;\n      state.lastFetch = Date.now();\n      render();\n      saveState(state);\n  }).catch(function(e) {\n      root.getElementById('condition-text').innerText = 'Error';\n  });\n}\n\nfunction searchCity() {\n  var input = root.getElementById('inp-city');\n  var msg = root.getElementById('search-status');\n  var query = input.value.trim();\n  \n  if(!query) return;\n  msg.innerText = 'Searching...';\n  \n  var url = 'https://geocoding-api.open-meteo.com/v1/search?name=' + query + '&count=1&language=en&format=json';\n  \n  fetch(url).then(function(r){ return r.json(); }).then(function(data) {\n      if(data.results && data.results.length > 0) {\n          var res = data.results[0];\n          state.city = res.name;\n          state.lat = res.latitude;\n          state.lon = res.longitude;\n          toggleSearch(false);\n          msg.innerText = '';\n          fetchData();\n      } else {\n          msg.innerText = 'City not found.';\n      }\n  }).catch(function() {\n      msg.innerText = 'Network error.';\n  });\n}\n\nfunction toggleSearch(show) {\n  var el = root.getElementById('search-panel');\n  if(show) {\n      el.classList.remove('hidden');\n      root.getElementById('inp-city').focus();\n  } else {\n      el.classList.add('hidden');\n  }\n}\n\nasync function init() {\n  var saved = await getState();\n  if (saved) state = saved;\n  \n  render();\n  \n  // Auto-fetch if data is older than 1 hour or missing\n  if(!state.data || (Date.now() - state.lastFetch > 3600000)) {\n      fetchData();\n  }\n  \n  root.getElementById('btn-search').onclick = function() { toggleSearch(true); };\n  root.getElementById('btn-cancel').onclick = function() { toggleSearch(false); };\n  root.getElementById('btn-go').onclick = searchCity;\n  root.getElementById('btn-refresh').onclick = fetchData;\n  \n  // Enter key support\n  root.getElementById('inp-city').onkeydown = function(e) {\n      if(e.key === 'Enter') searchCity();\n  };\n}\n\ninit();",
      "source": "obsidget"
    },
    {
      "id": "yaml-api-test",
      "title": "YAML API Tester Pro",
      "cols": 2,
      "rows": 2,
      "bgColor": "#1f2937",
      "kind": "runner",
      "html": "<div class=\"test-container\" style=\"position: relative; resize: both; overflow: auto;\">\n  <h4>🛠️ YAML API Tester Pro</h4>\n  \n  <div class=\"selector-row\">\n    <label>Target Note:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"note-search\" list=\"note-list\" placeholder=\"Search or select a note...\" onchange=\"handleTargetChange()\">\n      <datalist id=\"note-list\"></datalist>\n      <button onclick=\"refreshAll()\" class=\"mini-btn\">🔄</button>\n    </div>\n  </div>\n\n  <div class=\"editor-section\">\n    <label>YAML Properties (JSON):</label>\n    <textarea id=\"fm-editor\" placeholder=\"Loading frontmatter...\"></textarea>\n  </div>\n  \n  <div class=\"actions\">\n    <button onclick=\"saveYAML()\" class=\"save-btn\">💾 Save Properties</button>\n    <button onclick=\"refreshFM()\" class=\"secondary\">🔄 Refresh Editor</button>\n  </div>\n\n  <div class=\"quick-add\">\n    <label>Quick Add 'test_obsidget':</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"prop-value\" placeholder=\"Enter value...\" oninput=\"saveLocalState()\">\n      <button onclick=\"addProperty()\">Add</button>\n    </div>\n  </div>\n\n  <div id=\"status-bar\" class=\"status\">Ready</div>\n  <div class=\"obsidget-resize-handle\" aria-hidden=\"true\" style=\"position: absolute; right: 6px; bottom: 6px; width: 12px; height: 12px; pointer-events: none; opacity: 0.5; background: linear-gradient(135deg, transparent 50%, var(--text-muted) 50%), linear-gradient(135deg, transparent 50%, var(--text-muted) 50%); background-size: 6px 6px; background-position: 0 0, 6px 6px;\"></div>\n</div>",
      "css": ".test-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 15px;\n    color: var(--text-normal);\n}\n.selector-row, .editor-section, .quick-add {\n    margin-bottom: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n}\nlabel {\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: var(--text-muted);\n}\n.search-wrapper {\n    display: flex;\n    gap: 8px;\n    width: 100%;\n}\n#note-search, #prop-value, #fm-editor {\n    width: 100%;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 8px;\n    font-size: 0.8rem;\n    outline: none;\n}\n#fm-editor {\n    height: 150px;\n    font-family: var(--font-monospace);\n    resize: vertical;\n    color: var(--text-accent);\n}\n#note-search:focus, #prop-value:focus, #fm-editor:focus {\n    border-color: var(--interactive-accent);\n    box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.1);\n}\n.actions { display: flex; gap: 8px; margin-bottom: 15px; }\nbutton {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 6px 12px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.8rem;\n    font-weight: 600;\n}\nbutton.secondary {\n    background: var(--background-modifier-border);\n    color: var(--text-normal);\n}\nbutton.save-btn {\n    background: var(--background-modifier-success);\n    flex: 1;\n}\n.mini-btn {\n    padding: 8px;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    cursor: pointer;\n}\n.status {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    margin-top: 10px;\n    font-style: italic;\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 8px;\n}",
      "js": "async function saveLocalState() {\n    const path = root.getElementById('note-search').value;\n    const val = root.getElementById('prop-value').value;\n    await api.saveState({ targetPath: path, propValue: val });\n}\n\nasync function handleTargetChange() {\n    const path = root.getElementById('note-search').value;\n    if (!path || path.endsWith('.md') || path === \"\") {\n        await saveLocalState();\n        await refreshFM();\n    }\n}\n\nasync function refreshAll() {\n    populateSelector();\n    await refreshFM();\n}\n\nasync function refreshFM() {\n    const editor = root.getElementById('fm-editor');\n    const path = root.getElementById('note-search').value;\n    \n    setStatus(\"Loading properties...\");\n    const fm = await api.getFrontmatter(path);\n    editor.value = JSON.stringify(fm, null, 2);\n    setStatus(\"Properties loaded\");\n}\n\nasync function saveYAML() {\n    const path = root.getElementById('note-search').value;\n    const content = root.getElementById('fm-editor').value;\n    \n    try {\n        const data = JSON.parse(content);\n        setStatus(\"Saving to YAML...\");\n        await api.updateFrontmatter(data, path);\n        new Notice(\"YAML properties updated!\");\n        setStatus(\"Saved successfully\");\n        refreshFM();\n    } catch (e) {\n        new Notice(\"Error: Invalid JSON format\");\n        setStatus(\"Error: Invalid JSON\");\n    }\n}\n\nasync function addProperty() {\n    const path = root.getElementById('note-search').value;\n    const val = root.getElementById('prop-value').value || (\"Test \" + Math.floor(Math.random() * 100));\n    \n    setStatus(\"Updating...\");\n    await api.updateFrontmatter({ \n        test_obsidget: val,\n        last_update: new Date().toLocaleTimeString()\n    }, path);\n    \n    new Notice(\"Property added!\");\n    refreshFM();\n}\n\nfunction populateSelector() {\n    const datalist = root.getElementById('note-list');\n    const files = api.getFiles('md');\n    \n    datalist.innerHTML = '<option value=\"\">Current Note</option>';\n    files.forEach(file => {\n        const option = document.createElement('option');\n        option.value = file;\n        datalist.appendChild(option);\n    });\n    setStatus(\"Note list updated\");\n}\n\nfunction setStatus(msg) {\n    root.getElementById('status-bar').innerText = msg;\n}\n\nasync function init() {\n    populateSelector();\n    \n    const saved = await api.getState();\n    if (saved) {\n        if (saved.targetPath) root.getElementById('note-search').value = saved.targetPath;\n        if (saved.propValue) root.getElementById('prop-value').value = saved.propValue;\n    }\n    \n    refreshFM();\n}\n\ninit();",
      "source": "obsidget"
    }
  ],
  "widgetState": {}
}